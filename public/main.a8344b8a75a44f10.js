(self.webpackChunkfront=self.webpackChunkfront||[]).push([[179],{166:(kd,ws,Vi)=>{"use strict";function Fn(r){return"function"==typeof r}function zr(r){const s=r(u=>{Error.call(u),u.stack=(new Error).stack});return s.prototype=Object.create(Error.prototype),s.prototype.constructor=s,s}const Hc=zr(r=>function(s){r(this),this.message=s?`${s.length} errors occurred during unsubscription:\n${s.map((u,d)=>`${d+1}) ${u.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=s});function rt(r,o){if(r){const s=r.indexOf(o);0<=s&&r.splice(s,1)}}class ce{constructor(o){this.initialTeardown=o,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let o;if(!this.closed){this.closed=!0;const{_parentage:s}=this;if(s)if(this._parentage=null,Array.isArray(s))for(const m of s)m.remove(this);else s.remove(this);const{initialTeardown:u}=this;if(Fn(u))try{u()}catch(m){o=m instanceof Hc?m.errors:[m]}const{_finalizers:d}=this;if(d){this._finalizers=null;for(const m of d)try{Rt(m)}catch(x){o=o??[],x instanceof Hc?o=[...o,...x.errors]:o.push(x)}}if(o)throw new Hc(o)}}add(o){var s;if(o&&o!==this)if(this.closed)Rt(o);else{if(o instanceof ce){if(o.closed||o._hasParent(this))return;o._addParent(this)}(this._finalizers=null!==(s=this._finalizers)&&void 0!==s?s:[]).push(o)}}_hasParent(o){const{_parentage:s}=this;return s===o||Array.isArray(s)&&s.includes(o)}_addParent(o){const{_parentage:s}=this;this._parentage=Array.isArray(s)?(s.push(o),s):s?[s,o]:o}_removeParent(o){const{_parentage:s}=this;s===o?this._parentage=null:Array.isArray(s)&&rt(s,o)}remove(o){const{_finalizers:s}=this;s&&rt(s,o),o instanceof ce&&o._removeParent(this)}}ce.EMPTY=(()=>{const r=new ce;return r.closed=!0,r})();const Jo=ce.EMPTY;function ji(r){return r instanceof ce||r&&"closed"in r&&Fn(r.remove)&&Fn(r.add)&&Fn(r.unsubscribe)}function Rt(r){Fn(r)?r():r.unsubscribe()}const ro={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},io={setTimeout(r,o,...s){const{delegate:u}=io;return u?.setTimeout?u.setTimeout(r,o,...s):setTimeout(r,o,...s)},clearTimeout(r){const{delegate:o}=io;return(o?.clearTimeout||clearTimeout)(r)},delegate:void 0};function Gs(r){io.setTimeout(()=>{const{onUnhandledError:o}=ro;if(!o)throw r;o(r)})}function Ql(){}const Da=oo("C",void 0,void 0);function oo(r,o,s){return{kind:r,value:o,error:s}}let bs=null;function Es(r){if(ro.useDeprecatedSynchronousErrorHandling){const o=!bs;if(o&&(bs={errorThrown:!1,error:null}),r(),o){const{errorThrown:s,error:u}=bs;if(bs=null,s)throw u}}else r()}class Sa extends ce{constructor(o){super(),this.isStopped=!1,o?(this.destination=o,ji(o)&&o.add(this)):this.destination=Od}static create(o,s,u){return new pl(o,s,u)}next(o){this.isStopped?kr(function Ma(r){return oo("N",r,void 0)}(o),this):this._next(o)}error(o){this.isStopped?kr(function Qu(r){return oo("E",void 0,r)}(o),this):(this.isStopped=!0,this._error(o))}complete(){this.isStopped?kr(Da,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(o){this.destination.next(o)}_error(o){try{this.destination.error(o)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Qo=Function.prototype.bind;function ie(r,o){return Qo.call(r,o)}class ln{constructor(o){this.partialObserver=o}next(o){const{partialObserver:s}=this;if(s.next)try{s.next(o)}catch(u){es(u)}}error(o){const{partialObserver:s}=this;if(s.error)try{s.error(o)}catch(u){es(u)}else es(o)}complete(){const{partialObserver:o}=this;if(o.complete)try{o.complete()}catch(s){es(s)}}}class pl extends Sa{constructor(o,s,u){let d;if(super(),Fn(o)||!o)d={next:o??void 0,error:s??void 0,complete:u??void 0};else{let m;this&&ro.useDeprecatedNextContext?(m=Object.create(o),m.unsubscribe=()=>this.unsubscribe(),d={next:o.next&&ie(o.next,m),error:o.error&&ie(o.error,m),complete:o.complete&&ie(o.complete,m)}):d=o}this.destination=new ln(d)}}function es(r){ro.useDeprecatedSynchronousErrorHandling?function eh(r){ro.useDeprecatedSynchronousErrorHandling&&bs&&(bs.errorThrown=!0,bs.error=r)}(r):Gs(r)}function kr(r,o){const{onStoppedNotification:s}=ro;s&&io.setTimeout(()=>s(r,o))}const Od={closed:!0,next:Ql,error:function At(r){throw r},complete:Ql},Aa="function"==typeof Symbol&&Symbol.observable||"@@observable";function qs(r){return r}function Ia(r){return 0===r.length?qs:1===r.length?r[0]:function(s){return r.reduce((u,d)=>d(u),s)}}let ft=(()=>{class r{constructor(s){s&&(this._subscribe=s)}lift(s){const u=new r;return u.source=this,u.operator=s,u}subscribe(s,u,d){const m=function ts(r){return r&&r instanceof Sa||function Cs(r){return r&&Fn(r.next)&&Fn(r.error)&&Fn(r.complete)}(r)&&ji(r)}(s)?s:new pl(s,u,d);return Es(()=>{const{operator:x,source:b}=this;m.add(x?x.call(m,b):b?this._subscribe(m):this._trySubscribe(m))}),m}_trySubscribe(s){try{return this._subscribe(s)}catch(u){s.error(u)}}forEach(s,u){return new(u=et(u))((d,m)=>{const x=new pl({next:b=>{try{s(b)}catch(D){m(D),x.unsubscribe()}},error:m,complete:d});this.subscribe(x)})}_subscribe(s){var u;return null===(u=this.source)||void 0===u?void 0:u.subscribe(s)}[Aa](){return this}pipe(...s){return Ia(s)(this)}toPromise(s){return new(s=et(s))((u,d)=>{let m;this.subscribe(x=>m=x,x=>d(x),()=>u(m))})}}return r.create=o=>new r(o),r})();function et(r){var o;return null!==(o=r??ro.Promise)&&void 0!==o?o:Promise}const gl=zr(r=>function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let xe=(()=>{class r extends ft{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(s){const u=new Ke(this,this);return u.operator=s,u}_throwIfClosed(){if(this.closed)throw new gl}next(s){Es(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const u of this.currentObservers)u.next(s)}})}error(s){Es(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=s;const{observers:u}=this;for(;u.length;)u.shift().error(s)}})}complete(){Es(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:s}=this;for(;s.length;)s.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var s;return(null===(s=this.observers)||void 0===s?void 0:s.length)>0}_trySubscribe(s){return this._throwIfClosed(),super._trySubscribe(s)}_subscribe(s){return this._throwIfClosed(),this._checkFinalizedStatuses(s),this._innerSubscribe(s)}_innerSubscribe(s){const{hasError:u,isStopped:d,observers:m}=this;return u||d?Jo:(this.currentObservers=null,m.push(s),new ce(()=>{this.currentObservers=null,rt(m,s)}))}_checkFinalizedStatuses(s){const{hasError:u,thrownError:d,isStopped:m}=this;u?s.error(d):m&&s.complete()}asObservable(){const s=new ft;return s.source=this,s}}return r.create=(o,s)=>new Ke(o,s),r})();class Ke extends xe{constructor(o,s){super(),this.destination=o,this.source=s}next(o){var s,u;null===(u=null===(s=this.destination)||void 0===s?void 0:s.next)||void 0===u||u.call(s,o)}error(o){var s,u;null===(u=null===(s=this.destination)||void 0===s?void 0:s.error)||void 0===u||u.call(s,o)}complete(){var o,s;null===(s=null===(o=this.destination)||void 0===o?void 0:o.complete)||void 0===s||s.call(o)}_subscribe(o){var s,u;return null!==(u=null===(s=this.source)||void 0===s?void 0:s.subscribe(o))&&void 0!==u?u:Jo}}function fi(r){return Fn(r?.lift)}function Zr(r){return o=>{if(fi(o))return o.lift(function(s){try{return r(s,this)}catch(u){this.error(u)}});throw new TypeError("Unable to lift unknown Observable type")}}function vr(r,o,s,u,d){return new vi(r,o,s,u,d)}class vi extends Sa{constructor(o,s,u,d,m,x){super(o),this.onFinalize=m,this.shouldUnsubscribe=x,this._next=s?function(b){try{s(b)}catch(D){o.error(D)}}:super._next,this._error=d?function(b){try{d(b)}catch(D){o.error(D)}finally{this.unsubscribe()}}:super._error,this._complete=u?function(){try{u()}catch(b){o.error(b)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var o;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:s}=this;super.unsubscribe(),!s&&(null===(o=this.onFinalize)||void 0===o||o.call(this))}}}function rn(r,o){return Zr((s,u)=>{let d=0;s.subscribe(vr(u,m=>{u.next(r.call(o,m,d++))}))})}function En(r){return this instanceof En?(this.v=r,this):new En(r)}function Vn(r,o,s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var d,u=s.apply(r,o||[]),m=[];return d={},x("next"),x("throw"),x("return"),d[Symbol.asyncIterator]=function(){return this},d;function x(Y){u[Y]&&(d[Y]=function(re){return new Promise(function(pe,Ce){m.push([Y,re,pe,Ce])>1||b(Y,re)})})}function b(Y,re){try{!function D(Y){Y.value instanceof En?Promise.resolve(Y.value.v).then(P,F):V(m[0][2],Y)}(u[Y](re))}catch(pe){V(m[0][3],pe)}}function P(Y){b("next",Y)}function F(Y){b("throw",Y)}function V(Y,re){Y(re),m.shift(),m.length&&b(m[0][0],m[0][1])}}function Qr(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,o=r[Symbol.asyncIterator];return o?o.call(r):(r=function _t(r){var o="function"==typeof Symbol&&Symbol.iterator,s=o&&r[o],u=0;if(s)return s.call(r);if(r&&"number"==typeof r.length)return{next:function(){return r&&u>=r.length&&(r=void 0),{value:r&&r[u++],done:!r}}};throw new TypeError(o?"Object is not iterable.":"Symbol.iterator is not defined.")}(r),s={},u("next"),u("throw"),u("return"),s[Symbol.asyncIterator]=function(){return this},s);function u(m){s[m]=r[m]&&function(x){return new Promise(function(b,D){!function d(m,x,b,D){Promise.resolve(D).then(function(P){m({value:P,done:b})},x)}(b,D,(x=r[m](x)).done,x.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const Me=r=>r&&"number"==typeof r.length&&"function"!=typeof r;function je(r){return Fn(r?.then)}function He(r){return Fn(r[Aa])}function Be(r){return Symbol.asyncIterator&&Fn(r?.[Symbol.asyncIterator])}function Ie(r){return new TypeError(`You provided ${null!==r&&"object"==typeof r?"an invalid object":`'${r}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const vt=function Le(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function cn(r){return Fn(r?.[vt])}function Je(r){return Vn(this,arguments,function*(){const s=r.getReader();try{for(;;){const{value:u,done:d}=yield En(s.read());if(d)return yield En(void 0);yield yield En(u)}}finally{s.releaseLock()}})}function Nt(r){return Fn(r?.getReader)}function vn(r){if(r instanceof ft)return r;if(null!=r){if(He(r))return function hr(r){return new ft(o=>{const s=r[Aa]();if(Fn(s.subscribe))return s.subscribe(o);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(r);if(Me(r))return function dr(r){return new ft(o=>{for(let s=0;s<r.length&&!o.closed;s++)o.next(r[s]);o.complete()})}(r);if(je(r))return function nr(r){return new ft(o=>{r.then(s=>{o.closed||(o.next(s),o.complete())},s=>o.error(s)).then(null,Gs)})}(r);if(Be(r))return Or(r);if(cn(r))return function Bo(r){return new ft(o=>{for(const s of r)if(o.next(s),o.closed)return;o.complete()})}(r);if(Nt(r))return function Ri(r){return Or(Je(r))}(r)}throw Ie(r)}function Or(r){return new ft(o=>{(function ai(r,o){var s,u,d,m;return function tt(r,o,s,u){return new(s||(s=Promise))(function(m,x){function b(F){try{P(u.next(F))}catch(V){x(V)}}function D(F){try{P(u.throw(F))}catch(V){x(V)}}function P(F){F.done?m(F.value):function d(m){return m instanceof s?m:new s(function(x){x(m)})}(F.value).then(b,D)}P((u=u.apply(r,o||[])).next())})}(this,void 0,void 0,function*(){try{for(s=Qr(r);!(u=yield s.next()).done;)if(o.next(u.value),o.closed)return}catch(x){d={error:x}}finally{try{u&&!u.done&&(m=s.return)&&(yield m.call(s))}finally{if(d)throw d.error}}o.complete()})})(r,o).catch(s=>o.error(s))})}function lo(r,o,s,u=0,d=!1){const m=o.schedule(function(){s(),d?r.add(this.schedule(null,u)):this.unsubscribe()},u);if(r.add(m),!d)return m}function Vr(r,o,s=1/0){return Fn(o)?Vr((u,d)=>rn((m,x)=>o(u,m,d,x))(vn(r(u,d))),s):("number"==typeof o&&(s=o),Zr((u,d)=>function Xs(r,o,s,u,d,m,x,b){const D=[];let P=0,F=0,V=!1;const Y=()=>{V&&!D.length&&!P&&o.complete()},re=Ce=>P<u?pe(Ce):D.push(Ce),pe=Ce=>{m&&o.next(Ce),P++;let ze=!1;vn(s(Ce,F++)).subscribe(vr(o,$e=>{d?.($e),m?re($e):o.next($e)},()=>{ze=!0},void 0,()=>{if(ze)try{for(P--;D.length&&P<u;){const $e=D.shift();x?lo(o,x,()=>pe($e)):pe($e)}Y()}catch($e){o.error($e)}}))};return r.subscribe(vr(o,re,()=>{V=!0,Y()})),()=>{b?.()}}(u,d,r,s)))}function ka(r=1/0){return Vr(qs,r)}const ki=new ft(r=>r.complete());function th(r){return r[r.length-1]}function Vp(r){return Fn(th(r))?r.pop():void 0}function Ds(r){return function k_(r){return r&&Fn(r.schedule)}(th(r))?r.pop():void 0}function Gc(r,o=0){return Zr((s,u)=>{s.subscribe(vr(u,d=>lo(u,r,()=>u.next(d),o),()=>lo(u,r,()=>u.complete(),o),d=>lo(u,r,()=>u.error(d),o)))})}function Ys(r,o=0){return Zr((s,u)=>{u.add(r.schedule(()=>s.subscribe(u),o))})}function rh(r,o){if(!r)throw new Error("Iterable cannot be null");return new ft(s=>{lo(s,o,()=>{const u=r[Symbol.asyncIterator]();lo(s,o,()=>{u.next().then(d=>{d.done?s.complete():s.next(d.value)})},0,!0)})})}function jr(r,o){return o?function ih(r,o){if(null!=r){if(He(r))return function O_(r,o){return vn(r).pipe(Ys(o),Gc(o))}(r,o);if(Me(r))return function Up(r,o){return new ft(s=>{let u=0;return o.schedule(function(){u===r.length?s.complete():(s.next(r[u++]),s.closed||this.schedule())})})}(r,o);if(je(r))return function L_(r,o){return vn(r).pipe(Ys(o),Gc(o))}(r,o);if(Be(r))return rh(r,o);if(cn(r))return function nh(r,o){return new ft(s=>{let u;return lo(s,o,()=>{u=r[vt](),lo(s,o,()=>{let d,m;try{({value:d,done:m}=u.next())}catch(x){return void s.error(x)}m?s.complete():s.next(d)},0,!0)}),()=>Fn(u?.return)&&u.return()})}(r,o);if(Nt(r))return function Ld(r,o){return rh(Je(r),o)}(r,o)}throw Ie(r)}(r,o):vn(r)}function Ct(r,o,...s){if(!0===o)return void r();if(!1===o)return;const u=new pl({next:()=>{u.unsubscribe(),r()}});return o(...s).subscribe(u)}function Mt(r){for(let o in r)if(r[o]===Mt)return o;throw Error("Could not find renamed property on target object.")}function rs(r,o){for(const s in o)o.hasOwnProperty(s)&&!r.hasOwnProperty(s)&&(r[s]=o[s])}function jn(r){if("string"==typeof r)return r;if(Array.isArray(r))return"["+r.map(jn).join(", ")+"]";if(null==r)return""+r;if(r.overriddenName)return`${r.overriddenName}`;if(r.name)return`${r.name}`;const o=r.toString();if(null==o)return""+o;const s=o.indexOf("\n");return-1===s?o:o.substring(0,s)}function yl(r,o){return null==r||""===r?null===o?"":o:null==o||""===o?r:r+" "+o}const $p=Mt({__forward_ref__:Mt});function rr(r){return r.__forward_ref__=rr,r.toString=function(){return jn(this())},r}function jt(r){return ec(r)?r():r}function ec(r){return"function"==typeof r&&r.hasOwnProperty($p)&&r.__forward_ref__===rr}class Ue extends Error{constructor(o,s){super(function vl(r,o){return`NG0${Math.abs(r)}${o?": "+o.trim():""}`}(o,s)),this.code=o}}function un(r){return"string"==typeof r?r:null==r?"":String(r)}function xt(r,o){throw new Ue(-201,!1)}function Ot(r,o){null==r&&function ht(r,o,s,u){throw new Error(`ASSERTION ERROR: ${r}`+(null==u?"":` [Expected=> ${s} ${u} ${o} <=Actual]`))}(o,r,null,"!=")}function Ut(r){return{token:r.token,providedIn:r.providedIn||null,factory:r.factory,value:void 0}}function wi(r){return{providers:r.providers||[],imports:r.imports||[]}}function bi(r){return Gp(r,ic)||Gp(r,oc)}function Gp(r,o){return r.hasOwnProperty(o)?r[o]:null}function is(r){return r&&(r.hasOwnProperty(Xc)||r.hasOwnProperty(Bd))?r[Xc]:null}const ic=Mt({\u0275prov:Mt}),Xc=Mt({\u0275inj:Mt}),oc=Mt({ngInjectableDef:Mt}),Bd=Mt({ngInjectorDef:Mt});var $t=(()=>(($t=$t||{})[$t.Default=0]="Default",$t[$t.Host=1]="Host",$t[$t.Self=2]="Self",$t[$t.SkipSelf=4]="SkipSelf",$t[$t.Optional=8]="Optional",$t))();let Yc;function yt(r){const o=Yc;return Yc=r,o}function sh(r,o,s){const u=bi(r);return u&&"root"==u.providedIn?void 0===u.value?u.value=u.factory():u.value:s&$t.Optional?null:void 0!==o?o:void xt(jn(r))}function xr(r){return{toString:r}.toString()}var $r=(()=>(($r=$r||{})[$r.OnPush=0]="OnPush",$r[$r.Default=1]="Default",$r))(),Yn=(()=>{return(r=Yn||(Yn={}))[r.Emulated=0]="Emulated",r[r.None=2]="None",r[r.ShadowDom=3]="ShadowDom",Yn;var r})();const Sn=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),ir={},Un=[],ac=Mt({\u0275cmp:Mt}),os=Mt({\u0275dir:Mt}),La=Mt({\u0275pipe:Mt}),ss=Mt({\u0275mod:Mt}),on=Mt({\u0275fac:Mt}),Jc=Mt({__NG_ELEMENT_ID__:Mt});let Vd=0;function uo(r){return xr(()=>{const s=!0===r.standalone,u={},d={type:r.type,providersResolver:null,decls:r.decls,vars:r.vars,factory:null,template:r.template||null,consts:r.consts||null,ngContentSelectors:r.ngContentSelectors,hostBindings:r.hostBindings||null,hostVars:r.hostVars||0,hostAttrs:r.hostAttrs||null,contentQueries:r.contentQueries||null,declaredInputs:u,inputs:null,outputs:null,exportAs:r.exportAs||null,onPush:r.changeDetection===$r.OnPush,directiveDefs:null,pipeDefs:null,standalone:s,dependencies:s&&r.dependencies||null,getStandaloneInjector:null,selectors:r.selectors||Un,viewQuery:r.viewQuery||null,features:r.features||null,data:r.data||{},encapsulation:r.encapsulation||Yn.Emulated,id:"c"+Vd++,styles:r.styles||Un,_:null,setInput:null,schemas:r.schemas||null,tView:null},m=r.dependencies,x=r.features;return d.inputs=Ud(r.inputs,u),d.outputs=Ud(r.outputs),x&&x.forEach(b=>b(d)),d.directiveDefs=m?()=>("function"==typeof m?m():m).map(jd).filter(xl):null,d.pipeDefs=m?()=>("function"==typeof m?m():m).map($i).filter(xl):null,d})}function jd(r){return Pn(r)||li(r)}function xl(r){return null!==r}function Yr(r){return xr(()=>({type:r.type,bootstrap:r.bootstrap||Un,declarations:r.declarations||Un,imports:r.imports||Un,exports:r.exports||Un,transitiveCompileScopes:null,schemas:r.schemas||null,id:r.id||null}))}function Ud(r,o){if(null==r)return ir;const s={};for(const u in r)if(r.hasOwnProperty(u)){let d=r[u],m=d;Array.isArray(d)&&(m=d[1],d=d[0]),s[d]=u,o&&(o[d]=m)}return s}const Qt=uo;function Pn(r){return r[ac]||null}function li(r){return r[os]||null}function $i(r){return r[La]||null}function Hi(r,o){const s=r[ss]||null;if(!s&&!0===o)throw new Error(`Type ${jn(r)} does not have '\u0275mod' property.`);return s}function Ei(r){return Array.isArray(r)&&"object"==typeof r[1]}function wo(r){return Array.isArray(r)&&!0===r[1]}function Hd(r){return 0!=(8&r.flags)}function ch(r){return 2==(2&r.flags)}function uh(r){return 1==(1&r.flags)}function ho(r){return null!==r.template}function Zp(r){return 0!=(256&r[2])}function Fa(r,o){return r.hasOwnProperty(on)?r[on]:null}class ph{constructor(o,s,u){this.previousValue=o,this.currentValue=s,this.firstChange=u}isFirstChange(){return this.firstChange}}function Wi(){return Kd}function Kd(r){return r.type.prototype.ngOnChanges&&(r.setInput=uc),tm}function tm(){const r=Na(this),o=r?.current;if(o){const s=r.previous;if(s===ir)r.previous=o;else for(let u in o)s[u]=o[u];r.current=null,this.ngOnChanges(o)}}function uc(r,o,s,u){const d=Na(r)||function nm(r,o){return r[Jd]=o}(r,{previous:ir,current:null}),m=d.current||(d.current={}),x=d.previous,b=this.declaredInputs[s],D=x[b];m[b]=new ph(D&&D.currentValue,o,x===ir),r[u]=o}Wi.ngInherit=!0;const Jd="__ngSimpleChanges__";function Na(r){return r[Jd]||null}function Pr(r){for(;Array.isArray(r);)r=r[0];return r}function fr(r,o){return Pr(o[r])}function Zi(r,o){return Pr(o[r.index])}function ou(r,o){return r.data[o]}function Xi(r,o){const s=o[r];return Ei(s)?s:s[0]}function hc(r){return 64==(64&r[2])}function cs(r,o){return null==o?null:r[o]}function su(r){r[18]=0}function N(r,o){r[5]+=o;let s=r,u=r[3];for(;null!==u&&(1===o&&1===s[5]||-1===o&&0===s[5]);)u[5]+=o,s=u,u=u[3]}const M={lFrame:G_(null),bindingsEnabled:!0};function hn(){return M.bindingsEnabled}function Ne(){return M.lFrame.lView}function Wn(){return M.lFrame.tView}function Ci(){let r=l1();for(;null!==r&&64===r.type;)r=r.parent;return r}function l1(){return M.lFrame.currentTNode}function Ps(r,o){const s=M.lFrame;s.currentTNode=r,s.isParent=o}function rf(){return M.lFrame.isParent}function Ba(){return M.lFrame.bindingIndex++}function lu(r,o){const s=M.lFrame;s.bindingIndex=s.bindingRootIndex=r,af(o)}function af(r){M.lFrame.currentDirectiveIndex=r}function $_(r){M.lFrame.currentQueryIndex=r}function h1(r){const o=r[1];return 2===o.type?o.declTNode:1===o.type?r[6]:null}function gh(r,o,s){if(s&$t.SkipSelf){let d=o,m=r;for(;!(d=d.parent,null!==d||s&$t.Host||(d=h1(m),null===d||(m=m[15],10&d.type))););if(null===d)return!1;o=d,r=m}const u=M.lFrame=d1();return u.currentTNode=o,u.lView=r,!0}function H_(r){const o=d1(),s=r[1];M.lFrame=o,o.currentTNode=s.firstChild,o.lView=r,o.tView=s,o.contextLView=r,o.bindingIndex=s.bindingStartIndex,o.inI18n=!1}function d1(){const r=M.lFrame,o=null===r?null:r.child;return null===o?G_(r):o}function G_(r){const o={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:r,child:null,inI18n:!1};return null!==r&&(r.child=o),o}function f1(){const r=M.lFrame;return M.lFrame=r.parent,r.currentTNode=null,r.lView=null,r}const sm=f1;function _h(){const r=f1();r.isParent=!0,r.tView=null,r.selectedIndex=-1,r.contextLView=null,r.elementDepthCount=0,r.currentDirectiveIndex=-1,r.currentNamespace=null,r.bindingRootIndex=-1,r.bindingIndex=-1,r.currentQueryIndex=0}function ei(){return M.lFrame.selectedIndex}function ja(r){M.lFrame.selectedIndex=r}function Rr(){const r=M.lFrame;return ou(r.tView,r.selectedIndex)}function uf(r,o){for(let s=o.directiveStart,u=o.directiveEnd;s<u;s++){const m=r.data[s].type.prototype,{ngAfterContentInit:x,ngAfterContentChecked:b,ngAfterViewInit:D,ngAfterViewChecked:P,ngOnDestroy:F}=m;x&&(r.contentHooks||(r.contentHooks=[])).push(-s,x),b&&((r.contentHooks||(r.contentHooks=[])).push(s,b),(r.contentCheckHooks||(r.contentCheckHooks=[])).push(s,b)),D&&(r.viewHooks||(r.viewHooks=[])).push(-s,D),P&&((r.viewHooks||(r.viewHooks=[])).push(s,P),(r.viewCheckHooks||(r.viewCheckHooks=[])).push(s,P)),null!=F&&(r.destroyHooks||(r.destroyHooks=[])).push(s,F)}}function uu(r,o,s){W_(r,o,3,s)}function yh(r,o,s,u){(3&r[2])===s&&W_(r,o,s,u)}function vh(r,o){let s=r[2];(3&s)===o&&(s&=2047,s+=1,r[2]=s)}function W_(r,o,s,u){const m=u??-1,x=o.length-1;let b=0;for(let D=void 0!==u?65535&r[18]:0;D<x;D++)if("number"==typeof o[D+1]){if(b=o[D],null!=u&&b>=u)break}else o[D]<0&&(r[18]+=65536),(b<m||-1==m)&&(_1(r,s,o,D),r[18]=(4294901760&r[18])+D+2),D++}function _1(r,o,s,u){const d=s[u]<0,m=s[u+1],b=r[d?-s[u]:s[u]];if(d){if(r[2]>>11<r[18]>>16&&(3&r[2])===o){r[2]+=2048;try{m.call(b)}finally{}}}else try{m.call(b)}finally{}}class hf{constructor(o,s,u){this.factory=o,this.resolving=!1,this.canSeeViewProviders=s,this.injectImpl=u}}function ff(r,o,s){let u=0;for(;u<s.length;){const d=s[u];if("number"==typeof d){if(0!==d)break;u++;const m=s[u++],x=s[u++],b=s[u++];r.setAttribute(o,x,b,m)}else{const m=d,x=s[++u];Y_(m)?r.setProperty(o,m,x):r.setAttribute(o,m,x),u++}}return u}function X_(r){return 3===r||4===r||6===r}function Y_(r){return 64===r.charCodeAt(0)}function pf(r,o){if(null!==o&&0!==o.length)if(null===r||0===r.length)r=o.slice();else{let s=-1;for(let u=0;u<o.length;u++){const d=o[u];"number"==typeof d?s=d:0===s||K_(r,s,d,null,-1===s||2===s?o[++u]:null)}}return r}function K_(r,o,s,u,d){let m=0,x=r.length;if(-1===o)x=-1;else for(;m<r.length;){const b=r[m++];if("number"==typeof b){if(b===o){x=-1;break}if(b>o){x=m-1;break}}}for(;m<r.length;){const b=r[m];if("number"==typeof b)break;if(b===s){if(null===u)return void(null!==d&&(r[m+1]=d));if(u===r[m+1])return void(r[m+2]=d)}m++,null!==u&&m++,null!==d&&m++}-1!==x&&(r.splice(x,0,o),m=x+1),r.splice(m++,0,s),null!==u&&r.splice(m++,0,u),null!==d&&r.splice(m++,0,d)}function hu(r){return-1!==r}function du(r){return 32767&r}function xh(r,o){let s=function b1(r){return r>>16}(r),u=o;for(;s>0;)u=u[15],s--;return u}let lm=!0;function mf(r){const o=lm;return lm=r,o}let E1=0;const br={};function wh(r,o){const s=ey(r,o);if(-1!==s)return s;const u=o[1];u.firstCreatePass&&(r.injectorIndex=o.length,mc(u.data,r),mc(o,null),mc(u.blueprint,null));const d=cm(r,o),m=r.injectorIndex;if(hu(d)){const x=du(d),b=xh(d,o),D=b[1].data;for(let P=0;P<8;P++)o[m+P]=b[x+P]|D[x+P]}return o[m+8]=d,m}function mc(r,o){r.push(0,0,0,0,0,0,0,0,o)}function ey(r,o){return-1===r.injectorIndex||r.parent&&r.parent.injectorIndex===r.injectorIndex||null===o[r.injectorIndex+8]?-1:r.injectorIndex}function cm(r,o){if(r.parent&&-1!==r.parent.injectorIndex)return r.parent.injectorIndex;let s=0,u=null,d=o;for(;null!==d;){if(u=ty(d),null===u)return-1;if(s++,d=d[15],-1!==u.injectorIndex)return u.injectorIndex|s<<16}return-1}function um(r,o,s){!function cD(r,o,s){let u;"string"==typeof s?u=s.charCodeAt(0)||0:s.hasOwnProperty(Jc)&&(u=s[Jc]),null==u&&(u=s[Jc]=E1++);const d=255&u;o.data[r+(d>>5)]|=1<<d}(r,o,s)}function C1(r,o,s){if(s&$t.Optional||void 0!==r)return r;xt()}function T1(r,o,s,u){if(s&$t.Optional&&void 0===u&&(u=null),0==(s&($t.Self|$t.Host))){const d=r[9],m=yt(void 0);try{return d?d.get(o,u,s&$t.Optional):sh(o,u,s&$t.Optional)}finally{yt(m)}}return C1(u,0,s)}function hm(r,o,s,u=$t.Default,d){if(null!==r){if(1024&o[2]){const x=function S1(r,o,s,u,d){let m=r,x=o;for(;null!==m&&null!==x&&1024&x[2]&&!(256&x[2]);){const b=D1(m,x,s,u|$t.Self,br);if(b!==br)return b;let D=m.parent;if(!D){const P=x[21];if(P){const F=P.get(s,br,u);if(F!==br)return F}D=ty(x),x=x[15]}m=D}return d}(r,o,s,u,br);if(x!==br)return x}const m=D1(r,o,s,u,br);if(m!==br)return m}return T1(o,s,u,d)}function D1(r,o,s,u,d){const m=function fm(r){if("string"==typeof r)return r.charCodeAt(0)||0;const o=r.hasOwnProperty(Jc)?r[Jc]:void 0;return"number"==typeof o?o>=0?255&o:bh:o}(s);if("function"==typeof m){if(!gh(o,r,u))return u&$t.Host?C1(d,0,u):T1(o,s,u,d);try{const x=m(u);if(null!=x||u&$t.Optional)return x;xt()}finally{sm()}}else if("number"==typeof m){let x=null,b=ey(r,o),D=-1,P=u&$t.Host?o[16][6]:null;for((-1===b||u&$t.SkipSelf)&&(D=-1===b?cm(r,o):o[b+8],-1!==D&&Tl(u,!1)?(x=o[1],b=du(D),o=xh(D,o)):b=-1);-1!==b;){const F=o[1];if(M1(m,b,F.data)){const V=hD(b,o,s,x,u,P);if(V!==br)return V}D=o[b+8],-1!==D&&Tl(u,o[1].data[b+8]===P)&&M1(m,b,o)?(x=F,b=du(D),o=xh(D,o)):b=-1}}return d}function hD(r,o,s,u,d,m){const x=o[1],b=x.data[r+8],F=function dm(r,o,s,u,d){const m=r.providerIndexes,x=o.data,b=1048575&m,D=r.directiveStart,F=m>>20,Y=d?b+F:r.directiveEnd;for(let re=u?b:b+F;re<Y;re++){const pe=x[re];if(re<D&&s===pe||re>=D&&pe.type===s)return re}if(d){const re=x[D];if(re&&ho(re)&&re.type===s)return D}return null}(b,x,s,null==u?ch(b)&&lm:u!=x&&0!=(3&b.type),d&$t.Host&&m===b);return null!==F?bo(o,x,F,b):br}function bo(r,o,s,u){let d=r[s];const m=o.data;if(function aD(r){return r instanceof hf}(d)){const x=d;x.resolving&&function Fd(r,o){const s=o?`. Dependency path: ${o.join(" > ")} > ${r}`:"";throw new Ue(-200,`Circular dependency in DI detected for ${r}${s}`)}(function qn(r){return"function"==typeof r?r.name||r.toString():"object"==typeof r&&null!=r&&"function"==typeof r.type?r.type.name||r.type.toString():un(r)}(m[s]));const b=mf(x.canSeeViewProviders);x.resolving=!0;const D=x.injectImpl?yt(x.injectImpl):null;gh(r,u,$t.Default);try{d=r[s]=x.factory(void 0,m,r,u),o.firstCreatePass&&s>=u.directiveStart&&function cu(r,o,s){const{ngOnChanges:u,ngOnInit:d,ngDoCheck:m}=o.type.prototype;if(u){const x=Kd(o);(s.preOrderHooks||(s.preOrderHooks=[])).push(r,x),(s.preOrderCheckHooks||(s.preOrderCheckHooks=[])).push(r,x)}d&&(s.preOrderHooks||(s.preOrderHooks=[])).push(0-r,d),m&&((s.preOrderHooks||(s.preOrderHooks=[])).push(r,m),(s.preOrderCheckHooks||(s.preOrderCheckHooks=[])).push(r,m))}(s,m[s],o)}finally{null!==D&&yt(D),mf(b),x.resolving=!1,sm()}}return d}function M1(r,o,s){return!!(s[o+(r>>5)]&1<<r)}function Tl(r,o){return!(r&$t.Self||r&$t.Host&&o)}class Eo{constructor(o,s){this._tNode=o,this._lView=s}get(o,s,u){return hm(this._tNode,this._lView,o,u,s)}}function bh(){return new Eo(Ci(),Ne())}function Ti(r){return xr(()=>{const o=r.prototype.constructor,s=o[on]||Qe(o),u=Object.prototype;let d=Object.getPrototypeOf(r.prototype).constructor;for(;d&&d!==u;){const m=d[on]||Qe(d);if(m&&m!==s)return m;d=Object.getPrototypeOf(d)}return m=>new m})}function Qe(r){return ec(r)?()=>{const o=Qe(jt(r));return o&&o()}:Fa(r)}function ty(r){const o=r[1],s=o.type;return 2===s?o.declTNode:1===s?r[6]:null}const nt="__parameters__";function _c(r,o,s){return xr(()=>{const u=function ny(r){return function(...s){if(r){const u=r(...s);for(const d in u)this[d]=u[d]}}}(o);function d(...m){if(this instanceof d)return u.apply(this,m),this;const x=new d(...m);return b.annotation=x,b;function b(D,P,F){const V=D.hasOwnProperty(nt)?D[nt]:Object.defineProperty(D,nt,{value:[]})[nt];for(;V.length<=F;)V.push(null);return(V[F]=V[F]||[]).push(x),D}}return s&&(d.prototype=Object.create(s.prototype)),d.prototype.ngMetadataName=r,d.annotationCls=d,d})}class Ht{constructor(o,s){this._desc=o,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof s?this.__NG_ELEMENT_ID__=s:void 0!==s&&(this.\u0275prov=Ut({token:this,providedIn:s.providedIn||"root",factory:s.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function ds(r,o){r.forEach(s=>Array.isArray(s)?ds(s,o):o(s))}function ry(r,o,s){o>=r.length?r.push(s):r.splice(o,0,s)}function gf(r,o){return o>=r.length-1?r.pop():r.splice(o,1)[0]}function gr(r,o,s){let u=mu(r,o);return u>=0?r[1|u]=s:(u=~u,function Re(r,o,s,u){let d=r.length;if(d==o)r.push(s,u);else if(1===d)r.push(u,r[0]),r[0]=s;else{for(d--,r.push(r[d-1],r[d]);d>o;)r[d]=r[d-2],d--;r[o]=s,r[o+1]=u}}(r,u,o,s)),u}function vf(r,o){const s=mu(r,o);if(s>=0)return r[1|s]}function mu(r,o){return function N1(r,o,s){let u=0,d=r.length>>s;for(;d!==u;){const m=u+(d-u>>1),x=r[m<<s];if(o===x)return m<<s;x>o?d=m:u=m+1}return~(d<<s)}(r,o,1)}const gu={},Ha="__NG_DI_FLAG__",sa="ngTempTokenPath",vm=/\n/gm,xm="__source";let _u;function fs(r){const o=_u;return _u=r,o}function oy(r,o=$t.Default){if(void 0===_u)throw new Ue(-203,!1);return null===_u?sh(r,void 0,o):_u.get(r,o&$t.Optional?null:void 0,o)}function Tt(r,o=$t.Default){return(function co(){return Yc}()||oy)(jt(r),o)}function Kr(r,o=$t.Default){return"number"!=typeof o&&(o=0|(o.optional&&8)|(o.host&&1)|(o.self&&2)|(o.skipSelf&&4)),Tt(r,o)}function Ga(r){const o=[];for(let s=0;s<r.length;s++){const u=jt(r[s]);if(Array.isArray(u)){if(0===u.length)throw new Ue(900,!1);let d,m=$t.Default;for(let x=0;x<u.length;x++){const b=u[x],D=sy(b);"number"==typeof D?-1===D?d=b.token:m|=D:d=b}o.push(Tt(d,m))}else o.push(Tt(u))}return o}function Tr(r,o){return r[Ha]=o,r.prototype[Ha]=o,r}function sy(r){return r[Ha]}const yu=Tr(_c("Optional"),8),Ml=Tr(_c("SkipSelf"),4);var Uo=(()=>((Uo=Uo||{})[Uo.Important=1]="Important",Uo[Uo.DashCase=2]="DashCase",Uo))();const wu=new Map;let Mh=0;const yy="__ngContext__";function Ki(r,o){Ei(o)?(r[yy]=o[20],function aa(r){wu.set(r[20],r)}(o)):r[yy]=o}function Am(r,o){return undefined(r,o)}function Sh(r){const o=r[3];return wo(o)?o[3]:o}function An(r){return $o(r[13])}function bf(r){return $o(r[4])}function $o(r){for(;null!==r&&!wo(r);)r=r[4];return r}function Eu(r,o,s,u,d){if(null!=u){let m,x=!1;wo(u)?m=u:Ei(u)&&(x=!0,u=u[0]);const b=Pr(u);0===r&&null!==s?null==d?Ty(o,s,b):bc(o,s,b,d||null,!0):1===r&&null!==s?bc(o,s,b,d||null,!0):2===r?function Lm(r,o,s){const u=Ef(r,o);u&&function cw(r,o,s,u){r.removeChild(o,s,u)}(r,u,o,s)}(o,b,x):3===r&&o.destroyNode(b),null!=m&&function fw(r,o,s,u,d){const m=s[7];m!==Pr(s)&&Eu(o,r,u,m,d);for(let b=10;b<s.length;b++){const D=s[b];Ah(D[1],D,r,o,u,m)}}(o,r,m,s,d)}}function yr(r,o,s){return r.createElement(o,s)}function wy(r,o){const s=r[9],u=s.indexOf(o),d=o[3];512&o[2]&&(o[2]&=-513,N(d,-1)),s.splice(u,1)}function Rm(r,o){if(r.length<=10)return;const s=10+o,u=r[s];if(u){const d=u[17];null!==d&&d!==r&&wy(d,u),o>0&&(r[s-1][4]=u[4]);const m=gf(r,10+o);!function rw(r,o){Ah(r,o,o[11],2,null,null),o[0]=null,o[6]=null}(u[1],u);const x=m[19];null!==x&&x.detachView(m[1]),u[3]=null,u[4]=null,u[2]&=-65}return u}function St(r,o){if(!(128&o[2])){const s=o[11];s.destroyNode&&Ah(r,o,s,3,null,null),function sw(r){let o=r[13];if(!o)return Pt(r[1],r);for(;o;){let s=null;if(Ei(o))s=o[13];else{const u=o[10];u&&(s=u)}if(!s){for(;o&&!o[4]&&o!==r;)Ei(o)&&Pt(o[1],o),o=o[3];null===o&&(o=r),Ei(o)&&Pt(o[1],o),s=o&&o[4]}o=s}}(o)}}function Pt(r,o){if(!(128&o[2])){o[2]&=-65,o[2]|=128,function Il(r,o){let s;if(null!=r&&null!=(s=r.destroyHooks))for(let u=0;u<s.length;u+=2){const d=o[s[u]];if(!(d instanceof hf)){const m=s[u+1];if(Array.isArray(m))for(let x=0;x<m.length;x+=2){const b=d[m[x]],D=m[x+1];try{D.call(b)}finally{}}else try{m.call(d)}finally{}}}}(r,o),function by(r,o){const s=r.cleanup,u=o[7];let d=-1;if(null!==s)for(let m=0;m<s.length-1;m+=2)if("string"==typeof s[m]){const x=s[m+1],b="function"==typeof x?x(o):Pr(o[x]),D=u[d=s[m+2]],P=s[m+3];"boolean"==typeof P?b.removeEventListener(s[m],D,P):P>=0?u[d=P]():u[d=-P].unsubscribe(),m+=2}else{const x=u[d=s[m+1]];s[m].call(x)}if(null!==u){for(let m=d+1;m<u.length;m++)(0,u[m])();o[7]=null}}(r,o),1===o[1].type&&o[11].destroy();const s=o[17];if(null!==s&&wo(o[3])){s!==o[3]&&wy(s,o);const u=o[19];null!==u&&u.detachView(r)}!function bu(r){wu.delete(r[20])}(o)}}function Ey(r,o,s){return function Cy(r,o,s){let u=o;for(;null!==u&&40&u.type;)u=(o=u).parent;if(null===u)return s[0];if(2&u.flags){const d=r.data[u.directiveStart].encapsulation;if(d===Yn.None||d===Yn.Emulated)return null}return Zi(u,s)}(r,o.parent,s)}function bc(r,o,s,u,d){r.insertBefore(o,s,u,d)}function Ty(r,o,s){r.appendChild(o,s)}function Dy(r,o,s,u,d){null!==u?bc(r,o,s,u,d):Ty(r,o,s)}function Ef(r,o){return r.parentNode(o)}let Vm,hw=function Wa(r,o,s){return 40&r.type?Zi(r,s):null};function Do(r,o,s,u){const d=Ey(r,u,o),m=o[11],b=function My(r,o,s){return hw(r,o,s)}(u.parent||o[6],u,o);if(null!=d)if(Array.isArray(s))for(let D=0;D<s.length;D++)Dy(m,d,s[D],b,!1);else Dy(m,d,s,b,!1)}function Cf(r,o){if(null!==o){const s=o.type;if(3&s)return Zi(o,r);if(4&s)return Om(-1,r[o.index]);if(8&s){const u=o.child;if(null!==u)return Cf(r,u);{const d=r[o.index];return wo(d)?Om(-1,d):Pr(d)}}if(32&s)return Am(o,r)()||Pr(r[o.index]);{const u=Sy(r,o);return null!==u?Array.isArray(u)?u[0]:Cf(Sh(r[16]),u):Cf(r,o.next)}}return null}function Sy(r,o){return null!==o?r[16][6].projection[o.projection]:null}function Om(r,o){const s=10+r+1;if(s<o.length){const u=o[s],d=u[1].firstChild;if(null!==d)return Cf(u,d)}return o[7]}function Fm(r,o,s,u,d,m,x){for(;null!=s;){const b=u[s.index],D=s.type;if(x&&0===o&&(b&&Ki(Pr(b),u),s.flags|=4),64!=(64&s.flags))if(8&D)Fm(r,o,s.child,u,d,m,!1),Eu(o,r,d,b,m);else if(32&D){const P=Am(s,u);let F;for(;F=P();)Eu(o,r,d,F,m);Eu(o,r,d,b,m)}else 16&D?Ay(r,o,u,s,d,m):Eu(o,r,d,b,m);s=x?s.projectionNext:s.next}}function Ah(r,o,s,u,d,m){Fm(s,u,r.firstChild,o,d,m,!1)}function Ay(r,o,s,u,d,m){const x=s[16],D=x[6].projection[u.projection];if(Array.isArray(D))for(let P=0;P<D.length;P++)Eu(o,r,d,D[P],m);else Fm(r,o,D,x[3],d,m,!0)}function Nm(r,o,s){r.setAttribute(o,"style",s)}function Pl(r,o,s){""===s?r.removeAttribute(o,"class"):r.setAttribute(o,"class",s)}class Oy{constructor(o){this.changingThisBreaksApplicationSecurity=o}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}function Za(r){return r instanceof Oy?r.changingThisBreaksApplicationSecurity:r}const Ew=/^(?:(?:https?|mailto|data|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi;var mi=(()=>((mi=mi||{})[mi.NONE=0]="NONE",mi[mi.HTML=1]="HTML",mi[mi.STYLE=2]="STYLE",mi[mi.SCRIPT=3]="SCRIPT",mi[mi.URL=4]="URL",mi[mi.RESOURCE_URL=5]="RESOURCE_URL",mi))();function qm(r){const o=function kh(){const r=Ne();return r&&r[12]}();return o?o.sanitize(mi.URL,r)||"":function Tu(r,o){const s=function TD(r){return r instanceof Oy&&r.getTypeName()||null}(r);if(null!=s&&s!==o){if("ResourceURL"===s&&"URL"===o)return!0;throw new Error(`Required a safe ${o}, got a ${s} (see https://g.co/ng/security#xss)`)}return s===o}(r,"URL")?Za(r):function Um(r){return(r=String(r)).match(Ew)?r:"unsafe:"+r}(un(r))}const Os=new Ht("ENVIRONMENT_INITIALIZER"),Sw=new Ht("INJECTOR",-1),Df=new Ht("INJECTOR_DEF_TYPES");class Vy{get(o,s=gu){if(s===gu){const u=new Error(`NullInjectorError: No provider for ${jn(o)}!`);throw u.name="NullInjectorError",u}return s}}function Ec(...r){return{\u0275providers:jy(0,r)}}function jy(r,...o){const s=[],u=new Set;let d;return ds(o,m=>{const x=m;Ls(x,s,[],u)&&(d||(d=[]),d.push(x))}),void 0!==d&&Aw(d,s),s}function Aw(r,o){for(let s=0;s<r.length;s++){const{providers:d}=r[s];ds(d,m=>{o.push(m)})}}function Ls(r,o,s,u){if(!(r=jt(r)))return!1;let d=null,m=is(r);const x=!m&&Pn(r);if(m||x){if(x&&!x.standalone)return!1;d=r}else{const D=r.ngModule;if(m=is(D),!m)return!1;d=D}const b=u.has(d);if(x){if(b)return!1;if(u.add(d),x.dependencies){const D="function"==typeof x.dependencies?x.dependencies():x.dependencies;for(const P of D)Ls(P,o,s,u)}}else{if(!m)return!1;{if(null!=m.imports&&!b){let P;u.add(d);try{ds(m.imports,F=>{Ls(F,o,s,u)&&(P||(P=[]),P.push(F))})}finally{}void 0!==P&&Aw(P,o)}if(!b){const P=Fa(d)||(()=>new d);o.push({provide:d,useFactory:P,deps:Un},{provide:Df,useValue:d,multi:!0},{provide:Os,useValue:()=>Tt(d),multi:!0})}const D=m.providers;null==D||b||ds(D,F=>{o.push(F)})}}return d!==r&&void 0!==r.providers}const _n=Mt({provide:String,useValue:Mt});function Du(r){return null!==r&&"object"==typeof r&&_n in r}function Rl(r){return"function"==typeof r}const Wm=new Ht("Set Injector scope."),Af={},Pw={};let ua;function $n(){return void 0===ua&&(ua=new Vy),ua}class Fs{}class kl extends Fs{constructor(o,s,u,d){super(),this.parent=s,this.source=u,this.scopes=d,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,$y(o,x=>this.processProvider(x)),this.records.set(Sw,Qi(void 0,this)),d.has("environment")&&this.records.set(Fs,Qi(void 0,this));const m=this.records.get(Wm);null!=m&&"string"==typeof m.value&&this.scopes.add(m.value),this.injectorDefTypes=new Set(this.get(Df.multi,Un,$t.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const o of this._ngOnDestroyHooks)o.ngOnDestroy();for(const o of this._onDestroyHooks)o()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(o){this._onDestroyHooks.push(o)}runInContext(o){this.assertNotDestroyed();const s=fs(this),u=yt(void 0);try{return o()}finally{fs(s),yt(u)}}get(o,s=gu,u=$t.Default){this.assertNotDestroyed();const d=fs(this),m=yt(void 0);try{if(!(u&$t.SkipSelf)){let b=this.records.get(o);if(void 0===b){const D=function Xm(r){return"function"==typeof r||"object"==typeof r&&r instanceof Ht}(o)&&bi(o);b=D&&this.injectableDefInScope(D)?Qi(Fi(o),Af):null,this.records.set(o,b)}if(null!=b)return this.hydrate(o,b)}return(u&$t.Self?$n():this.parent).get(o,s=u&$t.Optional&&s===gu?null:s)}catch(x){if("NullInjectorError"===x.name){if((x[sa]=x[sa]||[]).unshift(jn(o)),d)throw x;return function ay(r,o,s,u){const d=r[sa];throw o[xm]&&d.unshift(o[xm]),r.message=function xf(r,o,s,u=null){r=r&&"\n"===r.charAt(0)&&"\u0275"==r.charAt(1)?r.slice(2):r;let d=jn(o);if(Array.isArray(o))d=o.map(jn).join(" -> ");else if("object"==typeof o){let m=[];for(let x in o)if(o.hasOwnProperty(x)){let b=o[x];m.push(x+":"+("string"==typeof b?JSON.stringify(b):jn(b)))}d=`{${m.join(", ")}}`}return`${s}${u?"("+u+")":""}[${d}]: ${r.replace(vm,"\n  ")}`}("\n"+r.message,d,s,u),r.ngTokenPath=d,r[sa]=null,r}(x,o,"R3InjectorError",this.source)}throw x}finally{yt(m),fs(d)}}resolveInjectorInitializers(){const o=fs(this),s=yt(void 0);try{const u=this.get(Os.multi,Un,$t.Self);for(const d of u)d()}finally{fs(o),yt(s)}}toString(){const o=[],s=this.records;for(const u of s.keys())o.push(jn(u));return`R3Injector[${o.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Ue(205,!1)}processProvider(o){let s=Rl(o=jt(o))?o:jt(o&&o.provide);const u=function Oh(r){return Du(r)?Qi(void 0,r.useValue):Qi(Zm(r),Af)}(o);if(Rl(o)||!0!==o.multi)this.records.get(s);else{let d=this.records.get(s);d||(d=Qi(void 0,Af,!0),d.factory=()=>Ga(d.multi),this.records.set(s,d)),s=o,d.multi.push(o)}this.records.set(s,u)}hydrate(o,s){return s.value===Af&&(s.value=Pw,s.value=s.factory()),"object"==typeof s.value&&s.value&&function ND(r){return null!==r&&"object"==typeof r&&"function"==typeof r.ngOnDestroy}(s.value)&&this._ngOnDestroyHooks.add(s.value),s.value}injectableDefInScope(o){if(!o.providedIn)return!1;const s=jt(o.providedIn);return"string"==typeof s?"any"===s||this.scopes.has(s):this.injectorDefTypes.has(s)}}function Fi(r){const o=bi(r),s=null!==o?o.factory:Fa(r);if(null!==s)return s;if(r instanceof Ht)throw new Ue(204,!1);if(r instanceof Function)return function FD(r){const o=r.length;if(o>0)throw function _f(r,o){const s=[];for(let u=0;u<r;u++)s.push(o);return s}(o,"?"),new Ue(204,!1);const s=function Zc(r){const o=r&&(r[ic]||r[oc]);if(o){const s=function zd(r){if(r.hasOwnProperty("name"))return r.name;const o=(""+r).match(/^function\s*([^\s(]+)/);return null===o?"":o[1]}(r);return console.warn(`DEPRECATED: DI is instantiating a token "${s}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${s}" class.`),o}return null}(r);return null!==s?()=>s.factory(r):()=>new r}(r);throw new Ue(204,!1)}function Zm(r,o,s){let u;if(Rl(r)){const d=jt(r);return Fa(d)||Fi(d)}if(Du(r))u=()=>jt(r.useValue);else if(function Mf(r){return!(!r||!r.useFactory)}(r))u=()=>r.useFactory(...Ga(r.deps||[]));else if(function Uy(r){return!(!r||!r.useExisting)}(r))u=()=>Tt(jt(r.useExisting));else{const d=jt(r&&(r.useClass||r.provide));if(!function Ns(r){return!!r.deps}(r))return Fa(d)||Fi(d);u=()=>new d(...Ga(r.deps))}return u}function Qi(r,o,s=!1){return{factory:r,value:o,multi:s?[]:void 0}}function Rw(r){return!!r.\u0275providers}function $y(r,o){for(const s of r)Array.isArray(s)?$y(s,o):Rw(s)?$y(s.\u0275providers,o):o(s)}class ps{}class qy{resolveComponentFactory(o){throw function Ol(r){const o=Error(`No component factory found for ${jn(r)}. Did you add it to @NgModule.entryComponents?`);return o.ngComponent=r,o}(o)}}let Cc=(()=>{class r{}return r.NULL=new qy,r})();function Wy(){return ha(Ci(),Ne())}function ha(r,o){return new Dr(Zi(r,o))}let Dr=(()=>{class r{constructor(s){this.nativeElement=s}}return r.__NG_ELEMENT_ID__=Wy,r})();class Xy{}let So=(()=>{class r{}return r.__NG_ELEMENT_ID__=()=>function Yy(){const r=Ne(),s=Xi(Ci().index,r);return(Ei(s)?s:r)[11]}(),r})(),Ky=(()=>{class r{}return r.\u0275prov=Ut({token:r,providedIn:"root",factory:()=>null}),r})();class Lh{constructor(o){this.full=o,this.major=o.split(".")[0],this.minor=o.split(".")[1],this.patch=o.split(".").slice(2).join(".")}}const kw=new Lh("14.3.0"),ni={};function Jy(r){return r.ngOriginalError}class Fh{constructor(){this._console=console}handleError(o){const s=this._findOriginalError(o);this._console.error("ERROR",o),s&&this._console.error("ORIGINAL ERROR",s)}_findOriginalError(o){let s=o&&Jy(o);for(;s&&Jy(s);)s=Jy(s);return s||null}}function fa(r){return r instanceof Function?r():r}function gi(r,o,s){let u=r.length;for(;;){const d=r.indexOf(o,s);if(-1===d)return d;if(0===d||r.charCodeAt(d-1)<=32){const m=o.length;if(d+m===u||r.charCodeAt(d+m)<=32)return d}s=d+1}}const Ao="ng-template";function Gr(r,o,s){let u=0;for(;u<r.length;){let d=r[u++];if(s&&"class"===d){if(d=r[u],-1!==gi(d.toLowerCase(),o,0))return!0}else if(1===d){for(;u<r.length&&"string"==typeof(d=r[u++]);)if(d.toLowerCase()===o)return!0;return!1}}return!1}function Qy(r){return 4===r.type&&r.value!==Ao}function Mr(r,o,s){return o===(4!==r.type||s?r.value:Ao)}function zw(r,o,s){let u=4;const d=r.attrs||[],m=function tv(r){for(let o=0;o<r.length;o++)if(X_(r[o]))return o;return r.length}(d);let x=!1;for(let b=0;b<o.length;b++){const D=o[b];if("number"!=typeof D){if(!x)if(4&u){if(u=2|1&u,""!==D&&!Mr(r,D,s)||""===D&&1===o.length){if(Ni(u))return!1;x=!0}}else{const P=8&u?D:o[++b];if(8&u&&null!==r.attrs){if(!Gr(r.attrs,P,s)){if(Ni(u))return!1;x=!0}continue}const V=ev(8&u?"class":D,d,Qy(r),s);if(-1===V){if(Ni(u))return!1;x=!0;continue}if(""!==P){let Y;Y=V>m?"":d[V+1].toLowerCase();const re=8&u?Y:null;if(re&&-1!==gi(re,P,0)||2&u&&P!==Y){if(Ni(u))return!1;x=!0}}}}else{if(!x&&!Ni(u)&&!Ni(D))return!1;if(x&&Ni(D))continue;x=!1,u=D|1&u}}return Ni(u)||x}function Ni(r){return 0==(1&r)}function ev(r,o,s,u){if(null===o)return-1;let d=0;if(u||!s){let m=!1;for(;d<o.length;){const x=o[d];if(x===r)return d;if(3===x||6===x)m=!0;else{if(1===x||2===x){let b=o[++d];for(;"string"==typeof b;)b=o[++d];continue}if(4===x)break;if(0===x){d+=4;continue}}d+=m?1:2}return-1}return function Bw(r,o){let s=r.indexOf(4);if(s>-1)for(s++;s<r.length;){const u=r[s];if("number"==typeof u)return-1;if(u===o)return s;s++}return-1}(o,r)}function Nh(r,o,s=!1){for(let u=0;u<o.length;u++)if(zw(r,o[u],s))return!0;return!1}function Vw(r,o){return r?":not("+o.trim()+")":o}function rv(r){let o=r[0],s=1,u=2,d="",m=!1;for(;s<r.length;){let x=r[s];if("string"==typeof x)if(2&u){const b=r[++s];d+="["+x+(b.length>0?'="'+b+'"':"")+"]"}else 8&u?d+="."+x:4&u&&(d+=" "+x);else""!==d&&!Ni(x)&&(o+=Vw(m,d),d=""),u=x,m=m||!Ni(u);s++}return""!==d&&(o+=Vw(m,d)),o}const Yt={};function _o(r){Rf(Wn(),Ne(),ei()+r,!1)}function Rf(r,o,s,u){if(!u)if(3==(3&o[2])){const m=r.preOrderCheckHooks;null!==m&&uu(o,m,s)}else{const m=r.preOrderHooks;null!==m&&yh(o,m,0,s)}ja(s)}function sv(r,o=null,s=null,u){const d=av(r,o,s,u);return d.resolveInjectorInitializers(),d}function av(r,o=null,s=null,u,d=new Set){const m=[s||Un,Ec(r)];return u=u||("object"==typeof r?void 0:jn(r)),new kl(m,o||$n(),u||null,d)}let _i=(()=>{class r{static create(s,u){if(Array.isArray(s))return sv({name:""},u,s,"");{const d=s.name??"";return sv({name:d},s.parent,s.providers,d)}}}return r.THROW_IF_NOT_FOUND=gu,r.NULL=new Vy,r.\u0275prov=Ut({token:r,providedIn:"any",factory:()=>Tt(Sw)}),r.__NG_ELEMENT_ID__=-1,r})();function Ze(r,o=$t.Default){const s=Ne();return null===s?Tt(r,o):hm(Ci(),s,jt(r),o)}function Lf(){throw new Error("invalid")}function Nf(r,o){return r<<17|o<<2}function eo(r){return r>>17&32767}function _v(r){return 2|r}function Ll(r){return(131068&r)>>2}function yv(r,o){return-131069&r|o<<2}function vv(r){return 1|r}function Vf(r,o){const s=r.contentQueries;if(null!==s)for(let u=0;u<s.length;u+=2){const d=s[u],m=s[u+1];if(-1!==m){const x=r.data[m];$_(d),x.contentQueries(2,o[m],m)}}}function ag(r,o,s,u,d,m,x,b,D,P,F){const V=o.blueprint.slice();return V[0]=d,V[2]=76|u,(null!==F||r&&1024&r[2])&&(V[2]|=1024),su(V),V[3]=V[15]=r,V[8]=s,V[10]=x||r&&r[10],V[11]=b||r&&r[11],V[12]=D||r&&r[12]||null,V[9]=P||r&&r[9]||null,V[6]=m,V[20]=function Sl(){return Mh++}(),V[21]=F,V[16]=2==o.type?r[16]:V,V}function Mu(r,o,s,u,d){let m=r.data[o];if(null===m)m=function $h(r,o,s,u,d){const m=l1(),x=rf(),D=r.data[o]=function JD(r,o,s,u,d,m){return{type:s,index:u,insertBeforeIndex:null,injectorIndex:o?o.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:d,attrs:m,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:o,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,x?m:m&&m.parent,s,o,u,d);return null===r.firstChild&&(r.firstChild=D),null!==m&&(x?null==m.child&&null!==D.parent&&(m.child=D):null===m.next&&(m.next=D)),D}(r,o,s,u,d),function au(){return M.lFrame.inI18n}()&&(m.flags|=64);else if(64&m.type){m.type=s,m.value=u,m.attrs=d;const x=function nf(){const r=M.lFrame,o=r.currentTNode;return r.isParent?o:o.parent}();m.injectorIndex=null===x?-1:x.injectorIndex}return Ps(m,!0),m}function Nn(r,o,s,u){if(0===s)return-1;const d=o.length;for(let m=0;m<s;m++)o.push(u),r.blueprint.push(u),r.data.push(null);return d}function jf(r,o,s){H_(o);try{const u=r.viewQuery;null!==u&&Hf(1,u,s);const d=r.template;null!==d&&Sv(r,o,d,1,s),r.firstCreatePass&&(r.firstCreatePass=!1),r.staticContentQueries&&Vf(r,o),r.staticViewQueries&&Hf(2,r.viewQuery,s);const m=r.components;null!==m&&function db(r,o){for(let s=0;s<o.length;s++)nM(r,o[s])}(o,m)}catch(u){throw r.firstCreatePass&&(r.incompleteFirstPass=!0,r.firstCreatePass=!1),u}finally{o[2]&=-5,_h()}}function Uf(r,o,s,u){const d=o[2];if(128!=(128&d)){H_(o);try{su(o),function dc(r){return M.lFrame.bindingIndex=r}(r.bindingStartIndex),null!==s&&Sv(r,o,s,2,u);const x=3==(3&d);if(x){const P=r.preOrderCheckHooks;null!==P&&uu(o,P,null)}else{const P=r.preOrderHooks;null!==P&&yh(o,P,0,null),vh(o,0)}if(function eM(r){for(let o=An(r);null!==o;o=bf(o)){if(!o[2])continue;const s=o[9];for(let u=0;u<s.length;u++){const d=s[u],m=d[3];0==(512&d[2])&&N(m,1),d[2]|=512}}}(o),function QD(r){for(let o=An(r);null!==o;o=bf(o))for(let s=10;s<o.length;s++){const u=o[s],d=u[1];hc(u)&&Uf(d,u,d.template,u[8])}}(o),null!==r.contentQueries&&Vf(r,o),x){const P=r.contentCheckHooks;null!==P&&uu(o,P)}else{const P=r.contentHooks;null!==P&&yh(o,P,1),vh(o,1)}!function Mv(r,o){const s=r.hostBindingOpCodes;if(null!==s)try{for(let u=0;u<s.length;u++){const d=s[u];if(d<0)ja(~d);else{const m=d,x=s[++u],b=s[++u];lu(x,m),b(2,o[m])}}}finally{ja(-1)}}(r,o);const b=r.components;null!==b&&function sg(r,o){for(let s=0;s<o.length;s++)tM(r,o[s])}(o,b);const D=r.viewQuery;if(null!==D&&Hf(2,D,u),x){const P=r.viewCheckHooks;null!==P&&uu(o,P)}else{const P=r.viewHooks;null!==P&&yh(o,P,2),vh(o,2)}!0===r.firstUpdatePass&&(r.firstUpdatePass=!1),o[2]&=-41,512&o[2]&&(o[2]&=-513,N(o[3],-1))}finally{_h()}}}function Sv(r,o,s,u,d){const m=ei(),x=2&u;try{ja(-1),x&&o.length>22&&Rf(r,o,22,!1),s(u,d)}finally{ja(m)}}function Ac(r,o,s){!hn()||(function vb(r,o,s,u){const d=s.directiveStart,m=s.directiveEnd;r.firstCreatePass||wh(s,o),Ki(u,o);const x=s.initialInputs;for(let b=d;b<m;b++){const D=r.data[b],P=ho(D);P&&Su(o,s,D);const F=bo(o,r,b,s);Ki(F,o),null!==x&&Lv(0,b-d,F,D,0,x),P&&(Xi(s.index,o)[8]=F)}}(r,o,s,Zi(s,o)),128==(128&s.flags)&&function xb(r,o,s){const u=s.directiveStart,d=s.directiveEnd,m=s.index,x=function u1(){return M.lFrame.currentDirectiveIndex}();try{ja(m);for(let b=u;b<d;b++){const D=r.data[b],P=o[b];af(b),(null!==D.hostBindings||0!==D.hostVars||null!==D.hostAttrs)&&kv(D,P)}}finally{ja(-1),af(x)}}(r,o,s))}function lg(r,o,s=Zi){const u=o.localNames;if(null!==u){let d=o.index+1;for(let m=0;m<u.length;m+=2){const x=u[m+1],b=-1===x?s(o,r):r[x];r[d++]=b}}}function fb(r){const o=r.tView;return null===o||o.incompleteFirstPass?r.tView=Av(1,null,r.template,r.decls,r.vars,r.directiveDefs,r.pipeDefs,r.viewQuery,r.schemas,r.consts):o}function Av(r,o,s,u,d,m,x,b,D,P){const F=22+u,V=F+d,Y=function YD(r,o){const s=[];for(let u=0;u<o;u++)s.push(u<r?null:Yt);return s}(F,V),re="function"==typeof P?P():P;return Y[1]={type:r,blueprint:Y,template:s,queries:null,viewQuery:b,declTNode:o,data:Y.slice().fill(null,F),bindingStartIndex:F,expandoStartIndex:V,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof m?m():m,pipeRegistry:"function"==typeof x?x():x,firstChild:null,schemas:D,consts:re,incompleteFirstPass:!1}}function mb(r,o,s){for(let u in r)if(r.hasOwnProperty(u)){const d=r[u];(s=null===s?{}:s).hasOwnProperty(u)?s[u].push(o,d):s[u]=[o,d]}return s}function gb(r,o){const u=o.directiveEnd,d=r.data,m=o.attrs,x=[];let b=null,D=null;for(let P=o.directiveStart;P<u;P++){const F=d[P],V=F.inputs,Y=null===m||Qy(o)?null:Eb(V,m);x.push(Y),b=mb(V,P,b),D=mb(F.outputs,P,D)}null!==b&&(b.hasOwnProperty("class")&&(o.flags|=16),b.hasOwnProperty("style")&&(o.flags|=32)),o.initialInputs=x,o.inputs=b,o.outputs=D}function zi(r,o,s,u,d,m,x,b){const D=Zi(o,s);let F,P=o.inputs;!b&&null!=P&&(F=P[u])?(zv(r,s,F,u,d),ch(o)&&Iv(s,o.index)):3&o.type&&(u=function cg(r){return"class"===r?"className":"for"===r?"htmlFor":"formaction"===r?"formAction":"innerHtml"===r?"innerHTML":"readonly"===r?"readOnly":"tabindex"===r?"tabIndex":r}(u),d=null!=x?x(d,o.value||"",u):d,m.setProperty(D,u,d))}function Iv(r,o){const s=Xi(o,r);16&s[2]||(s[2]|=32)}function Pv(r,o,s,u){let d=!1;if(hn()){const m=function wb(r,o,s){const u=r.directiveRegistry;let d=null;if(u)for(let m=0;m<u.length;m++){const x=u[m];Nh(s,x.selectors,!1)&&(d||(d=[]),um(wh(s,o),r,x.type),ho(x)?(Ov(r,s),d.unshift(x)):d.push(x))}return d}(r,o,s),x=null===u?null:{"":-1};if(null!==m){d=!0,hg(s,r.data.length,m.length);for(let F=0;F<m.length;F++){const V=m[F];V.providersResolver&&V.providersResolver(V)}let b=!1,D=!1,P=Nn(r,o,m.length,null);for(let F=0;F<m.length;F++){const V=m[F];s.mergedAttrs=pf(s.mergedAttrs,V.hostAttrs),dg(r,s,o,P,V),bb(P,V,x),null!==V.contentQueries&&(s.flags|=8),(null!==V.hostBindings||null!==V.hostAttrs||0!==V.hostVars)&&(s.flags|=128);const Y=V.type.prototype;!b&&(Y.ngOnChanges||Y.ngOnInit||Y.ngDoCheck)&&((r.preOrderHooks||(r.preOrderHooks=[])).push(s.index),b=!0),!D&&(Y.ngOnChanges||Y.ngDoCheck)&&((r.preOrderCheckHooks||(r.preOrderCheckHooks=[])).push(s.index),D=!0),P++}gb(r,s)}x&&function Ic(r,o,s){if(o){const u=r.localNames=[];for(let d=0;d<o.length;d+=2){const m=s[o[d+1]];if(null==m)throw new Ue(-301,!1);u.push(o[d],m)}}}(s,u,x)}return s.mergedAttrs=pf(s.mergedAttrs,s.attrs),d}function Rv(r,o,s,u,d,m){const x=m.hostBindings;if(x){let b=r.hostBindingOpCodes;null===b&&(b=r.hostBindingOpCodes=[]);const D=~o.index;(function yb(r){let o=r.length;for(;o>0;){const s=r[--o];if("number"==typeof s&&s<0)return s}return 0})(b)!=D&&b.push(D),b.push(u,d,x)}}function kv(r,o){null!==r.hostBindings&&r.hostBindings(1,o)}function Ov(r,o){o.flags|=2,(r.components||(r.components=[])).push(o.index)}function bb(r,o,s){if(s){if(o.exportAs)for(let u=0;u<o.exportAs.length;u++)s[o.exportAs[u]]=r;ho(o)&&(s[""]=r)}}function hg(r,o,s){r.flags|=1,r.directiveStart=o,r.directiveEnd=o+s,r.providerIndexes=o}function dg(r,o,s,u,d){r.data[u]=d;const m=d.factory||(d.factory=Fa(d.type)),x=new hf(m,ho(d),Ze);r.blueprint[u]=x,s[u]=x,Rv(r,o,0,u,Nn(r,s,d.hostVars,Yt),d)}function Su(r,o,s){const u=Zi(o,r),d=fb(s),m=r[10],x=$f(r,ag(r,d,null,s.onPush?32:16,u,o,m,m.createRenderer(u,s),null,null,null));r[o.index]=x}function Lv(r,o,s,u,d,m){const x=m[o];if(null!==x){const b=u.setInput;for(let D=0;D<x.length;){const P=x[D++],F=x[D++],V=x[D++];null!==b?u.setInput(s,V,P,F):s[F]=V}}}function Eb(r,o){let s=null,u=0;for(;u<o.length;){const d=o[u];if(0!==d)if(5!==d){if("number"==typeof d)break;r.hasOwnProperty(d)&&(null===s&&(s=[]),s.push(d,r[d],o[u+1])),u+=2}else u+=2;else u+=4}return s}function Cb(r,o,s,u){return new Array(r,!0,!1,o,null,0,u,s,null,null)}function tM(r,o){const s=Xi(o,r);if(hc(s)){const u=s[1];48&s[2]?Uf(u,s,u.template,s[8]):s[5]>0&&Fv(s)}}function Fv(r){for(let u=An(r);null!==u;u=bf(u))for(let d=10;d<u.length;d++){const m=u[d];if(hc(m))if(512&m[2]){const x=m[1];Uf(x,m,x.template,m[8])}else m[5]>0&&Fv(m)}const s=r[1].components;if(null!==s)for(let u=0;u<s.length;u++){const d=Xi(s[u],r);hc(d)&&d[5]>0&&Fv(d)}}function nM(r,o){const s=Xi(o,r),u=s[1];(function rM(r,o){for(let s=o.length;s<r.blueprint.length;s++)o.push(r.blueprint[s])})(u,s),jf(u,s,s[8])}function $f(r,o){return r[13]?r[14][4]=o:r[13]=o,r[14]=o,o}function Nv(r){for(;r;){r[2]|=32;const o=Sh(r);if(Zp(r)&&!o)return r;r=o}return null}function qr(r,o,s,u=!0){const d=o[10];d.begin&&d.begin();try{Uf(r,o,r.template,s)}catch(x){throw u&&Hh(o,x),x}finally{d.end&&d.end()}}function Hf(r,o,s){$_(0),o(r,s)}function pa(r){return r[7]||(r[7]=[])}function Tb(r){return r.cleanup||(r.cleanup=[])}function Hh(r,o){const s=r[9],u=s?s.get(Fh,null):null;u&&u.handleError(o)}function zv(r,o,s,u,d){for(let m=0;m<s.length;){const x=s[m++],b=s[m++],D=o[x],P=r.data[x];null!==P.setInput?P.setInput(D,d,u,b):D[b]=d}}function Gh(r,o,s){let u=s?r.styles:null,d=s?r.classes:null,m=0;if(null!==o)for(let x=0;x<o.length;x++){const b=o[x];"number"==typeof b?m=b:1==m?d=yl(d,b):2==m&&(u=yl(u,b+": "+o[++x]+";"))}s?r.styles=u:r.stylesWithoutHost=u,s?r.classes=d:r.classesWithoutHost=d}function pg(r,o,s,u,d=!1){for(;null!==s;){const m=o[s.index];if(null!==m&&u.push(Pr(m)),wo(m))for(let b=10;b<m.length;b++){const D=m[b],P=D[1].firstChild;null!==P&&pg(D[1],D,P,u)}const x=s.type;if(8&x)pg(r,o,s.child,u);else if(32&x){const b=Am(s,o);let D;for(;D=b();)u.push(D)}else if(16&x){const b=Sy(o,s);if(Array.isArray(b))u.push(...b);else{const D=Sh(o[16]);pg(D[1],D,b,u,!0)}}s=d?s.projectionNext:s.next}return u}class Gf{constructor(o,s){this._lView=o,this._cdRefInjectingView=s,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const o=this._lView,s=o[1];return pg(s,o,s.firstChild,[])}get context(){return this._lView[8]}set context(o){this._lView[8]=o}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const o=this._lView[3];if(wo(o)){const s=o[8],u=s?s.indexOf(this):-1;u>-1&&(Rm(o,u),gf(s,u))}this._attachedToViewContainer=!1}St(this._lView[1],this._lView)}onDestroy(o){!function pb(r,o,s,u){const d=pa(o);null===s?d.push(u):(d.push(s),r.firstCreatePass&&Tb(r).push(u,d.length-1))}(this._lView[1],this._lView,null,o)}markForCheck(){Nv(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){qr(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Ue(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function ow(r,o){Ah(r,o,o[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(o){if(this._attachedToViewContainer)throw new Ue(902,!1);this._appRef=o}}class iM extends Gf{constructor(o){super(o),this._view=o}detectChanges(){const o=this._view;qr(o[1],o,o[8],!1)}checkNoChanges(){}get context(){return null}}class mg extends Cc{constructor(o){super(),this.ngModule=o}resolveComponentFactory(o){const s=Pn(o);return new qh(s,this.ngModule)}}function gg(r){const o=[];for(let s in r)r.hasOwnProperty(s)&&o.push({propName:r[s],templateName:s});return o}class Bv{constructor(o,s){this.injector=o,this.parentInjector=s}get(o,s,u){const d=this.injector.get(o,ni,u);return d!==ni||s===ni?d:this.parentInjector.get(o,s,u)}}class qh extends ps{constructor(o,s){super(),this.componentDef=o,this.ngModule=s,this.componentType=o.type,this.selector=function jw(r){return r.map(rv).join(",")}(o.selectors),this.ngContentSelectors=o.ngContentSelectors?o.ngContentSelectors:[],this.isBoundToModule=!!s}get inputs(){return gg(this.componentDef.inputs)}get outputs(){return gg(this.componentDef.outputs)}create(o,s,u,d){let m=(d=d||this.ngModule)instanceof Fs?d:d?.injector;m&&null!==this.componentDef.getStandaloneInjector&&(m=this.componentDef.getStandaloneInjector(m)||m);const x=m?new Bv(o,m):o,b=x.get(Xy,null);if(null===b)throw new Ue(407,!1);const D=x.get(Ky,null),P=b.createRenderer(null,this.componentDef),F=this.componentDef.selectors[0][0]||"div",V=u?function KD(r,o,s){return r.selectRootElement(o,s===Yn.ShadowDom)}(P,u,this.componentDef.encapsulation):yr(P,F,function Io(r){const o=r.toLowerCase();return"svg"===o?"svg":"math"===o?"math":null}(F)),Y=this.componentDef.onPush?288:272,re=Av(0,null,null,1,0,null,null,null,null,null),pe=ag(null,re,null,Y,null,null,b,P,D,x,null);let Ce,ze;H_(pe);try{const $e=function Vv(r,o,s,u,d,m){const x=s[1];s[22]=r;const D=Mu(x,22,2,"#host",null),P=D.mergedAttrs=o.hostAttrs;null!==P&&(Gh(D,P,!0),null!==r&&(ff(d,r,P),null!==D.classes&&Pl(d,r,D.classes),null!==D.styles&&Nm(d,r,D.styles)));const F=u.createRenderer(r,o),V=ag(s,fb(o),null,o.onPush?32:16,s[22],D,u,F,m||null,null,null);return x.firstCreatePass&&(um(wh(D,s),x,o.type),Ov(x,D),hg(D,s.length,1)),$f(s,V),s[22]=V}(V,this.componentDef,pe,b,P);if(V)if(u)ff(P,V,["ng-version",kw.full]);else{const{attrs:ct,classes:Ve}=function UD(r){const o=[],s=[];let u=1,d=2;for(;u<r.length;){let m=r[u];if("string"==typeof m)2===d?""!==m&&o.push(m,r[++u]):8===d&&s.push(m);else{if(!Ni(d))break;d=m}u++}return{attrs:o,classes:s}}(this.componentDef.selectors[0]);ct&&ff(P,V,ct),Ve&&Ve.length>0&&Pl(P,V,Ve.join(" "))}if(ze=ou(re,22),void 0!==s){const ct=ze.projection=[];for(let Ve=0;Ve<this.ngContentSelectors.length;Ve++){const Zt=s[Ve];ct.push(null!=Zt?Array.from(Zt):null)}}Ce=function _g(r,o,s,u){const d=s[1],m=function _b(r,o,s){const u=Ci();r.firstCreatePass&&(s.providersResolver&&s.providersResolver(s),dg(r,u,o,Nn(r,o,1,null),s),gb(r,u));const d=bo(o,r,u.directiveStart,u);Ki(d,o);const m=Zi(u,o);return m&&Ki(m,o),d}(d,s,o);if(r[8]=s[8]=m,null!==u)for(const b of u)b(m,o);if(o.contentQueries){const b=Ci();o.contentQueries(1,m,b.directiveStart)}const x=Ci();return!d.firstCreatePass||null===o.hostBindings&&null===o.hostAttrs||(ja(x.index),Rv(s[1],x,0,x.directiveStart,x.directiveEnd,o),kv(o,m)),m}($e,this.componentDef,pe,[sM]),jf(re,pe,null)}finally{_h()}return new qf(this.componentType,Ce,ha(ze,pe),pe,ze)}}class qf extends class Hy{}{constructor(o,s,u,d,m){super(),this.location=u,this._rootLView=d,this._tNode=m,this.instance=s,this.hostView=this.changeDetectorRef=new iM(d),this.componentType=o}setInput(o,s){const u=this._tNode.inputs;let d;if(null!==u&&(d=u[o])){const m=this._rootLView;zv(m[1],m,d,o,s),Iv(m,this._tNode.index)}}get injector(){return new Eo(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(o){this.hostView.onDestroy(o)}}function sM(){const r=Ci();uf(Ne()[1],r)}function ur(r){let o=function jv(r){return Object.getPrototypeOf(r.prototype).constructor}(r.type),s=!0;const u=[r];for(;o;){let d;if(ho(r))d=o.\u0275cmp||o.\u0275dir;else{if(o.\u0275cmp)throw new Ue(903,!1);d=o.\u0275dir}if(d){if(s){u.push(d);const x=r;x.inputs=yg(r.inputs),x.declaredInputs=yg(r.declaredInputs),x.outputs=yg(r.outputs);const b=d.hostBindings;b&&Sb(r,b);const D=d.viewQuery,P=d.contentQueries;if(D&&Mb(r,D),P&&vg(r,P),rs(r.inputs,d.inputs),rs(r.declaredInputs,d.declaredInputs),rs(r.outputs,d.outputs),ho(d)&&d.data.animation){const F=r.data;F.animation=(F.animation||[]).concat(d.data.animation)}}const m=d.features;if(m)for(let x=0;x<m.length;x++){const b=m[x];b&&b.ngInherit&&b(r),b===ur&&(s=!1)}}o=Object.getPrototypeOf(o)}!function aM(r){let o=0,s=null;for(let u=r.length-1;u>=0;u--){const d=r[u];d.hostVars=o+=d.hostVars,d.hostAttrs=pf(d.hostAttrs,s=pf(s,d.hostAttrs))}}(u)}function yg(r){return r===ir?{}:r===Un?[]:r}function Mb(r,o){const s=r.viewQuery;r.viewQuery=s?(u,d)=>{o(u,d),s(u,d)}:o}function vg(r,o){const s=r.contentQueries;r.contentQueries=s?(u,d,m)=>{o(u,d,m),s(u,d,m)}:o}function Sb(r,o){const s=r.hostBindings;r.hostBindings=s?(u,d)=>{o(u,d),s(u,d)}:o}let Zf=null;function Rc(){if(!Zf){const r=Sn.Symbol;if(r&&r.iterator)Zf=r.iterator;else{const o=Object.getOwnPropertyNames(Map.prototype);for(let s=0;s<o.length;++s){const u=o[s];"entries"!==u&&"size"!==u&&Map.prototype[u]===Map.prototype.entries&&(Zf=u)}}}return Zf}function Wh(r){return!!function xg(r){return null!==r&&("function"==typeof r||"object"==typeof r)}(r)&&(Array.isArray(r)||!(r instanceof Map)&&Rc()in r)}function to(r,o,s){return!Object.is(r[o],s)&&(r[o]=s,!0)}function Au(r,o,s,u){return to(r,Ba(),s)?o+un(s)+u:Yt}function Po(r,o,s){const u=Ne();return to(u,Ba(),o)&&zi(Wn(),Rr(),u,r,o,u[11],s,!1),Po}function Dg(r,o,s,u,d){const x=d?"class":"style";zv(r,s,o.inputs[x],x,u)}function yo(r,o,s,u){const d=Ne(),m=Wn(),x=22+r,b=d[11],D=d[x]=yr(b,o,function g1(){return M.lFrame.currentNamespace}()),P=m.firstCreatePass?function Fb(r,o,s,u,d,m,x){const b=o.consts,P=Mu(o,r,2,d,cs(b,m));return Pv(o,s,P,cs(b,x)),null!==P.attrs&&Gh(P,P.attrs,!1),null!==P.mergedAttrs&&Gh(P,P.mergedAttrs,!0),null!==o.queries&&o.queries.elementStart(o,P),P}(x,m,d,0,o,s,u):m.data[x];Ps(P,!0);const F=P.mergedAttrs;null!==F&&ff(b,D,F);const V=P.classes;null!==V&&Pl(b,D,V);const Y=P.styles;return null!==Y&&Nm(b,D,Y),64!=(64&P.flags)&&Do(m,d,D,P),0===function ne(){return M.lFrame.elementDepthCount}()&&Ki(D,d),function Te(){M.lFrame.elementDepthCount++}(),uh(P)&&(Ac(m,d,P),function Qa(r,o,s){if(Hd(o)){const d=o.directiveEnd;for(let m=o.directiveStart;m<d;m++){const x=r.data[m];x.contentQueries&&x.contentQueries(1,s[m],m)}}}(m,P,d)),null!==u&&lg(d,P),yo}function Ro(){let r=Ci();rf()?function sf(){M.lFrame.isParent=!1}():(r=r.parent,Ps(r,!1));const o=r;!function at(){M.lFrame.elementDepthCount--}();const s=Wn();return s.firstCreatePass&&(uf(s,r),Hd(r)&&s.queries.elementEnd(r)),null!=o.classesWithoutHost&&function v1(r){return 0!=(16&r.flags)}(o)&&Dg(s,o,Ne(),o.classesWithoutHost,!0),null!=o.stylesWithoutHost&&function x1(r){return 0!=(32&r.flags)}(o)&&Dg(s,o,Ne(),o.stylesWithoutHost,!1),Ro}function ko(r,o,s,u){return yo(r,o,s,u),Ro(),ko}function kc(r){return!!r&&"function"==typeof r.then}const $v=function Nb(r){return!!r&&"function"==typeof r.subscribe};function ri(r,o,s,u){const d=Ne(),m=Wn(),x=Ci();return function Hv(r,o,s,u,d,m,x,b){const D=uh(u),F=r.firstCreatePass&&Tb(r),V=o[8],Y=pa(o);let re=!0;if(3&u.type||b){const ze=Zi(u,o),$e=b?b(ze):ze,ct=Y.length,Ve=b?er=>b(Pr(er[u.index])):u.index;let Zt=null;if(!b&&D&&(Zt=function pM(r,o,s,u){const d=r.cleanup;if(null!=d)for(let m=0;m<d.length-1;m+=2){const x=d[m];if(x===s&&d[m+1]===u){const b=o[7],D=d[m+2];return b.length>D?b[D]:null}"string"==typeof x&&(m+=2)}return null}(r,o,d,u.index)),null!==Zt)(Zt.__ngLastListenerFn__||Zt).__ngNextListenerFn__=m,Zt.__ngLastListenerFn__=m,re=!1;else{m=zb(u,o,V,m,!1);const er=s.listen($e,d,m);Y.push(m,er),F&&F.push(d,Ve,ct,ct+1)}}else m=zb(u,o,V,m,!1);const pe=u.outputs;let Ce;if(re&&null!==pe&&(Ce=pe[d])){const ze=Ce.length;if(ze)for(let $e=0;$e<ze;$e+=2){const si=o[Ce[$e]][Ce[$e+1]].subscribe(m),zp=Y.length;Y.push(m,si),F&&F.push(d,u.index,zp,-(zp+1))}}}(m,d,d[11],x,r,o,0,u),ri}function Gv(r,o,s,u){try{return!1!==s(u)}catch(d){return Hh(r,d),!1}}function zb(r,o,s,u,d){return function m(x){if(x===Function)return u;Nv(2&r.flags?Xi(r.index,o):o);let D=Gv(o,0,u,x),P=m.__ngNextListenerFn__;for(;P;)D=Gv(o,0,P,x)&&D,P=P.__ngNextListenerFn__;return d&&!1===D&&(x.preventDefault(),x.returnValue=!1),D}}function ed(r,o,s){return qv(r,"",o,"",s),ed}function qv(r,o,s,u,d){const m=Ne(),x=Au(m,o,s,u);return x!==Yt&&zi(Wn(),Rr(),m,r,x,m[11],d,!1),qv}function Sg(r,o,s,u,d){const m=r[s+1],x=null===o;let b=u?eo(m):Ll(m),D=!1;for(;0!==b&&(!1===D||x);){const F=r[b+1];Xv(r[b],o)&&(D=!0,r[b+1]=u?vv(F):_v(F)),b=u?eo(F):Ll(F)}D&&(r[s+1]=u?_v(m):vv(m))}function Xv(r,o){return null===r||null==o||(Array.isArray(r)?r[1]:r)===o||!(!Array.isArray(r)||"string"!=typeof o)&&mu(r,o)>=0}function Ru(r,o){return function va(r,o,s,u){const d=Ne(),m=Wn(),x=function Va(r){const o=M.lFrame,s=o.bindingIndex;return o.bindingIndex=o.bindingIndex+r,s}(2);m.firstUpdatePass&&function Zb(r,o,s,u){const d=r.data;if(null===d[s+1]){const m=d[ei()],x=function Wb(r,o){return o>=r.expandoStartIndex}(r,s);(function Jb(r,o){return 0!=(r.flags&(o?16:32))})(m,u)&&null===o&&!x&&(o=!1),o=function Kn(r,o,s,u){const d=function lf(r){const o=M.lFrame.currentDirectiveIndex;return-1===o?null:r[o]}(r);let m=u?o.residualClasses:o.residualStyles;if(null===d)0===(u?o.classBindings:o.styleBindings)&&(s=tp(s=Kv(null,r,o,s,u),o.attrs,u),m=null);else{const x=o.directiveStylingLast;if(-1===x||r[x]!==d)if(s=Kv(d,r,o,s,u),null===m){let D=function wM(r,o,s){const u=s?o.classBindings:o.styleBindings;if(0!==Ll(u))return r[eo(u)]}(r,o,u);void 0!==D&&Array.isArray(D)&&(D=Kv(null,r,o,D[1],u),D=tp(D,o.attrs,u),function bM(r,o,s,u){r[eo(s?o.classBindings:o.styleBindings)]=u}(r,o,u,D))}else m=function EM(r,o,s){let u;const d=o.directiveEnd;for(let m=1+o.directiveStylingLast;m<d;m++)u=tp(u,r[m].hostAttrs,s);return tp(u,o.attrs,s)}(r,o,u)}return void 0!==m&&(u?o.residualClasses=m:o.residualStyles=m),s}(d,m,o,u),function td(r,o,s,u,d,m){let x=m?o.classBindings:o.styleBindings,b=eo(x),D=Ll(x);r[u]=s;let F,P=!1;if(Array.isArray(s)){const V=s;F=V[1],(null===F||mu(V,F)>0)&&(P=!0)}else F=s;if(d)if(0!==D){const Y=eo(r[b+1]);r[u+1]=Nf(Y,b),0!==Y&&(r[Y+1]=yv(r[Y+1],u)),r[b+1]=function ZD(r,o){return 131071&r|o<<17}(r[b+1],u)}else r[u+1]=Nf(b,0),0!==b&&(r[b+1]=yv(r[b+1],u)),b=u;else r[u+1]=Nf(D,0),0===b?b=u:r[D+1]=yv(r[D+1],u),D=u;P&&(r[u+1]=_v(r[u+1])),Sg(r,F,u,!0),Sg(r,F,u,!1),function _M(r,o,s,u,d){const m=d?r.residualClasses:r.residualStyles;null!=m&&"string"==typeof o&&mu(m,o)>=0&&(s[u+1]=vv(s[u+1]))}(o,F,r,u,m),x=Nf(b,D),m?o.classBindings=x:o.styleBindings=x}(d,m,o,s,x,u)}}(m,r,x,u),o!==Yt&&to(d,x,o)&&function Yb(r,o,s,u,d,m,x,b){if(!(3&o.type))return;const D=r.data,P=D[b+1];Ig(function rb(r){return 1==(1&r)}(P)?Kb(D,o,s,d,Ll(P),x):void 0)||(Ig(m)||function Bh(r){return 2==(2&r)}(P)&&(m=Kb(D,null,s,d,b,x)),function ED(r,o,s,u,d){if(o)d?r.addClass(s,u):r.removeClass(s,u);else{let m=-1===u.indexOf("-")?void 0:Uo.DashCase;null==d?r.removeStyle(s,u,m):("string"==typeof d&&d.endsWith("!important")&&(d=d.slice(0,-10),m|=Uo.Important),r.setStyle(s,u,d,m))}}(u,x,fr(ei(),s),d,m))}(m,m.data[ei()],d,d[11],r,d[x+1]=function DM(r,o){return null==r||("string"==typeof o?r+=o:"object"==typeof r&&(r=jn(Za(r)))),r}(o,s),u,x)}(r,o,null,!0),Ru}function Kv(r,o,s,u,d){let m=null;const x=s.directiveEnd;let b=s.directiveStylingLast;for(-1===b?b=s.directiveStart:b++;b<x&&(m=o[b],u=tp(u,m.hostAttrs,d),m!==r);)b++;return null!==r&&(s.directiveStylingLast=b),u}function tp(r,o,s){const u=s?1:2;let d=-1;if(null!==o)for(let m=0;m<o.length;m++){const x=o[m];"number"==typeof x?d=x:d===u&&(Array.isArray(r)||(r=void 0===r?[]:["",r]),gr(r,x,!!s||o[++m]))}return void 0===r?null:r}function Kb(r,o,s,u,d,m){const x=null===o;let b;for(;d>0;){const D=r[d],P=Array.isArray(D),F=P?D[1]:D,V=null===F;let Y=s[d+1];Y===Yt&&(Y=V?Un:void 0);let re=V?vf(Y,u):F===u?Y:void 0;if(P&&!Ig(re)&&(re=vf(D,u)),Ig(re)&&(b=re,x))return b;const pe=r[d+1];d=x?eo(pe):Ll(pe)}if(null!==o){let D=m?o.residualClasses:o.residualStyles;null!=D&&(b=vf(D,u))}return b}function Ig(r){return void 0!==r}function rd(r,o=""){const s=Ne(),u=Wn(),d=r+22,m=u.firstCreatePass?Mu(u,d,1,o,null):u.data[d],x=s[d]=function Pm(r,o){return r.createText(o)}(s[11],o);Do(u,s,x,m),Ps(m,!1)}function Jv(r){return Qv("",r,""),Jv}function Qv(r,o,s){const u=Ne(),d=Au(u,r,o,s);return d!==Yt&&function Nl(r,o,s){const u=fr(o,r);!function Lt(r,o,s){r.setValue(o,s)}(r[11],u,s)}(u,ei(),d),Qv}const Ou="en-US";let l0=Ou;function Ug(r,o,s,u,d){if(r=jt(r),Array.isArray(r))for(let m=0;m<r.length;m++)Ug(r[m],o,s,u,d);else{const m=Wn(),x=Ne();let b=Rl(r)?r:jt(r.provide),D=Zm(r);const P=Ci(),F=1048575&P.providerIndexes,V=P.directiveStart,Y=P.providerIndexes>>20;if(Rl(r)||!r.multi){const re=new hf(D,d,Ze),pe=D0(b,o,d?F:F+Y,V);-1===pe?(um(wh(P,x),m,b),C0(m,r,o.length),o.push(b),P.directiveStart++,P.directiveEnd++,d&&(P.providerIndexes+=1048576),s.push(re),x.push(re)):(s[pe]=re,x[pe]=re)}else{const re=D0(b,o,F+Y,V),pe=D0(b,o,F,F+Y),Ce=re>=0&&s[re],ze=pe>=0&&s[pe];if(d&&!ze||!d&&!Ce){um(wh(P,x),m,b);const $e=function GE(r,o,s,u,d){const m=new hf(r,s,Ze);return m.multi=[],m.index=o,m.componentProviders=0,T0(m,d,u&&!s),m}(d?HE:KM,s.length,d,u,D);!d&&ze&&(s[pe].providerFactory=$e),C0(m,r,o.length,0),o.push(b),P.directiveStart++,P.directiveEnd++,d&&(P.providerIndexes+=1048576),s.push($e),x.push($e)}else C0(m,r,re>-1?re:pe,T0(s[d?pe:re],D,!d&&u));!d&&u&&ze&&s[pe].componentProviders++}}}function C0(r,o,s,u){const d=Rl(o),m=function Sf(r){return!!r.useClass}(o);if(d||m){const D=(m?jt(o.useClass):o).prototype.ngOnDestroy;if(D){const P=r.destroyHooks||(r.destroyHooks=[]);if(!d&&o.multi){const F=P.indexOf(s);-1===F?P.push(s,[u,D]):P[F+1].push(u,D)}else P.push(s,D)}}}function T0(r,o,s){return s&&r.componentProviders++,r.multi.push(o)-1}function D0(r,o,s,u){for(let d=s;d<u;d++)if(o[d]===r)return d;return-1}function KM(r,o,s,u){return $g(this.multi,[])}function HE(r,o,s,u){const d=this.multi;let m;if(this.providerFactory){const x=this.providerFactory.componentProviders,b=bo(s,s[1],this.providerFactory.index,u);m=b.slice(0,x),$g(d,m);for(let D=x;D<b.length;D++)m.push(b[D])}else m=[],$g(d,m);return m}function $g(r,o){for(let s=0;s<r.length;s++)o.push((0,r[s])());return o}function Fr(r,o=[]){return s=>{s.providersResolver=(u,d)=>function $E(r,o,s){const u=Wn();if(u.firstCreatePass){const d=ho(r);Ug(s,u.data,u.blueprint,d,!0),Ug(o,u.data,u.blueprint,d,!1)}}(u,d?d(r):r,o)}}class Lc{}class M0{}class qE extends Lc{constructor(o,s){super(),this._parent=s,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new mg(this);const u=Hi(o);this._bootstrapComponents=fa(u.bootstrap),this._r3Injector=av(o,s,[{provide:Lc,useValue:this},{provide:Cc,useValue:this.componentFactoryResolver}],jn(o),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(o)}get injector(){return this._r3Injector}destroy(){const o=this._r3Injector;!o.destroyed&&o.destroy(),this.destroyCbs.forEach(s=>s()),this.destroyCbs=null}onDestroy(o){this.destroyCbs.push(o)}}class S0 extends M0{constructor(o){super(),this.moduleType=o}create(o){return new qE(this.moduleType,o)}}class WE extends Lc{constructor(o,s,u){super(),this.componentFactoryResolver=new mg(this),this.instance=null;const d=new kl([...o,{provide:Lc,useValue:this},{provide:Cc,useValue:this.componentFactoryResolver}],s||$n(),u,new Set(["environment"]));this.injector=d,d.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(o){this.injector.onDestroy(o)}}function gs(r,o,s=null){return new WE(r,o,s).injector}let QM=(()=>{class r{constructor(s){this._injector=s,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(s){if(!s.standalone)return null;if(!this.cachedInjectors.has(s.id)){const u=jy(0,s.type),d=u.length>0?gs([u],this._injector,`Standalone[${s.type.name}]`):null;this.cachedInjectors.set(s.id,d)}return this.cachedInjectors.get(s.id)}ngOnDestroy(){try{for(const s of this.cachedInjectors.values())null!==s&&s.destroy()}finally{this.cachedInjectors.clear()}}}return r.\u0275prov=Ut({token:r,providedIn:"environment",factory:()=>new r(Tt(Fs))}),r})();function ZE(r){r.getStandaloneInjector=o=>o.get(QM).getOrCreateStandaloneInjector(r)}function fp(r){return o=>{setTimeout(r,void 0,o)}}const Er=class u2 extends xe{constructor(o=!1){super(),this.__isAsync=o}emit(o){super.next(o)}subscribe(o,s,u){let d=o,m=s||(()=>null),x=u;if(o&&"object"==typeof o){const D=o;d=D.next?.bind(D),m=D.error?.bind(D),x=D.complete?.bind(D)}this.__isAsync&&(m=fp(m),d&&(d=fp(d)),x&&(x=fp(x)));const b=super.subscribe({next:d,error:m,complete:x});return o instanceof ce&&o.add(b),b}};let Vs=(()=>{class r{}return r.__NG_ELEMENT_ID__=N0,r})();const F0=Vs,ba=class extends F0{constructor(o,s,u){super(),this._declarationLView=o,this._declarationTContainer=s,this.elementRef=u}createEmbeddedView(o,s){const u=this._declarationTContainer.tViews,d=ag(this._declarationLView,u,o,16,null,u.declTNode,null,null,null,null,s||null);d[17]=this._declarationLView[this._declarationTContainer.index];const x=this._declarationLView[19];return null!==x&&(d[19]=x.createEmbeddedView(u)),jf(u,d,o),new Gf(d)}};function N0(){return function mp(r,o){return 4&r.type?new ba(o,r,ha(r,o)):null}(Ci(),Ne())}let _s=(()=>{class r{}return r.__NG_ELEMENT_ID__=z0,r})();function z0(){return function Xg(r,o){let s;const u=o[r.index];if(wo(u))s=u;else{let d;if(8&r.type)d=Pr(u);else{const m=o[11];d=m.createComment("");const x=Zi(r,o);bc(m,Ef(m,x),d,function uw(r,o){return r.nextSibling(o)}(m,x),!1)}o[r.index]=s=Cb(u,o,d,r),$f(o,s)}return new cC(s,r,o)}(Ci(),Ne())}const B0=_s,cC=class extends B0{constructor(o,s,u){super(),this._lContainer=o,this._hostTNode=s,this._hostLView=u}get element(){return ha(this._hostTNode,this._hostLView)}get injector(){return new Eo(this._hostTNode,this._hostLView)}get parentInjector(){const o=cm(this._hostTNode,this._hostLView);if(hu(o)){const s=xh(o,this._hostLView),u=du(o);return new Eo(s[1].data[u+8],s)}return new Eo(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(o){const s=Wg(this._lContainer);return null!==s&&s[o]||null}get length(){return this._lContainer.length-10}createEmbeddedView(o,s,u){let d,m;"number"==typeof u?d=u:null!=u&&(d=u.index,m=u.injector);const x=o.createEmbeddedView(s||{},m);return this.insert(x,d),x}createComponent(o,s,u,d,m){const x=o&&!function mo(r){return"function"==typeof r}(o);let b;if(x)b=s;else{const V=s||{};b=V.index,u=V.injector,d=V.projectableNodes,m=V.environmentInjector||V.ngModuleRef}const D=x?o:new qh(Pn(o)),P=u||this.parentInjector;if(!m&&null==D.ngModule){const Y=(x?P:this.parentInjector).get(Fs,null);Y&&(m=Y)}const F=D.create(P,d,void 0,m);return this.insert(F.hostView,b),F}insert(o,s){const u=o._lView,d=u[1];if(function om(r){return wo(r[3])}(u)){const F=this.indexOf(o);if(-1!==F)this.detach(F);else{const V=u[3],Y=new cC(V,V[6],V[3]);Y.detach(Y.indexOf(o))}}const m=this._adjustIndex(s),x=this._lContainer;!function aw(r,o,s,u){const d=10+u,m=s.length;u>0&&(s[d-1][4]=o),u<m-10?(o[4]=s[d],ry(s,10+u,o)):(s.push(o),o[4]=null),o[3]=s;const x=o[17];null!==x&&s!==x&&function lw(r,o){const s=r[9];o[16]!==o[3][3][16]&&(r[2]=!0),null===s?r[9]=[o]:s.push(o)}(x,o);const b=o[19];null!==b&&b.insertView(r),o[2]|=64}(d,u,x,m);const b=Om(m,x),D=u[11],P=Ef(D,x[7]);return null!==P&&function iw(r,o,s,u,d,m){u[0]=d,u[6]=o,Ah(r,u,s,1,d,m)}(d,x[6],D,u,P,b),o.attachToViewContainerRef(),ry(Zg(x),m,o),o}move(o,s){return this.insert(o,s)}indexOf(o){const s=Wg(this._lContainer);return null!==s?s.indexOf(o):-1}remove(o){const s=this._adjustIndex(o,-1),u=Rm(this._lContainer,s);u&&(gf(Zg(this._lContainer),s),St(u[1],u))}detach(o){const s=this._adjustIndex(o,-1),u=Rm(this._lContainer,s);return u&&null!=gf(Zg(this._lContainer),s)?new Gf(u):null}_adjustIndex(o,s=0){return o??this.length+s}};function Wg(r){return r[8]}function Zg(r){return r[8]||(r[8]=[])}function wp(...r){}const Uu=new Ht("Application Initializer");let $u=(()=>{class r{constructor(s){this.appInits=s,this.resolve=wp,this.reject=wp,this.initialized=!1,this.done=!1,this.donePromise=new Promise((u,d)=>{this.resolve=u,this.reject=d})}runInitializers(){if(this.initialized)return;const s=[],u=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let d=0;d<this.appInits.length;d++){const m=this.appInits[d]();if(kc(m))s.push(m);else if($v(m)){const x=new Promise((b,D)=>{m.subscribe({complete:b,error:D})});s.push(x)}}Promise.all(s).then(()=>{u()}).catch(d=>{this.reject(d)}),0===s.length&&u(),this.initialized=!0}}return r.\u0275fac=function(s){return new(s||r)(Tt(Uu,8))},r.\u0275prov=Ut({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const vd=new Ht("AppId",{providedIn:"root",factory:function ex(){return`${xd()}${xd()}${xd()}`}});function xd(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const Tn=new Ht("Platform Initializer"),tx=new Ht("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),CC=new Ht("appBootstrapListener");let N2=(()=>{class r{log(s){console.log(s)}warn(s){console.warn(s)}}return r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=Ut({token:r,factory:r.\u0275fac,providedIn:"platform"}),r})();const ol=new Ht("LocaleId",{providedIn:"root",factory:()=>Kr(ol,$t.Optional|$t.SkipSelf)||function TC(){return typeof $localize<"u"&&$localize.locale||Ou}()});class MC{constructor(o,s){this.ngModuleFactory=o,this.componentFactories=s}}let l_=(()=>{class r{compileModuleSync(s){return new S0(s)}compileModuleAsync(s){return Promise.resolve(this.compileModuleSync(s))}compileModuleAndAllComponentsSync(s){const u=this.compileModuleSync(s),m=fa(Hi(s).declarations).reduce((x,b)=>{const D=Pn(b);return D&&x.push(new qh(D)),x},[]);return new MC(u,m)}compileModuleAndAllComponentsAsync(s){return Promise.resolve(this.compileModuleAndAllComponentsSync(s))}clearCache(){}clearCacheFor(s){}getModuleId(s){}}return r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=Ut({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const j2=(()=>Promise.resolve(0))();function nx(r){typeof Zone>"u"?j2.then(()=>{r&&r.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",r)}class yi{constructor({enableLongStackTrace:o=!1,shouldCoalesceEventChangeDetection:s=!1,shouldCoalesceRunChangeDetection:u=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Er(!1),this.onMicrotaskEmpty=new Er(!1),this.onStable=new Er(!1),this.onError=new Er(!1),typeof Zone>"u")throw new Ue(908,!1);Zone.assertZonePatched();const d=this;if(d._nesting=0,d._outer=d._inner=Zone.current,Zone.AsyncStackTaggingZoneSpec){const m=Zone.AsyncStackTaggingZoneSpec;d._inner=d._inner.fork(new m("Angular"))}Zone.TaskTrackingZoneSpec&&(d._inner=d._inner.fork(new Zone.TaskTrackingZoneSpec)),o&&Zone.longStackTraceZoneSpec&&(d._inner=d._inner.fork(Zone.longStackTraceZoneSpec)),d.shouldCoalesceEventChangeDetection=!u&&s,d.shouldCoalesceRunChangeDetection=u,d.lastRequestAnimationFrameId=-1,d.nativeRequestAnimationFrame=function U2(){let r=Sn.requestAnimationFrame,o=Sn.cancelAnimationFrame;if(typeof Zone<"u"&&r&&o){const s=r[Zone.__symbol__("OriginalDelegate")];s&&(r=s);const u=o[Zone.__symbol__("OriginalDelegate")];u&&(o=u)}return{nativeRequestAnimationFrame:r,nativeCancelAnimationFrame:o}}().nativeRequestAnimationFrame,function $2(r){const o=()=>{!function kC(r){r.isCheckStableRunning||-1!==r.lastRequestAnimationFrameId||(r.lastRequestAnimationFrameId=r.nativeRequestAnimationFrame.call(Sn,()=>{r.fakeTopEventTask||(r.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{r.lastRequestAnimationFrameId=-1,ix(r),r.isCheckStableRunning=!0,rx(r),r.isCheckStableRunning=!1},void 0,()=>{},()=>{})),r.fakeTopEventTask.invoke()}),ix(r))}(r)};r._inner=r._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(s,u,d,m,x,b)=>{try{return ox(r),s.invokeTask(d,m,x,b)}finally{(r.shouldCoalesceEventChangeDetection&&"eventTask"===m.type||r.shouldCoalesceRunChangeDetection)&&o(),sx(r)}},onInvoke:(s,u,d,m,x,b,D)=>{try{return ox(r),s.invoke(d,m,x,b,D)}finally{r.shouldCoalesceRunChangeDetection&&o(),sx(r)}},onHasTask:(s,u,d,m)=>{s.hasTask(d,m),u===d&&("microTask"==m.change?(r._hasPendingMicrotasks=m.microTask,ix(r),rx(r)):"macroTask"==m.change&&(r.hasPendingMacrotasks=m.macroTask))},onHandleError:(s,u,d,m)=>(s.handleError(d,m),r.runOutsideAngular(()=>r.onError.emit(m)),!1)})}(d)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!yi.isInAngularZone())throw new Ue(909,!1)}static assertNotInAngularZone(){if(yi.isInAngularZone())throw new Ue(909,!1)}run(o,s,u){return this._inner.run(o,s,u)}runTask(o,s,u,d){const m=this._inner,x=m.scheduleEventTask("NgZoneEvent: "+d,o,RC,wp,wp);try{return m.runTask(x,s,u)}finally{m.cancelTask(x)}}runGuarded(o,s,u){return this._inner.runGuarded(o,s,u)}runOutsideAngular(o){return this._outer.run(o)}}const RC={};function rx(r){if(0==r._nesting&&!r.hasPendingMicrotasks&&!r.isStable)try{r._nesting++,r.onMicrotaskEmpty.emit(null)}finally{if(r._nesting--,!r.hasPendingMicrotasks)try{r.runOutsideAngular(()=>r.onStable.emit(null))}finally{r.isStable=!0}}}function ix(r){r.hasPendingMicrotasks=!!(r._hasPendingMicrotasks||(r.shouldCoalesceEventChangeDetection||r.shouldCoalesceRunChangeDetection)&&-1!==r.lastRequestAnimationFrameId)}function ox(r){r._nesting++,r.isStable&&(r.isStable=!1,r.onUnstable.emit(null))}function sx(r){r._nesting--,rx(r)}class H2{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Er,this.onMicrotaskEmpty=new Er,this.onStable=new Er,this.onError=new Er}run(o,s,u){return o.apply(s,u)}runGuarded(o,s,u){return o.apply(s,u)}runOutsideAngular(o){return o()}runTask(o,s,u,d){return o.apply(s,u)}}const OC=new Ht(""),c_=new Ht("");let h_,u_=(()=>{class r{constructor(s,u,d){this._ngZone=s,this.registry=u,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,h_||(function G2(r){h_=r}(d),d.addToWindow(u)),this._watchAngularEvents(),s.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{yi.assertNotInAngularZone(),nx(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())nx(()=>{for(;0!==this._callbacks.length;){let s=this._callbacks.pop();clearTimeout(s.timeoutId),s.doneCb(this._didWork)}this._didWork=!1});else{let s=this.getPendingTasks();this._callbacks=this._callbacks.filter(u=>!u.updateCb||!u.updateCb(s)||(clearTimeout(u.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(s=>({source:s.source,creationLocation:s.creationLocation,data:s.data})):[]}addCallback(s,u,d){let m=-1;u&&u>0&&(m=setTimeout(()=>{this._callbacks=this._callbacks.filter(x=>x.timeoutId!==m),s(this._didWork,this.getPendingTasks())},u)),this._callbacks.push({doneCb:s,timeoutId:m,updateCb:d})}whenStable(s,u,d){if(d&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(s,u,d),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(s){this.registry.registerApplication(s,this)}unregisterApplication(s){this.registry.unregisterApplication(s)}findProviders(s,u,d){return[]}}return r.\u0275fac=function(s){return new(s||r)(Tt(yi),Tt(ax),Tt(c_))},r.\u0275prov=Ut({token:r,factory:r.\u0275fac}),r})(),ax=(()=>{class r{constructor(){this._applications=new Map}registerApplication(s,u){this._applications.set(s,u)}unregisterApplication(s){this._applications.delete(s)}unregisterAllApplications(){this._applications.clear()}getTestability(s){return this._applications.get(s)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(s,u=!0){return h_?.findTestabilityInTree(this,s,u)??null}}return r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=Ut({token:r,factory:r.\u0275fac,providedIn:"platform"}),r})(),Nc=null;const LC=new Ht("AllowMultipleToken"),d_=new Ht("PlatformDestroyListeners");class NC{constructor(o,s){this.name=o,this.token=s}}function zC(r,o,s=[]){const u=`Platform: ${o}`,d=new Ht(u);return(m=[])=>{let x=hx();if(!x||x.injector.get(LC,!1)){const b=[...s,...m,{provide:d,useValue:!0}];r?r(b):function Wo(r){if(Nc&&!Nc.get(LC,!1))throw new Ue(400,!1);Nc=r;const o=r.get(BC);(function cx(r){const o=r.get(Tn,null);o&&o.forEach(s=>s())})(r)}(function ux(r=[],o){return _i.create({name:o,providers:[{provide:Wm,useValue:"platform"},{provide:d_,useValue:new Set([()=>Nc=null])},...r]})}(b,u))}return function f_(r){const o=hx();if(!o)throw new Ue(401,!1);return o}()}}function hx(){return Nc?.get(BC)??null}let BC=(()=>{class r{constructor(s){this._injector=s,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(s,u){const d=function dx(r,o){let s;return s="noop"===r?new H2:("zone.js"===r?void 0:r)||new yi(o),s}(u?.ngZone,function VC(r){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!r||!r.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!r||!r.ngZoneRunCoalescing)||!1}}(u)),m=[{provide:yi,useValue:d}];return d.run(()=>{const x=_i.create({providers:m,parent:this.injector,name:s.moduleType.name}),b=s.create(x),D=b.injector.get(Fh,null);if(!D)throw new Ue(402,!1);return d.runOutsideAngular(()=>{const P=d.onError.subscribe({next:F=>{D.handleError(F)}});b.onDestroy(()=>{Xl(this._modules,b),P.unsubscribe()})}),function p_(r,o,s){try{const u=s();return kc(u)?u.catch(d=>{throw o.runOutsideAngular(()=>r.handleError(d)),d}):u}catch(u){throw o.runOutsideAngular(()=>r.handleError(u)),u}}(D,d,()=>{const P=b.injector.get($u);return P.runInitializers(),P.donePromise.then(()=>(function c0(r){Ot(r,"Expected localeId to be defined"),"string"==typeof r&&(l0=r.toLowerCase().replace(/_/g,"-"))}(b.injector.get(ol,Ou)||Ou),this._moduleDoBootstrap(b),b))})})}bootstrapModule(s,u=[]){const d=fx({},u);return function FC(r,o,s){const u=new S0(s);return Promise.resolve(u)}(0,0,s).then(m=>this.bootstrapModuleFactory(m,d))}_moduleDoBootstrap(s){const u=s.injector.get(Hu);if(s._bootstrapComponents.length>0)s._bootstrapComponents.forEach(d=>u.bootstrap(d));else{if(!s.instance.ngDoBootstrap)throw new Ue(403,!1);s.instance.ngDoBootstrap(u)}this._modules.push(s)}onDestroy(s){this._destroyListeners.push(s)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Ue(404,!1);this._modules.slice().forEach(u=>u.destroy()),this._destroyListeners.forEach(u=>u());const s=this._injector.get(d_,null);s&&(s.forEach(u=>u()),s.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return r.\u0275fac=function(s){return new(s||r)(Tt(_i))},r.\u0275prov=Ut({token:r,factory:r.\u0275fac,providedIn:"platform"}),r})();function fx(r,o){return Array.isArray(o)?o.reduce(fx,r):{...r,...o}}let Hu=(()=>{class r{constructor(s,u,d){this._zone=s,this._injector=u,this._exceptionHandler=d,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const m=new ft(b=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{b.next(this._stable),b.complete()})}),x=new ft(b=>{let D;this._zone.runOutsideAngular(()=>{D=this._zone.onStable.subscribe(()=>{yi.assertNotInAngularZone(),nx(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,b.next(!0))})})});const P=this._zone.onUnstable.subscribe(()=>{yi.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{b.next(!1)}))});return()=>{D.unsubscribe(),P.unsubscribe()}});this.isStable=function oh(...r){const o=Ds(r),s=function jp(r,o){return"number"==typeof th(r)?r.pop():o}(r,1/0),u=r;return u.length?1===u.length?vn(u[0]):ka(s)(jr(u,o)):ki}(m,x.pipe(function Gn(r={}){const{connector:o=(()=>new xe),resetOnError:s=!0,resetOnComplete:u=!0,resetOnRefCountZero:d=!0}=r;return m=>{let x,b,D,P=0,F=!1,V=!1;const Y=()=>{b?.unsubscribe(),b=void 0},re=()=>{Y(),x=D=void 0,F=V=!1},pe=()=>{const Ce=x;re(),Ce?.unsubscribe()};return Zr((Ce,ze)=>{P++,!V&&!F&&Y();const $e=D=D??o();ze.add(()=>{P--,0===P&&!V&&!F&&(b=Ct(pe,d))}),$e.subscribe(ze),!x&&P>0&&(x=new pl({next:ct=>$e.next(ct),error:ct=>{V=!0,Y(),b=Ct(re,s,ct),$e.error(ct)},complete:()=>{F=!0,Y(),b=Ct(re,u),$e.complete()}}),vn(Ce).subscribe(x))})(m)}}()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(s,u){const d=s instanceof ps;if(!this._injector.get($u).done)throw!d&&function as(r){const o=Pn(r)||li(r)||$i(r);return null!==o&&o.standalone}(s),new Ue(405,false);let x;x=d?s:this._injector.get(Cc).resolveComponentFactory(s),this.componentTypes.push(x.componentType);const b=function q2(r){return r.isBoundToModule}(x)?void 0:this._injector.get(Lc),P=x.create(_i.NULL,[],u||x.selector,b),F=P.location.nativeElement,V=P.injector.get(OC,null);return V?.registerApplication(F),P.onDestroy(()=>{this.detachView(P.hostView),Xl(this.components,P),V?.unregisterApplication(F)}),this._loadComponent(P),P}tick(){if(this._runningTick)throw new Ue(101,!1);try{this._runningTick=!0;for(let s of this._views)s.detectChanges()}catch(s){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(s))}finally{this._runningTick=!1}}attachView(s){const u=s;this._views.push(u),u.attachToAppRef(this)}detachView(s){const u=s;Xl(this._views,u),u.detachFromAppRef()}_loadComponent(s){this.attachView(s.hostView),this.tick(),this.components.push(s),this._injector.get(CC,[]).concat(this._bootstrapListeners).forEach(d=>d(s))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(s=>s()),this._views.slice().forEach(s=>s.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(s){return this._destroyListeners.push(s),()=>Xl(this._destroyListeners,s)}destroy(){if(this._destroyed)throw new Ue(406,!1);const s=this._injector;s.destroy&&!s.destroyed&&s.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return r.\u0275fac=function(s){return new(s||r)(Tt(yi),Tt(Fs),Tt(Fh))},r.\u0275prov=Ut({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();function Xl(r,o){const s=r.indexOf(o);s>-1&&r.splice(s,1)}let UC=!0,m_=(()=>{class r{}return r.__NG_ELEMENT_ID__=K2,r})();function K2(r){return function GC(r,o,s){if(ch(r)&&!s){const u=Xi(r.index,o);return new Gf(u,u)}return 47&r.type?new Gf(o[16],o):null}(Ci(),Ne(),16==(16&r))}class XC{constructor(){}supports(o){return Wh(o)}create(o){return new YC(o)}}const nS=(r,o)=>o;class YC{constructor(o){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=o||nS}forEachItem(o){let s;for(s=this._itHead;null!==s;s=s._next)o(s)}forEachOperation(o){let s=this._itHead,u=this._removalsHead,d=0,m=null;for(;s||u;){const x=!u||s&&s.currentIndex<JC(u,d,m)?s:u,b=JC(x,d,m),D=x.currentIndex;if(x===u)d--,u=u._nextRemoved;else if(s=s._next,null==x.previousIndex)d++;else{m||(m=[]);const P=b-d,F=D-d;if(P!=F){for(let Y=0;Y<P;Y++){const re=Y<m.length?m[Y]:m[Y]=0,pe=re+Y;F<=pe&&pe<P&&(m[Y]=re+1)}m[x.previousIndex]=F-P}}b!==D&&o(x,b,D)}}forEachPreviousItem(o){let s;for(s=this._previousItHead;null!==s;s=s._nextPrevious)o(s)}forEachAddedItem(o){let s;for(s=this._additionsHead;null!==s;s=s._nextAdded)o(s)}forEachMovedItem(o){let s;for(s=this._movesHead;null!==s;s=s._nextMoved)o(s)}forEachRemovedItem(o){let s;for(s=this._removalsHead;null!==s;s=s._nextRemoved)o(s)}forEachIdentityChange(o){let s;for(s=this._identityChangesHead;null!==s;s=s._nextIdentityChange)o(s)}diff(o){if(null==o&&(o=[]),!Wh(o))throw new Ue(900,!1);return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let d,m,x,s=this._itHead,u=!1;if(Array.isArray(o)){this.length=o.length;for(let b=0;b<this.length;b++)m=o[b],x=this._trackByFn(b,m),null!==s&&Object.is(s.trackById,x)?(u&&(s=this._verifyReinsertion(s,m,x,b)),Object.is(s.item,m)||this._addIdentityChange(s,m)):(s=this._mismatch(s,m,x,b),u=!0),s=s._next}else d=0,function hM(r,o){if(Array.isArray(r))for(let s=0;s<r.length;s++)o(r[s]);else{const s=r[Rc()]();let u;for(;!(u=s.next()).done;)o(u.value)}}(o,b=>{x=this._trackByFn(d,b),null!==s&&Object.is(s.trackById,x)?(u&&(s=this._verifyReinsertion(s,b,x,d)),Object.is(s.item,b)||this._addIdentityChange(s,b)):(s=this._mismatch(s,b,x,d),u=!0),s=s._next,d++}),this.length=d;return this._truncate(s),this.collection=o,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let o;for(o=this._previousItHead=this._itHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._additionsHead;null!==o;o=o._nextAdded)o.previousIndex=o.currentIndex;for(this._additionsHead=this._additionsTail=null,o=this._movesHead;null!==o;o=o._nextMoved)o.previousIndex=o.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(o,s,u,d){let m;return null===o?m=this._itTail:(m=o._prev,this._remove(o)),null!==(o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(u,null))?(Object.is(o.item,s)||this._addIdentityChange(o,s),this._reinsertAfter(o,m,d)):null!==(o=null===this._linkedRecords?null:this._linkedRecords.get(u,d))?(Object.is(o.item,s)||this._addIdentityChange(o,s),this._moveAfter(o,m,d)):o=this._addAfter(new KC(s,u),m,d),o}_verifyReinsertion(o,s,u,d){let m=null===this._unlinkedRecords?null:this._unlinkedRecords.get(u,null);return null!==m?o=this._reinsertAfter(m,o._prev,d):o.currentIndex!=d&&(o.currentIndex=d,this._addToMoves(o,d)),o}_truncate(o){for(;null!==o;){const s=o._next;this._addToRemovals(this._unlink(o)),o=s}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(o,s,u){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(o);const d=o._prevRemoved,m=o._nextRemoved;return null===d?this._removalsHead=m:d._nextRemoved=m,null===m?this._removalsTail=d:m._prevRemoved=d,this._insertAfter(o,s,u),this._addToMoves(o,u),o}_moveAfter(o,s,u){return this._unlink(o),this._insertAfter(o,s,u),this._addToMoves(o,u),o}_addAfter(o,s,u){return this._insertAfter(o,s,u),this._additionsTail=null===this._additionsTail?this._additionsHead=o:this._additionsTail._nextAdded=o,o}_insertAfter(o,s,u){const d=null===s?this._itHead:s._next;return o._next=d,o._prev=s,null===d?this._itTail=o:d._prev=o,null===s?this._itHead=o:s._next=o,null===this._linkedRecords&&(this._linkedRecords=new zc),this._linkedRecords.put(o),o.currentIndex=u,o}_remove(o){return this._addToRemovals(this._unlink(o))}_unlink(o){null!==this._linkedRecords&&this._linkedRecords.remove(o);const s=o._prev,u=o._next;return null===s?this._itHead=u:s._next=u,null===u?this._itTail=s:u._prev=s,o}_addToMoves(o,s){return o.previousIndex===s||(this._movesTail=null===this._movesTail?this._movesHead=o:this._movesTail._nextMoved=o),o}_addToRemovals(o){return null===this._unlinkedRecords&&(this._unlinkedRecords=new zc),this._unlinkedRecords.put(o),o.currentIndex=null,o._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=o,o._prevRemoved=null):(o._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=o),o}_addIdentityChange(o,s){return o.item=s,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=o:this._identityChangesTail._nextIdentityChange=o,o}}class KC{constructor(o,s){this.item=o,this.trackById=s,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class rS{constructor(){this._head=null,this._tail=null}add(o){null===this._head?(this._head=this._tail=o,o._nextDup=null,o._prevDup=null):(this._tail._nextDup=o,o._prevDup=this._tail,o._nextDup=null,this._tail=o)}get(o,s){let u;for(u=this._head;null!==u;u=u._nextDup)if((null===s||s<=u.currentIndex)&&Object.is(u.trackById,o))return u;return null}remove(o){const s=o._prevDup,u=o._nextDup;return null===s?this._head=u:s._nextDup=u,null===u?this._tail=s:u._prevDup=s,null===this._head}}class zc{constructor(){this.map=new Map}put(o){const s=o.trackById;let u=this.map.get(s);u||(u=new rS,this.map.set(s,u)),u.add(o)}get(o,s){const d=this.map.get(o);return d?d.get(o,s):null}remove(o){const s=o.trackById;return this.map.get(s).remove(o)&&this.map.delete(s),o}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function JC(r,o,s){const u=r.previousIndex;if(null===u)return u;let d=0;return s&&u<s.length&&(d=s[u]),u+o+d}function _x(){return new bd([new XC])}let bd=(()=>{class r{constructor(s){this.factories=s}static create(s,u){if(null!=u){const d=u.factories.slice();s=s.concat(d)}return new r(s)}static extend(s){return{provide:r,useFactory:u=>r.create(s,u||_x()),deps:[[r,new Ml,new yu]]}}find(s){const u=this.factories.find(d=>d.supports(s));if(null!=u)return u;throw new Ue(901,!1)}}return r.\u0275prov=Ut({token:r,providedIn:"root",factory:_x}),r})();const cS=zC(null,"core",[]);let Ca=(()=>{class r{constructor(s){}}return r.\u0275fac=function(s){return new(s||r)(Tt(Hu))},r.\u0275mod=Yr({type:r}),r.\u0275inj=wi({}),r})();let __=null;function ll(){return __}const Lo=new Ht("DocumentToken");let Dp=(()=>{class r{historyGo(s){throw new Error("Not implemented")}}return r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=Ut({token:r,factory:function(){return function fS(){return Tt(y_)}()},providedIn:"platform"}),r})();const pS=new Ht("Location Initialized");let y_=(()=>{class r extends Dp{constructor(s){super(),this._doc=s,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return ll().getBaseHref(this._doc)}onPopState(s){const u=ll().getGlobalEventTarget(this._doc,"window");return u.addEventListener("popstate",s,!1),()=>u.removeEventListener("popstate",s)}onHashChange(s){const u=ll().getGlobalEventTarget(this._doc,"window");return u.addEventListener("hashchange",s,!1),()=>u.removeEventListener("hashchange",s)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(s){this.location.pathname=s}pushState(s,u,d){tT()?this._history.pushState(s,u,d):this.location.hash=d}replaceState(s,u,d){tT()?this._history.replaceState(s,u,d):this.location.hash=d}forward(){this._history.forward()}back(){this._history.back()}historyGo(s=0){this._history.go(s)}getState(){return this._history.state}}return r.\u0275fac=function(s){return new(s||r)(Tt(Lo))},r.\u0275prov=Ut({token:r,factory:function(){return function nT(){return new y_(Tt(Lo))}()},providedIn:"platform"}),r})();function tT(){return!!window.history.pushState}function v_(r,o){if(0==r.length)return o;if(0==o.length)return r;let s=0;return r.endsWith("/")&&s++,o.startsWith("/")&&s++,2==s?r+o.substring(1):1==s?r+o:r+"/"+o}function rT(r){const o=r.match(/#|\?|$/),s=o&&o.index||r.length;return r.slice(0,s-("/"===r[s-1]?1:0))+r.slice(s)}function Ta(r){return r&&"?"!==r[0]?"?"+r:r}let cl=(()=>{class r{historyGo(s){throw new Error("Not implemented")}}return r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=Ut({token:r,factory:function(){return Kr(iT)},providedIn:"root"}),r})();const Ex=new Ht("appBaseHref");let iT=(()=>{class r extends cl{constructor(s,u){super(),this._platformLocation=s,this._removeListenerFns=[],this._baseHref=u??this._platformLocation.getBaseHrefFromDOM()??Kr(Lo).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(s){this._removeListenerFns.push(this._platformLocation.onPopState(s),this._platformLocation.onHashChange(s))}getBaseHref(){return this._baseHref}prepareExternalUrl(s){return v_(this._baseHref,s)}path(s=!1){const u=this._platformLocation.pathname+Ta(this._platformLocation.search),d=this._platformLocation.hash;return d&&s?`${u}${d}`:u}pushState(s,u,d,m){const x=this.prepareExternalUrl(d+Ta(m));this._platformLocation.pushState(s,u,x)}replaceState(s,u,d,m){const x=this.prepareExternalUrl(d+Ta(m));this._platformLocation.replaceState(s,u,x)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(s=0){this._platformLocation.historyGo?.(s)}}return r.\u0275fac=function(s){return new(s||r)(Tt(Dp),Tt(Ex,8))},r.\u0275prov=Ut({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),oT=(()=>{class r extends cl{constructor(s,u){super(),this._platformLocation=s,this._baseHref="",this._removeListenerFns=[],null!=u&&(this._baseHref=u)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(s){this._removeListenerFns.push(this._platformLocation.onPopState(s),this._platformLocation.onHashChange(s))}getBaseHref(){return this._baseHref}path(s=!1){let u=this._platformLocation.hash;return null==u&&(u="#"),u.length>0?u.substring(1):u}prepareExternalUrl(s){const u=v_(this._baseHref,s);return u.length>0?"#"+u:u}pushState(s,u,d,m){let x=this.prepareExternalUrl(d+Ta(m));0==x.length&&(x=this._platformLocation.pathname),this._platformLocation.pushState(s,u,x)}replaceState(s,u,d,m){let x=this.prepareExternalUrl(d+Ta(m));0==x.length&&(x=this._platformLocation.pathname),this._platformLocation.replaceState(s,u,x)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(s=0){this._platformLocation.historyGo?.(s)}}return r.\u0275fac=function(s){return new(s||r)(Tt(Dp),Tt(Ex,8))},r.\u0275prov=Ut({token:r,factory:r.\u0275fac}),r})(),Cx=(()=>{class r{constructor(s){this._subject=new Er,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=s;const u=this._locationStrategy.getBaseHref();this._baseHref=rT(sT(u)),this._locationStrategy.onPopState(d=>{this._subject.emit({url:this.path(!0),pop:!0,state:d.state,type:d.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(s=!1){return this.normalize(this._locationStrategy.path(s))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(s,u=""){return this.path()==this.normalize(s+Ta(u))}normalize(s){return r.stripTrailingSlash(function mS(r,o){return r&&o.startsWith(r)?o.substring(r.length):o}(this._baseHref,sT(s)))}prepareExternalUrl(s){return s&&"/"!==s[0]&&(s="/"+s),this._locationStrategy.prepareExternalUrl(s)}go(s,u="",d=null){this._locationStrategy.pushState(d,"",s,u),this._notifyUrlChangeListeners(this.prepareExternalUrl(s+Ta(u)),d)}replaceState(s,u="",d=null){this._locationStrategy.replaceState(d,"",s,u),this._notifyUrlChangeListeners(this.prepareExternalUrl(s+Ta(u)),d)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(s=0){this._locationStrategy.historyGo?.(s)}onUrlChange(s){return this._urlChangeListeners.push(s),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(u=>{this._notifyUrlChangeListeners(u.url,u.state)})),()=>{const u=this._urlChangeListeners.indexOf(s);this._urlChangeListeners.splice(u,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(s="",u){this._urlChangeListeners.forEach(d=>d(s,u))}subscribe(s,u,d){return this._subject.subscribe({next:s,error:u,complete:d})}}return r.normalizeQueryParams=Ta,r.joinWithSlash=v_,r.stripTrailingSlash=rT,r.\u0275fac=function(s){return new(s||r)(Tt(cl))},r.\u0275prov=Ut({token:r,factory:function(){return function Tx(){return new Cx(Tt(cl))}()},providedIn:"root"}),r})();function sT(r){return r.replace(/\/index.html$/,"")}function Dt(r,o){o=encodeURIComponent(o);for(const s of r.split(";")){const u=s.indexOf("="),[d,m]=-1==u?[s,""]:[s.slice(0,u),s.slice(u+1)];if(d.trim()===o)return decodeURIComponent(m)}return null}class Bt{constructor(o,s,u,d){this.$implicit=o,this.ngForOf=s,this.index=u,this.count=d}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Rn=(()=>{class r{constructor(s,u,d){this._viewContainer=s,this._template=u,this._differs=d,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(s){this._ngForOf=s,this._ngForOfDirty=!0}set ngForTrackBy(s){this._trackByFn=s}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(s){s&&(this._template=s)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const s=this._ngForOf;!this._differ&&s&&(this._differ=this._differs.find(s).create(this.ngForTrackBy))}if(this._differ){const s=this._differ.diff(this._ngForOf);s&&this._applyChanges(s)}}_applyChanges(s){const u=this._viewContainer;s.forEachOperation((d,m,x)=>{if(null==d.previousIndex)u.createEmbeddedView(this._template,new Bt(d.item,this._ngForOf,-1,-1),null===x?void 0:x);else if(null==x)u.remove(null===m?void 0:m);else if(null!==m){const b=u.get(m);u.move(b,x),Jn(b,d)}});for(let d=0,m=u.length;d<m;d++){const b=u.get(d).context;b.index=d,b.count=m,b.ngForOf=this._ngForOf}s.forEachIdentityChange(d=>{Jn(u.get(d.currentIndex),d)})}static ngTemplateContextGuard(s,u){return!0}}return r.\u0275fac=function(s){return new(s||r)(Ze(_s),Ze(Vs),Ze(bd))},r.\u0275dir=Qt({type:r,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),r})();function Jn(r,o){r.context.$implicit=o.item}let dO=(()=>{class r{}return r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=Yr({type:r}),r.\u0275inj=wi({}),r})();let gO=(()=>{class r{}return r.\u0275prov=Ut({token:r,providedIn:"root",factory:()=>new _O(Tt(Lo),window)}),r})();class _O{constructor(o,s){this.document=o,this.window=s,this.offset=()=>[0,0]}setOffset(o){this.offset=Array.isArray(o)?()=>o:o}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(o){this.supportsScrolling()&&this.window.scrollTo(o[0],o[1])}scrollToAnchor(o){if(!this.supportsScrolling())return;const s=function yO(r,o){const s=r.getElementById(o)||r.getElementsByName(o)[0];if(s)return s;if("function"==typeof r.createTreeWalker&&r.body&&(r.body.createShadowRoot||r.body.attachShadow)){const u=r.createTreeWalker(r.body,NodeFilter.SHOW_ELEMENT);let d=u.currentNode;for(;d;){const m=d.shadowRoot;if(m){const x=m.getElementById(o)||m.querySelector(`[name="${o}"]`);if(x)return x}d=u.nextNode()}}return null}(this.document,o);s&&(this.scrollToElement(s),s.focus())}setHistoryScrollRestoration(o){if(this.supportScrollRestoration()){const s=this.window.history;s&&s.scrollRestoration&&(s.scrollRestoration=o)}}scrollToElement(o){const s=o.getBoundingClientRect(),u=s.left+this.window.pageXOffset,d=s.top+this.window.pageYOffset,m=this.offset();this.window.scrollTo(u-m[0],d-m[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const o=tP(this.window.history)||tP(Object.getPrototypeOf(this.window.history));return!(!o||!o.writable&&!o.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function tP(r){return Object.getOwnPropertyDescriptor(r,"scrollRestoration")}class nP{}class OS extends class GO extends class bx{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function dS(r){__||(__=r)}(new OS)}onAndCancel(o,s,u){return o.addEventListener(s,u,!1),()=>{o.removeEventListener(s,u,!1)}}dispatchEvent(o,s){o.dispatchEvent(s)}remove(o){o.parentNode&&o.parentNode.removeChild(o)}createElement(o,s){return(s=s||this.getDefaultDocument()).createElement(o)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(o){return o.nodeType===Node.ELEMENT_NODE}isShadowRoot(o){return o instanceof DocumentFragment}getGlobalEventTarget(o,s){return"window"===s?window:"document"===s?o:"body"===s?o.body:null}getBaseHref(o){const s=function qO(){return Fx=Fx||document.querySelector("base"),Fx?Fx.getAttribute("href"):null}();return null==s?null:function WO(r){vT=vT||document.createElement("a"),vT.setAttribute("href",r);const o=vT.pathname;return"/"===o.charAt(0)?o:`/${o}`}(s)}resetBaseElement(){Fx=null}getUserAgent(){return window.navigator.userAgent}getCookie(o){return Dt(document.cookie,o)}}let vT,Fx=null;const aP=new Ht("TRANSITION_ID"),XO=[{provide:Uu,useFactory:function ZO(r,o,s){return()=>{s.get($u).donePromise.then(()=>{const u=ll(),d=o.querySelectorAll(`style[ng-transition="${r}"]`);for(let m=0;m<d.length;m++)u.remove(d[m])})}},deps:[aP,Lo,_i],multi:!0}];let KO=(()=>{class r{build(){return new XMLHttpRequest}}return r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=Ut({token:r,factory:r.\u0275fac}),r})();const xT=new Ht("EventManagerPlugins");let wT=(()=>{class r{constructor(s,u){this._zone=u,this._eventNameToPlugin=new Map,s.forEach(d=>d.manager=this),this._plugins=s.slice().reverse()}addEventListener(s,u,d){return this._findPluginFor(u).addEventListener(s,u,d)}addGlobalEventListener(s,u,d){return this._findPluginFor(u).addGlobalEventListener(s,u,d)}getZone(){return this._zone}_findPluginFor(s){const u=this._eventNameToPlugin.get(s);if(u)return u;const d=this._plugins;for(let m=0;m<d.length;m++){const x=d[m];if(x.supports(s))return this._eventNameToPlugin.set(s,x),x}throw new Error(`No event manager plugin found for event ${s}`)}}return r.\u0275fac=function(s){return new(s||r)(Tt(xT),Tt(yi))},r.\u0275prov=Ut({token:r,factory:r.\u0275fac}),r})();class lP{constructor(o){this._doc=o}addGlobalEventListener(o,s,u){const d=ll().getGlobalEventTarget(this._doc,o);if(!d)throw new Error(`Unsupported event target ${d} for event ${s}`);return this.addEventListener(d,s,u)}}let cP=(()=>{class r{constructor(){this._stylesSet=new Set}addStyles(s){const u=new Set;s.forEach(d=>{this._stylesSet.has(d)||(this._stylesSet.add(d),u.add(d))}),this.onStylesAdded(u)}onStylesAdded(s){}getAllStyles(){return Array.from(this._stylesSet)}}return r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=Ut({token:r,factory:r.\u0275fac}),r})(),Nx=(()=>{class r extends cP{constructor(s){super(),this._doc=s,this._hostNodes=new Map,this._hostNodes.set(s.head,[])}_addStylesToHost(s,u,d){s.forEach(m=>{const x=this._doc.createElement("style");x.textContent=m,d.push(u.appendChild(x))})}addHost(s){const u=[];this._addStylesToHost(this._stylesSet,s,u),this._hostNodes.set(s,u)}removeHost(s){const u=this._hostNodes.get(s);u&&u.forEach(uP),this._hostNodes.delete(s)}onStylesAdded(s){this._hostNodes.forEach((u,d)=>{this._addStylesToHost(s,d,u)})}ngOnDestroy(){this._hostNodes.forEach(s=>s.forEach(uP))}}return r.\u0275fac=function(s){return new(s||r)(Tt(Lo))},r.\u0275prov=Ut({token:r,factory:r.\u0275fac}),r})();function uP(r){ll().remove(r)}const LS={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},FS=/%COMP%/g;function bT(r,o,s){for(let u=0;u<o.length;u++){let d=o[u];Array.isArray(d)?bT(r,d,s):(d=d.replace(FS,r),s.push(d))}return s}function fP(r){return o=>{if("__ngUnwrap__"===o)return r;!1===r(o)&&(o.preventDefault(),o.returnValue=!1)}}let NS=(()=>{class r{constructor(s,u,d){this.eventManager=s,this.sharedStylesHost=u,this.appId=d,this.rendererByCompId=new Map,this.defaultRenderer=new zS(s)}createRenderer(s,u){if(!s||!u)return this.defaultRenderer;switch(u.encapsulation){case Yn.Emulated:{let d=this.rendererByCompId.get(u.id);return d||(d=new rL(this.eventManager,this.sharedStylesHost,u,this.appId),this.rendererByCompId.set(u.id,d)),d.applyToHost(s),d}case 1:case Yn.ShadowDom:return new iL(this.eventManager,this.sharedStylesHost,s,u);default:if(!this.rendererByCompId.has(u.id)){const d=bT(u.id,u.styles,[]);this.sharedStylesHost.addStyles(d),this.rendererByCompId.set(u.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return r.\u0275fac=function(s){return new(s||r)(Tt(wT),Tt(Nx),Tt(vd))},r.\u0275prov=Ut({token:r,factory:r.\u0275fac}),r})();class zS{constructor(o){this.eventManager=o,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(o,s){return s?document.createElementNS(LS[s]||s,o):document.createElement(o)}createComment(o){return document.createComment(o)}createText(o){return document.createTextNode(o)}appendChild(o,s){(mP(o)?o.content:o).appendChild(s)}insertBefore(o,s,u){o&&(mP(o)?o.content:o).insertBefore(s,u)}removeChild(o,s){o&&o.removeChild(s)}selectRootElement(o,s){let u="string"==typeof o?document.querySelector(o):o;if(!u)throw new Error(`The selector "${o}" did not match any elements`);return s||(u.textContent=""),u}parentNode(o){return o.parentNode}nextSibling(o){return o.nextSibling}setAttribute(o,s,u,d){if(d){s=d+":"+s;const m=LS[d];m?o.setAttributeNS(m,s,u):o.setAttribute(s,u)}else o.setAttribute(s,u)}removeAttribute(o,s,u){if(u){const d=LS[u];d?o.removeAttributeNS(d,s):o.removeAttribute(`${u}:${s}`)}else o.removeAttribute(s)}addClass(o,s){o.classList.add(s)}removeClass(o,s){o.classList.remove(s)}setStyle(o,s,u,d){d&(Uo.DashCase|Uo.Important)?o.style.setProperty(s,u,d&Uo.Important?"important":""):o.style[s]=u}removeStyle(o,s,u){u&Uo.DashCase?o.style.removeProperty(s):o.style[s]=""}setProperty(o,s,u){o[s]=u}setValue(o,s){o.nodeValue=s}listen(o,s,u){return"string"==typeof o?this.eventManager.addGlobalEventListener(o,s,fP(u)):this.eventManager.addEventListener(o,s,fP(u))}}function mP(r){return"TEMPLATE"===r.tagName&&void 0!==r.content}class rL extends zS{constructor(o,s,u,d){super(o),this.component=u;const m=bT(d+"-"+u.id,u.styles,[]);s.addStyles(m),this.contentAttr=function eL(r){return"_ngcontent-%COMP%".replace(FS,r)}(d+"-"+u.id),this.hostAttr=function tL(r){return"_nghost-%COMP%".replace(FS,r)}(d+"-"+u.id)}applyToHost(o){super.setAttribute(o,this.hostAttr,"")}createElement(o,s){const u=super.createElement(o,s);return super.setAttribute(u,this.contentAttr,""),u}}class iL extends zS{constructor(o,s,u,d){super(o),this.sharedStylesHost=s,this.hostEl=u,this.shadowRoot=u.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const m=bT(d.id,d.styles,[]);for(let x=0;x<m.length;x++){const b=document.createElement("style");b.textContent=m[x],this.shadowRoot.appendChild(b)}}nodeOrShadowRoot(o){return o===this.hostEl?this.shadowRoot:o}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(o,s){return super.appendChild(this.nodeOrShadowRoot(o),s)}insertBefore(o,s,u){return super.insertBefore(this.nodeOrShadowRoot(o),s,u)}removeChild(o,s){return super.removeChild(this.nodeOrShadowRoot(o),s)}parentNode(o){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(o)))}}let oL=(()=>{class r extends lP{constructor(s){super(s)}supports(s){return!0}addEventListener(s,u,d){return s.addEventListener(u,d,!1),()=>this.removeEventListener(s,u,d)}removeEventListener(s,u,d){return s.removeEventListener(u,d)}}return r.\u0275fac=function(s){return new(s||r)(Tt(Lo))},r.\u0275prov=Ut({token:r,factory:r.\u0275fac}),r})();const gP=["alt","control","meta","shift"],sL={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},aL={alt:r=>r.altKey,control:r=>r.ctrlKey,meta:r=>r.metaKey,shift:r=>r.shiftKey};let lL=(()=>{class r extends lP{constructor(s){super(s)}supports(s){return null!=r.parseEventName(s)}addEventListener(s,u,d){const m=r.parseEventName(u),x=r.eventCallback(m.fullKey,d,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>ll().onAndCancel(s,m.domEventName,x))}static parseEventName(s){const u=s.toLowerCase().split("."),d=u.shift();if(0===u.length||"keydown"!==d&&"keyup"!==d)return null;const m=r._normalizeKey(u.pop());let x="",b=u.indexOf("code");if(b>-1&&(u.splice(b,1),x="code."),gP.forEach(P=>{const F=u.indexOf(P);F>-1&&(u.splice(F,1),x+=P+".")}),x+=m,0!=u.length||0===m.length)return null;const D={};return D.domEventName=d,D.fullKey=x,D}static matchEventFullKeyCode(s,u){let d=sL[s.key]||s.key,m="";return u.indexOf("code.")>-1&&(d=s.code,m="code."),!(null==d||!d)&&(d=d.toLowerCase()," "===d?d="space":"."===d&&(d="dot"),gP.forEach(x=>{x!==d&&(0,aL[x])(s)&&(m+=x+".")}),m+=d,m===u)}static eventCallback(s,u,d){return m=>{r.matchEventFullKeyCode(m,s)&&d.runGuarded(()=>u(m))}}static _normalizeKey(s){return"esc"===s?"escape":s}}return r.\u0275fac=function(s){return new(s||r)(Tt(Lo))},r.\u0275prov=Ut({token:r,factory:r.\u0275fac}),r})();const dL=zC(cS,"browser",[{provide:tx,useValue:"browser"},{provide:Tn,useValue:function cL(){OS.makeCurrent()},multi:!0},{provide:Lo,useFactory:function hL(){return function _w(r){Vm=r}(document),document},deps:[]}]),vP=new Ht(""),xP=[{provide:c_,useClass:class YO{addToWindow(o){Sn.getAngularTestability=(u,d=!0)=>{const m=o.findTestabilityInTree(u,d);if(null==m)throw new Error("Could not find testability for element.");return m},Sn.getAllAngularTestabilities=()=>o.getAllTestabilities(),Sn.getAllAngularRootElements=()=>o.getAllRootElements(),Sn.frameworkStabilizers||(Sn.frameworkStabilizers=[]),Sn.frameworkStabilizers.push(u=>{const d=Sn.getAllAngularTestabilities();let m=d.length,x=!1;const b=function(D){x=x||D,m--,0==m&&u(x)};d.forEach(function(D){D.whenStable(b)})})}findTestabilityInTree(o,s,u){return null==s?null:o.getTestability(s)??(u?ll().isShadowRoot(s)?this.findTestabilityInTree(o,s.host,!0):this.findTestabilityInTree(o,s.parentElement,!0):null)}},deps:[]},{provide:OC,useClass:u_,deps:[yi,ax,c_]},{provide:u_,useClass:u_,deps:[yi,ax,c_]}],wP=[{provide:Wm,useValue:"root"},{provide:Fh,useFactory:function uL(){return new Fh},deps:[]},{provide:xT,useClass:oL,multi:!0,deps:[Lo,yi,tx]},{provide:xT,useClass:lL,multi:!0,deps:[Lo]},{provide:NS,useClass:NS,deps:[wT,Nx,vd]},{provide:Xy,useExisting:NS},{provide:cP,useExisting:Nx},{provide:Nx,useClass:Nx,deps:[Lo]},{provide:wT,useClass:wT,deps:[xT,yi]},{provide:nP,useClass:KO,deps:[]},[]];let fL=(()=>{class r{constructor(s){}static withServerTransition(s){return{ngModule:r,providers:[{provide:vd,useValue:s.appId},{provide:aP,useExisting:vd},XO]}}}return r.\u0275fac=function(s){return new(s||r)(Tt(vP,12))},r.\u0275mod=Yr({type:r}),r.\u0275inj=wi({providers:[...wP,...xP],imports:[dO,Ca]}),r})(),bP=(()=>{class r{constructor(s){this._doc=s}getTitle(){return this._doc.title}setTitle(s){this._doc.title=s||""}}return r.\u0275fac=function(s){return new(s||r)(Tt(Lo))},r.\u0275prov=Ut({token:r,factory:function(s){let u=null;return u=s?new s:function mL(){return new bP(Tt(Lo))}(),u},providedIn:"root"}),r})();function tn(...r){return jr(r,Ds(r))}typeof window<"u"&&window;class Jl extends xe{constructor(o){super(),this._value=o}get value(){return this.getValue()}_subscribe(o){const s=super._subscribe(o);return!s.closed&&o.next(this._value),s}getValue(){const{hasError:o,thrownError:s,_value:u}=this;if(o)throw s;return this._throwIfClosed(),u}next(o){super.next(this._value=o)}}const ET=zr(r=>function(){r(this),this.name="EmptyError",this.message="no elements in sequence"}),{isArray:EL}=Array,{getPrototypeOf:CL,prototype:TL,keys:DL}=Object;function TP(r){if(1===r.length){const o=r[0];if(EL(o))return{args:o,keys:null};if(function ML(r){return r&&"object"==typeof r&&CL(r)===TL}(o)){const s=DL(o);return{args:s.map(u=>o[u]),keys:s}}}return{args:r,keys:null}}const{isArray:SL}=Array;function DP(r){return rn(o=>function AL(r,o){return SL(o)?r(...o):r(o)}(r,o))}function MP(r,o){return r.reduce((s,u,d)=>(s[u]=o[d],s),{})}function SP(...r){const o=Ds(r),s=Vp(r),{args:u,keys:d}=TP(r);if(0===u.length)return jr([],o);const m=new ft(function IL(r,o,s=qs){return u=>{AP(o,()=>{const{length:d}=r,m=new Array(d);let x=d,b=d;for(let D=0;D<d;D++)AP(o,()=>{const P=jr(r[D],o);let F=!1;P.subscribe(vr(u,V=>{m[D]=V,F||(F=!0,b--),b||u.next(s(m.slice()))},()=>{--x||u.complete()}))},u)},u)}}(u,o,d?x=>MP(d,x):qs));return s?m.pipe(DP(s)):m}function AP(r,o,s){r?lo(s,r,o):o()}function jS(...r){return function PL(){return ka(1)}()(jr(r,Ds(r)))}function IP(r){return new ft(o=>{vn(r()).subscribe(o)})}function zx(r,o){const s=Fn(r)?r:()=>r,u=d=>d.error(s());return new ft(o?d=>o.schedule(u,0,d):u)}function US(){return Zr((r,o)=>{let s=null;r._refCount++;const u=vr(o,void 0,void 0,void 0,()=>{if(!r||r._refCount<=0||0<--r._refCount)return void(s=null);const d=r._connection,m=s;s=null,d&&(!m||d===m)&&d.unsubscribe(),o.unsubscribe()});r.subscribe(u),u.closed||(s=r.connect())})}class PP extends ft{constructor(o,s){super(),this.source=o,this.subjectFactory=s,this._subject=null,this._refCount=0,this._connection=null,fi(o)&&(this.lift=o.lift)}_subscribe(o){return this.getSubject().subscribe(o)}getSubject(){const o=this._subject;return(!o||o.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:o}=this;this._subject=this._connection=null,o?.unsubscribe()}connect(){let o=this._connection;if(!o){o=this._connection=new ce;const s=this.getSubject();o.add(this.source.subscribe(vr(s,void 0,()=>{this._teardown(),s.complete()},u=>{this._teardown(),s.error(u)},()=>this._teardown()))),o.closed&&(this._connection=null,o=ce.EMPTY)}return o}refCount(){return US()(this)}}function jc(r,o){return Zr((s,u)=>{let d=null,m=0,x=!1;const b=()=>x&&!d&&u.complete();s.subscribe(vr(u,D=>{d?.unsubscribe();let P=0;const F=m++;vn(r(D,F)).subscribe(d=vr(u,V=>u.next(o?o(D,V,F,P++):V),()=>{d=null,b()}))},()=>{x=!0,b()}))})}function Bx(r){return r<=0?()=>ki:Zr((o,s)=>{let u=0;o.subscribe(vr(s,d=>{++u<=r&&(s.next(d),r<=u&&s.complete())}))})}function Xu(r,o){return Zr((s,u)=>{let d=0;s.subscribe(vr(u,m=>r.call(o,m,d++)&&u.next(m)))})}function CT(r){return Zr((o,s)=>{let u=!1;o.subscribe(vr(s,d=>{u=!0,s.next(d)},()=>{u||s.next(r),s.complete()}))})}function RP(r=kL){return Zr((o,s)=>{let u=!1;o.subscribe(vr(s,d=>{u=!0,s.next(d)},()=>u?s.complete():s.error(r())))})}function kL(){return new ET}function Td(r,o){const s=arguments.length>=2;return u=>u.pipe(r?Xu((d,m)=>r(d,m,u)):qs,Bx(1),s?CT(o):RP(()=>new ET))}function Dd(r,o){return Fn(o)?Vr(r,o,1):Vr(r,1)}function Yo(r,o,s){const u=Fn(r)||o||s?{next:r,error:o,complete:s}:r;return u?Zr((d,m)=>{var x;null===(x=u.subscribe)||void 0===x||x.call(u);let b=!0;d.subscribe(vr(m,D=>{var P;null===(P=u.next)||void 0===P||P.call(u,D),m.next(D)},()=>{var D;b=!1,null===(D=u.complete)||void 0===D||D.call(u),m.complete()},D=>{var P;b=!1,null===(P=u.error)||void 0===P||P.call(u,D),m.error(D)},()=>{var D,P;b&&(null===(D=u.unsubscribe)||void 0===D||D.call(u)),null===(P=u.finalize)||void 0===P||P.call(u)}))}):qs}function Md(r){return Zr((o,s)=>{let m,u=null,d=!1;u=o.subscribe(vr(s,void 0,void 0,x=>{m=vn(r(x,Md(r)(o))),u?(u.unsubscribe(),u=null,m.subscribe(s)):d=!0})),d&&(u.unsubscribe(),u=null,m.subscribe(s))})}function OL(r,o,s,u,d){return(m,x)=>{let b=s,D=o,P=0;m.subscribe(vr(x,F=>{const V=P++;D=b?r(D,F,V):(b=!0,F),u&&x.next(D)},d&&(()=>{b&&x.next(D),x.complete()})))}}function kP(r,o){return Zr(OL(r,o,arguments.length>=2,!0))}function $S(r){return r<=0?()=>ki:Zr((o,s)=>{let u=[];o.subscribe(vr(s,d=>{u.push(d),r<u.length&&u.shift()},()=>{for(const d of u)s.next(d);s.complete()},void 0,()=>{u=null}))})}function OP(r,o){const s=arguments.length>=2;return u=>u.pipe(r?Xu((d,m)=>r(d,m,u)):qs,$S(1),s?CT(o):RP(()=>new ET))}function HS(r){return Zr((o,s)=>{try{o.subscribe(s)}finally{s.add(r)}})}const Ln="primary",Vx=Symbol("RouteTitle");class NL{constructor(o){this.params=o||{}}has(o){return Object.prototype.hasOwnProperty.call(this.params,o)}get(o){if(this.has(o)){const s=this.params[o];return Array.isArray(s)?s[0]:s}return null}getAll(o){if(this.has(o)){const s=this.params[o];return Array.isArray(s)?s:[s]}return[]}get keys(){return Object.keys(this.params)}}function T_(r){return new NL(r)}function zL(r,o,s){const u=s.path.split("/");if(u.length>r.length||"full"===s.pathMatch&&(o.hasChildren()||u.length<r.length))return null;const d={};for(let m=0;m<u.length;m++){const x=u[m],b=r[m];if(x.startsWith(":"))d[x.substring(1)]=b;else if(x!==b.path)return null}return{consumed:r.slice(0,u.length),posParams:d}}function Uc(r,o){const s=r?Object.keys(r):void 0,u=o?Object.keys(o):void 0;if(!s||!u||s.length!=u.length)return!1;let d;for(let m=0;m<s.length;m++)if(d=s[m],!LP(r[d],o[d]))return!1;return!0}function LP(r,o){if(Array.isArray(r)&&Array.isArray(o)){if(r.length!==o.length)return!1;const s=[...r].sort(),u=[...o].sort();return s.every((d,m)=>u[m]===d)}return r===o}function FP(r){return Array.prototype.concat.apply([],r)}function NP(r){return r.length>0?r[r.length-1]:null}function No(r,o){for(const s in r)r.hasOwnProperty(s)&&o(r[s],s)}function Sd(r){return $v(r)?r:kc(r)?jr(Promise.resolve(r)):tn(r)}const jL={exact:function VP(r,o,s){if(!Rp(r.segments,o.segments)||!TT(r.segments,o.segments,s)||r.numberOfChildren!==o.numberOfChildren)return!1;for(const u in o.children)if(!r.children[u]||!VP(r.children[u],o.children[u],s))return!1;return!0},subset:jP},zP={exact:function UL(r,o){return Uc(r,o)},subset:function $L(r,o){return Object.keys(o).length<=Object.keys(r).length&&Object.keys(o).every(s=>LP(r[s],o[s]))},ignored:()=>!0};function BP(r,o,s){return jL[s.paths](r.root,o.root,s.matrixParams)&&zP[s.queryParams](r.queryParams,o.queryParams)&&!("exact"===s.fragment&&r.fragment!==o.fragment)}function jP(r,o,s){return UP(r,o,o.segments,s)}function UP(r,o,s,u){if(r.segments.length>s.length){const d=r.segments.slice(0,s.length);return!(!Rp(d,s)||o.hasChildren()||!TT(d,s,u))}if(r.segments.length===s.length){if(!Rp(r.segments,s)||!TT(r.segments,s,u))return!1;for(const d in o.children)if(!r.children[d]||!jP(r.children[d],o.children[d],u))return!1;return!0}{const d=s.slice(0,r.segments.length),m=s.slice(r.segments.length);return!!(Rp(r.segments,d)&&TT(r.segments,d,u)&&r.children[Ln])&&UP(r.children[Ln],o,m,u)}}function TT(r,o,s){return o.every((u,d)=>zP[s](r[d].parameters,u.parameters))}class Pp{constructor(o,s,u){this.root=o,this.queryParams=s,this.fragment=u}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=T_(this.queryParams)),this._queryParamMap}toString(){return qL.serialize(this)}}class zn{constructor(o,s){this.segments=o,this.children=s,this.parent=null,No(s,(u,d)=>u.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return DT(this)}}class jx{constructor(o,s){this.path=o,this.parameters=s}get parameterMap(){return this._parameterMap||(this._parameterMap=T_(this.parameters)),this._parameterMap}toString(){return qP(this)}}function Rp(r,o){return r.length===o.length&&r.every((s,u)=>s.path===o[u].path)}let $P=(()=>{class r{}return r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=Ut({token:r,factory:function(){return new qS},providedIn:"root"}),r})();class qS{parse(o){const s=new tF(o);return new Pp(s.parseRootSegment(),s.parseQueryParams(),s.parseFragment())}serialize(o){const s=`/${Ux(o.root,!0)}`,u=function XL(r){const o=Object.keys(r).map(s=>{const u=r[s];return Array.isArray(u)?u.map(d=>`${MT(s)}=${MT(d)}`).join("&"):`${MT(s)}=${MT(u)}`}).filter(s=>!!s);return o.length?`?${o.join("&")}`:""}(o.queryParams);return`${s}${u}${"string"==typeof o.fragment?`#${function WL(r){return encodeURI(r)}(o.fragment)}`:""}`}}const qL=new qS;function DT(r){return r.segments.map(o=>qP(o)).join("/")}function Ux(r,o){if(!r.hasChildren())return DT(r);if(o){const s=r.children[Ln]?Ux(r.children[Ln],!1):"",u=[];return No(r.children,(d,m)=>{m!==Ln&&u.push(`${m}:${Ux(d,!1)}`)}),u.length>0?`${s}(${u.join("//")})`:s}{const s=function GL(r,o){let s=[];return No(r.children,(u,d)=>{d===Ln&&(s=s.concat(o(u,d)))}),No(r.children,(u,d)=>{d!==Ln&&(s=s.concat(o(u,d)))}),s}(r,(u,d)=>d===Ln?[Ux(r.children[Ln],!1)]:[`${d}:${Ux(u,!1)}`]);return 1===Object.keys(r.children).length&&null!=r.children[Ln]?`${DT(r)}/${s[0]}`:`${DT(r)}/(${s.join("//")})`}}function HP(r){return encodeURIComponent(r).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function MT(r){return HP(r).replace(/%3B/gi,";")}function WS(r){return HP(r).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function ST(r){return decodeURIComponent(r)}function GP(r){return ST(r.replace(/\+/g,"%20"))}function qP(r){return`${WS(r.path)}${function ZL(r){return Object.keys(r).map(o=>`;${WS(o)}=${WS(r[o])}`).join("")}(r.parameters)}`}const YL=/^[^\/()?;=#]+/;function AT(r){const o=r.match(YL);return o?o[0]:""}const KL=/^[^=?&#]+/,QL=/^[^&#]+/;class tF{constructor(o){this.url=o,this.remaining=o}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new zn([],{}):new zn([],this.parseChildren())}parseQueryParams(){const o={};if(this.consumeOptional("?"))do{this.parseQueryParam(o)}while(this.consumeOptional("&"));return o}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const o=[];for(this.peekStartsWith("(")||o.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),o.push(this.parseSegment());let s={};this.peekStartsWith("/(")&&(this.capture("/"),s=this.parseParens(!0));let u={};return this.peekStartsWith("(")&&(u=this.parseParens(!1)),(o.length>0||Object.keys(s).length>0)&&(u[Ln]=new zn(o,s)),u}parseSegment(){const o=AT(this.remaining);if(""===o&&this.peekStartsWith(";"))throw new Ue(4009,!1);return this.capture(o),new jx(ST(o),this.parseMatrixParams())}parseMatrixParams(){const o={};for(;this.consumeOptional(";");)this.parseParam(o);return o}parseParam(o){const s=AT(this.remaining);if(!s)return;this.capture(s);let u="";if(this.consumeOptional("=")){const d=AT(this.remaining);d&&(u=d,this.capture(u))}o[ST(s)]=ST(u)}parseQueryParam(o){const s=function JL(r){const o=r.match(KL);return o?o[0]:""}(this.remaining);if(!s)return;this.capture(s);let u="";if(this.consumeOptional("=")){const x=function eF(r){const o=r.match(QL);return o?o[0]:""}(this.remaining);x&&(u=x,this.capture(u))}const d=GP(s),m=GP(u);if(o.hasOwnProperty(d)){let x=o[d];Array.isArray(x)||(x=[x],o[d]=x),x.push(m)}else o[d]=m}parseParens(o){const s={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const u=AT(this.remaining),d=this.remaining[u.length];if("/"!==d&&")"!==d&&";"!==d)throw new Ue(4010,!1);let m;u.indexOf(":")>-1?(m=u.slice(0,u.indexOf(":")),this.capture(m),this.capture(":")):o&&(m=Ln);const x=this.parseChildren();s[m]=1===Object.keys(x).length?x[Ln]:new zn([],x),this.consumeOptional("//")}return s}peekStartsWith(o){return this.remaining.startsWith(o)}consumeOptional(o){return!!this.peekStartsWith(o)&&(this.remaining=this.remaining.substring(o.length),!0)}capture(o){if(!this.consumeOptional(o))throw new Ue(4011,!1)}}function ZS(r){return r.segments.length>0?new zn([],{[Ln]:r}):r}function IT(r){const o={};for(const u of Object.keys(r.children)){const m=IT(r.children[u]);(m.segments.length>0||m.hasChildren())&&(o[u]=m)}return function nF(r){if(1===r.numberOfChildren&&r.children[Ln]){const o=r.children[Ln];return new zn(r.segments.concat(o.segments),o.children)}return r}(new zn(r.segments,o))}function kp(r){return r instanceof Pp}function oF(r,o,s,u,d){if(0===s.length)return D_(o.root,o.root,o.root,u,d);const m=function XP(r){if("string"==typeof r[0]&&1===r.length&&"/"===r[0])return new ZP(!0,0,r);let o=0,s=!1;const u=r.reduce((d,m,x)=>{if("object"==typeof m&&null!=m){if(m.outlets){const b={};return No(m.outlets,(D,P)=>{b[P]="string"==typeof D?D.split("/"):D}),[...d,{outlets:b}]}if(m.segmentPath)return[...d,m.segmentPath]}return"string"!=typeof m?[...d,m]:0===x?(m.split("/").forEach((b,D)=>{0==D&&"."===b||(0==D&&""===b?s=!0:".."===b?o++:""!=b&&d.push(b))}),d):[...d,m]},[]);return new ZP(s,o,u)}(s);return m.toRoot()?D_(o.root,o.root,new zn([],{}),u,d):function x(D){const P=function aF(r,o,s,u){if(r.isAbsolute)return new M_(o.root,!0,0);if(-1===u)return new M_(s,s===o.root,0);return function YP(r,o,s){let u=r,d=o,m=s;for(;m>d;){if(m-=d,u=u.parent,!u)throw new Ue(4005,!1);d=u.segments.length}return new M_(u,!1,d-m)}(s,u+($x(r.commands[0])?0:1),r.numberOfDoubleDots)}(m,o,r.snapshot?._urlSegment,D),F=P.processChildren?Gx(P.segmentGroup,P.index,m.commands):YS(P.segmentGroup,P.index,m.commands);return D_(o.root,P.segmentGroup,F,u,d)}(r.snapshot?._lastPathIndex)}function $x(r){return"object"==typeof r&&null!=r&&!r.outlets&&!r.segmentPath}function Hx(r){return"object"==typeof r&&null!=r&&r.outlets}function D_(r,o,s,u,d){let x,m={};u&&No(u,(D,P)=>{m[P]=Array.isArray(D)?D.map(F=>`${F}`):`${D}`}),x=r===o?s:WP(r,o,s);const b=ZS(IT(x));return new Pp(b,m,d)}function WP(r,o,s){const u={};return No(r.children,(d,m)=>{u[m]=d===o?s:WP(d,o,s)}),new zn(r.segments,u)}class ZP{constructor(o,s,u){if(this.isAbsolute=o,this.numberOfDoubleDots=s,this.commands=u,o&&u.length>0&&$x(u[0]))throw new Ue(4003,!1);const d=u.find(Hx);if(d&&d!==NP(u))throw new Ue(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class M_{constructor(o,s,u){this.segmentGroup=o,this.processChildren=s,this.index=u}}function YS(r,o,s){if(r||(r=new zn([],{})),0===r.segments.length&&r.hasChildren())return Gx(r,o,s);const u=function cF(r,o,s){let u=0,d=o;const m={match:!1,pathIndex:0,commandIndex:0};for(;d<r.segments.length;){if(u>=s.length)return m;const x=r.segments[d],b=s[u];if(Hx(b))break;const D=`${b}`,P=u<s.length-1?s[u+1]:null;if(d>0&&void 0===D)break;if(D&&P&&"object"==typeof P&&void 0===P.outlets){if(!JP(D,P,x))return m;u+=2}else{if(!JP(D,{},x))return m;u++}d++}return{match:!0,pathIndex:d,commandIndex:u}}(r,o,s),d=s.slice(u.commandIndex);if(u.match&&u.pathIndex<r.segments.length){const m=new zn(r.segments.slice(0,u.pathIndex),{});return m.children[Ln]=new zn(r.segments.slice(u.pathIndex),r.children),Gx(m,0,d)}return u.match&&0===d.length?new zn(r.segments,{}):u.match&&!r.hasChildren()?KS(r,o,s):u.match?Gx(r,0,d):KS(r,o,s)}function Gx(r,o,s){if(0===s.length)return new zn(r.segments,{});{const u=function lF(r){return Hx(r[0])?r[0].outlets:{[Ln]:r}}(s),d={};return No(u,(m,x)=>{"string"==typeof m&&(m=[m]),null!==m&&(d[x]=YS(r.children[x],o,m))}),No(r.children,(m,x)=>{void 0===u[x]&&(d[x]=m)}),new zn(r.segments,d)}}function KS(r,o,s){const u=r.segments.slice(0,o);let d=0;for(;d<s.length;){const m=s[d];if(Hx(m)){const D=uF(m.outlets);return new zn(u,D)}if(0===d&&$x(s[0])){u.push(new jx(r.segments[o].path,KP(s[0]))),d++;continue}const x=Hx(m)?m.outlets[Ln]:`${m}`,b=d<s.length-1?s[d+1]:null;x&&b&&$x(b)?(u.push(new jx(x,KP(b))),d+=2):(u.push(new jx(x,{})),d++)}return new zn(u,{})}function uF(r){const o={};return No(r,(s,u)=>{"string"==typeof s&&(s=[s]),null!==s&&(o[u]=KS(new zn([],{}),0,s))}),o}function KP(r){const o={};return No(r,(s,u)=>o[u]=`${s}`),o}function JP(r,o,s){return r==s.path&&Uc(o,s.parameters)}class Yu{constructor(o,s){this.id=o,this.url=s}}class JS extends Yu{constructor(o,s,u="imperative",d=null){super(o,s),this.type=0,this.navigationTrigger=u,this.restoredState=d}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Op extends Yu{constructor(o,s,u){super(o,s),this.urlAfterRedirects=u,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class PT extends Yu{constructor(o,s,u,d){super(o,s),this.reason=u,this.code=d,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class QP extends Yu{constructor(o,s,u,d){super(o,s),this.error=u,this.target=d,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class hF extends Yu{constructor(o,s,u,d){super(o,s),this.urlAfterRedirects=u,this.state=d,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class dF extends Yu{constructor(o,s,u,d){super(o,s),this.urlAfterRedirects=u,this.state=d,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class fF extends Yu{constructor(o,s,u,d,m){super(o,s),this.urlAfterRedirects=u,this.state=d,this.shouldActivate=m,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class pF extends Yu{constructor(o,s,u,d){super(o,s),this.urlAfterRedirects=u,this.state=d,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class mF extends Yu{constructor(o,s,u,d){super(o,s),this.urlAfterRedirects=u,this.state=d,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class gF{constructor(o){this.route=o,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class _F{constructor(o){this.route=o,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class yF{constructor(o){this.snapshot=o,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class vF{constructor(o){this.snapshot=o,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class xF{constructor(o){this.snapshot=o,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class wF{constructor(o){this.snapshot=o,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class eR{constructor(o,s,u){this.routerEvent=o,this.position=s,this.anchor=u,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class tR{constructor(o){this._root=o}get root(){return this._root.value}parent(o){const s=this.pathFromRoot(o);return s.length>1?s[s.length-2]:null}children(o){const s=QS(o,this._root);return s?s.children.map(u=>u.value):[]}firstChild(o){const s=QS(o,this._root);return s&&s.children.length>0?s.children[0].value:null}siblings(o){const s=eA(o,this._root);return s.length<2?[]:s[s.length-2].children.map(d=>d.value).filter(d=>d!==o)}pathFromRoot(o){return eA(o,this._root).map(s=>s.value)}}function QS(r,o){if(r===o.value)return o;for(const s of o.children){const u=QS(r,s);if(u)return u}return null}function eA(r,o){if(r===o.value)return[o];for(const s of o.children){const u=eA(r,s);if(u.length)return u.unshift(o),u}return[]}class Ku{constructor(o,s){this.value=o,this.children=s}toString(){return`TreeNode(${this.value})`}}function S_(r){const o={};return r&&r.children.forEach(s=>o[s.value.outlet]=s),o}class nR extends tR{constructor(o,s){super(o),this.snapshot=s,tA(this,o)}toString(){return this.snapshot.toString()}}function rR(r,o){const s=function EF(r,o){const x=new RT([],{},{},"",{},Ln,o,null,r.root,-1,{});return new oR("",new Ku(x,[]))}(r,o),u=new Jl([new jx("",{})]),d=new Jl({}),m=new Jl({}),x=new Jl({}),b=new Jl(""),D=new Lp(u,d,x,b,m,Ln,o,s.root);return D.snapshot=s.root,new nR(new Ku(D,[]),s)}class Lp{constructor(o,s,u,d,m,x,b,D){this.url=o,this.params=s,this.queryParams=u,this.fragment=d,this.data=m,this.outlet=x,this.component=b,this.title=this.data?.pipe(rn(P=>P[Vx]))??tn(void 0),this._futureSnapshot=D}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(rn(o=>T_(o)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(rn(o=>T_(o)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function iR(r,o="emptyOnly"){const s=r.pathFromRoot;let u=0;if("always"!==o)for(u=s.length-1;u>=1;){const d=s[u],m=s[u-1];if(d.routeConfig&&""===d.routeConfig.path)u--;else{if(m.component)break;u--}}return function CF(r){return r.reduce((o,s)=>({params:{...o.params,...s.params},data:{...o.data,...s.data},resolve:{...s.data,...o.resolve,...s.routeConfig?.data,...s._resolvedData}}),{params:{},data:{},resolve:{}})}(s.slice(u))}class RT{constructor(o,s,u,d,m,x,b,D,P,F,V,Y){this.url=o,this.params=s,this.queryParams=u,this.fragment=d,this.data=m,this.outlet=x,this.component=b,this.title=this.data?.[Vx],this.routeConfig=D,this._urlSegment=P,this._lastPathIndex=F,this._correctedLastPathIndex=Y??F,this._resolve=V}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=T_(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=T_(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(u=>u.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class oR extends tR{constructor(o,s){super(s),this.url=o,tA(this,s)}toString(){return sR(this._root)}}function tA(r,o){o.value._routerState=r,o.children.forEach(s=>tA(r,s))}function sR(r){const o=r.children.length>0?` { ${r.children.map(sR).join(", ")} } `:"";return`${r.value}${o}`}function nA(r){if(r.snapshot){const o=r.snapshot,s=r._futureSnapshot;r.snapshot=s,Uc(o.queryParams,s.queryParams)||r.queryParams.next(s.queryParams),o.fragment!==s.fragment&&r.fragment.next(s.fragment),Uc(o.params,s.params)||r.params.next(s.params),function BL(r,o){if(r.length!==o.length)return!1;for(let s=0;s<r.length;++s)if(!Uc(r[s],o[s]))return!1;return!0}(o.url,s.url)||r.url.next(s.url),Uc(o.data,s.data)||r.data.next(s.data)}else r.snapshot=r._futureSnapshot,r.data.next(r._futureSnapshot.data)}function rA(r,o){const s=Uc(r.params,o.params)&&function HL(r,o){return Rp(r,o)&&r.every((s,u)=>Uc(s.parameters,o[u].parameters))}(r.url,o.url);return s&&!(!r.parent!=!o.parent)&&(!r.parent||rA(r.parent,o.parent))}function qx(r,o,s){if(s&&r.shouldReuseRoute(o.value,s.value.snapshot)){const u=s.value;u._futureSnapshot=o.value;const d=function DF(r,o,s){return o.children.map(u=>{for(const d of s.children)if(r.shouldReuseRoute(u.value,d.value.snapshot))return qx(r,u,d);return qx(r,u)})}(r,o,s);return new Ku(u,d)}{if(r.shouldAttach(o.value)){const m=r.retrieve(o.value);if(null!==m){const x=m.route;return x.value._futureSnapshot=o.value,x.children=o.children.map(b=>qx(r,b)),x}}const u=function MF(r){return new Lp(new Jl(r.url),new Jl(r.params),new Jl(r.queryParams),new Jl(r.fragment),new Jl(r.data),r.outlet,r.component,r)}(o.value),d=o.children.map(m=>qx(r,m));return new Ku(u,d)}}const iA="ngNavigationCancelingError";function aR(r,o){const{redirectTo:s,navigationBehaviorOptions:u}=kp(o)?{redirectTo:o,navigationBehaviorOptions:void 0}:o,d=lR(!1,0,o);return d.url=s,d.navigationBehaviorOptions=u,d}function lR(r,o,s){const u=new Error("NavigationCancelingError: "+(r||""));return u[iA]=!0,u.cancellationCode=o,s&&(u.url=s),u}function cR(r){return uR(r)&&kp(r.url)}function uR(r){return r&&r[iA]}class SF{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new Wx,this.attachRef=null}}let Wx=(()=>{class r{constructor(){this.contexts=new Map}onChildOutletCreated(s,u){const d=this.getOrCreateContext(s);d.outlet=u,this.contexts.set(s,d)}onChildOutletDestroyed(s){const u=this.getContext(s);u&&(u.outlet=null,u.attachRef=null)}onOutletDeactivated(){const s=this.contexts;return this.contexts=new Map,s}onOutletReAttached(s){this.contexts=s}getOrCreateContext(s){let u=this.getContext(s);return u||(u=new SF,this.contexts.set(s,u)),u}getContext(s){return this.contexts.get(s)||null}}return r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=Ut({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const kT=!1;let hR=(()=>{class r{constructor(s,u,d,m,x){this.parentContexts=s,this.location=u,this.changeDetector=m,this.environmentInjector=x,this.activated=null,this._activatedRoute=null,this.activateEvents=new Er,this.deactivateEvents=new Er,this.attachEvents=new Er,this.detachEvents=new Er,this.name=d||Ln,s.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.getContext(this.name)?.outlet===this&&this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const s=this.parentContexts.getContext(this.name);s&&s.route&&(s.attachRef?this.attach(s.attachRef,s.route):this.activateWith(s.route,s.injector))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Ue(4012,kT);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Ue(4012,kT);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Ue(4012,kT);this.location.detach();const s=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(s.instance),s}attach(s,u){this.activated=s,this._activatedRoute=u,this.location.insert(s.hostView),this.attachEvents.emit(s.instance)}deactivate(){if(this.activated){const s=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(s)}}activateWith(s,u){if(this.isActivated)throw new Ue(4013,kT);this._activatedRoute=s;const d=this.location,x=s._futureSnapshot.component,b=this.parentContexts.getOrCreateContext(this.name).children,D=new AF(s,b,d.injector);if(u&&function IF(r){return!!r.resolveComponentFactory}(u)){const P=u.resolveComponentFactory(x);this.activated=d.createComponent(P,d.length,D)}else this.activated=d.createComponent(x,{index:d.length,injector:D,environmentInjector:u??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return r.\u0275fac=function(s){return new(s||r)(Ze(Wx),Ze(_s),function Ua(r){return function uD(r,o){if("class"===o)return r.classes;if("style"===o)return r.styles;const s=r.attrs;if(s){const u=s.length;let d=0;for(;d<u;){const m=s[d];if(X_(m))break;if(0===m)d+=2;else if("number"==typeof m)for(d++;d<u&&"string"==typeof s[d];)d++;else{if(m===o)return s[d+1];d+=2}}}return null}(Ci(),r)}("name"),Ze(m_),Ze(Fs))},r.\u0275dir=Qt({type:r,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0}),r})();class AF{constructor(o,s,u){this.route=o,this.childContexts=s,this.parent=u}get(o,s){return o===Lp?this.route:o===Wx?this.childContexts:this.parent.get(o,s)}}let oA=(()=>{class r{}return r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=uo({type:r,selectors:[["ng-component"]],standalone:!0,features:[ZE],decls:1,vars:0,template:function(s,u){1&s&&ko(0,"router-outlet")},dependencies:[hR],encapsulation:2}),r})();function dR(r,o){return r.providers&&!r._injector&&(r._injector=gs(r.providers,o,`Route: ${r.path}`)),r._injector??o}function aA(r){const o=r.children&&r.children.map(aA),s=o?{...r,children:o}:{...r};return!s.component&&!s.loadComponent&&(o||s.loadChildren)&&s.outlet&&s.outlet!==Ln&&(s.component=oA),s}function fl(r){return r.outlet||Ln}function fR(r,o){const s=r.filter(u=>fl(u)===o);return s.push(...r.filter(u=>fl(u)!==o)),s}function Zx(r){if(!r)return null;if(r.routeConfig?._injector)return r.routeConfig._injector;for(let o=r.parent;o;o=o.parent){const s=o.routeConfig;if(s?._loadedInjector)return s._loadedInjector;if(s?._injector)return s._injector}return null}class LF{constructor(o,s,u,d){this.routeReuseStrategy=o,this.futureState=s,this.currState=u,this.forwardEvent=d}activate(o){const s=this.futureState._root,u=this.currState?this.currState._root:null;this.deactivateChildRoutes(s,u,o),nA(this.futureState.root),this.activateChildRoutes(s,u,o)}deactivateChildRoutes(o,s,u){const d=S_(s);o.children.forEach(m=>{const x=m.value.outlet;this.deactivateRoutes(m,d[x],u),delete d[x]}),No(d,(m,x)=>{this.deactivateRouteAndItsChildren(m,u)})}deactivateRoutes(o,s,u){const d=o.value,m=s?s.value:null;if(d===m)if(d.component){const x=u.getContext(d.outlet);x&&this.deactivateChildRoutes(o,s,x.children)}else this.deactivateChildRoutes(o,s,u);else m&&this.deactivateRouteAndItsChildren(s,u)}deactivateRouteAndItsChildren(o,s){o.value.component&&this.routeReuseStrategy.shouldDetach(o.value.snapshot)?this.detachAndStoreRouteSubtree(o,s):this.deactivateRouteAndOutlet(o,s)}detachAndStoreRouteSubtree(o,s){const u=s.getContext(o.value.outlet),d=u&&o.value.component?u.children:s,m=S_(o);for(const x of Object.keys(m))this.deactivateRouteAndItsChildren(m[x],d);if(u&&u.outlet){const x=u.outlet.detach(),b=u.children.onOutletDeactivated();this.routeReuseStrategy.store(o.value.snapshot,{componentRef:x,route:o,contexts:b})}}deactivateRouteAndOutlet(o,s){const u=s.getContext(o.value.outlet),d=u&&o.value.component?u.children:s,m=S_(o);for(const x of Object.keys(m))this.deactivateRouteAndItsChildren(m[x],d);u&&u.outlet&&(u.outlet.deactivate(),u.children.onOutletDeactivated(),u.attachRef=null,u.resolver=null,u.route=null)}activateChildRoutes(o,s,u){const d=S_(s);o.children.forEach(m=>{this.activateRoutes(m,d[m.value.outlet],u),this.forwardEvent(new wF(m.value.snapshot))}),o.children.length&&this.forwardEvent(new vF(o.value.snapshot))}activateRoutes(o,s,u){const d=o.value,m=s?s.value:null;if(nA(d),d===m)if(d.component){const x=u.getOrCreateContext(d.outlet);this.activateChildRoutes(o,s,x.children)}else this.activateChildRoutes(o,s,u);else if(d.component){const x=u.getOrCreateContext(d.outlet);if(this.routeReuseStrategy.shouldAttach(d.snapshot)){const b=this.routeReuseStrategy.retrieve(d.snapshot);this.routeReuseStrategy.store(d.snapshot,null),x.children.onOutletReAttached(b.contexts),x.attachRef=b.componentRef,x.route=b.route.value,x.outlet&&x.outlet.attach(b.componentRef,b.route.value),nA(b.route.value),this.activateChildRoutes(o,null,x.children)}else{const b=Zx(d.snapshot),D=b?.get(Cc)??null;x.attachRef=null,x.route=d,x.resolver=D,x.injector=b,x.outlet&&x.outlet.activateWith(d,x.injector),this.activateChildRoutes(o,null,x.children)}}else this.activateChildRoutes(o,null,u)}}class pR{constructor(o){this.path=o,this.route=this.path[this.path.length-1]}}class OT{constructor(o,s){this.component=o,this.route=s}}function FF(r,o,s){const u=r._root;return Xx(u,o?o._root:null,s,[u.value])}function A_(r,o){const s=Symbol(),u=o.get(r,s);return u===s?"function"!=typeof r||function Ar(r){return null!==bi(r)}(r)?o.get(r):r:u}function Xx(r,o,s,u,d={canDeactivateChecks:[],canActivateChecks:[]}){const m=S_(o);return r.children.forEach(x=>{(function zF(r,o,s,u,d={canDeactivateChecks:[],canActivateChecks:[]}){const m=r.value,x=o?o.value:null,b=s?s.getContext(r.value.outlet):null;if(x&&m.routeConfig===x.routeConfig){const D=function BF(r,o,s){if("function"==typeof s)return s(r,o);switch(s){case"pathParamsChange":return!Rp(r.url,o.url);case"pathParamsOrQueryParamsChange":return!Rp(r.url,o.url)||!Uc(r.queryParams,o.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!rA(r,o)||!Uc(r.queryParams,o.queryParams);default:return!rA(r,o)}}(x,m,m.routeConfig.runGuardsAndResolvers);D?d.canActivateChecks.push(new pR(u)):(m.data=x.data,m._resolvedData=x._resolvedData),Xx(r,o,m.component?b?b.children:null:s,u,d),D&&b&&b.outlet&&b.outlet.isActivated&&d.canDeactivateChecks.push(new OT(b.outlet.component,x))}else x&&Yx(o,b,d),d.canActivateChecks.push(new pR(u)),Xx(r,null,m.component?b?b.children:null:s,u,d)})(x,m[x.value.outlet],s,u.concat([x.value]),d),delete m[x.value.outlet]}),No(m,(x,b)=>Yx(x,s.getContext(b),d)),d}function Yx(r,o,s){const u=S_(r),d=r.value;No(u,(m,x)=>{Yx(m,d.component?o?o.children.getContext(x):null:o,s)}),s.canDeactivateChecks.push(new OT(d.component&&o&&o.outlet&&o.outlet.isActivated?o.outlet.component:null,d))}function Kx(r){return"function"==typeof r}function lA(r){return r instanceof ET||"EmptyError"===r?.name}const LT=Symbol("INITIAL_VALUE");function I_(){return jc(r=>SP(r.map(o=>o.pipe(Bx(1),function RL(...r){const o=Ds(r);return Zr((s,u)=>{(o?jS(r,s,o):jS(r,s)).subscribe(u)})}(LT)))).pipe(rn(o=>{for(const s of o)if(!0!==s){if(s===LT)return LT;if(!1===s||s instanceof Pp)return s}return!0}),Xu(o=>o!==LT),Bx(1)))}function mR(r){return function ml(...r){return Ia(r)}(Yo(o=>{if(kp(o))throw aR(0,o)}),rn(o=>!0===o))}const cA={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function gR(r,o,s,u,d){const m=uA(r,o,s);return m.matched?function n3(r,o,s,u){const d=o.canMatch;return d&&0!==d.length?tn(d.map(x=>{const b=A_(x,r);return Sd(function GF(r){return r&&Kx(r.canMatch)}(b)?b.canMatch(o,s):r.runInContext(()=>b(o,s)))})).pipe(I_(),mR()):tn(!0)}(u=dR(o,u),o,s).pipe(rn(x=>!0===x?m:{...cA})):tn(m)}function uA(r,o,s){if(""===o.path)return"full"===o.pathMatch&&(r.hasChildren()||s.length>0)?{...cA}:{matched:!0,consumedSegments:[],remainingSegments:s,parameters:{},positionalParamSegments:{}};const d=(o.matcher||zL)(s,r,o);if(!d)return{...cA};const m={};No(d.posParams,(b,D)=>{m[D]=b.path});const x=d.consumed.length>0?{...m,...d.consumed[d.consumed.length-1].parameters}:m;return{matched:!0,consumedSegments:d.consumed,remainingSegments:s.slice(d.consumed.length),parameters:x,positionalParamSegments:d.posParams??{}}}function FT(r,o,s,u,d="corrected"){if(s.length>0&&function o3(r,o,s){return s.some(u=>NT(r,o,u)&&fl(u)!==Ln)}(r,s,u)){const x=new zn(o,function i3(r,o,s,u){const d={};d[Ln]=u,u._sourceSegment=r,u._segmentIndexShift=o.length;for(const m of s)if(""===m.path&&fl(m)!==Ln){const x=new zn([],{});x._sourceSegment=r,x._segmentIndexShift=o.length,d[fl(m)]=x}return d}(r,o,u,new zn(s,r.children)));return x._sourceSegment=r,x._segmentIndexShift=o.length,{segmentGroup:x,slicedSegments:[]}}if(0===s.length&&function s3(r,o,s){return s.some(u=>NT(r,o,u))}(r,s,u)){const x=new zn(r.segments,function r3(r,o,s,u,d,m){const x={};for(const b of u)if(NT(r,s,b)&&!d[fl(b)]){const D=new zn([],{});D._sourceSegment=r,D._segmentIndexShift="legacy"===m?r.segments.length:o.length,x[fl(b)]=D}return{...d,...x}}(r,o,s,u,r.children,d));return x._sourceSegment=r,x._segmentIndexShift=o.length,{segmentGroup:x,slicedSegments:s}}const m=new zn(r.segments,r.children);return m._sourceSegment=r,m._segmentIndexShift=o.length,{segmentGroup:m,slicedSegments:s}}function NT(r,o,s){return(!(r.hasChildren()||o.length>0)||"full"!==s.pathMatch)&&""===s.path}function _R(r,o,s,u){return!!(fl(r)===u||u!==Ln&&NT(o,s,r))&&("**"===r.path||uA(o,r,s).matched)}function yR(r,o,s){return 0===o.length&&!r.children[s]}const zT=!1;class BT{constructor(o){this.segmentGroup=o||null}}class vR{constructor(o){this.urlTree=o}}function Jx(r){return zx(new BT(r))}function xR(r){return zx(new vR(r))}class u3{constructor(o,s,u,d,m){this.injector=o,this.configLoader=s,this.urlSerializer=u,this.urlTree=d,this.config=m,this.allowRedirects=!0}apply(){const o=FT(this.urlTree.root,[],[],this.config).segmentGroup,s=new zn(o.segments,o.children);return this.expandSegmentGroup(this.injector,this.config,s,Ln).pipe(rn(m=>this.createUrlTree(IT(m),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Md(m=>{if(m instanceof vR)return this.allowRedirects=!1,this.match(m.urlTree);throw m instanceof BT?this.noMatchError(m):m}))}match(o){return this.expandSegmentGroup(this.injector,this.config,o.root,Ln).pipe(rn(d=>this.createUrlTree(IT(d),o.queryParams,o.fragment))).pipe(Md(d=>{throw d instanceof BT?this.noMatchError(d):d}))}noMatchError(o){return new Ue(4002,zT)}createUrlTree(o,s,u){const d=ZS(o);return new Pp(d,s,u)}expandSegmentGroup(o,s,u,d){return 0===u.segments.length&&u.hasChildren()?this.expandChildren(o,s,u).pipe(rn(m=>new zn([],m))):this.expandSegment(o,u,s,u.segments,d,!0)}expandChildren(o,s,u){const d=[];for(const m of Object.keys(u.children))"primary"===m?d.unshift(m):d.push(m);return jr(d).pipe(Dd(m=>{const x=u.children[m],b=fR(s,m);return this.expandSegmentGroup(o,b,x,m).pipe(rn(D=>({segment:D,outlet:m})))}),kP((m,x)=>(m[x.outlet]=x.segment,m),{}),OP())}expandSegment(o,s,u,d,m,x){return jr(u).pipe(Dd(b=>this.expandSegmentAgainstRoute(o,s,u,b,d,m,x).pipe(Md(P=>{if(P instanceof BT)return tn(null);throw P}))),Td(b=>!!b),Md((b,D)=>{if(lA(b))return yR(s,d,m)?tn(new zn([],{})):Jx(s);throw b}))}expandSegmentAgainstRoute(o,s,u,d,m,x,b){return _R(d,s,m,x)?void 0===d.redirectTo?this.matchSegmentAgainstRoute(o,s,d,m,x):b&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(o,s,u,d,m,x):Jx(s):Jx(s)}expandSegmentAgainstRouteUsingRedirect(o,s,u,d,m,x){return"**"===d.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(o,u,d,x):this.expandRegularSegmentAgainstRouteUsingRedirect(o,s,u,d,m,x)}expandWildCardWithParamsAgainstRouteUsingRedirect(o,s,u,d){const m=this.applyRedirectCommands([],u.redirectTo,{});return u.redirectTo.startsWith("/")?xR(m):this.lineralizeSegments(u,m).pipe(Vr(x=>{const b=new zn(x,{});return this.expandSegment(o,b,s,x,d,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(o,s,u,d,m,x){const{matched:b,consumedSegments:D,remainingSegments:P,positionalParamSegments:F}=uA(s,d,m);if(!b)return Jx(s);const V=this.applyRedirectCommands(D,d.redirectTo,F);return d.redirectTo.startsWith("/")?xR(V):this.lineralizeSegments(d,V).pipe(Vr(Y=>this.expandSegment(o,s,u,Y.concat(P),x,!1)))}matchSegmentAgainstRoute(o,s,u,d,m){return"**"===u.path?(o=dR(u,o),u.loadChildren?(u._loadedRoutes?tn({routes:u._loadedRoutes,injector:u._loadedInjector}):this.configLoader.loadChildren(o,u)).pipe(rn(b=>(u._loadedRoutes=b.routes,u._loadedInjector=b.injector,new zn(d,{})))):tn(new zn(d,{}))):gR(s,u,d,o).pipe(jc(({matched:x,consumedSegments:b,remainingSegments:D})=>x?this.getChildConfig(o=u._injector??o,u,d).pipe(Vr(F=>{const V=F.injector??o,Y=F.routes,{segmentGroup:re,slicedSegments:pe}=FT(s,b,D,Y),Ce=new zn(re.segments,re.children);if(0===pe.length&&Ce.hasChildren())return this.expandChildren(V,Y,Ce).pipe(rn(Ve=>new zn(b,Ve)));if(0===Y.length&&0===pe.length)return tn(new zn(b,{}));const ze=fl(u)===m;return this.expandSegment(V,Ce,Y,pe,ze?Ln:m,!0).pipe(rn(ct=>new zn(b.concat(ct.segments),ct.children)))})):Jx(s)))}getChildConfig(o,s,u){return s.children?tn({routes:s.children,injector:o}):s.loadChildren?void 0!==s._loadedRoutes?tn({routes:s._loadedRoutes,injector:s._loadedInjector}):function t3(r,o,s,u){const d=o.canLoad;return void 0===d||0===d.length?tn(!0):tn(d.map(x=>{const b=A_(x,r);return Sd(function jF(r){return r&&Kx(r.canLoad)}(b)?b.canLoad(o,s):r.runInContext(()=>b(o,s)))})).pipe(I_(),mR())}(o,s,u).pipe(Vr(d=>d?this.configLoader.loadChildren(o,s).pipe(Yo(m=>{s._loadedRoutes=m.routes,s._loadedInjector=m.injector})):function l3(r){return zx(lR(zT,3))}())):tn({routes:[],injector:o})}lineralizeSegments(o,s){let u=[],d=s.root;for(;;){if(u=u.concat(d.segments),0===d.numberOfChildren)return tn(u);if(d.numberOfChildren>1||!d.children[Ln])return zx(new Ue(4e3,zT));d=d.children[Ln]}}applyRedirectCommands(o,s,u){return this.applyRedirectCreateUrlTree(s,this.urlSerializer.parse(s),o,u)}applyRedirectCreateUrlTree(o,s,u,d){const m=this.createSegmentGroup(o,s.root,u,d);return new Pp(m,this.createQueryParams(s.queryParams,this.urlTree.queryParams),s.fragment)}createQueryParams(o,s){const u={};return No(o,(d,m)=>{if("string"==typeof d&&d.startsWith(":")){const b=d.substring(1);u[m]=s[b]}else u[m]=d}),u}createSegmentGroup(o,s,u,d){const m=this.createSegments(o,s.segments,u,d);let x={};return No(s.children,(b,D)=>{x[D]=this.createSegmentGroup(o,b,u,d)}),new zn(m,x)}createSegments(o,s,u,d){return s.map(m=>m.path.startsWith(":")?this.findPosParam(o,m,d):this.findOrReturn(m,u))}findPosParam(o,s,u){const d=u[s.path.substring(1)];if(!d)throw new Ue(4001,zT);return d}findOrReturn(o,s){let u=0;for(const d of s){if(d.path===o.path)return s.splice(u),d;u++}return o}}class d3{}class m3{constructor(o,s,u,d,m,x,b,D){this.injector=o,this.rootComponentType=s,this.config=u,this.urlTree=d,this.url=m,this.paramsInheritanceStrategy=x,this.relativeLinkResolution=b,this.urlSerializer=D}recognize(){const o=FT(this.urlTree.root,[],[],this.config.filter(s=>void 0===s.redirectTo),this.relativeLinkResolution).segmentGroup;return this.processSegmentGroup(this.injector,this.config,o,Ln).pipe(rn(s=>{if(null===s)return null;const u=new RT([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},Ln,this.rootComponentType,null,this.urlTree.root,-1,{}),d=new Ku(u,s),m=new oR(this.url,d);return this.inheritParamsAndData(m._root),m}))}inheritParamsAndData(o){const s=o.value,u=iR(s,this.paramsInheritanceStrategy);s.params=Object.freeze(u.params),s.data=Object.freeze(u.data),o.children.forEach(d=>this.inheritParamsAndData(d))}processSegmentGroup(o,s,u,d){return 0===u.segments.length&&u.hasChildren()?this.processChildren(o,s,u):this.processSegment(o,s,u,u.segments,d)}processChildren(o,s,u){return jr(Object.keys(u.children)).pipe(Dd(d=>{const m=u.children[d],x=fR(s,d);return this.processSegmentGroup(o,x,m,d)}),kP((d,m)=>d&&m?(d.push(...m),d):null),function LL(r,o=!1){return Zr((s,u)=>{let d=0;s.subscribe(vr(u,m=>{const x=r(m,d++);(x||o)&&u.next(m),!x&&u.complete()}))})}(d=>null!==d),CT(null),OP(),rn(d=>{if(null===d)return null;const m=wR(d);return function g3(r){r.sort((o,s)=>o.value.outlet===Ln?-1:s.value.outlet===Ln?1:o.value.outlet.localeCompare(s.value.outlet))}(m),m}))}processSegment(o,s,u,d,m){return jr(s).pipe(Dd(x=>this.processSegmentAgainstRoute(x._injector??o,x,u,d,m)),Td(x=>!!x),Md(x=>{if(lA(x))return yR(u,d,m)?tn([]):tn(null);throw x}))}processSegmentAgainstRoute(o,s,u,d,m){if(s.redirectTo||!_R(s,u,d,m))return tn(null);let x;if("**"===s.path){const b=d.length>0?NP(d).parameters:{},D=ER(u)+d.length;x=tn({snapshot:new RT(d,b,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,TR(s),fl(s),s.component??s._loadedComponent??null,s,bR(u),D,DR(s),D),consumedSegments:[],remainingSegments:[]})}else x=gR(u,s,d,o).pipe(rn(({matched:b,consumedSegments:D,remainingSegments:P,parameters:F})=>{if(!b)return null;const V=ER(u)+D.length;return{snapshot:new RT(D,F,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,TR(s),fl(s),s.component??s._loadedComponent??null,s,bR(u),V,DR(s),V),consumedSegments:D,remainingSegments:P}}));return x.pipe(jc(b=>{if(null===b)return tn(null);const{snapshot:D,consumedSegments:P,remainingSegments:F}=b;o=s._injector??o;const V=s._loadedInjector??o,Y=function _3(r){return r.children?r.children:r.loadChildren?r._loadedRoutes:[]}(s),{segmentGroup:re,slicedSegments:pe}=FT(u,P,F,Y.filter(ze=>void 0===ze.redirectTo),this.relativeLinkResolution);if(0===pe.length&&re.hasChildren())return this.processChildren(V,Y,re).pipe(rn(ze=>null===ze?null:[new Ku(D,ze)]));if(0===Y.length&&0===pe.length)return tn([new Ku(D,[])]);const Ce=fl(s)===m;return this.processSegment(V,Y,re,pe,Ce?Ln:m).pipe(rn(ze=>null===ze?null:[new Ku(D,ze)]))}))}}function y3(r){const o=r.value.routeConfig;return o&&""===o.path&&void 0===o.redirectTo}function wR(r){const o=[],s=new Set;for(const u of r){if(!y3(u)){o.push(u);continue}const d=o.find(m=>u.value.routeConfig===m.value.routeConfig);void 0!==d?(d.children.push(...u.children),s.add(d)):o.push(u)}for(const u of s){const d=wR(u.children);o.push(new Ku(u.value,d))}return o.filter(u=>!s.has(u))}function bR(r){let o=r;for(;o._sourceSegment;)o=o._sourceSegment;return o}function ER(r){let o=r,s=o._segmentIndexShift??0;for(;o._sourceSegment;)o=o._sourceSegment,s+=o._segmentIndexShift??0;return s-1}function TR(r){return r.data||{}}function DR(r){return r.resolve||{}}function MR(r){return"string"==typeof r.title||null===r.title}function hA(r){return jc(o=>{const s=r(o);return s?jr(s).pipe(rn(()=>o)):tn(o)})}let SR=(()=>{class r{buildTitle(s){let u,d=s.root;for(;void 0!==d;)u=this.getResolvedTitleForRoute(d)??u,d=d.children.find(m=>m.outlet===Ln);return u}getResolvedTitleForRoute(s){return s.data[Vx]}}return r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=Ut({token:r,factory:function(){return Kr(AR)},providedIn:"root"}),r})(),AR=(()=>{class r extends SR{constructor(s){super(),this.title=s}updateTitle(s){const u=this.buildTitle(s);void 0!==u&&this.title.setTitle(u)}}return r.\u0275fac=function(s){return new(s||r)(Tt(bP))},r.\u0275prov=Ut({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();class D3{}class S3 extends class M3{shouldDetach(o){return!1}store(o,s){}shouldAttach(o){return!1}retrieve(o){return null}shouldReuseRoute(o,s){return o.routeConfig===s.routeConfig}}{}const jT=new Ht("",{providedIn:"root",factory:()=>({})}),dA=new Ht("ROUTES");let fA=(()=>{class r{constructor(s,u){this.injector=s,this.compiler=u,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(s){if(this.componentLoaders.get(s))return this.componentLoaders.get(s);if(s._loadedComponent)return tn(s._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(s);const u=Sd(s.loadComponent()).pipe(Yo(m=>{this.onLoadEndListener&&this.onLoadEndListener(s),s._loadedComponent=m}),HS(()=>{this.componentLoaders.delete(s)})),d=new PP(u,()=>new xe).pipe(US());return this.componentLoaders.set(s,d),d}loadChildren(s,u){if(this.childrenLoaders.get(u))return this.childrenLoaders.get(u);if(u._loadedRoutes)return tn({routes:u._loadedRoutes,injector:u._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(u);const m=this.loadModuleFactoryOrRoutes(u.loadChildren).pipe(rn(b=>{this.onLoadEndListener&&this.onLoadEndListener(u);let D,P,F=!1;Array.isArray(b)?P=b:(D=b.create(s).injector,P=FP(D.get(dA,[],$t.Self|$t.Optional)));return{routes:P.map(aA),injector:D}}),HS(()=>{this.childrenLoaders.delete(u)})),x=new PP(m,()=>new xe).pipe(US());return this.childrenLoaders.set(u,x),x}loadModuleFactoryOrRoutes(s){return Sd(s()).pipe(Vr(u=>u instanceof M0||Array.isArray(u)?tn(u):jr(this.compiler.compileModuleAsync(u))))}}return r.\u0275fac=function(s){return new(s||r)(Tt(_i),Tt(l_))},r.\u0275prov=Ut({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();class I3{}class P3{shouldProcessUrl(o){return!0}extract(o){return o}merge(o,s){return o}}function R3(r){throw r}function k3(r,o,s){return o.parse("/")}const O3={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},L3={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};function PR(){const r=Kr($P),o=Kr(Wx),s=Kr(Cx),u=Kr(_i),d=Kr(l_),m=Kr(dA,{optional:!0})??[],x=Kr(jT,{optional:!0})??{},b=Kr(AR),D=Kr(SR,{optional:!0}),P=Kr(I3,{optional:!0}),F=Kr(D3,{optional:!0}),V=new zo(null,r,o,s,u,d,FP(m));return P&&(V.urlHandlingStrategy=P),F&&(V.routeReuseStrategy=F),V.titleStrategy=D??b,function F3(r,o){r.errorHandler&&(o.errorHandler=r.errorHandler),r.malformedUriErrorHandler&&(o.malformedUriErrorHandler=r.malformedUriErrorHandler),r.onSameUrlNavigation&&(o.onSameUrlNavigation=r.onSameUrlNavigation),r.paramsInheritanceStrategy&&(o.paramsInheritanceStrategy=r.paramsInheritanceStrategy),r.relativeLinkResolution&&(o.relativeLinkResolution=r.relativeLinkResolution),r.urlUpdateStrategy&&(o.urlUpdateStrategy=r.urlUpdateStrategy),r.canceledNavigationResolution&&(o.canceledNavigationResolution=r.canceledNavigationResolution)}(x,V),V}let zo=(()=>{class r{constructor(s,u,d,m,x,b,D){this.rootComponentType=s,this.urlSerializer=u,this.rootContexts=d,this.location=m,this.config=D,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new xe,this.errorHandler=R3,this.malformedUriErrorHandler=k3,this.navigated=!1,this.lastSuccessfulId=-1,this.afterPreactivation=()=>tn(void 0),this.urlHandlingStrategy=new P3,this.routeReuseStrategy=new S3,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.configLoader=x.get(fA),this.configLoader.onLoadEndListener=Y=>this.triggerEvent(new _F(Y)),this.configLoader.onLoadStartListener=Y=>this.triggerEvent(new gF(Y)),this.ngModule=x.get(Lc),this.console=x.get(N2);const V=x.get(yi);this.isNgZoneEnabled=V instanceof yi&&yi.isInAngularZone(),this.resetConfig(D),this.currentUrlTree=function VL(){return new Pp(new zn([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=rR(this.currentUrlTree,this.rootComponentType),this.transitions=new Jl({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){return this.location.getState()?.\u0275routerPageId}setupNavigations(s){const u=this.events;return s.pipe(Xu(d=>0!==d.id),rn(d=>({...d,extractedUrl:this.urlHandlingStrategy.extract(d.rawUrl)})),jc(d=>{let m=!1,x=!1;return tn(d).pipe(Yo(b=>{this.currentNavigation={id:b.id,initialUrl:b.rawUrl,extractedUrl:b.extractedUrl,trigger:b.source,extras:b.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),jc(b=>{const D=this.browserUrlTree.toString(),P=!this.navigated||b.extractedUrl.toString()!==D||D!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||P)&&this.urlHandlingStrategy.shouldProcessUrl(b.rawUrl))return RR(b.source)&&(this.browserUrlTree=b.extractedUrl),tn(b).pipe(jc(V=>{const Y=this.transitions.getValue();return u.next(new JS(V.id,this.serializeUrl(V.extractedUrl),V.source,V.restoredState)),Y!==this.transitions.getValue()?ki:Promise.resolve(V)}),function h3(r,o,s,u){return jc(d=>function c3(r,o,s,u,d){return new u3(r,o,s,u,d).apply()}(r,o,s,d.extractedUrl,u).pipe(rn(m=>({...d,urlAfterRedirects:m}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Yo(V=>{this.currentNavigation={...this.currentNavigation,finalUrl:V.urlAfterRedirects},d.urlAfterRedirects=V.urlAfterRedirects}),function x3(r,o,s,u,d,m){return Vr(x=>function p3(r,o,s,u,d,m,x="emptyOnly",b="legacy"){return new m3(r,o,s,u,d,x,b,m).recognize().pipe(jc(D=>null===D?function f3(r){return new ft(o=>o.error(r))}(new d3):tn(D)))}(r,o,s,x.urlAfterRedirects,u.serialize(x.urlAfterRedirects),u,d,m).pipe(rn(b=>({...x,targetSnapshot:b}))))}(this.ngModule.injector,this.rootComponentType,this.config,this.urlSerializer,this.paramsInheritanceStrategy,this.relativeLinkResolution),Yo(V=>{if(d.targetSnapshot=V.targetSnapshot,"eager"===this.urlUpdateStrategy){if(!V.extras.skipLocationChange){const re=this.urlHandlingStrategy.merge(V.urlAfterRedirects,V.rawUrl);this.setBrowserUrl(re,V)}this.browserUrlTree=V.urlAfterRedirects}const Y=new hF(V.id,this.serializeUrl(V.extractedUrl),this.serializeUrl(V.urlAfterRedirects),V.targetSnapshot);u.next(Y)}));if(P&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:Y,extractedUrl:re,source:pe,restoredState:Ce,extras:ze}=b,$e=new JS(Y,this.serializeUrl(re),pe,Ce);u.next($e);const ct=rR(re,this.rootComponentType).snapshot;return tn(d={...b,targetSnapshot:ct,urlAfterRedirects:re,extras:{...ze,skipLocationChange:!1,replaceUrl:!1}})}return this.rawUrlTree=b.rawUrl,b.resolve(null),ki}),Yo(b=>{const D=new dF(b.id,this.serializeUrl(b.extractedUrl),this.serializeUrl(b.urlAfterRedirects),b.targetSnapshot);this.triggerEvent(D)}),rn(b=>d={...b,guards:FF(b.targetSnapshot,b.currentSnapshot,this.rootContexts)}),function WF(r,o){return Vr(s=>{const{targetSnapshot:u,currentSnapshot:d,guards:{canActivateChecks:m,canDeactivateChecks:x}}=s;return 0===x.length&&0===m.length?tn({...s,guardsResult:!0}):function ZF(r,o,s,u){return jr(r).pipe(Vr(d=>function e3(r,o,s,u,d){const m=o&&o.routeConfig?o.routeConfig.canDeactivate:null;return m&&0!==m.length?tn(m.map(b=>{const D=Zx(o)??d,P=A_(b,D);return Sd(function HF(r){return r&&Kx(r.canDeactivate)}(P)?P.canDeactivate(r,o,s,u):D.runInContext(()=>P(r,o,s,u))).pipe(Td())})).pipe(I_()):tn(!0)}(d.component,d.route,s,o,u)),Td(d=>!0!==d,!0))}(x,u,d,r).pipe(Vr(b=>b&&function VF(r){return"boolean"==typeof r}(b)?function XF(r,o,s,u){return jr(o).pipe(Dd(d=>jS(function KF(r,o){return null!==r&&o&&o(new yF(r)),tn(!0)}(d.route.parent,u),function YF(r,o){return null!==r&&o&&o(new xF(r)),tn(!0)}(d.route,u),function QF(r,o,s){const u=o[o.length-1],m=o.slice(0,o.length-1).reverse().map(x=>function NF(r){const o=r.routeConfig?r.routeConfig.canActivateChild:null;return o&&0!==o.length?{node:r,guards:o}:null}(x)).filter(x=>null!==x).map(x=>IP(()=>tn(x.guards.map(D=>{const P=Zx(x.node)??s,F=A_(D,P);return Sd(function $F(r){return r&&Kx(r.canActivateChild)}(F)?F.canActivateChild(u,r):P.runInContext(()=>F(u,r))).pipe(Td())})).pipe(I_())));return tn(m).pipe(I_())}(r,d.path,s),function JF(r,o,s){const u=o.routeConfig?o.routeConfig.canActivate:null;if(!u||0===u.length)return tn(!0);const d=u.map(m=>IP(()=>{const x=Zx(o)??s,b=A_(m,x);return Sd(function UF(r){return r&&Kx(r.canActivate)}(b)?b.canActivate(o,r):x.runInContext(()=>b(o,r))).pipe(Td())}));return tn(d).pipe(I_())}(r,d.route,s))),Td(d=>!0!==d,!0))}(u,m,r,o):tn(b)),rn(b=>({...s,guardsResult:b})))})}(this.ngModule.injector,b=>this.triggerEvent(b)),Yo(b=>{if(d.guardsResult=b.guardsResult,kp(b.guardsResult))throw aR(0,b.guardsResult);const D=new fF(b.id,this.serializeUrl(b.extractedUrl),this.serializeUrl(b.urlAfterRedirects),b.targetSnapshot,!!b.guardsResult);this.triggerEvent(D)}),Xu(b=>!!b.guardsResult||(this.restoreHistory(b),this.cancelNavigationTransition(b,"",3),!1)),hA(b=>{if(b.guards.canActivateChecks.length)return tn(b).pipe(Yo(D=>{const P=new pF(D.id,this.serializeUrl(D.extractedUrl),this.serializeUrl(D.urlAfterRedirects),D.targetSnapshot);this.triggerEvent(P)}),jc(D=>{let P=!1;return tn(D).pipe(function w3(r,o){return Vr(s=>{const{targetSnapshot:u,guards:{canActivateChecks:d}}=s;if(!d.length)return tn(s);let m=0;return jr(d).pipe(Dd(x=>function b3(r,o,s,u){const d=r.routeConfig,m=r._resolve;return void 0!==d?.title&&!MR(d)&&(m[Vx]=d.title),function E3(r,o,s,u){const d=function C3(r){return[...Object.keys(r),...Object.getOwnPropertySymbols(r)]}(r);if(0===d.length)return tn({});const m={};return jr(d).pipe(Vr(x=>function T3(r,o,s,u){const d=Zx(o)??u,m=A_(r,d);return Sd(m.resolve?m.resolve(o,s):d.runInContext(()=>m(o,s)))}(r[x],o,s,u).pipe(Td(),Yo(b=>{m[x]=b}))),$S(1),function FL(r){return rn(()=>r)}(m),Md(x=>lA(x)?ki:zx(x)))}(m,r,o,u).pipe(rn(x=>(r._resolvedData=x,r.data=iR(r,s).resolve,d&&MR(d)&&(r.data[Vx]=d.title),null)))}(x.route,u,r,o)),Yo(()=>m++),$S(1),Vr(x=>m===d.length?tn(s):ki))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Yo({next:()=>P=!0,complete:()=>{P||(this.restoreHistory(D),this.cancelNavigationTransition(D,"",2))}}))}),Yo(D=>{const P=new mF(D.id,this.serializeUrl(D.extractedUrl),this.serializeUrl(D.urlAfterRedirects),D.targetSnapshot);this.triggerEvent(P)}))}),hA(b=>{const D=P=>{const F=[];P.routeConfig?.loadComponent&&!P.routeConfig._loadedComponent&&F.push(this.configLoader.loadComponent(P.routeConfig).pipe(Yo(V=>{P.component=V}),rn(()=>{})));for(const V of P.children)F.push(...D(V));return F};return SP(D(b.targetSnapshot.root)).pipe(CT(),Bx(1))}),hA(()=>this.afterPreactivation()),rn(b=>{const D=function TF(r,o,s){const u=qx(r,o._root,s?s._root:void 0);return new nR(u,o)}(this.routeReuseStrategy,b.targetSnapshot,b.currentRouterState);return d={...b,targetRouterState:D}}),Yo(b=>{this.currentUrlTree=b.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(b.urlAfterRedirects,b.rawUrl),this.routerState=b.targetRouterState,"deferred"===this.urlUpdateStrategy&&(b.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,b),this.browserUrlTree=b.urlAfterRedirects)}),((r,o,s)=>rn(u=>(new LF(o,u.targetRouterState,u.currentRouterState,s).activate(r),u)))(this.rootContexts,this.routeReuseStrategy,b=>this.triggerEvent(b)),Yo({next(){m=!0},complete(){m=!0}}),HS(()=>{m||x||this.cancelNavigationTransition(d,"",1),this.currentNavigation?.id===d.id&&(this.currentNavigation=null)}),Md(b=>{if(x=!0,uR(b)){cR(b)||(this.navigated=!0,this.restoreHistory(d,!0));const D=new PT(d.id,this.serializeUrl(d.extractedUrl),b.message,b.cancellationCode);if(u.next(D),cR(b)){const P=this.urlHandlingStrategy.merge(b.url,this.rawUrlTree),F={skipLocationChange:d.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||RR(d.source)};this.scheduleNavigation(P,"imperative",null,F,{resolve:d.resolve,reject:d.reject,promise:d.promise})}else d.resolve(!1)}else{this.restoreHistory(d,!0);const D=new QP(d.id,this.serializeUrl(d.extractedUrl),b,d.targetSnapshot??void 0);u.next(D);try{d.resolve(this.errorHandler(b))}catch(P){d.reject(P)}}return ki}))}))}resetRootComponentType(s){this.rootComponentType=s,this.routerState.root.component=this.rootComponentType}setTransition(s){this.transitions.next({...this.transitions.value,...s})}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(s=>{const u="popstate"===s.type?"popstate":"hashchange";"popstate"===u&&setTimeout(()=>{const d={replaceUrl:!0},m=s.state?.navigationId?s.state:null;if(m){const b={...m};delete b.navigationId,delete b.\u0275routerPageId,0!==Object.keys(b).length&&(d.state=b)}const x=this.parseUrl(s.url);this.scheduleNavigation(x,u,m,d)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(s){this.events.next(s)}resetConfig(s){this.config=s.map(aA),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(s,u={}){const{relativeTo:d,queryParams:m,fragment:x,queryParamsHandling:b,preserveFragment:D}=u,P=d||this.routerState.root,F=D?this.currentUrlTree.fragment:x;let V=null;switch(b){case"merge":V={...this.currentUrlTree.queryParams,...m};break;case"preserve":V=this.currentUrlTree.queryParams;break;default:V=m||null}return null!==V&&(V=this.removeEmptyProps(V)),oF(P,this.currentUrlTree,s,V,F??null)}navigateByUrl(s,u={skipLocationChange:!1}){const d=kp(s)?s:this.parseUrl(s),m=this.urlHandlingStrategy.merge(d,this.rawUrlTree);return this.scheduleNavigation(m,"imperative",null,u)}navigate(s,u={skipLocationChange:!1}){return function N3(r){for(let o=0;o<r.length;o++){if(null==r[o])throw new Ue(4008,false)}}(s),this.navigateByUrl(this.createUrlTree(s,u),u)}serializeUrl(s){return this.urlSerializer.serialize(s)}parseUrl(s){let u;try{u=this.urlSerializer.parse(s)}catch(d){u=this.malformedUriErrorHandler(d,this.urlSerializer,s)}return u}isActive(s,u){let d;if(d=!0===u?{...O3}:!1===u?{...L3}:u,kp(s))return BP(this.currentUrlTree,s,d);const m=this.parseUrl(s);return BP(this.currentUrlTree,m,d)}removeEmptyProps(s){return Object.keys(s).reduce((u,d)=>{const m=s[d];return null!=m&&(u[d]=m),u},{})}processNavigations(){this.navigations.subscribe(s=>{this.navigated=!0,this.lastSuccessfulId=s.id,this.currentPageId=s.targetPageId,this.events.next(new Op(s.id,this.serializeUrl(s.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,this.titleStrategy?.updateTitle(this.routerState.snapshot),s.resolve(!0)},s=>{this.console.warn(`Unhandled Navigation Error: ${s}`)})}scheduleNavigation(s,u,d,m,x){if(this.disposed)return Promise.resolve(!1);let b,D,P;x?(b=x.resolve,D=x.reject,P=x.promise):P=new Promise((Y,re)=>{b=Y,D=re});const F=++this.navigationId;let V;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(d=this.location.getState()),V=d&&d.\u0275routerPageId?d.\u0275routerPageId:m.replaceUrl||m.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1):V=0,this.setTransition({id:F,targetPageId:V,source:u,restoredState:d,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:s,extras:m,resolve:b,reject:D,promise:P,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),P.catch(Y=>Promise.reject(Y))}setBrowserUrl(s,u){const d=this.urlSerializer.serialize(s),m={...u.extras.state,...this.generateNgRouterState(u.id,u.targetPageId)};this.location.isCurrentPathEqualTo(d)||u.extras.replaceUrl?this.location.replaceState(d,"",m):this.location.go(d,"",m)}restoreHistory(s,u=!1){if("computed"===this.canceledNavigationResolution){const d=this.currentPageId-s.targetPageId;"popstate"!==s.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.currentNavigation?.finalUrl||0===d?this.currentUrlTree===this.currentNavigation?.finalUrl&&0===d&&(this.resetState(s),this.browserUrlTree=s.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(d)}else"replace"===this.canceledNavigationResolution&&(u&&this.resetState(s),this.resetUrlToCurrentUrlTree())}resetState(s){this.routerState=s.currentRouterState,this.currentUrlTree=s.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,s.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(s,u,d){const m=new PT(s.id,this.serializeUrl(s.extractedUrl),u,d);this.triggerEvent(m),s.resolve(!1)}generateNgRouterState(s,u){return"computed"===this.canceledNavigationResolution?{navigationId:s,\u0275routerPageId:u}:{navigationId:s}}}return r.\u0275fac=function(s){Lf()},r.\u0275prov=Ut({token:r,factory:function(){return PR()},providedIn:"root"}),r})();function RR(r){return"imperative"!==r}class kR{}let V3=(()=>{class r{constructor(s,u,d,m,x){this.router=s,this.injector=d,this.preloadingStrategy=m,this.loader=x}setUpPreloading(){this.subscription=this.router.events.pipe(Xu(s=>s instanceof Op),Dd(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(s,u){const d=[];for(const m of u){m.providers&&!m._injector&&(m._injector=gs(m.providers,s,`Route: ${m.path}`));const x=m._injector??s,b=m._loadedInjector??x;m.loadChildren&&!m._loadedRoutes&&void 0===m.canLoad||m.loadComponent&&!m._loadedComponent?d.push(this.preloadConfig(x,m)):(m.children||m._loadedRoutes)&&d.push(this.processRoutes(b,m.children??m._loadedRoutes))}return jr(d).pipe(ka())}preloadConfig(s,u){return this.preloadingStrategy.preload(u,()=>{let d;d=u.loadChildren&&void 0===u.canLoad?this.loader.loadChildren(s,u):tn(null);const m=d.pipe(Vr(x=>null===x?tn(void 0):(u._loadedRoutes=x.routes,u._loadedInjector=x.injector,this.processRoutes(x.injector??s,x.routes))));return u.loadComponent&&!u._loadedComponent?jr([m,this.loader.loadComponent(u)]).pipe(ka()):m})}}return r.\u0275fac=function(s){return new(s||r)(Tt(zo),Tt(l_),Tt(Fs),Tt(kR),Tt(fA))},r.\u0275prov=Ut({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const gA=new Ht("");let OR=(()=>{class r{constructor(s,u,d={}){this.router=s,this.viewportScroller=u,this.options=d,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},d.scrollPositionRestoration=d.scrollPositionRestoration||"disabled",d.anchorScrolling=d.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(s=>{s instanceof JS?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=s.navigationTrigger,this.restoredId=s.restoredState?s.restoredState.navigationId:0):s instanceof Op&&(this.lastId=s.id,this.scheduleScrollEvent(s,this.router.parseUrl(s.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(s=>{s instanceof eR&&(s.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(s.position):s.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(s.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(s,u){this.router.triggerEvent(new eR(s,"popstate"===this.lastSource?this.store[this.restoredId]:null,u))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return r.\u0275fac=function(s){Lf()},r.\u0275prov=Ut({token:r,factory:r.\u0275fac}),r})();function P_(r,o){return{\u0275kind:r,\u0275providers:o}}function _A(r){return[{provide:dA,multi:!0,useValue:r}]}function FR(){const r=Kr(_i);return o=>{const s=r.get(Hu);if(o!==s.components[0])return;const u=r.get(zo),d=r.get(NR);1===r.get(yA)&&u.initialNavigation(),r.get(zR,null,$t.Optional)?.setUpPreloading(),r.get(gA,null,$t.Optional)?.init(),u.resetRootComponentType(s.componentTypes[0]),d.closed||(d.next(),d.unsubscribe())}}const NR=new Ht("",{factory:()=>new xe}),yA=new Ht("",{providedIn:"root",factory:()=>1});const zR=new Ht("");function H3(r){return P_(0,[{provide:zR,useExisting:V3},{provide:kR,useExisting:r}])}const BR=new Ht("ROUTER_FORROOT_GUARD"),G3=[Cx,{provide:$P,useClass:qS},{provide:zo,useFactory:PR},Wx,{provide:Lp,useFactory:function LR(r){return r.routerState.root},deps:[zo]},fA];function q3(){return new NC("Router",zo)}let VR=(()=>{class r{constructor(s){}static forRoot(s,u){return{ngModule:r,providers:[G3,[],_A(s),{provide:BR,useFactory:Y3,deps:[[zo,new yu,new Ml]]},{provide:jT,useValue:u||{}},u?.useHash?{provide:cl,useClass:oT}:{provide:cl,useClass:iT},{provide:gA,useFactory:()=>{const r=Kr(zo),o=Kr(gO),s=Kr(jT);return s.scrollOffset&&o.setOffset(s.scrollOffset),new OR(r,o,s)}},u?.preloadingStrategy?H3(u.preloadingStrategy).\u0275providers:[],{provide:NC,multi:!0,useFactory:q3},u?.initialNavigation?K3(u):[],[{provide:jR,useFactory:FR},{provide:CC,multi:!0,useExisting:jR}]]}}static forChild(s){return{ngModule:r,providers:[_A(s)]}}}return r.\u0275fac=function(s){return new(s||r)(Tt(BR,8))},r.\u0275mod=Yr({type:r}),r.\u0275inj=wi({imports:[oA]}),r})();function Y3(r){return"guarded"}function K3(r){return["disabled"===r.initialNavigation?P_(3,[{provide:Uu,multi:!0,useFactory:()=>{const o=Kr(zo);return()=>{o.setUpLocationChangeListener()}}},{provide:yA,useValue:2}]).\u0275providers:[],"enabledBlocking"===r.initialNavigation?P_(2,[{provide:yA,useValue:0},{provide:Uu,multi:!0,deps:[_i],useFactory:o=>{const s=o.get(pS,Promise.resolve());let u=!1;return()=>s.then(()=>new Promise(m=>{const x=o.get(zo),b=o.get(NR);(function d(m){o.get(zo).events.pipe(Xu(b=>b instanceof Op||b instanceof PT||b instanceof QP),rn(b=>b instanceof Op||b instanceof PT&&(0===b.code||1===b.code)&&null),Xu(b=>null!==b),Bx(1)).subscribe(()=>{m()})})(()=>{m(!0),u=!0}),x.afterPreactivation=()=>(m(!0),u||b.closed?tn(void 0):b),x.initialNavigation()}))}}]).\u0275providers:[]]}const jR=new Ht(""),Q3=[];let eN=(()=>{class r{}return r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=Yr({type:r}),r.\u0275inj=wi({imports:[VR.forRoot(Q3),VR]}),r})();class UR{}class $R{}class Ju{constructor(o){this.normalizedNames=new Map,this.lazyUpdate=null,o?this.lazyInit="string"==typeof o?()=>{this.headers=new Map,o.split("\n").forEach(s=>{const u=s.indexOf(":");if(u>0){const d=s.slice(0,u),m=d.toLowerCase(),x=s.slice(u+1).trim();this.maybeSetNormalizedName(d,m),this.headers.has(m)?this.headers.get(m).push(x):this.headers.set(m,[x])}})}:()=>{this.headers=new Map,Object.keys(o).forEach(s=>{let u=o[s];const d=s.toLowerCase();"string"==typeof u&&(u=[u]),u.length>0&&(this.headers.set(d,u),this.maybeSetNormalizedName(s,d))})}:this.headers=new Map}has(o){return this.init(),this.headers.has(o.toLowerCase())}get(o){this.init();const s=this.headers.get(o.toLowerCase());return s&&s.length>0?s[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(o){return this.init(),this.headers.get(o.toLowerCase())||null}append(o,s){return this.clone({name:o,value:s,op:"a"})}set(o,s){return this.clone({name:o,value:s,op:"s"})}delete(o,s){return this.clone({name:o,value:s,op:"d"})}maybeSetNormalizedName(o,s){this.normalizedNames.has(s)||this.normalizedNames.set(s,o)}init(){this.lazyInit&&(this.lazyInit instanceof Ju?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(o=>this.applyUpdate(o)),this.lazyUpdate=null))}copyFrom(o){o.init(),Array.from(o.headers.keys()).forEach(s=>{this.headers.set(s,o.headers.get(s)),this.normalizedNames.set(s,o.normalizedNames.get(s))})}clone(o){const s=new Ju;return s.lazyInit=this.lazyInit&&this.lazyInit instanceof Ju?this.lazyInit:this,s.lazyUpdate=(this.lazyUpdate||[]).concat([o]),s}applyUpdate(o){const s=o.name.toLowerCase();switch(o.op){case"a":case"s":let u=o.value;if("string"==typeof u&&(u=[u]),0===u.length)return;this.maybeSetNormalizedName(o.name,s);const d=("a"===o.op?this.headers.get(s):void 0)||[];d.push(...u),this.headers.set(s,d);break;case"d":const m=o.value;if(m){let x=this.headers.get(s);if(!x)return;x=x.filter(b=>-1===m.indexOf(b)),0===x.length?(this.headers.delete(s),this.normalizedNames.delete(s)):this.headers.set(s,x)}else this.headers.delete(s),this.normalizedNames.delete(s)}}forEach(o){this.init(),Array.from(this.normalizedNames.keys()).forEach(s=>o(this.normalizedNames.get(s),this.headers.get(s)))}}class tN{encodeKey(o){return HR(o)}encodeValue(o){return HR(o)}decodeKey(o){return decodeURIComponent(o)}decodeValue(o){return decodeURIComponent(o)}}const rN=/%(\d[a-f0-9])/gi,iN={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function HR(r){return encodeURIComponent(r).replace(rN,(o,s)=>iN[s]??o)}function GT(r){return`${r}`}class Ad{constructor(o={}){if(this.updates=null,this.cloneFrom=null,this.encoder=o.encoder||new tN,o.fromString){if(o.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function nN(r,o){const s=new Map;return r.length>0&&r.replace(/^\?/,"").split("&").forEach(d=>{const m=d.indexOf("="),[x,b]=-1==m?[o.decodeKey(d),""]:[o.decodeKey(d.slice(0,m)),o.decodeValue(d.slice(m+1))],D=s.get(x)||[];D.push(b),s.set(x,D)}),s}(o.fromString,this.encoder)}else o.fromObject?(this.map=new Map,Object.keys(o.fromObject).forEach(s=>{const u=o.fromObject[s],d=Array.isArray(u)?u.map(GT):[GT(u)];this.map.set(s,d)})):this.map=null}has(o){return this.init(),this.map.has(o)}get(o){this.init();const s=this.map.get(o);return s?s[0]:null}getAll(o){return this.init(),this.map.get(o)||null}keys(){return this.init(),Array.from(this.map.keys())}append(o,s){return this.clone({param:o,value:s,op:"a"})}appendAll(o){const s=[];return Object.keys(o).forEach(u=>{const d=o[u];Array.isArray(d)?d.forEach(m=>{s.push({param:u,value:m,op:"a"})}):s.push({param:u,value:d,op:"a"})}),this.clone(s)}set(o,s){return this.clone({param:o,value:s,op:"s"})}delete(o,s){return this.clone({param:o,value:s,op:"d"})}toString(){return this.init(),this.keys().map(o=>{const s=this.encoder.encodeKey(o);return this.map.get(o).map(u=>s+"="+this.encoder.encodeValue(u)).join("&")}).filter(o=>""!==o).join("&")}clone(o){const s=new Ad({encoder:this.encoder});return s.cloneFrom=this.cloneFrom||this,s.updates=(this.updates||[]).concat(o),s}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(o=>this.map.set(o,this.cloneFrom.map.get(o))),this.updates.forEach(o=>{switch(o.op){case"a":case"s":const s=("a"===o.op?this.map.get(o.param):void 0)||[];s.push(GT(o.value)),this.map.set(o.param,s);break;case"d":if(void 0===o.value){this.map.delete(o.param);break}{let u=this.map.get(o.param)||[];const d=u.indexOf(GT(o.value));-1!==d&&u.splice(d,1),u.length>0?this.map.set(o.param,u):this.map.delete(o.param)}}}),this.cloneFrom=this.updates=null)}}class oN{constructor(){this.map=new Map}set(o,s){return this.map.set(o,s),this}get(o){return this.map.has(o)||this.map.set(o,o.defaultValue()),this.map.get(o)}delete(o){return this.map.delete(o),this}has(o){return this.map.has(o)}keys(){return this.map.keys()}}function GR(r){return typeof ArrayBuffer<"u"&&r instanceof ArrayBuffer}function qR(r){return typeof Blob<"u"&&r instanceof Blob}function WR(r){return typeof FormData<"u"&&r instanceof FormData}class Qx{constructor(o,s,u,d){let m;if(this.url=s,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=o.toUpperCase(),function sN(r){switch(r){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||d?(this.body=void 0!==u?u:null,m=d):m=u,m&&(this.reportProgress=!!m.reportProgress,this.withCredentials=!!m.withCredentials,m.responseType&&(this.responseType=m.responseType),m.headers&&(this.headers=m.headers),m.context&&(this.context=m.context),m.params&&(this.params=m.params)),this.headers||(this.headers=new Ju),this.context||(this.context=new oN),this.params){const x=this.params.toString();if(0===x.length)this.urlWithParams=s;else{const b=s.indexOf("?");this.urlWithParams=s+(-1===b?"?":b<s.length-1?"&":"")+x}}else this.params=new Ad,this.urlWithParams=s}serializeBody(){return null===this.body?null:GR(this.body)||qR(this.body)||WR(this.body)||function aN(r){return typeof URLSearchParams<"u"&&r instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Ad?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||WR(this.body)?null:qR(this.body)?this.body.type||null:GR(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Ad?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(o={}){const s=o.method||this.method,u=o.url||this.url,d=o.responseType||this.responseType,m=void 0!==o.body?o.body:this.body,x=void 0!==o.withCredentials?o.withCredentials:this.withCredentials,b=void 0!==o.reportProgress?o.reportProgress:this.reportProgress;let D=o.headers||this.headers,P=o.params||this.params;const F=o.context??this.context;return void 0!==o.setHeaders&&(D=Object.keys(o.setHeaders).reduce((V,Y)=>V.set(Y,o.setHeaders[Y]),D)),o.setParams&&(P=Object.keys(o.setParams).reduce((V,Y)=>V.set(Y,o.setParams[Y]),P)),new Qx(s,u,m,{params:P,headers:D,context:F,reportProgress:b,responseType:d,withCredentials:x})}}var Bi=(()=>((Bi=Bi||{})[Bi.Sent=0]="Sent",Bi[Bi.UploadProgress=1]="UploadProgress",Bi[Bi.ResponseHeader=2]="ResponseHeader",Bi[Bi.DownloadProgress=3]="DownloadProgress",Bi[Bi.Response=4]="Response",Bi[Bi.User=5]="User",Bi))();class vA{constructor(o,s=200,u="OK"){this.headers=o.headers||new Ju,this.status=void 0!==o.status?o.status:s,this.statusText=o.statusText||u,this.url=o.url||null,this.ok=this.status>=200&&this.status<300}}class xA extends vA{constructor(o={}){super(o),this.type=Bi.ResponseHeader}clone(o={}){return new xA({headers:o.headers||this.headers,status:void 0!==o.status?o.status:this.status,statusText:o.statusText||this.statusText,url:o.url||this.url||void 0})}}class qT extends vA{constructor(o={}){super(o),this.type=Bi.Response,this.body=void 0!==o.body?o.body:null}clone(o={}){return new qT({body:void 0!==o.body?o.body:this.body,headers:o.headers||this.headers,status:void 0!==o.status?o.status:this.status,statusText:o.statusText||this.statusText,url:o.url||this.url||void 0})}}class ZR extends vA{constructor(o){super(o,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${o.url||"(unknown url)"}`:`Http failure response for ${o.url||"(unknown url)"}: ${o.status} ${o.statusText}`,this.error=o.error||null}}function wA(r,o){return{body:o,headers:r.headers,context:r.context,observe:r.observe,params:r.params,reportProgress:r.reportProgress,responseType:r.responseType,withCredentials:r.withCredentials}}let XR=(()=>{class r{constructor(s){this.handler=s}request(s,u,d={}){let m;if(s instanceof Qx)m=s;else{let D,P;D=d.headers instanceof Ju?d.headers:new Ju(d.headers),d.params&&(P=d.params instanceof Ad?d.params:new Ad({fromObject:d.params})),m=new Qx(s,u,void 0!==d.body?d.body:null,{headers:D,context:d.context,params:P,reportProgress:d.reportProgress,responseType:d.responseType||"json",withCredentials:d.withCredentials})}const x=tn(m).pipe(Dd(D=>this.handler.handle(D)));if(s instanceof Qx||"events"===d.observe)return x;const b=x.pipe(Xu(D=>D instanceof qT));switch(d.observe||"body"){case"body":switch(m.responseType){case"arraybuffer":return b.pipe(rn(D=>{if(null!==D.body&&!(D.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return D.body}));case"blob":return b.pipe(rn(D=>{if(null!==D.body&&!(D.body instanceof Blob))throw new Error("Response is not a Blob.");return D.body}));case"text":return b.pipe(rn(D=>{if(null!==D.body&&"string"!=typeof D.body)throw new Error("Response is not a string.");return D.body}));default:return b.pipe(rn(D=>D.body))}case"response":return b;default:throw new Error(`Unreachable: unhandled observe type ${d.observe}}`)}}delete(s,u={}){return this.request("DELETE",s,u)}get(s,u={}){return this.request("GET",s,u)}head(s,u={}){return this.request("HEAD",s,u)}jsonp(s,u){return this.request("JSONP",s,{params:(new Ad).append(u,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(s,u={}){return this.request("OPTIONS",s,u)}patch(s,u,d={}){return this.request("PATCH",s,wA(d,u))}post(s,u,d={}){return this.request("POST",s,wA(d,u))}put(s,u,d={}){return this.request("PUT",s,wA(d,u))}}return r.\u0275fac=function(s){return new(s||r)(Tt(UR))},r.\u0275prov=Ut({token:r,factory:r.\u0275fac}),r})();class YR{constructor(o,s){this.next=o,this.interceptor=s}handle(o){return this.interceptor.intercept(o,this.next)}}const KR=new Ht("HTTP_INTERCEPTORS");let lN=(()=>{class r{intercept(s,u){return u.handle(s)}}return r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=Ut({token:r,factory:r.\u0275fac}),r})();const cN=/^\)\]\}',?\n/;let JR=(()=>{class r{constructor(s){this.xhrFactory=s}handle(s){if("JSONP"===s.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new ft(u=>{const d=this.xhrFactory.build();if(d.open(s.method,s.urlWithParams),s.withCredentials&&(d.withCredentials=!0),s.headers.forEach((re,pe)=>d.setRequestHeader(re,pe.join(","))),s.headers.has("Accept")||d.setRequestHeader("Accept","application/json, text/plain, */*"),!s.headers.has("Content-Type")){const re=s.detectContentTypeHeader();null!==re&&d.setRequestHeader("Content-Type",re)}if(s.responseType){const re=s.responseType.toLowerCase();d.responseType="json"!==re?re:"text"}const m=s.serializeBody();let x=null;const b=()=>{if(null!==x)return x;const re=d.statusText||"OK",pe=new Ju(d.getAllResponseHeaders()),Ce=function uN(r){return"responseURL"in r&&r.responseURL?r.responseURL:/^X-Request-URL:/m.test(r.getAllResponseHeaders())?r.getResponseHeader("X-Request-URL"):null}(d)||s.url;return x=new xA({headers:pe,status:d.status,statusText:re,url:Ce}),x},D=()=>{let{headers:re,status:pe,statusText:Ce,url:ze}=b(),$e=null;204!==pe&&($e=typeof d.response>"u"?d.responseText:d.response),0===pe&&(pe=$e?200:0);let ct=pe>=200&&pe<300;if("json"===s.responseType&&"string"==typeof $e){const Ve=$e;$e=$e.replace(cN,"");try{$e=""!==$e?JSON.parse($e):null}catch(Zt){$e=Ve,ct&&(ct=!1,$e={error:Zt,text:$e})}}ct?(u.next(new qT({body:$e,headers:re,status:pe,statusText:Ce,url:ze||void 0})),u.complete()):u.error(new ZR({error:$e,headers:re,status:pe,statusText:Ce,url:ze||void 0}))},P=re=>{const{url:pe}=b(),Ce=new ZR({error:re,status:d.status||0,statusText:d.statusText||"Unknown Error",url:pe||void 0});u.error(Ce)};let F=!1;const V=re=>{F||(u.next(b()),F=!0);let pe={type:Bi.DownloadProgress,loaded:re.loaded};re.lengthComputable&&(pe.total=re.total),"text"===s.responseType&&!!d.responseText&&(pe.partialText=d.responseText),u.next(pe)},Y=re=>{let pe={type:Bi.UploadProgress,loaded:re.loaded};re.lengthComputable&&(pe.total=re.total),u.next(pe)};return d.addEventListener("load",D),d.addEventListener("error",P),d.addEventListener("timeout",P),d.addEventListener("abort",P),s.reportProgress&&(d.addEventListener("progress",V),null!==m&&d.upload&&d.upload.addEventListener("progress",Y)),d.send(m),u.next({type:Bi.Sent}),()=>{d.removeEventListener("error",P),d.removeEventListener("abort",P),d.removeEventListener("load",D),d.removeEventListener("timeout",P),s.reportProgress&&(d.removeEventListener("progress",V),null!==m&&d.upload&&d.upload.removeEventListener("progress",Y)),d.readyState!==d.DONE&&d.abort()}})}}return r.\u0275fac=function(s){return new(s||r)(Tt(nP))},r.\u0275prov=Ut({token:r,factory:r.\u0275fac}),r})();const bA=new Ht("XSRF_COOKIE_NAME"),EA=new Ht("XSRF_HEADER_NAME");class QR{}let hN=(()=>{class r{constructor(s,u,d){this.doc=s,this.platform=u,this.cookieName=d,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const s=this.doc.cookie||"";return s!==this.lastCookieString&&(this.parseCount++,this.lastToken=Dt(s,this.cookieName),this.lastCookieString=s),this.lastToken}}return r.\u0275fac=function(s){return new(s||r)(Tt(Lo),Tt(tx),Tt(bA))},r.\u0275prov=Ut({token:r,factory:r.\u0275fac}),r})(),CA=(()=>{class r{constructor(s,u){this.tokenService=s,this.headerName=u}intercept(s,u){const d=s.url.toLowerCase();if("GET"===s.method||"HEAD"===s.method||d.startsWith("http://")||d.startsWith("https://"))return u.handle(s);const m=this.tokenService.getToken();return null!==m&&!s.headers.has(this.headerName)&&(s=s.clone({headers:s.headers.set(this.headerName,m)})),u.handle(s)}}return r.\u0275fac=function(s){return new(s||r)(Tt(QR),Tt(EA))},r.\u0275prov=Ut({token:r,factory:r.\u0275fac}),r})(),dN=(()=>{class r{constructor(s,u){this.backend=s,this.injector=u,this.chain=null}handle(s){if(null===this.chain){const u=this.injector.get(KR,[]);this.chain=u.reduceRight((d,m)=>new YR(d,m),this.backend)}return this.chain.handle(s)}}return r.\u0275fac=function(s){return new(s||r)(Tt($R),Tt(_i))},r.\u0275prov=Ut({token:r,factory:r.\u0275fac}),r})(),fN=(()=>{class r{static disable(){return{ngModule:r,providers:[{provide:CA,useClass:lN}]}}static withOptions(s={}){return{ngModule:r,providers:[s.cookieName?{provide:bA,useValue:s.cookieName}:[],s.headerName?{provide:EA,useValue:s.headerName}:[]]}}}return r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=Yr({type:r}),r.\u0275inj=wi({providers:[CA,{provide:KR,useExisting:CA,multi:!0},{provide:QR,useClass:hN},{provide:bA,useValue:"XSRF-TOKEN"},{provide:EA,useValue:"X-XSRF-TOKEN"}]}),r})(),pN=(()=>{class r{}return r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=Yr({type:r}),r.\u0275inj=wi({providers:[XR,{provide:UR,useClass:dN},JR,{provide:$R,useExisting:JR}],imports:[fN.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]}),r})(),ek=(()=>{class r{constructor(s){this.http=s,this.baseUrl="localhost:3000/api/"}getArboles(){return this.http.get("/api/arboles")}getImagenes(s){return this.http.get(`/api/fotos/${s}`)}getUbicacion(s){return this.http.get(`/api/ubicaciones/${s}`)}setComentario(s,u){return this.http.post(`api/comentarios/${s}`,{comentario:u})}}return r.\u0275fac=function(s){return new(s||r)(Tt(XR))},r.\u0275prov=Ut({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),tk=(()=>{class r{constructor(s,u){this._renderer=s,this._elementRef=u,this.onChange=d=>{},this.onTouched=()=>{}}setProperty(s,u){this._renderer.setProperty(this._elementRef.nativeElement,s,u)}registerOnTouched(s){this.onTouched=s}registerOnChange(s){this.onChange=s}setDisabledState(s){this.setProperty("disabled",s)}}return r.\u0275fac=function(s){return new(s||r)(Ze(So),Ze(Dr))},r.\u0275dir=Qt({type:r}),r})(),Fp=(()=>{class r extends tk{}return r.\u0275fac=function(){let o;return function(u){return(o||(o=Ti(r)))(u||r)}}(),r.\u0275dir=Qt({type:r,features:[ur]}),r})();const $c=new Ht("NgValueAccessor"),_N={provide:$c,useExisting:rr(()=>WT),multi:!0},vN=new Ht("CompositionEventMode");let WT=(()=>{class r extends tk{constructor(s,u,d){super(s,u),this._compositionMode=d,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function yN(){const r=ll()?ll().getUserAgent():"";return/android (\d+)/.test(r.toLowerCase())}())}writeValue(s){this.setProperty("value",s??"")}_handleInput(s){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(s)}_compositionStart(){this._composing=!0}_compositionEnd(s){this._composing=!1,this._compositionMode&&this.onChange(s)}}return r.\u0275fac=function(s){return new(s||r)(Ze(So),Ze(Dr),Ze(vN,8))},r.\u0275dir=Qt({type:r,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(s,u){1&s&&ri("input",function(m){return u._handleInput(m.target.value)})("blur",function(){return u.onTouched()})("compositionstart",function(){return u._compositionStart()})("compositionend",function(m){return u._compositionEnd(m.target.value)})},features:[Fr([_N]),ur]}),r})();const Ko=new Ht("NgValidators"),Pd=new Ht("NgAsyncValidators");function dk(r){return null!=r}function fk(r){return kc(r)?jr(r):r}function pk(r){let o={};return r.forEach(s=>{o=null!=s?{...o,...s}:o}),0===Object.keys(o).length?null:o}function mk(r,o){return o.map(s=>s(r))}function gk(r){return r.map(o=>function bN(r){return!r.validate}(o)?o:s=>o.validate(s))}function TA(r){return null!=r?function _k(r){if(!r)return null;const o=r.filter(dk);return 0==o.length?null:function(s){return pk(mk(s,o))}}(gk(r)):null}function DA(r){return null!=r?function yk(r){if(!r)return null;const o=r.filter(dk);return 0==o.length?null:function(s){return function mN(...r){const o=Vp(r),{args:s,keys:u}=TP(r),d=new ft(m=>{const{length:x}=s;if(!x)return void m.complete();const b=new Array(x);let D=x,P=x;for(let F=0;F<x;F++){let V=!1;vn(s[F]).subscribe(vr(m,Y=>{V||(V=!0,P--),b[F]=Y},()=>D--,void 0,()=>{(!D||!V)&&(P||m.next(u?MP(u,b):b),m.complete())}))}});return o?d.pipe(DP(o)):d}(mk(s,o).map(fk)).pipe(rn(pk))}}(gk(r)):null}function vk(r,o){return null===r?[o]:Array.isArray(r)?[...r,o]:[r,o]}function MA(r){return r?Array.isArray(r)?r:[r]:[]}function XT(r,o){return Array.isArray(r)?r.includes(o):r===o}function bk(r,o){const s=MA(o);return MA(r).forEach(d=>{XT(s,d)||s.push(d)}),s}function Ek(r,o){return MA(o).filter(s=>!XT(r,s))}class Ck{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(o){this._rawValidators=o||[],this._composedValidatorFn=TA(this._rawValidators)}_setAsyncValidators(o){this._rawAsyncValidators=o||[],this._composedAsyncValidatorFn=DA(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(o){this._onDestroyCallbacks.push(o)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(o=>o()),this._onDestroyCallbacks=[]}reset(o){this.control&&this.control.reset(o)}hasError(o,s){return!!this.control&&this.control.hasError(o,s)}getError(o,s){return this.control?this.control.getError(o,s):null}}class xs extends Ck{get formDirective(){return null}get path(){return null}}class Rd extends Ck{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}let Dk=(()=>{class r extends class Tk{constructor(o){this._cd=o}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}{constructor(s){super(s)}}return r.\u0275fac=function(s){return new(s||r)(Ze(Rd,2))},r.\u0275dir=Qt({type:r,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(s,u){2&s&&Ru("ng-untouched",u.isUntouched)("ng-touched",u.isTouched)("ng-pristine",u.isPristine)("ng-dirty",u.isDirty)("ng-valid",u.isValid)("ng-invalid",u.isInvalid)("ng-pending",u.isPending)},features:[ur]}),r})();const e1="VALID",KT="INVALID",R_="PENDING",t1="DISABLED";function Sk(r){return Array.isArray(r)?TA(r):r||null}function Ak(r){return Array.isArray(r)?DA(r):r||null}function JT(r){return null!=r&&!Array.isArray(r)&&"object"==typeof r}function n1(r,o){(function OA(r,o){const s=function xk(r){return r._rawValidators}(r);null!==o.validator?r.setValidators(vk(s,o.validator)):"function"==typeof s&&r.setValidators([s]);const u=function wk(r){return r._rawAsyncValidators}(r);null!==o.asyncValidator?r.setAsyncValidators(vk(u,o.asyncValidator)):"function"==typeof u&&r.setAsyncValidators([u]);const d=()=>r.updateValueAndValidity();tD(o._rawValidators,d),tD(o._rawAsyncValidators,d)})(r,o),o.valueAccessor.writeValue(r.value),r.disabled&&o.valueAccessor.setDisabledState?.(!0),function RN(r,o){o.valueAccessor.registerOnChange(s=>{r._pendingValue=s,r._pendingChange=!0,r._pendingDirty=!0,"change"===r.updateOn&&kk(r,o)})}(r,o),function ON(r,o){const s=(u,d)=>{o.valueAccessor.writeValue(u),d&&o.viewToModelUpdate(u)};r.registerOnChange(s),o._registerOnDestroy(()=>{r._unregisterOnChange(s)})}(r,o),function kN(r,o){o.valueAccessor.registerOnTouched(()=>{r._pendingTouched=!0,"blur"===r.updateOn&&r._pendingChange&&kk(r,o),"submit"!==r.updateOn&&r.markAsTouched()})}(r,o),function PN(r,o){if(o.valueAccessor.setDisabledState){const s=u=>{o.valueAccessor.setDisabledState(u)};r.registerOnDisabledChange(s),o._registerOnDestroy(()=>{r._unregisterOnDisabledChange(s)})}}(r,o)}function tD(r,o){r.forEach(s=>{s.registerOnValidatorChange&&s.registerOnValidatorChange(o)})}function kk(r,o){r._pendingDirty&&r.markAsDirty(),r.setValue(r._pendingValue,{emitModelToViewChange:!1}),o.viewToModelUpdate(r._pendingValue),r._pendingChange=!1}function Nk(r,o){const s=r.indexOf(o);s>-1&&r.splice(s,1)}function zk(r){return"object"==typeof r&&null!==r&&2===Object.keys(r).length&&"value"in r&&"disabled"in r}const UN={provide:Rd,useExisting:rr(()=>zA)},Uk=(()=>Promise.resolve())();let zA=(()=>{class r extends Rd{constructor(s,u,d,m,x){super(),this._changeDetectorRef=x,this.control=new class extends class Rk{constructor(o,s){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=o,this._rawAsyncValidators=s,this._composedValidatorFn=Sk(this._rawValidators),this._composedAsyncValidatorFn=Ak(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(o){this._rawValidators=this._composedValidatorFn=o}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(o){this._rawAsyncValidators=this._composedAsyncValidatorFn=o}get parent(){return this._parent}get valid(){return this.status===e1}get invalid(){return this.status===KT}get pending(){return this.status==R_}get disabled(){return this.status===t1}get enabled(){return this.status!==t1}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(o){this._rawValidators=o,this._composedValidatorFn=Sk(o)}setAsyncValidators(o){this._rawAsyncValidators=o,this._composedAsyncValidatorFn=Ak(o)}addValidators(o){this.setValidators(bk(o,this._rawValidators))}addAsyncValidators(o){this.setAsyncValidators(bk(o,this._rawAsyncValidators))}removeValidators(o){this.setValidators(Ek(o,this._rawValidators))}removeAsyncValidators(o){this.setAsyncValidators(Ek(o,this._rawAsyncValidators))}hasValidator(o){return XT(this._rawValidators,o)}hasAsyncValidator(o){return XT(this._rawAsyncValidators,o)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(o={}){this.touched=!0,this._parent&&!o.onlySelf&&this._parent.markAsTouched(o)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(o=>o.markAllAsTouched())}markAsUntouched(o={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(s=>{s.markAsUntouched({onlySelf:!0})}),this._parent&&!o.onlySelf&&this._parent._updateTouched(o)}markAsDirty(o={}){this.pristine=!1,this._parent&&!o.onlySelf&&this._parent.markAsDirty(o)}markAsPristine(o={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(s=>{s.markAsPristine({onlySelf:!0})}),this._parent&&!o.onlySelf&&this._parent._updatePristine(o)}markAsPending(o={}){this.status=R_,!1!==o.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!o.onlySelf&&this._parent.markAsPending(o)}disable(o={}){const s=this._parentMarkedDirty(o.onlySelf);this.status=t1,this.errors=null,this._forEachChild(u=>{u.disable({...o,onlySelf:!0})}),this._updateValue(),!1!==o.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...o,skipPristineCheck:s}),this._onDisabledChange.forEach(u=>u(!0))}enable(o={}){const s=this._parentMarkedDirty(o.onlySelf);this.status=e1,this._forEachChild(u=>{u.enable({...o,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:o.emitEvent}),this._updateAncestors({...o,skipPristineCheck:s}),this._onDisabledChange.forEach(u=>u(!1))}_updateAncestors(o){this._parent&&!o.onlySelf&&(this._parent.updateValueAndValidity(o),o.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(o){this._parent=o}getRawValue(){return this.value}updateValueAndValidity(o={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===e1||this.status===R_)&&this._runAsyncValidator(o.emitEvent)),!1!==o.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!o.onlySelf&&this._parent.updateValueAndValidity(o)}_updateTreeValidity(o={emitEvent:!0}){this._forEachChild(s=>s._updateTreeValidity(o)),this.updateValueAndValidity({onlySelf:!0,emitEvent:o.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?t1:e1}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(o){if(this.asyncValidator){this.status=R_,this._hasOwnPendingAsyncValidator=!0;const s=fk(this.asyncValidator(this));this._asyncValidationSubscription=s.subscribe(u=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(u,{emitEvent:o})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(o,s={}){this.errors=o,this._updateControlsErrors(!1!==s.emitEvent)}get(o){let s=o;return null==s||(Array.isArray(s)||(s=s.split(".")),0===s.length)?null:s.reduce((u,d)=>u&&u._find(d),this)}getError(o,s){const u=s?this.get(s):this;return u&&u.errors?u.errors[o]:null}hasError(o,s){return!!this.getError(o,s)}get root(){let o=this;for(;o._parent;)o=o._parent;return o}_updateControlsErrors(o){this.status=this._calculateStatus(),o&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(o)}_initObservables(){this.valueChanges=new Er,this.statusChanges=new Er}_calculateStatus(){return this._allControlsDisabled()?t1:this.errors?KT:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(R_)?R_:this._anyControlsHaveStatus(KT)?KT:e1}_anyControlsHaveStatus(o){return this._anyControls(s=>s.status===o)}_anyControlsDirty(){return this._anyControls(o=>o.dirty)}_anyControlsTouched(){return this._anyControls(o=>o.touched)}_updatePristine(o={}){this.pristine=!this._anyControlsDirty(),this._parent&&!o.onlySelf&&this._parent._updatePristine(o)}_updateTouched(o={}){this.touched=this._anyControlsTouched(),this._parent&&!o.onlySelf&&this._parent._updateTouched(o)}_registerOnCollectionChange(o){this._onCollectionChange=o}_setUpdateStrategy(o){JT(o)&&null!=o.updateOn&&(this._updateOn=o.updateOn)}_parentMarkedDirty(o){return!o&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(o){return null}}{constructor(o=null,s,u){super(function PA(r){return(JT(r)?r.validators:r)||null}(s),function RA(r,o){return(JT(o)?o.asyncValidators:r)||null}(u,s)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(o),this._setUpdateStrategy(s),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),JT(s)&&(s.nonNullable||s.initialValueIsDefault)&&(this.defaultValue=zk(o)?o.value:o)}setValue(o,s={}){this.value=this._pendingValue=o,this._onChange.length&&!1!==s.emitModelToViewChange&&this._onChange.forEach(u=>u(this.value,!1!==s.emitViewToModelChange)),this.updateValueAndValidity(s)}patchValue(o,s={}){this.setValue(o,s)}reset(o=this.defaultValue,s={}){this._applyFormState(o),this.markAsPristine(s),this.markAsUntouched(s),this.setValue(this.value,s),this._pendingChange=!1}_updateValue(){}_anyControls(o){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(o){this._onChange.push(o)}_unregisterOnChange(o){Nk(this._onChange,o)}registerOnDisabledChange(o){this._onDisabledChange.push(o)}_unregisterOnDisabledChange(o){Nk(this._onDisabledChange,o)}_forEachChild(o){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(o){zk(o)?(this.value=this._pendingValue=o.value,o.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=o}},this._registered=!1,this.update=new Er,this._parent=s,this._setValidators(u),this._setAsyncValidators(d),this.valueAccessor=function FA(r,o){if(!o)return null;let s,u,d;return Array.isArray(o),o.forEach(m=>{m.constructor===WT?s=m:function NN(r){return Object.getPrototypeOf(r.constructor)===Fp}(m)?u=m:d=m}),d||u||s||null}(0,m)}ngOnChanges(s){if(this._checkForErrors(),!this._registered||"name"in s){if(this._registered&&(this._checkName(),this.formDirective)){const u=s.name.previousValue;this.formDirective.removeControl({name:u,path:this._getPath(u)})}this._setUpControl()}"isDisabled"in s&&this._updateDisabled(s),function LA(r,o){if(!r.hasOwnProperty("model"))return!1;const s=r.model;return!!s.isFirstChange()||!Object.is(o,s.currentValue)}(s,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(s){this.viewModel=s,this.update.emit(s)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){n1(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(s){Uk.then(()=>{this.control.setValue(s,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(s){const u=s.isDisabled.currentValue,d=0!==u&&function al(r){return"boolean"==typeof r?r:null!=r&&"false"!==r}(u);Uk.then(()=>{d&&!this.control.disabled?this.control.disable():!d&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(s){return this._parent?function QT(r,o){return[...o.path,r]}(s,this._parent):[s]}}return r.\u0275fac=function(s){return new(s||r)(Ze(xs,9),Ze(Ko,10),Ze(Pd,10),Ze($c,10),Ze(m_,8))},r.\u0275dir=Qt({type:r,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Fr([UN]),ur,Wi]}),r})(),Hk=(()=>{class r{}return r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=Yr({type:r}),r.\u0275inj=wi({}),r})();const QN={provide:$c,useExisting:rr(()=>UA),multi:!0};function Kk(r,o){return null==r?`${o}`:(o&&"object"==typeof o&&(o="Object"),`${r}: ${o}`.slice(0,50))}let UA=(()=>{class r extends Fp{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(s){this._compareWith=s}writeValue(s){this.value=s;const d=Kk(this._getOptionId(s),s);this.setProperty("value",d)}registerOnChange(s){this.onChange=u=>{this.value=this._getOptionValue(u),s(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(s){for(const u of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(u),s))return u;return null}_getOptionValue(s){const u=function ez(r){return r.split(":")[0]}(s);return this._optionMap.has(u)?this._optionMap.get(u):s}}return r.\u0275fac=function(){let o;return function(u){return(o||(o=Ti(r)))(u||r)}}(),r.\u0275dir=Qt({type:r,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(s,u){1&s&&ri("change",function(m){return u.onChange(m.target.value)})("blur",function(){return u.onTouched()})},inputs:{compareWith:"compareWith"},features:[Fr([QN]),ur]}),r})(),Jk=(()=>{class r{constructor(s,u,d){this._element=s,this._renderer=u,this._select=d,this._select&&(this.id=this._select._registerOption())}set ngValue(s){null!=this._select&&(this._select._optionMap.set(this.id,s),this._setElementValue(Kk(this.id,s)),this._select.writeValue(this._select.value))}set value(s){this._setElementValue(s),this._select&&this._select.writeValue(this._select.value)}_setElementValue(s){this._renderer.setProperty(this._element.nativeElement,"value",s)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return r.\u0275fac=function(s){return new(s||r)(Ze(Dr),Ze(So),Ze(UA,9))},r.\u0275dir=Qt({type:r,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),r})();const tz={provide:$c,useExisting:rr(()=>$A),multi:!0};function Qk(r,o){return null==r?`${o}`:("string"==typeof o&&(o=`'${o}'`),o&&"object"==typeof o&&(o="Object"),`${r}: ${o}`.slice(0,50))}let $A=(()=>{class r extends Fp{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(s){this._compareWith=s}writeValue(s){let u;if(this.value=s,Array.isArray(s)){const d=s.map(m=>this._getOptionId(m));u=(m,x)=>{m._setSelected(d.indexOf(x.toString())>-1)}}else u=(d,m)=>{d._setSelected(!1)};this._optionMap.forEach(u)}registerOnChange(s){this.onChange=u=>{const d=[],m=u.selectedOptions;if(void 0!==m){const x=m;for(let b=0;b<x.length;b++){const P=this._getOptionValue(x[b].value);d.push(P)}}else{const x=u.options;for(let b=0;b<x.length;b++){const D=x[b];if(D.selected){const P=this._getOptionValue(D.value);d.push(P)}}}this.value=d,s(d)}}_registerOption(s){const u=(this._idCounter++).toString();return this._optionMap.set(u,s),u}_getOptionId(s){for(const u of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(u)._value,s))return u;return null}_getOptionValue(s){const u=function nz(r){return r.split(":")[0]}(s);return this._optionMap.has(u)?this._optionMap.get(u)._value:s}}return r.\u0275fac=function(){let o;return function(u){return(o||(o=Ti(r)))(u||r)}}(),r.\u0275dir=Qt({type:r,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(s,u){1&s&&ri("change",function(m){return u.onChange(m.target)})("blur",function(){return u.onTouched()})},inputs:{compareWith:"compareWith"},features:[Fr([tz]),ur]}),r})(),eO=(()=>{class r{constructor(s,u,d){this._element=s,this._renderer=u,this._select=d,this._select&&(this.id=this._select._registerOption(this))}set ngValue(s){null!=this._select&&(this._value=s,this._setElementValue(Qk(this.id,s)),this._select.writeValue(this._select.value))}set value(s){this._select?(this._value=s,this._setElementValue(Qk(this.id,s)),this._select.writeValue(this._select.value)):this._setElementValue(s)}_setElementValue(s){this._renderer.setProperty(this._element.nativeElement,"value",s)}_setSelected(s){this._renderer.setProperty(this._element.nativeElement,"selected",s)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return r.\u0275fac=function(s){return new(s||r)(Ze(Dr),Ze(So),Ze($A,9))},r.\u0275dir=Qt({type:r,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),r})(),hz=(()=>{class r{}return r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=Yr({type:r}),r.\u0275inj=wi({imports:[Hk]}),r})(),dz=(()=>{class r{}return r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=Yr({type:r}),r.\u0275inj=wi({imports:[hz]}),r})();function pz(r,o){if(1&r&&(yo(0,"option",7),rd(1),Ro()),2&r){const s=o.$implicit;Po("value",s.arbol_id),_o(1),Jv(s.nombre_arbol)}}let mz=(()=>{class r{constructor(){this.seleccionado="",this.enviar=new Er,this.arboles=[]}ngOnInit(){}changesSelection(s){this.seleccionado=s.target.value,this.enviar.emit(this.seleccionado)}}return r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=uo({type:r,selectors:[["app-selector"]],inputs:{arboles:"arboles"},outputs:{enviar:"enviar"},decls:9,vars:1,consts:[[1,"mt-5"],[1,"text-center"],[1,"row"],[1,"contenedor-selector","mx-auto"],["aria-label","Default select example",1,"form-select",3,"change"],["value","0","selected",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(s,u){1&s&&(yo(0,"div",0)(1,"h1",1),rd(2,"Seleccione un Arbol"),Ro(),yo(3,"div",2)(4,"div",3)(5,"select",4),ri("change",function(m){return u.changesSelection(m)}),yo(6,"option",5),rd(7,"Seleccione"),Ro(),function Tg(r,o,s,u,d,m,x,b){const D=Ne(),P=Wn(),F=r+22,V=P.firstCreatePass?function Cg(r,o,s,u,d,m,x,b,D){const P=o.consts,F=Mu(o,r,4,x||null,cs(P,b));Pv(o,s,F,cs(P,D)),uf(o,F);const V=F.tViews=Av(2,F,u,d,m,o.directiveRegistry,o.pipeRegistry,null,o.schemas,P);return null!==o.queries&&(o.queries.template(o,F),V.queries=o.queries.embeddedTView(F)),F}(F,P,D,o,s,u,d,m,x):P.data[F];Ps(V,!1);const Y=D[11].createComment("");Do(P,D,Y,V),Ki(Y,D),$f(D,D[F]=Cb(Y,D,Y,V)),uh(V)&&Ac(P,D,V),null!=x&&lg(D,V,b)}(8,pz,2,2,"option",6),Ro()()()()),2&s&&(_o(8),Po("ngForOf",u.arboles))},dependencies:[Rn,Jk,eO]}),r})(),gz=(()=>{class r{constructor(){this.imagen="",this.imagenPorDefecto="assets/no-image.png"}ngOnInit(){}ngOnChanges(s){this.imagenPorDefecto=this.imagen.url_foto}}return r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=uo({type:r,selectors:[["app-images"]],inputs:{imagen:"imagen"},features:[Wi],decls:3,vars:1,consts:[[1,"mt-5"],[1,"imagen"],["height","500px",3,"src"]],template:function(s,u){1&s&&(yo(0,"div",0)(1,"div",1),ko(2,"img",2),Ro()()),2&s&&(_o(2),ed("src",u.imagenPorDefecto,qm))}}),r})();var GA=Vi(898),qA=Vi.n(GA);let _z=(()=>{class r{constructor(){this.latitud=26.3398,this.longitud=-81.7787,this.userlocation=[26.3398,-81.7787],this.style="mapbox://styles/mapbox/streets-v11"}ngOnInit(){qA(),this.map=new(qA().Map)({accessToken:"pk.eyJ1IjoiZHBpZXRyb2NhcmxvIiwiYSI6ImNram9tOGFuMTBvb3oyeXFsdW5uYmJjNGQifQ._zE6Mub0-Vpl7ggMj8xSUQ",container:"map",style:this.style,zoom:8,center:[this.latitud,this.longitud]})}ngOnChanges(s){this.latitud=this.userlocation[0],this.longitud=this.userlocation[1],this.map?.flyTo({center:[this.latitud,this.longitud]});const u=(new GA.Popup).setHTML("<h6>aqui estoy</h6> <span>estoy en este lugar del mundo</span>");new GA.Marker({color:"red"}).setLngLat({lng:this.latitud,lat:this.longitud}).setPopup(u).addTo(this.map)}}return r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=uo({type:r,selectors:[["app-map"]],inputs:{latitud:"latitud",longitud:"longitud",userlocation:"userlocation"},features:[Wi],decls:1,vars:0,consts:[["id","map",1,"mt-5",2,"width","100%","height","90%"]],template:function(s,u){1&s&&ko(0,"div",0)}}),r})();var yz=Vi(226),vz=Vi.n(yz);let xz=(()=>{class r{constructor(s){this.services=s,this.id_arbol="",this.comentario=""}ngOnInit(){}enviar(){console.log(this.comentario,this.id_arbol),this.services.setComentario(this.id_arbol,this.comentario).subscribe(s=>{vz().fire({icon:"success",title:"Your work has been saved",showConfirmButton:!1,timer:1500}),this.comentario=""})}}return r.\u0275fac=function(s){return new(s||r)(Ze(ek))},r.\u0275cmp=uo({type:r,selectors:[["app-message"]],inputs:{id_arbol:"id_arbol"},decls:7,vars:1,consts:[[1,"form-group"],["for","comentario "],["id","comentario","rows","3",1,"form-control",3,"ngModel","ngModelChange"],[1,"text-end","mt-2"],[1,"btn","btn-primary",3,"click"]],template:function(s,u){1&s&&(yo(0,"div",0)(1,"label",1),rd(2,"Ingrese comentario"),Ro(),yo(3,"textarea",2),ri("ngModelChange",function(m){return u.comentario=m}),Ro()(),yo(4,"div",3)(5,"button",4),ri("click",function(){return u.enviar()}),rd(6,"Enviar"),Ro()()),2&s&&(_o(3),Po("ngModel",u.comentario))},dependencies:[WT,Dk,zA]}),r})(),wz=(()=>{class r{constructor(s){this.services=s,this.title="front",this.imagenes=[],this.SelectArbol="",this.arboles=[],this.latitud=0,this.longitud=0}ngOnInit(){this.services.getArboles().subscribe(s=>{this.arboles=s.response})}recibirData(s){this.SelectArbol=s,"4"!==s&&(s=+s);let u="";this.services.getImagenes(s).subscribe(m=>{this.imagenes=m.response[0]});for(let m in this.arboles)m==s&&(u=this.arboles[m]);this.services.getUbicacion(u.ubicacion_id).subscribe(m=>{this.ubicacion=m[0],this.latitud=m.response[0].latitud,this.longitud=m.response[0].longitud,this.userLocation=[this.latitud,this.longitud]})}}return r.\u0275fac=function(s){return new(s||r)(Ze(ek))},r.\u0275cmp=uo({type:r,selectors:[["app-root"]],decls:9,vars:6,consts:[[1,"container"],[3,"arboles","enviar"],[1,"row"],[1,"col-6"],[3,"imagen"],[3,"latitud","longitud","userlocation"],[1,"row","mt-5"],[3,"id_arbol"]],template:function(s,u){1&s&&(yo(0,"div",0)(1,"app-selector",1),ri("enviar",function(m){return u.recibirData(m)}),Ro(),yo(2,"div",2)(3,"div",3),ko(4,"app-images",4),Ro(),yo(5,"div",3),ko(6,"app-map",5),Ro()(),yo(7,"div",6),ko(8,"app-message",7),Ro()()),2&s&&(_o(1),Po("arboles",u.arboles),_o(3),Po("imagen",u.imagenes),_o(2),Po("latitud",u.latitud)("longitud",u.longitud)("userlocation",u.userLocation),_o(2),Po("id_arbol",u.SelectArbol))},dependencies:[mz,gz,_z,xz]}),r})(),bz=(()=>{class r{}return r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=Yr({type:r,bootstrap:[wz]}),r.\u0275inj=wi({imports:[pN,fL,eN,dz]}),r})();qA().accessToken="pk.eyJ1IjoiZGFya3Jpc2luZyIsImEiOiJjbHI5dmtxODkwN2FjMnBxbm5lNnE3MTd4In0.p1PYHbV4B_DC08YdbTeHUw",function Y2(){UC=!1}(),dL().bootstrapModule(bz).catch(r=>console.error(r))},898:function(kd){kd.exports=function(){"use strict";var ws,Vi,Fn;function zr(rt,ce){if(ws)if(Vi){var Jo="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+ws+")(sharedChunk); ("+Vi+")(sharedChunk); self.onerror = null;",ji={};ws(ji),Fn=ce(ji),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(Fn.workerUrl=window.URL.createObjectURL(new Blob([Jo],{type:"text/javascript"})))}else Vi=ce;else ws=ce}return zr(0,function(rt){var ce=typeof self<"u"?self:{},Jo="3.0.1";let ji;const Rt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==ji){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ji=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch{ji=t}}return ji},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Rt.API_URL)return null;try{const t=new URL(Rt.API_URL);return"api.mapbox.cn"===t.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===t.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},ro={supported:!1,testSupport:function(t){!Ql&&Gs&&(Da?Qu(t):io=t)}};let io,Gs,Ql=!1,Da=!1;function Qu(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Gs),t.isContextLost())return;ro.supported=!0}catch{}t.deleteTexture(e),Ql=!0}ce.document&&(Gs=ce.document.createElement("img"),Gs.onload=function(){io&&Qu(io),io=null,Da=!0},Gs.onerror=function(){Ql=!0,io=null},Gs.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ma="01";function oo(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var bs=Es;function Es(t,e,n,i){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=i}Es.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,i=0;i<8;i++){var a=this.sampleCurveX(n)-t;if(Math.abs(a)<e)return n;var l=this.sampleCurveDerivativeX(n);if(Math.abs(l)<1e-6)break;n-=a/l}var c=0,h=1;for(n=t,i=0;i<20&&(a=this.sampleCurveX(n),!(Math.abs(a-t)<e));i++)t>a?c=n:h=n,n=.5*(h-c)+c;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var eh=oo(bs),Sa=Qo;function Qo(t,e){this.x=t,this.y=e}Qo.prototype={clone:function(){return new Qo(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),i=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=i,this},_rotateAround:function(t,e){var n=Math.cos(t),i=Math.sin(t),a=e.y+i*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-i*(this.y-e.y),this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Qo.convert=function(t){return t instanceof Qo?t:Array.isArray(t)?new Qo(t[0],t[1]):t};var ie=oo(Sa);function ln(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!ln(t[n],e[n]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(!ln(t[n],e[n]))return!1;return!0}return t===e}const pl=Math.PI/180,es=180/Math.PI;function At(t){return t*pl}function kr(t){return t*es}const Od=[[0,0],[1,0],[1,1],[0,1]];function Aa(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function qs(t){let e=1/0,n=1/0,i=-1/0,a=-1/0;for(const l of t)e=Math.min(e,l.x),n=Math.min(n,l.y),i=Math.max(i,l.x),a=Math.max(a,l.y);return{min:new ie(e,n),max:new ie(i,a)}}function ml(t,e,n=0,i=!0){const a=new ie(n,n),l=t.sub(a),c=e.add(a),h=[l,new ie(c.x,l.y),c,new ie(l.x,c.y)];return i&&h.push(l.clone()),h}function Ia(t,e,n,i){const a=new eh(t,e,n,i);return function(l){return a.solve(l)}}const ft=Ia(.25,.1,.25,1);function et(t,e,n){return Math.min(n,Math.max(e,t))}function Cs(t,e,n){return(n=et((n-t)/(e-t),0,1))*n*(3-2*n)}function ts(t,e,n){const i=n-e,a=((t-e)%i+i)%i+e;return a===e?n:a}function gl(t,e,n){if(!t.length)return n(null,[]);let i=t.length;const a=new Array(t.length);let l=null;t.forEach((c,h)=>{e(c,(f,p)=>{f&&(l=f),a[h]=p,0==--i&&n(l,a)})})}function xe(t){const e=[];for(const n in t)e.push(t[n]);return e}function Ke(t,...e){for(const n of e)for(const i in n)t[i]=n[i];return t}function fi(t,e){const n={};for(let i=0;i<e.length;i++){const a=e[i];a in t&&(n[a]=t[a])}return n}let Zr=1;function vr(){return Zr++}function vi(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function rn(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function _l(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Xr(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function Pa(t,e){return-1!==t.indexOf(e,t.length-e.length)}function Ws(t,e,n){const i={};for(const a in t)i[a]=e.call(n||this,t[a],a,t);return i}function ke(t,e,n){const i={};for(const a in t)e.call(n||this,t[a],a,t)&&(i[a]=t[a]);return i}function q(t){return Array.isArray(t)?t.map(q):"object"==typeof t&&t?Ws(t,q):t}const X={};function ee(t){X[t]||(typeof console<"u"&&console.warn(t),X[t]=!0)}function be(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function we(t){let e=0;for(let n,i,a=0,l=t.length,c=l-1;a<l;c=a++)n=t[a],i=t[c],e+=(i.x-n.x)*(n.y+i.y);return e}function Ae([t,e,n]){const i=At(e+90),a=At(n);return{x:t*Math.cos(i)*Math.sin(a),y:t*Math.sin(i)*Math.sin(a),z:t*Math.cos(a),azimuthal:e,polar:n}}function tt(t,e,n){const i=Math.sqrt(t*t+e*e+n*n),a=i>0?Math.acos(n/i)*es:0;let l=0!==t||0!==e?Math.atan2(-e,-t)*es+90:0;return l<0&&(l+=360),[i,l,a]}function De(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function st(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,i,a,l)=>{const c=a||l;return e[i]=!c||c.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let mt=null;function _t(){return!!ce.document.fullscreenElement||!!ce.document.webkitFullscreenElement}function Dn(t){try{const e=ce[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Zn(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function tr(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]}function Bn(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]}function En(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]}const Vn="mapbox-tiles";let Pi,so,Br=500,Qr=50;function Ra(){try{return ce.caches}catch{}}function ao(){Ra()&&!Pi&&(Pi=ce.caches.open(Vn))}function ns(t){const e=t.indexOf("?");if(e<0)return t;const i=function(a){const l=a.indexOf("?");return l>0?a.slice(l+1).split("&"):[]}(t).filter(a=>{const l=a.split("=");return"language"===l[0]||"worldview"===l[0]});return i.length?`${t.slice(0,e)}?${i.join("&")}`:t.slice(0,e)}let Ts=1/0;function Zs(t){Ts++,Ts>Qr&&(t.getActor().send("enforceCacheSizeLimit",Br),Ts=0)}const _e={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(_e);class ye extends Error{constructor(e,n,i){401===n&&vn(i)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=i}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ee=De()?()=>self.worker&&self.worker.referrer:()=>("blob:"===ce.location.protocol?ce.parent:ce).location.href,Fe=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(Ee())&&!/^\w+:/.test(n))){if(ce.fetch&&ce.Request&&ce.AbortController&&ce.Request.prototype.hasOwnProperty("signal"))return function(i,a){const l=new ce.AbortController,c=new ce.Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:Ee(),referrerPolicy:i.referrerPolicy,signal:l.signal});let h=!1,f=!1;const p=(g=c.url).indexOf("sku=")>0&&vn(g);var g;"json"===i.type&&c.headers.set("Accept","application/json");const _=(v,w,E)=>{if(f)return;if(v&&"SecurityError"!==v.message&&ee(v.toString()),w&&E)return y(w);const T=Date.now();ce.fetch(c).then(C=>{if(C.ok){const S=p?C.clone():null;return y(C,S,T)}return a(new ye(C.statusText,C.status,i.url))}).catch(C=>{"AbortError"!==C.name&&a(new Error(`${C.message} ${i.url}`))})},y=(v,w,E)=>{("arrayBuffer"===i.type?v.arrayBuffer():"json"===i.type?v.json():v.text()).then(T=>{f||(w&&E&&function(C,S,I){if(ao(),!Pi)return;const R={status:S.status,statusText:S.statusText,headers:new ce.Headers};S.headers.forEach((L,B)=>R.headers.set(B,L));const A=st(S.headers.get("Cache-Control")||"");if(A["no-store"])return;A["max-age"]&&R.headers.set("Expires",new Date(I+1e3*A["max-age"]).toUTCString());const k=R.headers.get("Expires");k&&(new Date(k).getTime()-I<42e4||function(L,B){if(void 0===so)try{new Response(new ReadableStream),so=!0}catch{so=!1}so?B(L.body):L.blob().then(B)}(S,L=>{const B=new ce.Response(L,R);ao(),Pi&&Pi.then(j=>j.put(ns(C.url),B)).catch(j=>ee(j.message))}))}(c,w,E),h=!0,a(null,T,v.headers.get("Cache-Control"),v.headers.get("Expires")))}).catch(T=>{f||a(new Error(T.message))})};return p?function(v,w){if(ao(),!Pi)return w(null);const E=ns(v.url);Pi.then(T=>{T.match(E).then(C=>{const S=function(I){if(!I)return!1;const R=new Date(I.headers.get("Expires")||0),A=st(I.headers.get("Cache-Control")||"");return R>Date.now()&&!A["no-cache"]}(C);T.delete(E),S&&T.put(E,C.clone()),w(null,C,S)}).catch(w)}).catch(w)}(c,_):_(null,null),{cancel:()=>{f=!0,h||l.abort()}}}(t,e);if(De()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(i,a){const l=new ce.XMLHttpRequest;l.open(i.method||"GET",i.url,!0),"arrayBuffer"===i.type&&(l.responseType="arraybuffer");for(const c in i.headers)l.setRequestHeader(c,i.headers[c]);return"json"===i.type&&(l.responseType="text",l.setRequestHeader("Accept","application/json")),l.withCredentials="include"===i.credentials,l.onerror=()=>{a(new Error(l.statusText))},l.onload=()=>{if((l.status>=200&&l.status<300||0===l.status)&&null!==l.response){let c=l.response;if("json"===i.type)try{c=JSON.parse(l.response)}catch(h){return a(h)}a(null,c,l.getResponseHeader("Cache-Control"),l.getResponseHeader("Expires"))}else a(new ye(l.statusText,l.status,i.url))},l.send(i.body),{cancel:()=>l.abort()}}(t,e)},Me=function(t,e){return Fe(Ke(t,{type:"json"}),e)},je=function(t,e){return Fe(Ke(t,{type:"arrayBuffer"}),e)};function He(t){const e=ce.document.createElement("a");return e.href=t,e.protocol===ce.document.location.protocol&&e.host===ce.document.location.host}const Be="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ie,Le;Ie=[],Le=0;const vt=function(t,e){if(ro.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Le>=Rt.MAX_PARALLEL_IMAGE_REQUESTS){const l={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Ie.push(l),l}Le++;let n=!1;const i=()=>{if(!n)for(n=!0,Le--;Ie.length&&Le<Rt.MAX_PARALLEL_IMAGE_REQUESTS;){const l=Ie.shift(),{requestParameters:c,callback:h,cancelled:f}=l;f||(l.cancel=vt(c,h).cancel)}},a=je(t,(l,c,h,f)=>{i(),l?e(l):c&&(ce.createImageBitmap?function(p,g){const _=new ce.Blob([new Uint8Array(p)],{type:"image/png"});ce.createImageBitmap(_).then(y=>{g(null,y)}).catch(y=>{g(new Error(`Could not load image because of ${y.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(c,(p,g)=>e(p,g,h,f)):function(p,g){const _=new ce.Image,y=ce.URL;_.onload=()=>{g(null,_),y.revokeObjectURL(_.src),_.onload=null,ce.requestAnimationFrame(()=>{_.src=Be})},_.onerror=()=>g(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const v=new ce.Blob([new Uint8Array(p)],{type:"image/png"});_.src=p.byteLength?y.createObjectURL(v):Be}(c,(p,g)=>e(p,g,h,f)))});return{cancel:()=>{a.cancel(),i()}}},cn="NO_ACCESS_TOKEN";class Je{constructor(e,n,i){this._transformRequestFn=e,this._customAccessToken=n,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const e=function(){let n="";for(let i=0;i<10;i++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ma,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,n){return this._transformRequestFn&&this._transformRequestFn(e,n)||{url:e}}normalizeStyleURL(e,n){if(!Nt(e))return e;const i=Or(e);return i.params.push("sdk=js-3.0.1"),i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||n)}normalizeGlyphsURL(e,n){if(!Nt(e))return e;const i=Or(e);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||n)}normalizeModelURL(e,n){if(!Nt(e))return e;const i=Or(e);return i.path=`/models/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||n)}normalizeSourceURL(e,n,i,a){if(!Nt(e))return e;const l=Or(e);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),i&&l.params.push(`language=${i}`),a&&l.params.push(`worldview=${a}`),this._makeAPIURL(l,this._customAccessToken||n)}normalizeSpriteURL(e,n,i,a){const l=Or(e);return Nt(e)?(l.path=`/styles/v1${l.path}/sprite${n}${i}`,this._makeAPIURL(l,this._customAccessToken||a)):(l.path+=`${n}${i}`,Ri(l))}normalizeTileURL(e,n,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!Nt(e))return e;const a=Or(e);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||i&&"raster"!==a.authority&&512===i?"@2x":""}${ro.supported?".webp":"$1"}`),"raster"===a.authority?a.path=`/${Rt.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${Rt.TILE_URL_VERSION}${a.path}`);const l=this._customAccessToken||function(c){for(const h of c){const f=h.match(/^access_token=(.*)$/);if(f)return f[1]}return null}(a.params)||Rt.ACCESS_TOKEN;return Rt.REQUIRE_ACCESS_TOKEN&&l&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,l)}canonicalizeTileURL(e,n){const i=Or(e);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return e;let a="mapbox://";i.path.match(/^\/raster\/v1\//)?a+=`raster/${i.path.replace(`/${Rt.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${i.path.replace(`/${Rt.TILE_URL_VERSION}/`,"")}`;let l=i.params;return n&&(l=l.filter(c=>!c.match(/^access_token=/))),l.length&&(a+=`?${l.join("&")}`),a}canonicalizeTileset(e,n){const i=!!n&&Nt(n),a=[];for(const l of e.tiles||[])vn(l)?a.push(this.canonicalizeTileURL(l,i)):a.push(l);return a}_makeAPIURL(e,n){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=Or(Rt.API_URL);if(e.protocol=a.protocol,e.authority=a.authority,"http"===e.protocol){const l=e.params.indexOf("secure");l>=0&&e.params.splice(l,1)}if("/"!==a.path&&(e.path=`${a.path}${e.path}`),!Rt.REQUIRE_ACCESS_TOKEN)return Ri(e);if(n=n||Rt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===n[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return e.params=e.params.filter(l=>-1===l.indexOf("access_token")),e.params.push(`access_token=${n||""}`),Ri(e)}}function Nt(t){return 0===t.indexOf("mapbox:")}function vn(t){return Rt.API_URL_REGEX.test(t)}function hr(t){return Rt.API_CDN_URL_REGEX.test(t)}function dr(t){return Rt.API_STYLE_REGEX.test(t)&&!nr(t)}function nr(t){return Rt.API_SPRITE_REGEX.test(t)}const Bo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Or(t){const e=t.match(Bo);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Ri(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const ai="mapbox.eventData";function lo(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(ce.atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Xs{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const n=lo(Rt.ACCESS_TOKEN);let i="";return i=n&&n.u?ce.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(a,l)=>String.fromCharCode(Number("0x"+l)))):Rt.ACCESS_TOKEN||"",e?`${ai}.${e}:${i}`:`${ai}:${i}`}fetchEventData(){const e=Dn("localStorage"),n=this.getStorageKey(),i=this.getStorageKey("uuid");if(e)try{const a=ce.localStorage.getItem(n);a&&(this.eventData=JSON.parse(a));const l=ce.localStorage.getItem(i);l&&(this.anonId=l)}catch{ee("Unable to read from LocalStorage")}}saveEventData(){const e=Dn("localStorage"),n=this.getStorageKey(),i=this.getStorageKey("uuid");if(e)try{ce.localStorage.setItem(i,this.anonId),Object.keys(this.eventData).length>=1&&ce.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{ee("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,i,a){if(!Rt.EVENTS_URL)return;const l=Or(Rt.EVENTS_URL);l.params.push(`access_token=${a||Rt.ACCESS_TOKEN||""}`);const c={event:this.type,created:new Date(e).toISOString()},h=n?Ke(c,n):c,f={url:Ri(l),headers:{"Content-Type":"text/plain"},body:JSON.stringify([h])};var g;this.pendingRequest=(g=p=>{this.pendingRequest=null,i(p),this.saveEventData(),this.processRequests(a)},Fe(Ke(f,{method:"POST"}),g))}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}const Vr=new class extends Xs{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){Rt.EVENTS_URL&&Rt.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>Nt(n)||vn(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=lo(Rt.ACCESS_TOKEN),n=e?e.u:Rt.ACCESS_TOKEN;let i=n!==this.eventData.tokenU;_l(this.anonId)||(this.anonId=vi(),i=!0);const a=this.queue.shift();if(this.eventData.lastSuccess){const l=new Date(this.eventData.lastSuccess),c=new Date(a),h=(a-this.eventData.lastSuccess)/864e5;i=i||h>=1||h<-1||l.getDate()!==c.getDate()}else i=!0;i?this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Jo,skuId:Ma,"enabled.telemetry":!1,userId:this.anonId},l=>{l||(this.eventData.lastSuccess=a,this.eventData.tokenU=n)},t):this.processRequests()}},ka=Vr.postTurnstileEvent.bind(Vr),ki=new class extends Xs{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,i){this.skuToken=e,this.errorCb=i,Rt.EVENTS_URL&&(n||Rt.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(cn)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),_l(this.anonId)||(this.anonId=vi()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Jo,skuId:Ma,skuToken:this.skuToken,userId:this.anonId},i=>{i?this.errorCb(i):e&&(this.success[e]=!0)},t))}},i1=ki.postMapLoadEvent.bind(ki),Bp=new class extends Xs{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){Rt.EVENTS_URL&&(t||Rt.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,performanceData:n}=this.queue.shift(),i=function(a){const l=ce.performance.getEntriesByType("resource"),c=ce.performance.getEntriesByType("mark"),h=function(y){const v={};if(y)for(const w in y)if("other"!==w)for(const E of y[w]){const T=`${w}ResolveRangeMin`,C=`${w}ResolveRangeMax`,S=`${w}RequestCount`,I=`${w}RequestCachedCount`;v[T]=Math.min(v[T]||1/0,E.startTime),v[C]=Math.max(v[C]||-1/0,E.responseEnd);const R=A=>{void 0===v[A]&&(v[A]=0),++v[A]};void 0!==E.transferSize&&0===E.transferSize&&R(I),R(S)}return v}(function(y,v){const w={};if(y)for(const E of y){const T=v(E);void 0===w[T]&&(w[T]=[]),w[T].push(E)}return w}(l,O_)),f=ce.devicePixelRatio,p=ce.navigator.connection||ce.navigator.mozConnection||ce.navigator.webkitConnection,g={counters:[],metadata:[],attributes:[]},_=(y,v,w)=>{null!=w&&y.push({name:v,value:w.toString()})};for(const y in h)_(g.counters,y,h[y]);if(a.interactionRange[0]!==1/0&&a.interactionRange[1]!==-1/0&&(_(g.counters,"interactionRangeMin",a.interactionRange[0]),_(g.counters,"interactionRangeMax",a.interactionRange[1])),c)for(const y of Object.keys(Gc)){const v=Gc[y],w=c.find(E=>E.name===v);w&&_(g.counters,v,w.startTime)}return _(g.counters,"visibilityHidden",a.visibilityHidden),_(g.attributes,"style",function(y){if(y)for(const v of y){const w=v.name.split("?")[0];if(dr(w)){const E=w.split("/").slice(-2);if(2===E.length)return`mapbox://styles/${E[0]}/${E[1]}`}}}(l)),_(g.attributes,"terrainEnabled",a.terrainEnabled?"true":"false"),_(g.attributes,"fogEnabled",a.fogEnabled?"true":"false"),_(g.attributes,"projection",a.projection),_(g.attributes,"zoom",a.zoom),_(g.metadata,"devicePixelRatio",f),_(g.metadata,"connectionEffectiveType",p?p.effectiveType:void 0),_(g.metadata,"navigatorUserAgent",ce.navigator.userAgent),_(g.metadata,"screenWidth",ce.screen.width),_(g.metadata,"screenHeight",ce.screen.height),_(g.metadata,"windowWidth",ce.innerWidth),_(g.metadata,"windowHeight",ce.innerHeight),_(g.metadata,"mapWidth",a.width/f),_(g.metadata,"mapHeight",a.height/f),_(g.metadata,"webglRenderer",a.renderer),_(g.metadata,"webglVendor",a.vendor),_(g.metadata,"sdkVersion",Jo),_(g.metadata,"sdkIdentifier","mapbox-gl-js"),g}(n);for(const a of i.metadata);for(const a of i.counters);for(const a of i.attributes);this.postEvent(e,i,()=>{},t)}},k_=Bp.postPerformanceEvent.bind(Bp),th=new class extends Xs{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,i){if(!Rt.API_URL||!Rt.SESSION_PATH)return;const a=Or(Rt.API_URL+Rt.SESSION_PATH);a.params.push(`sku=${e||""}`),a.params.push(`access_token=${i||Rt.ACCESS_TOKEN||""}`);const l={url:Ri(a),headers:{"Content-Type":"text/plain"}};var h;this.pendingRequest=(h=c=>{this.pendingRequest=null,n(c),this.saveEventData(),this.processRequests(i)},Fe(Ke(l,{method:"GET"}),h))}getSessionAPI(t,e,n,i){this.skuToken=e,this.errorCb=i,Rt.SESSION_PATH&&Rt.API_URL&&(n||Rt.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(cn)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,i=>{i?this.errorCb(i):e&&(this.success[e]=!0)},t)}},Vp=th.getSessionAPI.bind(th),Ds=new Set;function jp(t,e){e?Ds.add(t):Ds.delete(t)}const Gc={create:"create",load:"load",fullLoad:"fullLoad"},Ys={mark(t){ce.performance.mark(t)},measure(t,e,n){ce.performance.measure(t,e,n)}};function O_(t){const e=t.name.split("?")[0];return hr(e)&&e.includes("mapbox-gl.js")?"javascript":hr(e)&&e.includes("mapbox-gl.css")?"css":Rt.API_FONTS_REGEX.test(e)?"fontRange":nr(e)?"sprite":dr(e)?"style":Rt.API_TILEJSON_REGEX.test(e)?"tilejson":"other"}const L_=ce.performance;function Up(t){const e=t?t.url.toString():void 0;return L_.getEntriesByName(e)}var nh=rh;function rh(t){return e=t,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var i,a,l=new Blob([""],{type:"text/javascript"}),c=URL.createObjectURL(l);try{a=new Worker(c),i=!0}catch{i=!1}return a&&a.terminate(),URL.revokeObjectURL(c),i}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var i=document.createElement("canvas");i.width=i.height=1;var a=i.getContext("2d");if(!a)return!1;var l=a.getImageData(0,0,1,1);return l&&l.width===i.width}()||(void 0===Ld[n=e&&e.failIfMajorPerformanceCaveat]&&(Ld[n]=function(i){var a,c,h,f,l=(c=i,h=document.createElement("canvas"),(f=Object.create(rh.webGLContextAttributes)).failIfMajorPerformanceCaveat=c,h.getContext("webgl",f)||h.getContext("experimental-webgl",f));if(!l)return!1;try{a=l.createShader(l.VERTEX_SHADER)}catch{return!1}return!(!a||l.isContextLost())&&(l.shaderSource(a,"void main() {}"),l.compileShader(a),!0===l.getShaderParameter(a,l.COMPILE_STATUS))}(n)),!Ld[n]||document.documentMode));var e,n}var Ld={};let ih,jr,oh,Gn;rh.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ct={now:()=>void 0!==oh?oh:ce.performance.now(),setNow(t){oh=t},restoreNow(){oh=void 0},frame(t){const e=ce.requestAnimationFrame(t);return{cancel:()=>ce.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:n,height:i}=t;Gn||(Gn=ce.document.createElement("canvas"));const a=Gn.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return(n>Gn.width||i>Gn.height)&&(Gn.width=n,Gn.height=i),a.clearRect(-e,-e,n+2*e,i+2*e),a.drawImage(t,0,0,n,i),a.getImageData(-e,-e,n+2*e,i+2*e)},resolveURL:t=>(ih||(ih=ce.document.createElement("a")),ih.href=t,ih.href),get devicePixelRatio(){return ce.devicePixelRatio},get prefersReducedMotion(){return!!ce.matchMedia&&(null==jr&&(jr=ce.matchMedia("(prefers-reduced-motion: reduce)")),jr.matches)}};function Mt(t,e,n){const i=ce.document.createElement(t);return void 0!==e&&(i.className=e),n&&n.appendChild(i),i}function rs(t,e,n){const i=ce.document.createElementNS("http://www.w3.org/2000/svg",t);for(const a of Object.keys(e))i.setAttributeNS(null,a,e[a]);return n&&n.appendChild(i),i}const jn=ce.document&&ce.document.documentElement.style,yl=jn&&void 0!==jn.userSelect?"userSelect":"WebkitUserSelect";let $p;function rr(){jn&&yl&&($p=jn[yl],jn[yl]="none")}function jt(){jn&&yl&&(jn[yl]=$p)}function ec(t){t.preventDefault(),t.stopPropagation(),ce.removeEventListener("click",ec,!0)}function qc(){ce.addEventListener("click",ec,!0),ce.setTimeout(()=>{ce.removeEventListener("click",ec,!0)},0)}function Ue(t,e){const n=t.getBoundingClientRect();return qn(t,n,e)}function vl(t,e){const n=t.getBoundingClientRect(),i=[];for(let a=0;a<e.length;a++)i.push(qn(t,n,e[a]));return i}function un(t){return void 0!==ce.InstallTrigger&&2===t.button&&t.ctrlKey&&ce.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button}function qn(t,e,n){const i=t.offsetWidth===e.width?1:t.offsetWidth/e.width;return new ie((n.clientX-e.left)*i,(n.clientY-e.top)*i)}function Fd(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function Hp(t,e,n){if(n&&n[t]){const i=n[t].indexOf(e);-1!==i&&n[t].splice(i,1)}}class Se{constructor(e,n={}){Ke(this,n),this.type=e}}class xt extends Se{constructor(e,n={}){super("error",Ke({error:e},n))}}class Mn{on(e,n){return this._listeners=this._listeners||{},Fd(e,n,this._listeners),this}off(e,n){return Hp(e,n,this._listeners),Hp(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Fd(e,n,this._oneTimeListeners),this):new Promise(i=>this.once(e,i))}fire(e,n){"string"==typeof e&&(e=new Se(e,n||{}));const i=e.type;if(this.listens(i)){e.target=this;const a=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const h of a)h.call(this,e);const l=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const h of l)Hp(i,h,this._oneTimeListeners),h.call(this,e);const c=this._eventedParent;c&&(Ke(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),c.fire(e))}else e instanceof xt&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var le=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class Ye{constructor(e,n,i,a){this.message=(e?`${e}: `:"")+i,a&&(this.identifier=a),null!=n&&n.__line__&&(this.line=n.__line__)}}class tc extends Ye{}function xi(t,...e){for(const n of e)for(const i in n)t[i]=n[i];return t}function Ur(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Oa(t){if(Array.isArray(t))return t.map(Oa);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=Oa(t[n]);return e}return Ur(t)}class o1 extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}var Ks=o1;class Nd{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[i,a]of n)this.bindings[i]=a}concat(e){return new Nd(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var F_=Nd;const nc={kind:"null"},Xe={kind:"number"},Ot={kind:"string"},ht={kind:"boolean"},Oi={kind:"color"},rc={kind:"object"},pn={kind:"value"},Ut={kind:"collator"},Wc={kind:"formatted"},wi={kind:"resolvedImage"};function bi(t,e){return{kind:"array",itemType:t,N:e}}function Ar(t){if("array"===t.kind){const e=Ar(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const Gp=[nc,Xe,Ot,ht,Oi,Wc,rc,bi(pn),wi];function Zc(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Zc(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const n of Gp)if(!Zc(n,e))return null}return`Expected ${Ar(t)} but found ${Ar(e)} instead.`}function zd(t,e){return e.some(n=>n.kind===t.kind)}function is(t,e){return e.some(n=>"null"===n?null===t:"array"===n?Array.isArray(t):"object"===n?t&&!Array.isArray(t)&&"object"==typeof t:n===typeof t)}var ic,Xc={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function oc(t){return(t=Math.round(t))<0?0:t>255?255:t}function Bd(t){return oc("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function $t(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Yc(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{ic={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in Xc)return Xc[n].slice();if("#"===n[0])return 4===n.length?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===n.length&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var i=n.indexOf("("),a=n.indexOf(")");if(-1!==i&&a+1===n.length){var l=n.substr(0,i),c=n.substr(i+1,a-(i+1)).split(","),h=1;switch(l){case"rgba":if(4!==c.length)return null;h=$t(c.pop());case"rgb":return 3!==c.length?null:[Bd(c[0]),Bd(c[1]),Bd(c[2]),h];case"hsla":if(4!==c.length)return null;h=$t(c.pop());case"hsl":if(3!==c.length)return null;var f=(parseFloat(c[0])%360+360)%360/360,p=$t(c[1]),g=$t(c[2]),_=g<=.5?g*(p+1):g+p-g*p,y=2*g-_;return[oc(255*Yc(y,_,f+1/3)),oc(255*Yc(y,_,f)),oc(255*Yc(y,_,f-1/3)),h];default:return null}}return null}}catch{}class co{constructor(e,n,i,a=1){this.r=e,this.g=n,this.b=i,this.a=a}static parse(e){if(!e)return;if(e instanceof co)return e;if("string"!=typeof e)return;const n=ic(e);return n?new co(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[e,n,i,a]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(i)},${a})`}toArray(){const{r:e,g:n,b:i,a}=this;return 0===a?[0,0,0,0]:[255*e/a,255*n/a,255*i/a,a]}toArray01(){const{r:e,g:n,b:i,a}=this;return 0===a?[0,0,0,0]:[e/a,n/a,i/a,a]}toArray01Scaled(e){const{r:n,g:i,b:a,a:l}=this;return 0===l?[0,0,0]:[n/l*e,i/l*e,a/l*e]}toArray01PremultipliedAlpha(){const{r:e,g:n,b:i,a}=this;return[e,n,i,a]}toArray01Linear(){const{r:e,g:n,b:i,a}=this;return 0===a?[0,0,0,0]:[Math.pow(e/a,2.2),Math.pow(n/a,2.2),Math.pow(i/a,2.2),a]}}co.black=new co(0,0,0,1),co.white=new co(1,1,1,1),co.transparent=new co(0,0,0,0),co.red=new co(1,0,0,1),co.blue=new co(0,0,1,1);var yt=co;class sh{constructor(e,n,i){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class qp{constructor(e,n,i,a,l){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=i,this.fontStack=a,this.textColor=l}}class xr{constructor(e){this.sections=e}static fromString(e){return new xr([new qp(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.namePrimary.length)}static factory(e){return e instanceof xr?e:xr.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.namePrimary]);continue}e.push(n.text);const i={};n.fontStack&&(i["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(i["font-scale"]=n.scale),n.textColor&&(i["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(i)}return e}}class $r{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,n){return e?new $r({namePrimary:e,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function N_(t,e,n,i){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:`Invalid rgba value [${[t,e,n,i].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof i?[t,e,n,i]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function sc(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof yt||t instanceof sh||t instanceof xr||t instanceof $r)return!0;if(Array.isArray(t)){for(const e of t)if(!sc(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!sc(t[e]))return!1;return!0}return!1}function Yn(t){if(null===t)return nc;if("string"==typeof t)return Ot;if("boolean"==typeof t)return ht;if("number"==typeof t)return Xe;if(t instanceof yt)return Oi;if(t instanceof sh)return Ut;if(t instanceof xr)return Wc;if(t instanceof $r)return wi;if(Array.isArray(t)){const e=t.length;let n;for(const i of t){const a=Yn(i);if(n){if(n===a)continue;n=pn;break}n=a}return bi(n||pn,e)}return rc}function Sn(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof yt||t instanceof xr||t instanceof $r?t.toString():JSON.stringify(t)}class Wp{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(2!==e.length)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!sc(e[1]))return n.error("invalid value");const i=e[1];let a=Yn(i);const l=n.expectedType;return"array"!==a.kind||0!==a.N||!l||"array"!==l.kind||"number"==typeof l.N&&0!==l.N||(a=l),new Wp(a,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof yt?["rgba"].concat(this.value.toArray()):this.value instanceof xr?this.value.serialize():this.value}}var Kc=Wp,ir=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const Un={string:Ot,number:Xe,boolean:ht,object:rc};class ac{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let i,a=1;const l=e[0];if("array"===l){let h,f;if(e.length>2){const p=e[1];if("string"!=typeof p||!(p in Un)||"object"===p)return n.error('The item type argument of "array" must be one of string, number, boolean',1);h=Un[p],a++}else h=pn;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);f=e[2],a++}i=bi(h,f)}else i=Un[l];const c=[];for(;a<e.length;a++){const h=n.parse(e[a],a,pn);if(!h)return null;c.push(h)}return new ac(i,c)}evaluate(e){for(let n=0;n<this.args.length;n++){const i=this.args[n].evaluate(e);if(!Zc(this.type,Yn(i)))return i;if(n===this.args.length-1)throw new ir(`Expected value to be of type ${Ar(this.type)}, but found ${Ar(Yn(i))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if("array"===e.kind){const i=e.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){n.push(i.kind);const a=e.N;("number"==typeof a||this.args.length>1)&&n.push(a)}}return n.concat(this.args.map(i=>i.serialize()))}}var os=ac;class La{constructor(e){this.type=Wc,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const i=e[1];if(!Array.isArray(i)&&"object"==typeof i)return n.error("First argument must be an image or text section.");const a=[];let l=!1;for(let c=1;c<=e.length-1;++c){const h=e[c];if(l&&"object"==typeof h&&!Array.isArray(h)){l=!1;let f=null;if(h["font-scale"]&&(f=n.parse(h["font-scale"],1,Xe),!f))return null;let p=null;if(h["text-font"]&&(p=n.parse(h["text-font"],1,bi(Ot)),!p))return null;let g=null;if(h["text-color"]&&(g=n.parse(h["text-color"],1,Oi),!g))return null;const _=a[a.length-1];_.scale=f,_.font=p,_.textColor=g}else{const f=n.parse(e[c],1,pn);if(!f)return null;const p=f.type.kind;if("string"!==p&&"value"!==p&&"null"!==p&&"resolvedImage"!==p)return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");l=!0,a.push({content:f,scale:null,font:null,textColor:null})}}return new La(a)}evaluate(e){return new xr(this.sections.map(n=>{const i=n.content.evaluate(e);return Yn(i)===wi?new qp("",i,null,null,null):new qp(Sn(i),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const i={};n.scale&&(i["font-scale"]=n.scale.serialize()),n.font&&(i["text-font"]=n.font.serialize()),n.textColor&&(i["text-color"]=n.textColor.serialize()),e.push(i)}return e}}class ss{constructor(e,n){this.type=wi,this.inputPrimary=e,this.inputSecondary=n}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");const i=n.parse(e[1],1,Ot);if(!i)return n.error("No image name provided.");if(2===e.length)return new ss(i);const a=n.parse(e[2],1,Ot);return a?new ss(i,a):n.error("Secondary image variant is not a string.")}evaluate(e){const n=$r.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&e.availableImages&&(n.available=e.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function on(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}const Jc={"to-boolean":ht,"to-color":Oi,"to-number":Xe,"to-string":Ot};class Vd{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const i=e[0],a=[];let l=nc;if("to-array"===i){if(!Array.isArray(e[1]))return null;const c=e[1].length;if(n.expectedType){if("array"!==n.expectedType.kind)return n.error(`Expected ${n.expectedType.kind} but found array.`);l=bi(n.expectedType.itemType,c)}else{if(!(c>0&&sc(e[1][0])))return null;l=bi(Yn(e[1][0]),c)}for(let h=0;h<c;h++){const f=e[1][h];let p;if("array"===on(f))p=n.parse(f,void 0,l.itemType);else{const g=on(f);if(g!==l.itemType.kind)return n.error(`Expected ${l.itemType.kind} but found ${g}.`);p=n.registry.literal.parse(["literal",void 0===f?null:f],n)}if(!p)return null;a.push(p)}}else{if(("to-boolean"===i||"to-string"===i)&&2!==e.length)return n.error("Expected one argument.");l=Jc[i];for(let c=1;c<e.length;c++){const h=n.parse(e[c],c,pn);if(!h)return null;a.push(h)}}return new Vd(l,a)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let n,i;for(const a of this.args){if(n=a.evaluate(e),i=null,n instanceof yt)return n;if("string"==typeof n){const l=e.parseColor(n);if(l)return l}else if(Array.isArray(n)&&(i=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:N_(n[0],n[1],n[2],n[3]),!i))return new yt(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new ir(i||`Could not parse color from value '${"string"==typeof n?n:String(JSON.stringify(n))}'`)}if("number"===this.type.kind){let n=null;for(const i of this.args){if(n=i.evaluate(e),null===n)return 0;const a=Number(n);if(!isNaN(a))return a}throw new ir(`Could not convert ${JSON.stringify(n)} to number.`)}return"formatted"===this.type.kind?xr.fromString(Sn(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?$r.fromString(Sn(this.args[0].evaluate(e))):"array"===this.type.kind?this.args.map(n=>n.evaluate(e)):Sn(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new La([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ss(this.args[0]).serialize();const e="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}var uo=Vd;const z_=["Unknown","Point","LineString","Polygon"];var jd=class{constructor(t){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.options=t}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?z_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:i}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-t[0])+this.featureDistanceData.bearing[1]*(i*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=yt.parse(t)),e}getConfig(t){return this.options?this.options.get(t):null}};class xl{constructor(e,n,i,a){this.name=e,this.type=n,this._evaluate=i,this.args=a}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const i=e[0],a=xl.definitions[i];if(!a)return n.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const l=Array.isArray(a)?a[0]:a.type,c=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,h=c.filter(([p])=>!Array.isArray(p)||p.length===e.length-1);let f=null;for(const[p,g]of h){f=new V_(n.registry,n.path,null,n.scope,void 0,n.options);const _=[];let y=!1;for(let v=1;v<e.length;v++){const w=e[v],E=Array.isArray(p)?p[v-1]:p.type,T=f.parse(w,1+_.length,E);if(!T){y=!0;break}_.push(T)}if(!y)if(Array.isArray(p)&&p.length!==_.length)f.error(`Expected ${p.length} arguments, but found ${_.length} instead.`);else{for(let v=0;v<_.length;v++){const w=Array.isArray(p)?p[v]:p.type,E=_[v];f.concat(v+1).checkSubtype(w,E.type)}if(0===f.errors.length)return new xl(i,l,g,_)}}if(1===h.length)n.errors.push(...f.errors);else{const p=(h.length?h:c).map(([_])=>{return y=_,Array.isArray(y)?`(${y.map(Ar).join(", ")})`:`(${Ar(y.type)}...)`;var y}).join(" | "),g=[];for(let _=1;_<e.length;_++){const y=n.parse(e[_],1+g.length);if(!y)return null;g.push(Ar(y.type))}n.error(`Expected arguments of type ${p}, but found (${g.join(", ")}) instead.`)}return null}static register(e,n){xl.definitions=n;for(const i in n)e[i]=xl}}var Yr=xl;class ah{constructor(e,n,i){this.type=Ut,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(2!==e.length)return n.error("Expected one argument.");const i=e[1];if("object"!=typeof i||Array.isArray(i))return n.error("Collator options argument must be an object.");const a=n.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,ht);if(!a)return null;const l=n.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,ht);if(!l)return null;let c=null;return i.locale&&(c=n.parse(i.locale,1,Ot),!c)?null:new ah(a,l,c)}evaluate(e){return new sh(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var Ud={exports:{}};Ud.exports=function(){function t(i,a,l,c,h){for(;c>l;){if(c-l>600){var f=c-l+1,p=a-l+1,g=Math.log(f),_=.5*Math.exp(2*g/3),y=.5*Math.sqrt(g*_*(f-_)/f)*(p-f/2<0?-1:1);t(i,a,Math.max(l,Math.floor(a-p*_/f+y)),Math.min(c,Math.floor(a+(f-p)*_/f+y)),h)}var v=i[a],w=l,E=c;for(e(i,l,a),h(i[c],v)>0&&e(i,l,c);w<E;){for(e(i,w,E),w++,E--;h(i[w],v)<0;)w++;for(;h(i[E],v)>0;)E--}0===h(i[l],v)?e(i,l,E):e(i,++E,c),E<=a&&(l=E+1),a<=E&&(c=E-1)}}function e(i,a,l){var c=i[a];i[a]=i[l],i[l]=c}function n(i,a){return i<a?-1:i>a?1:0}return function(i,a,l,c,h){t(i,a,l||0,c||i.length-1,h||n)}}();var Qt=oo(Ud.exports);function Ui(t){let e=0;for(let n,i,a=0,l=t.length,c=l-1;a<l;c=a++)n=t[a],i=t[c],e+=(i.x-n.x)*(n.y+i.y);return e}function Pn(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function li(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function $i(t,e,n){const i=t[0]-e[0],a=t[1]-e[1],l=t[0]-n[0],c=t[1]-n[1];return i*c-l*a==0&&i*l<=0&&a*c<=0}function as(t,e,n=!1){let i=!1;for(let h=0,f=e.length;h<f;h++){const p=e[h];for(let g=0,_=p.length,y=_-1;g<_;y=g++){const v=p[y],w=p[g];if($i(t,v,w))return n;(l=v)[1]>(a=t)[1]!=(c=w)[1]>a[1]&&a[0]<(c[0]-l[0])*(a[1]-l[1])/(c[1]-l[1])+l[0]&&(i=!i)}}var a,l,c;return i}function Hi(t,e,n,i){const a=i[0]-n[0],l=i[1]-n[1],c=(t[0]-n[0])*l-a*(t[1]-n[1]),h=(e[0]-n[0])*l-a*(e[1]-n[1]);return c>0&&h<0||c<0&&h>0}function Gi(t,e,n,i){return(a=[i[0]-n[0],i[1]-n[1]])[0]*(l=[e[0]-t[0],e[1]-t[1]])[1]-a[1]*l[0]!=0&&!(!Hi(t,e,n,i)||!Hi(n,i,t,e));var a,l}const ot=8192;function mn(t,e){const n=(180+t[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,a=Math.pow(2,e.z);return[Math.round(n*a*ot),Math.round(i*a*ot)]}function Cr(t,e){for(let n=0;n<e.length;n++)if(as(t,e[n]))return!0;return!1}function qi(t,e,n){for(const i of n)for(let a=0,l=i.length,c=l-1;a<l;c=a++)if(Gi(t,e,i[c],i[a]))return!0;return!1}function ls(t,e){for(let n=0;n<t.length;++n)if(!as(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(qi(t[n],t[n+1],e))return!1;return!0}function pi(t,e){for(let n=0;n<e.length;n++)if(ls(t,e[n]))return!0;return!1}function Ms(t,e,n){const i=[];for(let a=0;a<t.length;a++){const l=[];for(let c=0;c<t[a].length;c++){const h=mn(t[a][c],n);Pn(e,h),l.push(h)}i.push(l)}return i}function Ir(t,e,n){const i=[];for(let a=0;a<t.length;a++){const l=Ms(t[a],e,n);i.push(l)}return i}function wl(t,e,n,i){if(t[0]<n[0]||t[0]>n[2]){const a=.5*i;let l=t[0]-n[0]>a?-i:n[0]-t[0]>a?i:0;0===l&&(l=t[0]-n[2]>a?-i:n[2]-t[0]>a?i:0),t[0]+=l}Pn(e,t)}function bl(t,e,n,i){const a=Math.pow(2,i.z)*ot,l=[i.x*ot,i.y*ot],c=[];if(!t)return c;for(const h of t)for(const f of h){const p=[f.x+l[0],f.y+l[1]];wl(p,e,n,a),c.push(p)}return c}function gn(t,e,n,i){const a=Math.pow(2,i.z)*ot,l=[i.x*ot,i.y*ot],c=[];if(!t)return c;for(const f of t){const p=[];for(const g of f){const _=[g.x+l[0],g.y+l[1]];Pn(e,_),p.push(_)}c.push(p)}if(e[2]-e[0]<=a/2){(h=e)[0]=h[1]=1/0,h[2]=h[3]=-1/0;for(const f of c)for(const p of f)wl(p,e,n,a)}var h;return c}class Js{constructor(e,n){this.type=ht,this.geojson=e,this.geometries=n}static parse(e,n){if(2!==e.length)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(sc(e[1])){const i=e[1];if("FeatureCollection"===i.type)for(let a=0;a<i.features.length;++a){const l=i.features[a].geometry.type;if("Polygon"===l||"MultiPolygon"===l)return new Js(i,i.features[a].geometry)}else if("Feature"===i.type){const a=i.geometry.type;if("Polygon"===a||"MultiPolygon"===a)return new Js(i,i.geometry)}else if("Polygon"===i.type||"MultiPolygon"===i.type)return new Js(i,i)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(n,i){const a=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],c=n.canonicalID();if(!c)return!1;if("Polygon"===i.type){const h=Ms(i.coordinates,l,c),f=bl(n.geometry(),a,l,c);if(!li(a,l))return!1;for(const p of f)if(!as(p,h))return!1}if("MultiPolygon"===i.type){const h=Ir(i.coordinates,l,c),f=bl(n.geometry(),a,l,c);if(!li(a,l))return!1;for(const p of f)if(!Cr(p,h))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(n,i){const a=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],c=n.canonicalID();if(!c)return!1;if("Polygon"===i.type){const h=Ms(i.coordinates,l,c),f=gn(n.geometry(),a,l,c);if(!li(a,l))return!1;for(const p of f)if(!ls(p,h))return!1}if("MultiPolygon"===i.type){const h=Ir(i.coordinates,l,c),f=gn(n.geometry(),a,l,c);if(!li(a,l))return!1;for(const p of f)if(!pi(p,h))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Qs=Js,Qc={exports:{}};Qc.exports=function(){var t={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},e=1/298.257223563,n=e*(2-e),i=Math.PI/180,a=function(p,g){if(void 0===p)throw new Error("No latitude given.");if(g&&!t[g])throw new Error("Unknown unit "+g+". Use one of: "+Object.keys(t).join(", "));var _=6378.137*i*(g?t[g]:1),y=Math.cos(p*i),v=1/(1-n*(1-y*y)),w=Math.sqrt(v);this.kx=_*w*y,this.ky=_*w*v*(1-n)},l={units:{configurable:!0}};function c(p,g){return p[0]===g[0]&&p[1]===g[1]}function h(p,g,_){var y=f(g[0]-p[0]);return[p[0]+y*_,p[1]+(g[1]-p[1])*_]}function f(p){for(;p<-180;)p+=360;for(;p>180;)p-=360;return p}return a.fromTile=function(p,g,_){var y=Math.PI*(1-2*(p+.5)/Math.pow(2,g)),v=Math.atan(.5*(Math.exp(y)-Math.exp(-y)))/i;return new a(v,_)},l.units.get=function(){return t},a.prototype.distance=function(p,g){var _=f(p[0]-g[0])*this.kx,y=(p[1]-g[1])*this.ky;return Math.sqrt(_*_+y*y)},a.prototype.bearing=function(p,g){var _=f(g[0]-p[0])*this.kx;return Math.atan2(_,(g[1]-p[1])*this.ky)/i},a.prototype.destination=function(p,g,_){var y=_*i;return this.offset(p,Math.sin(y)*g,Math.cos(y)*g)},a.prototype.offset=function(p,g,_){return[p[0]+g/this.kx,p[1]+_/this.ky]},a.prototype.lineDistance=function(p){for(var g=0,_=0;_<p.length-1;_++)g+=this.distance(p[_],p[_+1]);return g},a.prototype.area=function(p){for(var g=0,_=0;_<p.length;_++)for(var y=p[_],v=0,w=y.length,E=w-1;v<w;E=v++)g+=f(y[v][0]-y[E][0])*(y[v][1]+y[E][1])*(_?-1:1);return Math.abs(g)/2*this.kx*this.ky},a.prototype.along=function(p,g){var _=0;if(g<=0)return p[0];for(var y=0;y<p.length-1;y++){var v=p[y],w=p[y+1],E=this.distance(v,w);if((_+=E)>g)return h(v,w,(g-(_-E))/E)}return p[p.length-1]},a.prototype.pointToSegmentDistance=function(p,g,_){var y=g[0],v=g[1],w=f(_[0]-y)*this.kx,E=(_[1]-v)*this.ky,T=0;return 0===w&&0===E||((T=(f(p[0]-y)*this.kx*w+(p[1]-v)*this.ky*E)/(w*w+E*E))>1?(y=_[0],v=_[1]):T>0&&(y+=w/this.kx*T,v+=E/this.ky*T)),w=f(p[0]-y)*this.kx,E=(p[1]-v)*this.ky,Math.sqrt(w*w+E*E)},a.prototype.pointOnLine=function(p,g){for(var _,y,v,w,E=1/0,T=0;T<p.length-1;T++){var C=p[T][0],S=p[T][1],I=f(p[T+1][0]-C)*this.kx,R=(p[T+1][1]-S)*this.ky,A=0;0===I&&0===R||((A=(f(g[0]-C)*this.kx*I+(g[1]-S)*this.ky*R)/(I*I+R*R))>1?(C=p[T+1][0],S=p[T+1][1]):A>0&&(C+=I/this.kx*A,S+=R/this.ky*A));var k=(I=f(g[0]-C)*this.kx)*I+(R=(g[1]-S)*this.ky)*R;k<E&&(E=k,_=C,y=S,v=T,w=A)}return{point:[_,y],index:v,t:Math.max(0,Math.min(1,w))}},a.prototype.lineSlice=function(p,g,_){var y=this.pointOnLine(_,p),v=this.pointOnLine(_,g);if(y.index>v.index||y.index===v.index&&y.t>v.t){var w=y;y=v,v=w}var E=[y.point],T=y.index+1,C=v.index;!c(_[T],E[0])&&T<=C&&E.push(_[T]);for(var S=T+1;S<=C;S++)E.push(_[S]);return c(_[C],v.point)||E.push(v.point),E},a.prototype.lineSliceAlong=function(p,g,_){for(var y=0,v=[],w=0;w<_.length-1;w++){var E=_[w],T=_[w+1],C=this.distance(E,T);if((y+=C)>p&&0===v.length&&v.push(h(E,T,(p-(y-C))/C)),y>=g)return v.push(h(E,T,(g-(y-C))/C)),v;y>p&&v.push(T)}return v},a.prototype.bufferPoint=function(p,g){var _=g/this.ky,y=g/this.kx;return[p[0]-y,p[1]-_,p[0]+y,p[1]+_]},a.prototype.bufferBBox=function(p,g){var _=g/this.ky,y=g/this.kx;return[p[0]-y,p[1]-_,p[2]+y,p[3]+_]},a.prototype.insideBBox=function(p,g){return f(p[0]-g[0])>=0&&f(p[0]-g[2])<=0&&p[1]>=g[1]&&p[1]<=g[3]},Object.defineProperties(a,l),a}();var Ss=oo(Qc.exports),Hr={exports:{}};Hr.exports=function(){var t=function(n,i){if(void 0===n&&(n=[]),void 0===i&&(i=e),this.data=n,this.length=this.data.length,this.compare=i,this.length>0)for(var a=(this.length>>1)-1;a>=0;a--)this._down(a)};function e(n,i){return n<i?-1:n>i?1:0}return t.prototype.push=function(n){this.data.push(n),this.length++,this._up(this.length-1)},t.prototype.pop=function(){if(0!==this.length){var n=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),n}},t.prototype.peek=function(){return this.data[0]},t.prototype._up=function(n){for(var i=this.data,a=this.compare,l=i[n];n>0;){var c=n-1>>1,h=i[c];if(a(l,h)>=0)break;i[n]=h,n=c}i[n]=l},t.prototype._down=function(n){for(var i=this.data,a=this.compare,l=this.length>>1,c=i[n];n<l;){var h=1+(n<<1),f=i[h],p=h+1;if(p<this.length&&a(i[p],f)<0&&(h=p,f=i[p]),a(f,c)>=0)break;i[n]=f,n=h}i[n]=c},t}();var El=oo(Hr.exports),he=8192;function Vo(t,e){return e.dist-t.dist}function ar(t){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function lh(t){return t[1]-t[0]+1}function ta(t,e){const n=t[1]>=t[0]&&t[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function lc(t,e){if(t[0]>t[1])return[null,null];const n=lh(t);if(e){if(2===n)return[t,null];const i=Math.floor(n/2);return[[t[0],t[0]+i],[t[0]+i,t[1]]]}{if(1===n)return[t,null];const i=Math.floor(n/2)-1;return[[t[0],t[0]+i],[t[0]+i+1,t[1]]]}}function na(t,e){const n=[1/0,1/0,-1/0,-1/0];if(!ta(e,t.length))return n;for(let i=e[0];i<=e[1];++i)Pn(n,t[i]);return n}function ra(t){const e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<t.length;++n)for(let i=0;i<t[n].length;++i)Pn(e,t[n][i]);return e}function ia(t,e,n){if(ar(t)||ar(e))return NaN;let i=0,a=0;return t[2]<e[0]&&(i=e[0]-t[2]),t[0]>e[2]&&(i=t[0]-e[2]),t[1]>e[3]&&(a=t[1]-e[3]),t[3]<e[1]&&(a=e[1]-t[3]),n.distance([0,0],[i,a])}function As(t,e){const n=Math.pow(2,e.z);return[(a=(t.x/he+e.x)/n,360*a-180),(i=(t.y/he+e.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90)];var i,a}function Li(t,e){const n=[];for(let i=0;i<t.length;++i)n.push(As(t[i],e));return n}function $d(t,e,n){const i=n.pointOnLine(e,t).point;return n.distance(t,i)}function Ei(t,e,n,i,a){const l=n.slice(i[0],i[1]+1);let c=1/0;for(let h=e[0];h<=e[1];++h)if(0===(c=Math.min(c,$d(t[h],l,a))))return 0;return c}function wo(t,e,n,i,a){const l=Math.min(a.pointToSegmentDistance(t,n,i),a.pointToSegmentDistance(e,n,i)),c=Math.min(a.pointToSegmentDistance(n,t,e),a.pointToSegmentDistance(i,t,e));return Math.min(l,c)}function Hd(t,e,n,i,a){if(!ta(e,t.length)||!ta(i,n.length))return NaN;let l=1/0;for(let c=e[0];c<e[1];++c)for(let h=i[0];h<i[1];++h){if(Gi(t[c],t[c+1],n[h],n[h+1]))return 0;l=Math.min(l,wo(t[c],t[c+1],n[h],n[h+1],a))}return l}function ch(t,e,n,i,a){if(!ta(e,t.length)||!ta(i,n.length))return NaN;let l=1/0;for(let c=e[0];c<=e[1];++c)for(let h=i[0];h<=i[1];++h)if(0===(l=Math.min(l,a.distance(t[c],n[h]))))return l;return l}function uh(t,e,n){if(as(t,e,!0))return 0;let i=1/0;for(const a of e){const l=a.length;if(l<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(a[0]!==a[l-1]&&0===(i=Math.min(i,n.pointToSegmentDistance(t,a[l-1],a[0])))||0===(i=Math.min(i,$d(t,a,n))))return i}return i}function ho(t,e,n,i){if(!ta(e,t.length))return NaN;for(let l=e[0];l<=e[1];++l)if(as(t[l],n,!0))return 0;let a=1/0;for(let l=e[0];l<e[1];++l)for(const c of n)for(let h=0,f=c.length,p=f-1;h<f;p=h++){if(Gi(t[l],t[l+1],c[p],c[h]))return 0;a=Math.min(a,wo(t[l],t[l+1],c[p],c[h],i))}return a}function Zp(t,e){for(const n of t)for(let i=0;i<=n.length-1;++i)if(as(n[i],e,!0))return!0;return!1}function s1(t,e,n,i=1/0){const a=ra(t),l=ra(e);if(i!==1/0&&ia(a,l,n)>=i)return i;if(li(a,l)){if(Zp(t,e))return 0}else if(Zp(e,t))return 0;let c=i;for(const h of t)for(let f=0,p=h.length,g=p-1;f<p;g=f++)for(const _ of e)for(let y=0,v=_.length,w=v-1;y<v;w=y++){if(Gi(h[g],h[f],_[w],_[y]))return 0;c=Math.min(c,wo(h[g],h[f],_[w],_[y],n))}return c}function hh(t,e,n,i,a,l,c){if(null===l||null===c)return;const h=ia(na(i,l),na(a,c),n);h<e&&t.push({dist:h,range1:l,range2:c})}function B_(t,e,n,i,a=1/0){let l=Math.min(i.distance(t[0],n[0][0]),a);if(0===l)return l;const c=new El([{dist:0,range1:[0,t.length-1],range2:[0,0]}],Vo),h=e?50:100,f=ra(n);for(;c.length;){const p=c.pop();if(p.dist>=l)continue;const g=p.range1;if(lh(g)<=h){if(!ta(g,t.length))return NaN;if(e){const _=ho(t,g,n,i);if(0===(l=Math.min(l,_)))return l}else for(let _=g[0];_<=g[1];++_){const y=uh(t[_],n,i);if(0===(l=Math.min(l,y)))return l}}else{const _=lc(g,e);if(null!==_[0]){const y=ia(na(t,_[0]),f,i);y<l&&c.push({dist:y,range1:_[0],range2:[0,0]})}if(null!==_[1]){const y=ia(na(t,_[1]),f,i);y<l&&c.push({dist:y,range1:_[1],range2:[0,0]})}}}return l}function Xp(t,e,n,i,a,l=1/0){let c=Math.min(l,a.distance(t[0],n[0]));if(0===c)return c;const h=new El([{dist:0,range1:[0,t.length-1],range2:[0,n.length-1]}],Vo),f=e?50:100,p=i?50:100;for(;h.length;){const g=h.pop();if(g.dist>=c)continue;const _=g.range1,y=g.range2;if(lh(_)<=f&&lh(y)<=p){if(!ta(_,t.length)||!ta(y,n.length))return NaN;if(e&&i?c=Math.min(c,Hd(t,_,n,y,a)):e||i?e&&!i?c=Math.min(c,Ei(n,y,t,_,a)):!e&&i&&(c=Math.min(c,Ei(t,_,n,y,a))):c=Math.min(c,ch(t,_,n,y,a)),0===c)return c}else{const v=lc(_,e),w=lc(y,i);hh(h,c,a,t,n,v[0],w[0]),hh(h,c,a,t,n,v[0],w[1]),hh(h,c,a,t,n,v[1],w[0]),hh(h,c,a,t,n,v[1],w[1])}}return c}function Yp(t,e,n,i,a=1/0){let l=a;const c=na(t,[0,t.length-1]);for(const h of n)if(!(l!==1/0&&ia(c,na(h,[0,h.length-1]),i)>=l)&&(l=Math.min(l,Xp(t,e,h,!0,i,l)),0===l))return l;return l}function Gd(t,e,n,i,a=1/0){let l=a;const c=na(t,[0,t.length-1]);for(const h of n){if(l!==1/0&&ia(c,ra(h),i)>=l)continue;const f=B_(t,e,h,i,l);if(isNaN(f))return f;if(0===(l=Math.min(l,f)))return l}return l}function Kp(t){return"Point"===t||"MultiPoint"===t||"LineString"===t||"MultiLineString"===t||"Polygon"===t||"MultiPolygon"===t}class dh{constructor(e,n){this.type=Xe,this.geojson=e,this.geometries=n}static parse(e,n){if(2!==e.length)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(sc(e[1])){const i=e[1];if("FeatureCollection"===i.type){for(let a=0;a<i.features.length;++a)if(Kp(i.features[a].geometry.type))return new dh(i,i.features[a].geometry)}else if("Feature"===i.type){if(Kp(i.geometry.type))return new dh(i,i.geometry)}else if(Kp(i.type))return new dh(i,i)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const n=e.geometry(),i=e.canonicalID();if(null!=n&&null!=i){if("Point"===e.geometryType())return function(a,l,c){const h=[];for(const p of a)for(const g of p)h.push(As(g,l));const f=new Ss(h[0][1],"meters");return"Point"===c.type||"MultiPoint"===c.type||"LineString"===c.type?Xp(h,!1,"Point"===c.type?[c.coordinates]:c.coordinates,"LineString"===c.type,f):"MultiLineString"===c.type?Yp(h,!1,c.coordinates,f):"Polygon"===c.type||"MultiPolygon"===c.type?Gd(h,!1,"Polygon"===c.type?[c.coordinates]:c.coordinates,f):null}(n,i,this.geometries);if("LineString"===e.geometryType())return function(a,l,c){const h=[];for(const p of a){const g=[];for(const _ of p)g.push(As(_,l));h.push(g)}const f=new Ss(h[0][0][1],"meters");if("Point"===c.type||"MultiPoint"===c.type||"LineString"===c.type)return Yp("Point"===c.type?[c.coordinates]:c.coordinates,"LineString"===c.type,h,f);if("MultiLineString"===c.type){let p=1/0;for(let g=0;g<c.coordinates.length;g++){const _=Yp(c.coordinates[g],!0,h,f,p);if(isNaN(_))return _;if(0===(p=Math.min(p,_)))return p}return p}if("Polygon"===c.type||"MultiPolygon"===c.type){let p=1/0;for(let g=0;g<h.length;g++){const _=Gd(h[g],!0,"Polygon"===c.type?[c.coordinates]:c.coordinates,f,p);if(isNaN(_))return _;if(0===(p=Math.min(p,_)))return p}return p}return null}(n,i,this.geometries);if("Polygon"===e.geometryType())return function(a,l,c){const h=[];for(const p of function(g,_){const y=g.length;if(y<=1)return[g];const v=[];let w,E;for(let T=0;T<y;T++){const C=Ui(g[T]);0!==C&&(g[T].area=Math.abs(C),void 0===E&&(E=C<0),E===C<0?(w&&v.push(w),w=[g[T]]):w.push(g[T]))}return w&&v.push(w),v}(a)){const g=[];for(let _=0;_<p.length;++_)g.push(Li(p[_],l));h.push(g)}const f=new Ss(h[0][0][0][1],"meters");if("Point"===c.type||"MultiPoint"===c.type||"LineString"===c.type)return Gd("Point"===c.type?[c.coordinates]:c.coordinates,"LineString"===c.type,h,f);if("MultiLineString"===c.type){let p=1/0;for(let g=0;g<c.coordinates.length;g++){const _=Gd(c.coordinates[g],!0,h,f,p);if(isNaN(_))return _;if(0===(p=Math.min(p,_)))return p}return p}return"Polygon"===c.type||"MultiPolygon"===c.type?function(p,g,_){let y=1/0;for(const v of p)for(const w of g){const E=s1(v,w,_,y);if(isNaN(E))return E;if(0===(y=Math.min(y,E)))return y}return y}("Polygon"===c.type?[c.coordinates]:c.coordinates,h,f):null}(n,i,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var qd=dh;function tu(t){if(t instanceof Yr&&("get"===t.name&&1===t.args.length||"feature-state"===t.name||"has"===t.name&&1===t.args.length||"properties"===t.name||"geometry-type"===t.name||"id"===t.name||/^filter-/.test(t.name))||t instanceof Qs||t instanceof qd)return!1;let e=!0;return t.eachChild(n=>{e&&!tu(n)&&(e=!1)}),e}function Wd(t){if(t instanceof Yr&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(n=>{e&&!Wd(n)&&(e=!1)}),e}function Jp(t){if(t instanceof Yr&&"config"===t.name)return!1;let e=!0;return t.eachChild(n=>{e&&!Jp(n)&&(e=!1)}),e}function nu(t,e){if(t instanceof Yr&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(i=>{n&&!nu(i,e)&&(n=!1)}),n}class Zd{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(2!==e.length||"string"!=typeof e[1])return n.error("'var' expression requires exactly one string literal argument.");const i=e[1];return n.scope.has(i)?new Zd(i,n.scope.get(i)):n.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Xd=Zd;class Qp{constructor(e,n=[],i,a=new F_,l=[],c){this.registry=e,this.path=n,this.key=n.map(h=>`[${h}]`).join(""),this.scope=a,this.errors=l,this.expectedType=i,this.options=c}parse(e,n,i,a,l={}){return n||i?this.concat(n,i,a)._parse(e,l):this._parse(e,l)}_parse(e,n){function i(a,l,c){return"assert"===c?new os(l,[a]):"coerce"===c?new uo(l,[a]):a}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const a="string"==typeof e[0]?this.registry[e[0]]:void 0;if(a){let l=a.parse(e,this);if(!l)return null;if(this.expectedType){const c=this.expectedType,h=l.type;if("string"!==c.kind&&"number"!==c.kind&&"boolean"!==c.kind&&"object"!==c.kind&&"array"!==c.kind||"value"!==h.kind)if("color"!==c.kind&&"formatted"!==c.kind&&"resolvedImage"!==c.kind||"value"!==h.kind&&"string"!==h.kind){if(this.checkSubtype(c,h))return null}else l=i(l,c,n.typeAnnotation||"coerce");else l=i(l,c,n.typeAnnotation||"assert")}if(!(l instanceof Kc)&&"resolvedImage"!==l.type.kind&&fh(l)){const c=new jd(this.options);try{l=new Kc(l.type,l.evaluate(c))}catch(h){return this.error(h.message),null}}return l}return uo.parse(["to-array",e],this)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,i){const a="number"==typeof e?this.path.concat(e):this.path,l=i?this.scope.concat(i):this.scope;return new Qp(this.registry,a,n||null,l,this.errors,this.options)}error(e,...n){const i=`${this.key}${n.map(a=>`[${a}]`).join("")}`;this.errors.push(new Ks(i,e))}checkSubtype(e,n){const i=Zc(e,n);return i&&this.error(i),i}}var V_=Qp;function fh(t){if(t instanceof Xd)return fh(t.boundExpression);if(t instanceof Yr&&"error"===t.name||t instanceof Yr&&"config"===t.name||t instanceof ah||t instanceof Qs||t instanceof qd)return!1;const e=t instanceof uo||t instanceof os;let n=!0;return t.eachChild(i=>{n=e?n&&fh(i):n&&i instanceof Kc}),!!n&&tu(t)&&nu(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function cc(t,e){const n=t.length-1;let i,a,l=0,c=n,h=0;for(;l<=c;)if(h=Math.floor((l+c)/2),i=t[h],a=t[h+1],i<=e){if(h===n||e<a)return h;l=h+1}else{if(!(i>e))throw new ir("Input is not a number.");c=h-1}return 0}class Yd{constructor(e,n,i){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[a,l]of i)this.labels.push(a),this.outputs.push(l)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const i=n.parse(e[1],1,Xe);if(!i)return null;const a=[];let l=null;n.expectedType&&"value"!==n.expectedType.kind&&(l=n.expectedType);for(let c=1;c<e.length;c+=2){const h=1===c?-1/0:e[c],f=e[c+1],p=c,g=c+1;if("number"!=typeof h)return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',p);if(a.length&&a[a.length-1][0]>=h)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',p);const _=n.parse(f,g,l);if(!_)return null;l=l||_.type,a.push([h,_])}return new Yd(l,i,a)}evaluate(e){const n=this.labels,i=this.outputs;if(1===n.length)return i[0].evaluate(e);const a=this.input.evaluate(e);if(a<=n[0])return i[0].evaluate(e);const l=n.length;return a>=n[l-1]?i[l-1].evaluate(e):i[cc(n,a)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}var em=Yd;function wt(t,e,n){return t*(1-n)+e*n}function Fa(t,e,n){return t.map((i,a)=>wt(i,e[a],n))}var ph=Object.freeze({__proto__:null,array:Fa,color:function(t,e,n){return new yt(wt(t.r,e.r,n),wt(t.g,e.g,n),wt(t.b,e.b,n),wt(t.a,e.a,n))},number:wt});const tm=4/29,uc=6/29,Jd=3*uc*uc,nm=Math.PI/180,Qd=180/Math.PI;function ef(t){return t>.008856451679035631?Math.pow(t,1/3):t/Jd+tm}function fo(t){return t>uc?t*t*t:Jd*(t-tm)}function ru(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function tf(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function iu(t){const e=tf(t.r),n=tf(t.g),i=tf(t.b),a=ef((.4124564*e+.3575761*n+.1804375*i)/.95047),l=ef((.2126729*e+.7151522*n+.072175*i)/1);return{l:116*l-16,a:500*(a-l),b:200*(l-ef((.0193339*e+.119192*n+.9503041*i)/1.08883)),alpha:t.a}}function rm(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,i=isNaN(t.b)?e:e-t.b/200;return e=1*fo(e),n=.95047*fo(n),i=1.08883*fo(i),new yt(ru(3.2404542*n-1.5371385*e-.4985314*i),ru(-.969266*n+1.8760108*e+.041556*i),ru(.0556434*n-.2040259*e+1.0572252*i),t.alpha)}function a1(t,e,n){const i=e-t;return t+n*(i>180||i<-180?i-360*Math.round(i/360):i)}const Pr={forward:iu,reverse:rm,interpolate:function(t,e,n){return{l:wt(t.l,e.l,n),a:wt(t.a,e.a,n),b:wt(t.b,e.b,n),alpha:wt(t.alpha,e.alpha,n)}}},po={forward:function(t){const{l:e,a:n,b:i}=iu(t),a=Math.atan2(i,n)*Qd;return{h:a<0?a+360:a,c:Math.sqrt(n*n+i*i),l:e,alpha:t.a}},reverse:function(t){const e=t.h*nm,n=t.c;return rm({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:a1(t.h,e.h,n),c:wt(t.c,e.c,n),l:wt(t.l,e.l,n),alpha:wt(t.alpha,e.alpha,n)}}};var mh=Object.freeze({__proto__:null,hcl:po,lab:Pr});class fr{constructor(e,n,i,a,l){this.type=e,this.operator=n,this.interpolation=i,this.input=a,this.labels=[],this.outputs=[];for(const[c,h]of l)this.labels.push(c),this.outputs.push(h)}static interpolationFactor(e,n,i,a){let l=0;if("exponential"===e.name)l=Zi(n,e.base,i,a);else if("linear"===e.name)l=Zi(n,1,i,a);else if("cubic-bezier"===e.name){const c=e.controlPoints;l=new eh(c[0],c[1],c[2],c[3]).solve(Zi(n,1,i,a))}return l}static parse(e,n){let[i,a,l,...c]=e;if(!Array.isArray(a)||0===a.length)return n.error("Expected an interpolation type expression.",1);if("linear"===a[0])a={name:"linear"};else if("exponential"===a[0]){const p=a[1];if("number"!=typeof p)return n.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:p}}else{if("cubic-bezier"!==a[0])return n.error(`Unknown interpolation type ${String(a[0])}`,1,0);{const p=a.slice(1);if(4!==p.length||p.some(g=>"number"!=typeof g||g<0||g>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:p}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(l=n.parse(l,2,Xe),!l)return null;const h=[];let f=null;"interpolate-hcl"===i||"interpolate-lab"===i?f=Oi:n.expectedType&&"value"!==n.expectedType.kind&&(f=n.expectedType);for(let p=0;p<c.length;p+=2){const g=c[p],_=c[p+1],y=p+3,v=p+4;if("number"!=typeof g)return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',y);if(h.length&&h[h.length-1][0]>=g)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',y);const w=n.parse(_,v,f);if(!w)return null;f=f||w.type,h.push([g,w])}return"number"===f.kind||"color"===f.kind||"array"===f.kind&&"number"===f.itemType.kind&&"number"==typeof f.N?new fr(f,i,a,l,h):n.error(`Type ${Ar(f)} is not interpolatable.`)}evaluate(e){const n=this.labels,i=this.outputs;if(1===n.length)return i[0].evaluate(e);const a=this.input.evaluate(e);if(a<=n[0])return i[0].evaluate(e);const l=n.length;if(a>=n[l-1])return i[l-1].evaluate(e);const c=cc(n,a),h=fr.interpolationFactor(this.interpolation,a,n[c],n[c+1]),f=i[c].evaluate(e),p=i[c+1].evaluate(e);return"interpolate"===this.operator?ph[this.type.kind.toLowerCase()](f,p,h):"interpolate-hcl"===this.operator?po.reverse(po.interpolate(po.forward(f),po.forward(p),h)):Pr.reverse(Pr.interpolate(Pr.forward(f),Pr.forward(p),h))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];for(let i=0;i<this.labels.length;i++)n.push(this.labels[i],this.outputs[i].serialize());return n}}function Zi(t,e,n,i){const a=i-n,l=t-n;return 0===a?0:1===e?l/a:(Math.pow(e,l)-1)/(Math.pow(e,a)-1)}var Is=fr;class ou{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let i=null;const a=n.expectedType;a&&"value"!==a.kind&&(i=a);const l=[];for(const h of e.slice(1)){const f=n.parse(h,1+l.length,i,void 0,{typeAnnotation:"omit"});if(!f)return null;i=i||f.type,l.push(f)}const c=a&&l.some(h=>Zc(a,h.type));return new ou(c?pn:i,l)}evaluate(e){let n,i=null,a=0;for(const l of this.args){if(a++,i=l.evaluate(e),i&&i instanceof $r&&!i.available&&(n||(n=i),i=null,a===this.args.length))return n;if(null!==i)break}return i}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Cl=ou;class Xi{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const i=[];for(let l=1;l<e.length-1;l+=2){const c=e[l];if("string"!=typeof c)return n.error(`Expected string, but found ${typeof c} instead.`,l);if(/[^a-zA-Z0-9_]/.test(c))return n.error("Variable names must contain only alphanumeric characters or '_'.",l);const h=n.parse(e[l+1],l+1);if(!h)return null;i.push([c,h])}const a=n.parse(e[e.length-1],e.length-1,n.expectedType,i);return a?new Xi(i,a):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,i]of this.bindings)e.push(n,i.serialize());return e.push(this.result.serialize()),e}}var im=Xi;class hc{constructor(e,n,i){this.type=e,this.index=n,this.input=i}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=n.parse(e[1],1,Xe),a=n.parse(e[2],2,bi(n.expectedType||pn));return i&&a?new hc(a.type.itemType,i,a):null}evaluate(e){const n=this.index.evaluate(e),i=this.input.evaluate(e);if(n<0)throw new ir(`Array index out of bounds: ${n} < 0.`);if(n>=i.length)throw new ir(`Array index out of bounds: ${n} > ${i.length-1}.`);if(n!==Math.floor(n))throw new ir(`Array index must be an integer, but found ${n} instead.`);return i[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var om=hc;class cs{constructor(e,n){this.type=ht,this.needle=e,this.haystack=n}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=n.parse(e[1],1,pn),a=n.parse(e[2],2,pn);return i&&a?zd(i.type,[ht,Ot,Xe,nc,pn])?new cs(i,a):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ar(i.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(null==i)return!1;if(!is(n,["boolean","string","number","null"]))throw new ir(`Expected first argument to be of type boolean, string, number or null, but found ${Ar(Yn(n))} instead.`);if(!is(i,["string","array"]))throw new ir(`Expected second argument to be of type array or string, but found ${Ar(Yn(i))} instead.`);return i.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var su=cs;class N{constructor(e,n,i){this.type=Xe,this.needle=e,this.haystack=n,this.fromIndex=i}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=n.parse(e[1],1,pn),a=n.parse(e[2],2,pn);if(!i||!a)return null;if(!zd(i.type,[ht,Ot,Xe,nc,pn]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ar(i.type)} instead`);if(4===e.length){const l=n.parse(e[3],3,Xe);return l?new N(i,a,l):null}return new N(i,a)}evaluate(e){const n=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!is(n,["boolean","string","number","null"]))throw new ir(`Expected first argument to be of type boolean, string, number or null, but found ${Ar(Yn(n))} instead.`);if(!is(i,["string","array"]))throw new ir(`Expected second argument to be of type array or string, but found ${Ar(Yn(i))} instead.`);if(this.fromIndex){const a=this.fromIndex.evaluate(e);return i.indexOf(n,a)}return i.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var M=N;class O{constructor(e,n,i,a,l,c){this.inputType=e,this.type=n,this.input=i,this.cases=a,this.outputs=l,this.otherwise=c}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let i,a;n.expectedType&&"value"!==n.expectedType.kind&&(a=n.expectedType);const l={},c=[];for(let p=2;p<e.length-1;p+=2){let g=e[p];const _=e[p+1];Array.isArray(g)||(g=[g]);const y=n.concat(p);if(0===g.length)return y.error("Expected at least one branch label.");for(const w of g){if("number"!=typeof w&&"string"!=typeof w)return y.error("Branch labels must be numbers or strings.");if("number"==typeof w&&Math.abs(w)>Number.MAX_SAFE_INTEGER)return y.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof w&&Math.floor(w)!==w)return y.error("Numeric branch labels must be integer values.");if(i){if(y.checkSubtype(i,Yn(w)))return null}else i=Yn(w);if(void 0!==l[String(w)])return y.error("Branch labels must be unique.");l[String(w)]=c.length}const v=n.parse(_,p,a);if(!v)return null;a=a||v.type,c.push(v)}const h=n.parse(e[1],1,pn);if(!h)return null;const f=n.parse(e[e.length-1],e.length-1,a);return f?"value"!==h.type.kind&&n.concat(1).checkSubtype(i,h.type)?null:new O(i,a,h,l,c,f):null}evaluate(e){const n=this.input.evaluate(e);return(Yn(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),i=[],a={};for(const c of n){const h=a[this.cases[c]];void 0===h?(a[this.cases[c]]=i.length,i.push([this.cases[c],[c]])):i[h][1].push(c)}const l=c=>"number"===this.inputType.kind?Number(c):c;for(const[c,h]of i)e.push(1===h.length?l(h[0]):h.map(l)),e.push(this.outputs[c].serialize());return e.push(this.otherwise.serialize()),e}}var z=O;class ne{constructor(e,n,i){this.type=e,this.branches=n,this.otherwise=i}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let i;n.expectedType&&"value"!==n.expectedType.kind&&(i=n.expectedType);const a=[];for(let c=1;c<e.length-1;c+=2){const h=n.parse(e[c],c,ht);if(!h)return null;const f=n.parse(e[c+1],c+1,i);if(!f)return null;a.push([h,f]),i=i||f.type}const l=n.parse(e[e.length-1],e.length-1,i);return l?new ne(i,a,l):null}evaluate(e){for(const[n,i]of this.branches)if(n.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,i]of this.branches)e(n),e(i);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Te=ne;class at{constructor(e,n,i,a){this.type=e,this.input=n,this.beginIndex=i,this.endIndex=a}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=n.parse(e[1],1,pn),a=n.parse(e[2],2,Xe);if(!i||!a)return null;if(!zd(i.type,[bi(pn),Ot,pn]))return n.error(`Expected first argument to be of type array or string, but found ${Ar(i.type)} instead`);if(4===e.length){const l=n.parse(e[3],3,Xe);return l?new at(i.type,i,a,l):null}return new at(i.type,i,a)}evaluate(e){const n=this.input.evaluate(e),i=this.beginIndex.evaluate(e);if(!is(n,["string","array"]))throw new ir(`Expected first argument to be of type array or string, but found ${Ar(Yn(n))} instead.`);if(this.endIndex){const a=this.endIndex.evaluate(e);return n.slice(i,a)}return n.slice(i)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var hn=at;function xn(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function wr(t,e,n,i){return 0===i.compare(e,n)}function Ne(t,e,n){const i="=="!==t&&"!="!==t;return class uO{constructor(l,c,h){this.type=ht,this.lhs=l,this.rhs=c,this.collator=h,this.hasUntypedArgument="value"===l.type.kind||"value"===c.type.kind}static parse(l,c){if(3!==l.length&&4!==l.length)return c.error("Expected two or three arguments.");const h=l[0];let f=c.parse(l[1],1,pn);if(!f)return null;if(!xn(h,f.type))return c.concat(1).error(`"${h}" comparisons are not supported for type '${Ar(f.type)}'.`);let p=c.parse(l[2],2,pn);if(!p)return null;if(!xn(h,p.type))return c.concat(2).error(`"${h}" comparisons are not supported for type '${Ar(p.type)}'.`);if(f.type.kind!==p.type.kind&&"value"!==f.type.kind&&"value"!==p.type.kind)return c.error(`Cannot compare types '${Ar(f.type)}' and '${Ar(p.type)}'.`);i&&("value"===f.type.kind&&"value"!==p.type.kind?f=new os(p.type,[f]):"value"!==f.type.kind&&"value"===p.type.kind&&(p=new os(f.type,[p])));let g=null;if(4===l.length){if("string"!==f.type.kind&&"string"!==p.type.kind&&"value"!==f.type.kind&&"value"!==p.type.kind)return c.error("Cannot use collator to compare non-string types.");if(g=c.parse(l[3],3,Ut),!g)return null}return new uO(f,p,g)}evaluate(l){const c=this.lhs.evaluate(l),h=this.rhs.evaluate(l);if(i&&this.hasUntypedArgument){const f=Yn(c),p=Yn(h);if(f.kind!==p.kind||"string"!==f.kind&&"number"!==f.kind)throw new ir(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${f.kind}, ${p.kind}) instead.`)}if(this.collator&&!i&&this.hasUntypedArgument){const f=Yn(c),p=Yn(h);if("string"!==f.kind||"string"!==p.kind)return e(l,c,h)}return this.collator?n(l,c,h,this.collator.evaluate(l)):e(l,c,h)}eachChild(l){l(this.lhs),l(this.rhs),this.collator&&l(this.collator)}outputDefined(){return!0}serialize(){const l=[t];return this.eachChild(c=>{l.push(c.serialize())}),l}}}const Wn=Ne("==",function(t,e,n){return e===n},wr),rD=Ne("!=",function(t,e,n){return e!==n},function(t,e,n,i){return!wr(0,e,n,i)}),iD=Ne("<",function(t,e,n){return e<n},function(t,e,n,i){return i.compare(e,n)<0}),Ci=Ne(">",function(t,e,n){return e>n},function(t,e,n,i){return i.compare(e,n)>0}),l1=Ne("<=",function(t,e,n){return e<=n},function(t,e,n,i){return i.compare(e,n)<=0}),nf=Ne(">=",function(t,e,n){return e>=n},function(t,e,n,i){return i.compare(e,n)>=0});class Ps{constructor(e,n,i,a,l,c){this.type=Ot,this.number=e,this.locale=n,this.currency=i,this.unit=a,this.minFractionDigits=l,this.maxFractionDigits=c}static parse(e,n){if(3!==e.length)return n.error("Expected two arguments.");const i=n.parse(e[1],1,Xe);if(!i)return null;const a=e[2];if("object"!=typeof a||Array.isArray(a))return n.error("NumberFormat options argument must be an object.");let l=null;if(a.locale&&(l=n.parse(a.locale,1,Ot),!l))return null;let c=null;if(a.currency&&(c=n.parse(a.currency,1,Ot),!c))return null;let h=null;if(a.unit&&(h=n.parse(a.unit,1,Ot),!h))return null;let f=null;if(a["min-fraction-digits"]&&(f=n.parse(a["min-fraction-digits"],1,Xe),!f))return null;let p=null;return a["max-fraction-digits"]&&(p=n.parse(a["max-fraction-digits"],1,Xe),!p)?null:new Ps(i,l,c,h,f,p)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class rf{constructor(e){this.type=Xe,this.input=e}static parse(e,n){if(2!==e.length)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const i=n.parse(e[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?n.error(`Expected argument of type string or array, but found ${Ar(i.type)} instead.`):new rf(i):null}evaluate(e){const n=this.input.evaluate(e);if("string"==typeof n||Array.isArray(n))return n.length;throw new ir(`Expected value to be of type string or array, but found ${Ar(Yn(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function sf(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const oD={"==":Wn,"!=":rD,">":Ci,"<":iD,">=":nf,"<=":l1,array:os,at:om,boolean:os,case:Te,coalesce:Cl,collator:ah,format:La,image:ss,in:su,"index-of":M,interpolate:Is,"interpolate-hcl":Is,"interpolate-lab":Is,length:rf,let:im,literal:Kc,match:z,number:os,"number-format":Ps,object:os,slice:hn,step:em,string:os,"to-boolean":uo,"to-color":uo,"to-number":uo,"to-string":uo,var:Xd,within:Qs,distance:qd};function c1(t,[e,n,i,a]){e=e.evaluate(t),n=n.evaluate(t),i=i.evaluate(t);const l=a?a.evaluate(t):1,c=N_(e,n,i,l);if(c)throw new ir(c);return new yt(e/255*l,n/255*l,i/255*l,l)}function sD(t,[e,n,i,a]){e=e.evaluate(t),n=n.evaluate(t),i=i.evaluate(t);const l=a?a.evaluate(t):1,c=(g=n,_=i,y=l,"number"==typeof(p=e)&&p>=0&&p<=360?"number"==typeof g&&g>=0&&g<=100&&"number"==typeof _&&_>=0&&_<=100?void 0===y||"number"==typeof y&&y>=0&&y<=1?null:`Invalid hsla value [${[p,g,_,y].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof y?[p,g,_,y]:[p,g,_]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof y?[p,g,_,y]:[p,g,_]).join(", ")}]: 'h' must be between 0 and 360.`);var p,g,_,y;if(c)throw new ir(c);const h=`hsla(${e}, ${n}%, ${i}%, ${l})`,f=yt.parse(h);if(!f)throw new ir(`Failed to parse HSLA color: ${h}`);return f}function j_(t,e){return t in e}function Yi(t,e){const n=e[t];return void 0===n?null:n}function za(t,e,n){n.length&&(e+=`\x1f${n}`);const i=t.getConfig(e);return i?i.evaluate(t):null}function dc(t){return{type:t}}Yr.register(oD,{error:[{kind:"error"},[Ot],(t,[e])=>{throw new ir(e.evaluate(t))}],typeof:[Ot,[pn],(t,[e])=>Ar(Yn(e.evaluate(t)))],"to-rgba":[bi(Xe,4),[Oi],(t,[e])=>e.evaluate(t).toArray()],rgb:[Oi,[Xe,Xe,Xe],c1],rgba:[Oi,[Xe,Xe,Xe,Xe],c1],hsl:[Oi,[Xe,Xe,Xe],sD],hsla:[Oi,[Xe,Xe,Xe,Xe],sD],has:{type:ht,overloads:[[[Ot],(t,[e])=>j_(e.evaluate(t),t.properties())],[[Ot,rc],(t,[e,n])=>j_(e.evaluate(t),n.evaluate(t))]]},get:{type:pn,overloads:[[[Ot],(t,[e])=>Yi(e.evaluate(t),t.properties())],[[Ot,rc],(t,[e,n])=>Yi(e.evaluate(t),n.evaluate(t))]]},config:{type:pn,overloads:[[[Ot],(t,[e])=>za(t,e.evaluate(t),"")],[[Ot,Ot],(t,[e,n])=>za(t,e.evaluate(t),n.evaluate(t))]]},"feature-state":[pn,[Ot],(t,[e])=>Yi(e.evaluate(t),t.featureState||{})],properties:[rc,[],t=>t.properties()],"geometry-type":[Ot,[],t=>t.geometryType()],id:[pn,[],t=>t.id()],zoom:[Xe,[],t=>t.globals.zoom],pitch:[Xe,[],t=>t.globals.pitch||0],"distance-from-center":[Xe,[],t=>t.distanceFromCenter()],"measure-light":[Xe,[Ot],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[Xe,[],t=>t.globals.heatmapDensity||0],"line-progress":[Xe,[],t=>t.globals.lineProgress||0],"raster-value":[Xe,[],t=>t.globals.rasterValue||0],"sky-radial-progress":[Xe,[],t=>t.globals.skyRadialProgress||0],accumulated:[pn,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Xe,dc(Xe),(t,e)=>{let n=0;for(const i of e)n+=i.evaluate(t);return n}],"*":[Xe,dc(Xe),(t,e)=>{let n=1;for(const i of e)n*=i.evaluate(t);return n}],"-":{type:Xe,overloads:[[[Xe,Xe],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[Xe],(t,[e])=>-e.evaluate(t)]]},"/":[Xe,[Xe,Xe],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[Xe,[Xe,Xe],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[Xe,[],()=>Math.LN2],pi:[Xe,[],()=>Math.PI],e:[Xe,[],()=>Math.E],"^":[Xe,[Xe,Xe],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[Xe,[Xe],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Xe,[Xe],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Xe,[Xe],(t,[e])=>Math.log(e.evaluate(t))],log2:[Xe,[Xe],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Xe,[Xe],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Xe,[Xe],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Xe,[Xe],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Xe,[Xe],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Xe,[Xe],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Xe,[Xe],(t,[e])=>Math.atan(e.evaluate(t))],min:[Xe,dc(Xe),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[Xe,dc(Xe),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[Xe,[Xe],(t,[e])=>Math.abs(e.evaluate(t))],round:[Xe,[Xe],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[Xe,[Xe],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Xe,[Xe],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[ht,[Ot,pn],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[ht,[pn],(t,[e])=>t.id()===e.value],"filter-type-==":[ht,[Ot],(t,[e])=>t.geometryType()===e.value],"filter-<":[ht,[Ot,pn],(t,[e,n])=>{const i=t.properties()[e.value],a=n.value;return typeof i==typeof a&&i<a}],"filter-id-<":[ht,[pn],(t,[e])=>{const n=t.id(),i=e.value;return typeof n==typeof i&&n<i}],"filter->":[ht,[Ot,pn],(t,[e,n])=>{const i=t.properties()[e.value],a=n.value;return typeof i==typeof a&&i>a}],"filter-id->":[ht,[pn],(t,[e])=>{const n=t.id(),i=e.value;return typeof n==typeof i&&n>i}],"filter-<=":[ht,[Ot,pn],(t,[e,n])=>{const i=t.properties()[e.value],a=n.value;return typeof i==typeof a&&i<=a}],"filter-id-<=":[ht,[pn],(t,[e])=>{const n=t.id(),i=e.value;return typeof n==typeof i&&n<=i}],"filter->=":[ht,[Ot,pn],(t,[e,n])=>{const i=t.properties()[e.value],a=n.value;return typeof i==typeof a&&i>=a}],"filter-id->=":[ht,[pn],(t,[e])=>{const n=t.id(),i=e.value;return typeof n==typeof i&&n>=i}],"filter-has":[ht,[pn],(t,[e])=>e.value in t.properties()],"filter-has-id":[ht,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[ht,[bi(Ot)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[ht,[bi(pn)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[ht,[Ot,bi(pn)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[ht,[Ot,bi(pn)],(t,[e,n])=>function(i,a,l,c){for(;l<=c;){const h=l+c>>1;if(a[h]===i)return!0;a[h]>i?c=h-1:l=h+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:ht,overloads:[[[ht,ht],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[dc(ht),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:ht,overloads:[[[ht,ht],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[dc(ht),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[ht,[ht],(t,[e])=>!e.evaluate(t)],"is-supported-script":[ht,[Ot],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[Ot,[Ot],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Ot,[Ot],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Ot,dc(pn),(t,e)=>e.map(n=>Sn(n.evaluate(t))).join("")],"resolved-locale":[Ot,[Ut],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[Xe,[Xe,Xe,pn],(t,e)=>{const[n,i,a]=e.map(c=>c.evaluate(t));if(n>i||n===i)return n;let l;if("string"==typeof a)l=function(c){let h=0;if(0===c.length)return h;for(let f=0;f<c.length;f++)h=(h<<5)-h+c.charCodeAt(f),h&=h;return h}(a);else{if("number"!=typeof a)throw new ir(`Invalid seed input: ${a}`);l=a}return n+sf(l)()*(i-n)}]});var Ba=oD;function Va(t){return{result:"success",value:t}}function au(t){return{result:"error",value:t}}function U_(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function lu(t){return"data-driven"===t["property-type"]}function u1(t){return U_(t.expression,"measure-light")}function af(t){return U_(t.expression,"zoom")}function lf(t){return!!t.expression&&t.expression.interpolated}function cf(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function $_(t){return t}function h1(t,e){const n="color"===e.type,i=t.stops&&"object"==typeof t.stops[0][0],a=i||!(i||void 0!==t.property),l=t.type||(lf(e)?"exponential":"interval");if(n&&((t=xi({},t)).stops&&(t.stops=t.stops.map(p=>[p[0],yt.parse(p[1])])),t.default=yt.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!mh[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let c,h,f;if("exponential"===l)c=G_;else if("interval"===l)c=d1;else if("categorical"===l){c=H_,h=Object.create(null);for(const p of t.stops)h[p[0]]=p[1];f=typeof t.stops[0][0]}else{if("identity"!==l)throw new Error(`Unknown function type "${l}"`);c=f1}if(i){const p={},g=[];for(let v=0;v<t.stops.length;v++){const w=t.stops[v],E=w[0].zoom;void 0===p[E]&&(p[E]={zoom:E,type:t.type,property:t.property,default:t.default,stops:[]},g.push(E)),p[E].stops.push([w[0].value,w[1]])}const _=[];for(const v of g)_.push([p[v].zoom,h1(p[v],e)]);const y={name:"linear"};return{kind:"composite",interpolationType:y,interpolationFactor:Is.interpolationFactor.bind(void 0,y),zoomStops:_.map(v=>v[0]),evaluate:({zoom:v},w)=>G_({stops:_,base:t.base},e,v).evaluate(v,w)}}if(a){const p="exponential"===l?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:p,interpolationFactor:Is.interpolationFactor.bind(void 0,p),zoomStops:t.stops.map(g=>g[0]),evaluate:({zoom:g})=>c(t,e,g,h,f)}}return{kind:"source",evaluate(p,g){const _=g&&g.properties?g.properties[t.property]:void 0;return void 0===_?gh(t.default,e.default):c(t,e,_,h,f)}}}function gh(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function H_(t,e,n,i,a){return gh(typeof n===a?i[n]:void 0,t.default,e.default)}function d1(t,e,n){if("number"!==on(n))return gh(t.default,e.default);const i=t.stops.length;if(1===i||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[i-1][0])return t.stops[i-1][1];const a=cc(t.stops.map(l=>l[0]),n);return t.stops[a][1]}function G_(t,e,n){const i=void 0!==t.base?t.base:1;if("number"!==on(n))return gh(t.default,e.default);const a=t.stops.length;if(1===a||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[a-1][0])return t.stops[a-1][1];const l=cc(t.stops.map(g=>g[0]),n),c=function(g,_,y,v){const w=v-y,E=g-y;return 0===w?0:1===_?E/w:(Math.pow(_,E)-1)/(Math.pow(_,w)-1)}(n,i,t.stops[l][0],t.stops[l+1][0]),h=t.stops[l][1],f=t.stops[l+1][1];let p=ph[e.type]||$_;if(t.colorSpace&&"rgb"!==t.colorSpace){const g=mh[t.colorSpace];p=(_,y)=>g.reverse(g.interpolate(g.forward(_),g.forward(y),c))}return"function"==typeof h.evaluate?{evaluate(...g){const _=h.evaluate.apply(void 0,g),y=f.evaluate.apply(void 0,g);if(void 0!==_&&void 0!==y)return p(_,y,c)}}:p(h,f,c)}function f1(t,e,n){return"color"===e.type?n=yt.parse(n):"formatted"===e.type?n=xr.fromString(n.toString()):"resolvedImage"===e.type?n=$r.fromString(n.toString()):on(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),gh(n,t.default,e.default)}class sm{constructor(e,n,i){var a;this.expression=e,this._warningHistory={},this._evaluator=new jd(i),this._defaultValue=n?"color"===(a=n).type&&(cf(a.default)||Array.isArray(a.default))?new yt(0,0,0,0):"color"===a.type?yt.parse(a.default)||null:void 0===a.default?null:a.default:null,this._enumValues=n&&"enum"===n.type?n.values:null}evaluateWithoutErrorHandling(e,n,i,a,l,c,h,f){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=i,this._evaluator.canonical=a||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=c,this._evaluator.featureTileCoord=h||null,this._evaluator.featureDistanceData=f||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,i,a,l,c,h,f){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=i||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=c||null,this._evaluator.featureTileCoord=h||null,this._evaluator.featureDistanceData=f||null;try{const p=this.expression.evaluate(this._evaluator);if(null==p||"number"==typeof p&&p!=p)return this._defaultValue;if(this._enumValues&&!(p in this._enumValues))throw new ir(`Expected value to be one of ${Object.keys(this._enumValues).map(g=>JSON.stringify(g)).join(", ")}, but found ${JSON.stringify(p)} instead.`);return p}catch(p){return this._warningHistory[p.message]||(this._warningHistory[p.message]=!0,typeof console<"u"&&console.warn(p.message)),this._defaultValue}}}function _h(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Ba}function fc(t,e,n){const i=new V_(Ba,[],e?function(l){const c={color:Oi,string:Ot,number:Xe,enum:Ot,boolean:ht,formatted:Wc,resolvedImage:wi};return"array"===l.type?bi(c[l.value]||pn,l.length):c[l.type]}(e):void 0,void 0,void 0,n),a=i.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return a?Va(new sm(a,e,n)):au(i.errors)}class q_{constructor(e,n,i){this.kind=e,this._styleExpression=n,this.isLightConstant=i,this.isStateDependent="constant"!==e&&!Wd(n.expression),this.isConfigDependent=!Jp(n.expression)}evaluateWithoutErrorHandling(e,n,i,a,l,c){return this._styleExpression.evaluateWithoutErrorHandling(e,n,i,a,l,c)}evaluate(e,n,i,a,l,c){return this._styleExpression.evaluate(e,n,i,a,l,c)}}class ei{constructor(e,n,i,a,l){this.kind=e,this.zoomStops=i,this._styleExpression=n,this.isStateDependent="camera"!==e&&!Wd(n.expression),this.isLightConstant=l,this.isConfigDependent=!Jp(n.expression),this.interpolationType=a}evaluateWithoutErrorHandling(e,n,i,a,l,c){return this._styleExpression.evaluateWithoutErrorHandling(e,n,i,a,l,c)}evaluate(e,n,i,a,l,c){return this._styleExpression.evaluate(e,n,i,a,l,c)}interpolationFactor(e,n,i){return this.interpolationType?Is.interpolationFactor(this.interpolationType,e,n,i):0}}function ja(t,e,n){if("error"===(t=fc(t,e,n)).result)return t;const i=t.value.expression,a=tu(i);if(!a&&!lu(e))return au([new Ks("","data expressions not supported")]);const l=nu(i,["zoom","pitch","distance-from-center"]);if(!l&&!af(e))return au([new Ks("","zoom expressions not supported")]);const c=nu(i,["measure-light"]);if(!c&&!u1(e))return au([new Ks("","measure-light expression not supported")]);const h=e.expression&&e.expression.relaxZoomRestriction,f=am(i);return f||l||h?f instanceof Ks?au([f]):f instanceof Is&&!lf(e)?au([new Ks("",'"interpolate" expressions cannot be used with this property')]):Va(f?new ei(a?"camera":"composite",t.value,f.labels,f instanceof Is?f.interpolation:void 0,c):new q_(a?"constant":"source",t.value,c)):au([new Ks("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Rr{constructor(e,n){this._parameters=e,this._specification=n,xi(this,h1(this._parameters,this._specification))}static deserialize(e){return new Rr(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function am(t){let e=null;if(t instanceof im)e=am(t.result);else if(t instanceof Cl){for(const n of t.args)if(e=am(n),e)break}else(t instanceof em||t instanceof Is)&&t.input instanceof Yr&&"zoom"===t.input.name&&(e=t);return e instanceof Ks||t.eachChild(n=>{const i=am(n);i instanceof Ks?e=i:e&&i&&e!==i&&(e=new Ks("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Rs(t){const e=t.key,n=t.value,i=t.valueSpec||{},a=t.objectElementValidators||{},l=t.style,c=t.styleSpec;let h=[];const f=on(n);if("object"!==f)return[new Ye(e,n,`object expected, ${f} found`)];for(const p in n){const g=p.split(".")[0];let _;a[g]?_=a[g]:i[g]?_=br:a["*"]?_=a["*"]:i["*"]&&(_=br),_?h=h.concat(_({key:(e&&`${e}.`)+p,value:n[p],valueSpec:i[g]||i["*"],style:l,styleSpec:c,object:n,objectKey:p},n)):h.push(new tc(e,n[p],`unknown property "${p}"`))}for(const p in i)a[p]||i[p].required&&void 0===i[p].default&&void 0===n[p]&&h.push(new Ye(e,n,`missing required property "${p}"`));return h}function p1(t){const e=t.value,n=t.valueSpec,i=t.style,a=t.styleSpec,l=t.key,c=t.arrayElementValidator||br;if("array"!==on(e))return[new Ye(l,e,`array expected, ${on(e)} found`)];if(n.length&&e.length!==n.length)return[new Ye(l,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new Ye(l,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let h={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};a.$version<7&&(h.function=n.function),"object"===on(n.value)&&(h=n.value);let f=[];for(let p=0;p<e.length;p++)f=f.concat(c({array:e,arrayIndex:p,value:e[p],valueSpec:h,style:i,styleSpec:a,key:`${l}[${p}]`},!0));return f}function m1(t){const e=t.key,n=t.value,i=t.valueSpec;let a=on(n);if("number"===a&&n!=n&&(a="NaN"),"number"!==a)return[new Ye(e,n,`number expected, ${a} found`)];if("minimum"in i){let l=i.minimum;if("array"===on(i.minimum)&&(l=i.minimum[t.arrayIndex]),n<l)return[new Ye(e,n,`${n} is less than the minimum value ${l}`)]}if("maximum"in i){let l=i.maximum;if("array"===on(i.maximum)&&(l=i.maximum[t.arrayIndex]),n>l)return[new Ye(e,n,`${n} is greater than the maximum value ${l}`)]}return[]}function g1(t){const e=t.valueSpec,n=Ur(t.value.type);let i,a,l,c={};const h="categorical"!==n&&void 0===t.value.property,f=!h,p="array"===on(t.value.stops)&&"array"===on(t.value.stops[0])&&"object"===on(t.value.stops[0][0]),g=Rs({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(v){if("identity"===n)return[new Ye(v.key,v.value,'identity function may not have a "stops" property')];let w=[];const E=v.value;return w=w.concat(p1({key:v.key,value:E,valueSpec:v.valueSpec,style:v.style,styleSpec:v.styleSpec,arrayElementValidator:_})),"array"===on(E)&&0===E.length&&w.push(new Ye(v.key,E,"array must have at least one stop")),w},default:function(v){return br({key:v.key,value:v.value,valueSpec:e,style:v.style,styleSpec:v.styleSpec})}}});return"identity"===n&&h&&g.push(new Ye(t.key,t.value,'missing required property "property"')),"identity"===n||t.value.stops||g.push(new Ye(t.key,t.value,'missing required property "stops"')),"exponential"===n&&t.valueSpec.expression&&!lf(t.valueSpec)&&g.push(new Ye(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(f&&!lu(t.valueSpec)?g.push(new Ye(t.key,t.value,"property functions not supported")):h&&!af(t.valueSpec)&&g.push(new Ye(t.key,t.value,"zoom functions not supported"))),"categorical"!==n&&!p||void 0!==t.value.property||g.push(new Ye(t.key,t.value,'"property" property is required')),g;function _(v){let w=[];const E=v.value,T=v.key;if("array"!==on(E))return[new Ye(T,E,`array expected, ${on(E)} found`)];if(2!==E.length)return[new Ye(T,E,`array length 2 expected, length ${E.length} found`)];if(p){if("object"!==on(E[0]))return[new Ye(T,E,`object expected, ${on(E[0])} found`)];if(void 0===E[0].zoom)return[new Ye(T,E,"object stop key must have zoom")];if(void 0===E[0].value)return[new Ye(T,E,"object stop key must have value")];const C=Ur(E[0].zoom);if("number"!=typeof C)return[new Ye(T,E[0].zoom,"stop zoom values must be numbers")];if(l&&l>C)return[new Ye(T,E[0].zoom,"stop zoom values must appear in ascending order")];C!==l&&(l=C,a=void 0,c={}),w=w.concat(Rs({key:`${T}[0]`,value:E[0],valueSpec:{zoom:{}},style:v.style,styleSpec:v.styleSpec,objectElementValidators:{zoom:m1,value:y}}))}else w=w.concat(y({key:`${T}[0]`,value:E[0],valueSpec:{},style:v.style,styleSpec:v.styleSpec},E));return _h(Oa(E[1]))?w.concat([new Ye(`${T}[1]`,E[1],"expressions are not allowed in function stops.")]):w.concat(br({key:`${T}[1]`,value:E[1],valueSpec:e,style:v.style,styleSpec:v.styleSpec}))}function y(v,w){const E=on(v.value),T=Ur(v.value),C=null!==v.value?v.value:w;if(i){if(E!==i)return[new Ye(v.key,C,`${E} stop domain type must match previous stop domain type ${i}`)]}else i=E;if("number"!==E&&"string"!==E&&"boolean"!==E&&"number"!=typeof T&&"string"!=typeof T&&"boolean"!=typeof T)return[new Ye(v.key,C,"stop domain value must be a number, string, or boolean")];if("number"!==E&&"categorical"!==n){let S=`number expected, ${E} found`;return lu(e)&&void 0===n&&(S+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ye(v.key,C,S)]}return"categorical"!==n||"number"!==E||"number"==typeof T&&isFinite(T)&&Math.floor(T)===T?"categorical"!==n&&"number"===E&&"number"==typeof T&&"number"==typeof a&&void 0!==a&&T<a?[new Ye(v.key,C,"stop domain values must appear in ascending order")]:(a=T,"categorical"===n&&T in c?[new Ye(v.key,C,"stop domain values must be unique")]:(c[T]=!0,[])):[new Ye(v.key,C,`integer expected, found ${String(T)}`)]}}function cu(t){const e=("property"===t.expressionContext?ja:fc)(Oa(t.value),t.valueSpec);if("error"===e.result)return e.value.map(i=>new Ye(`${t.key}${i.key}`,t.value,i.message));const n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new Ye(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Wd(n))return[new Ye(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return uf(n,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!nu(n,["zoom","feature-state"]))return[new Ye(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!tu(n))return[new Ye(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function uf(t,e){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const a of e.valueSpec.expression.parameters)n.delete(a);if(0===n.size)return[];const i=[];return t instanceof Yr&&n.has(t.name)?[new Ye(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(a=>{i.push(...uf(a,e))}),i)}function uu(t){const e=t.key,n=t.value,i=t.valueSpec,a=[];return Array.isArray(i.values)?-1===i.values.indexOf(Ur(n))&&a.push(new Ye(e,n,`expected one of [${i.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(i.values).indexOf(Ur(n))&&a.push(new Ye(e,n,`expected one of [${Object.keys(i.values).join(", ")}], ${JSON.stringify(n)} found`)),a}function yh(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!yh(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function vh(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};yh(t)||(t=pc(t));const n=t;let i=!0;try{i=function(p){if(!us(p))return p;let g=Oa(p);return _1(g),g=W_(g),g}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(n,null,2)}\n        `)}const a=le[`filter_${e}`],l=fc(i,a);let c=null;if("error"===l.result)throw new Error(l.value.map(p=>`${p.key}: ${p.message}`).join(", "));c=(p,g,_)=>l.value.evaluate(p,g,{},_);let h=null,f=null;if(i!==n){const p=fc(n,a);if("error"===p.result)throw new Error(p.value.map(g=>`${g.key}: ${g.message}`).join(", "));h=(g,_,y,v,w)=>p.value.evaluate(g,_,{},y,void 0,void 0,v,w),f=!tu(p.value.expression)}return{filter:c,dynamicFilter:h||void 0,needGeometry:y1(i),needFeature:!!f}}function W_(t){if(!Array.isArray(t))return t;const e=function(n){if(hf.has(n[0]))for(let i=1;i<n.length;i++)if(us(n[i]))return!0;return n}(t);return!0===e?e:e.map(n=>W_(n))}function _1(t){let e=!1;const n=[];if("case"===t[0]){for(let i=1;i<t.length-1;i+=2)e=e||us(t[i]),n.push(t[i+1]);n.push(t[t.length-1])}else if("match"===t[0]){e=e||us(t[1]);for(let i=2;i<t.length-1;i+=2)n.push(t[i+1]);n.push(t[t.length-1])}else if("step"===t[0]){e=e||us(t[1]);for(let i=1;i<t.length-1;i+=2)n.push(t[i+1])}e&&(t.length=0,t.push("any",...n));for(let i=1;i<t.length;i++)_1(t[i])}function us(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let n=1;n<t.length;n++)if(us(t[n]))return!0;return!1}const hf=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function aD(t,e){return t<e?-1:t>e?1:0}function y1(t){if(!Array.isArray(t))return!1;if("within"===t[0]||"distance"===t[0])return!0;for(let e=1;e<t.length;e++)if(y1(t[e]))return!0;return!1}function pc(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?df(t[1],t[2],"=="):"!="===e?Z_(df(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?df(t[1],t[2],e):"any"===e?(n=t.slice(1),["any"].concat(n.map(pc))):"all"===e?["all"].concat(t.slice(1).map(pc)):"none"===e?["all"].concat(t.slice(1).map(pc).map(Z_)):"in"===e?v1(t[1],t.slice(2)):"!in"===e?Z_(v1(t[1],t.slice(2))):"has"===e?x1(t[1]):"!has"!==e||Z_(x1(t[1]));var n}function df(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function v1(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(aD)]]:["filter-in-small",t,["literal",e]]}}function x1(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Z_(t){return["!",t]}function w1(t){return yh(Oa(t.value))?cu(xi({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):ff(t)}function ff(t){const e=t.value,n=t.key;if("array"!==on(e))return[new Ye(n,e,`array expected, ${on(e)} found`)];const i=t.styleSpec;let a,l=[];if(e.length<1)return[new Ye(n,e,"filter array must have at least 1 element")];switch(l=l.concat(uu({key:`${n}[0]`,value:e[0],valueSpec:i.filter_operator,style:t.style,styleSpec:t.styleSpec})),Ur(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===Ur(e[1])&&l.push(new Ye(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&l.push(new Ye(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(a=on(e[1]),"string"!==a&&l.push(new Ye(`${n}[1]`,e[1],`string expected, ${a} found`)));for(let c=2;c<e.length;c++)a=on(e[c]),"$type"===Ur(e[1])?l=l.concat(uu({key:`${n}[${c}]`,value:e[c],valueSpec:i.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==a&&"number"!==a&&"boolean"!==a&&l.push(new Ye(`${n}[${c}]`,e[c],`string, number, or boolean expected, ${a} found`));break;case"any":case"all":case"none":for(let c=1;c<e.length;c++)l=l.concat(ff({key:`${n}[${c}]`,value:e[c],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":a=on(e[1]),2!==e.length?l.push(new Ye(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==a&&l.push(new Ye(`${n}[1]`,e[1],`string expected, ${a} found`))}return l}function X_(t,e){const n=t.key,i=t.style,a=t.layer,l=t.styleSpec,c=t.value,h=t.objectKey,f=l[`${e}_${t.layerType}`];if(!f)return[];const p=h.match(/^(.*)-transition$/);if("paint"===e&&p&&f[p[1]]&&f[p[1]].transition)return br({key:n,value:c,valueSpec:l.transition,style:i,styleSpec:l});const g=t.valueSpec||f[h];if(!g)return[new tc(n,c,`unknown property "${h}"`)];let _;if("string"===on(c)&&lu(g)&&!g.tokens&&(_=/^{([^}]+)}$/.exec(c))){const v=`\`{ "type": "identity", "property": ${_?JSON.stringify(_[1]):'"_"'} }\``;return[new Ye(n,c,`"${h}" does not support interpolation syntax\nUse an identity property function instead: ${v}.`)]}const y=[];if("symbol"===t.layerType)"text-field"!==h||!i||i.glyphs||i.imports||y.push(new Ye(n,c,'use of "text-field" requires a style "glyphs" property')),"text-font"===h&&cf(Oa(c))&&"identity"===Ur(c.type)&&y.push(new Ye(n,c,'"text-font" does not support identity functions'));else if("model"===t.layerType&&"paint"===e&&a&&a.layout&&a.layout.hasOwnProperty("model-id")&&lu(g)&&(u1(g)||af(g))){const v=ja(Oa(c),g),w=v.value.expression||v.value._styleExpression.expression;w&&!nu(w,["measure-light"])&&y.push(new Ye(n,c,`${h} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`))}return y.concat(br({key:t.key,value:c,valueSpec:g,style:i,styleSpec:l,expressionContext:"property",propertyType:e,propertyKey:h}))}function Y_(t){return X_(t,"paint")}function pf(t){return X_(t,"layout")}function K_(t){let e=[];const n=t.value,i=t.key,a=t.style,l=t.styleSpec;n.type||n.ref||e.push(new Ye(i,n,'either "type" or "ref" is required'));let c=Ur(n.type);const h=Ur(n.ref);if(n.id){const f=Ur(n.id);for(let p=0;p<t.arrayIndex;p++){const g=a.layers[p];Ur(g.id)===f&&e.push(new Ye(i,n.id,`duplicate layer id "${n.id}", previously used at line ${g.id.__line__}`))}}if("ref"in n){let f;["type","source","source-layer","filter","layout"].forEach(p=>{p in n&&e.push(new Ye(i,n[p],`"${p}" is prohibited for ref layers`))}),a.layers.forEach(p=>{Ur(p.id)===h&&(f=p)}),f?f.ref?e.push(new Ye(i,n.ref,"ref cannot reference another ref layer")):c=Ur(f.type):"string"==typeof h&&e.push(new Ye(i,n.ref,`ref layer "${h}" not found`))}else if("background"!==c&&"sky"!==c&&"slot"!==c)if(n.source){const f=a.sources&&a.sources[n.source],p=f&&Ur(f.type);f?"vector"===p&&"raster"===c?e.push(new Ye(i,n.source,`layer "${n.id}" requires a raster source`)):"raster"===p&&"raster"!==c?e.push(new Ye(i,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==p||n["source-layer"]?"raster-dem"===p&&"hillshade"!==c?e.push(new Ye(i,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==c||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||"geojson"===p&&f.lineMetrics||e.push(new Ye(i,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ye(i,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new Ye(i,n.source,`source "${n.source}" not found`))}else e.push(new Ye(i,n,'missing required property "source"'));return e=e.concat(Rs({key:i,value:n,valueSpec:l.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>br({key:`${i}.type`,value:n.type,valueSpec:l.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:f=>w1(xi({layerType:c},f)),layout:f=>Rs({layer:n,key:f.key,value:f.value,valueSpec:{},style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":p=>pf(xi({layerType:c},p))}}),paint:f=>Rs({layer:n,key:f.key,value:f.value,valueSpec:{},style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":p=>Y_(xi({layerType:c,layer:n},p))}})}})),e}function hu(t){const e=t.value,n=t.key,i=on(e);return"string"!==i?[new Ye(n,e,`string expected, ${i} found`)]:[]}const du={promoteId:function({key:t,value:e}){if("string"===on(e))return hu({key:t,value:e});{const n=[];for(const i in e)n.push(...hu({key:`${t}.${i}`,value:e[i]}));return n}}};function b1(t){const e=t.value,n=t.key,i=t.styleSpec,a=t.style;if(!e.type)return[new Ye(n,e,'"type" is required')];const l=Ur(e.type);let c;switch(l){case"vector":case"raster":case"raster-dem":return c=Rs({key:n,value:e,valueSpec:i[`source_${l.replace("-","_")}`],style:t.style,styleSpec:i,objectElementValidators:du}),c;case"geojson":if(c=Rs({key:n,value:e,valueSpec:i.source_geojson,style:a,styleSpec:i,objectElementValidators:du}),e.cluster)for(const h in e.clusterProperties){const[f,p]=e.clusterProperties[h],g="string"==typeof f?[f,["accumulated"],["get",h]]:f;c.push(...cu({key:`${n}.${h}.map`,value:p,expressionContext:"cluster-map"})),c.push(...cu({key:`${n}.${h}.reduce`,value:g,expressionContext:"cluster-reduce"}))}return c;case"video":return Rs({key:n,value:e,valueSpec:i.source_video,style:a,styleSpec:i});case"image":return Rs({key:n,value:e,valueSpec:i.source_image,style:a,styleSpec:i});case"canvas":return[new Ye(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return uu({key:`${n}.type`,value:e.type,valueSpec:{values:xh(i)},style:a,styleSpec:i})}}function xh(t){return t.source.reduce((e,n)=>{const i=t[n];return"enum"===i.type.type&&(e=e.concat(Object.keys(i.type.values))),e},[])}function lm(t){const e=t.value;let n=[];if(!e)return n;const i=on(e);return"string"!==i?(n=n.concat([new Ye(t.key,e,`string expected, "${i}" found`)]),n):(function(a){const l=-1===a.indexOf("://");try{return new URL(a,l?"http://example.com":void 0),!0}catch{return!1}}(e)||(n=n.concat([new Ye(t.key,e,`invalid url "${e}"`)])),n)}function mf(t){const e=t.value,n=t.styleSpec,i=n.light,a=t.style;let l=[];const c=on(e);if(void 0===e)return l;if("object"!==c)return l=l.concat([new Ye("light",e,`object expected, ${c} found`)]),l;for(const h in e){const f=h.match(/^(.*)-transition$/);l=l.concat(f&&i[f[1]]&&i[f[1]].transition?br({key:h,value:e[h],valueSpec:n.transition,style:a,styleSpec:n}):i[h]?br({key:h,value:e[h],valueSpec:i[h],style:a,styleSpec:n}):[new Ye(h,e[h],`unknown property "${h}"`)])}return l}function lD(t){const e=t.value;let n=[];if(!e)return n;const i=on(e);if("object"!==i)return n=n.concat([new Ye("light-3d",e,`object expected, ${i} found`)]),n;const a=t.styleSpec,l=a["light-3d"],c=t.key,h=t.style,f=t.style.lights;for(const _ of["type","id"])if(!(_ in e))return n=n.concat([new Ye("light-3d",e,`missing property ${_} on light`)]),n;if(e.type&&f)for(let _=0;_<t.arrayIndex;_++){const y=Ur(e.type),v=f[_];Ur(v.type)===y&&n.push(new Ye(c,e.id,`duplicate light type "${e.type}", previously defined at line ${v.id.__line__}`))}const p=`properties_light_${e.type}`;if(!(p in a))return n=n.concat([new Ye("light-3d",e,`Invalid light type ${e.type}`)]),n;const g=a[p];for(const _ in e)if("properties"===_){const y=e[_],v=on(y);if("object"!==v)return n=n.concat([new Ye("properties",y,`object expected, ${v} found`)]),n;for(const w in y)n=n.concat(g[w]?br({key:w,value:y[w],valueSpec:g[w],style:h,styleSpec:a}):[new tc(t.key,y[w],`unknown property "${w}"`)])}else{const y=_.match(/^(.*)-transition$/);n=n.concat(y&&l[y[1]]&&l[y[1]].transition?br({key:_,value:e[_],valueSpec:a.transition,style:h,styleSpec:a}):l[_]?br({key:_,value:e[_],valueSpec:l[_],style:h,styleSpec:a}):[new tc(_,e[_],`unknown property "${_}"`)])}return n}function J_(t){const e=t.value,n=t.key,i=t.style,a=t.styleSpec,l=a.terrain;let c=[];const h=on(e);if(void 0===e)return c;if("object"!==h)return c=c.concat([new Ye("terrain",e,`object expected, ${h} found`)]),c;for(const f in e){const p=f.match(/^(.*)-transition$/);c=c.concat(p&&l[p[1]]&&l[p[1]].transition?br({key:f,value:e[f],valueSpec:a.transition,style:i,styleSpec:a}):l[f]?br({key:f,value:e[f],valueSpec:l[f],style:i,styleSpec:a}):[new tc(f,e[f],`unknown property "${f}"`)])}if(e.source){const f=i.sources&&i.sources[e.source],p=f&&Ur(f.type);f?"raster-dem"!==p&&c.push(new Ye(n,e.source,`terrain cannot be used with a source of type ${String(p)}, it only be used with a "raster-dem" source type`)):c.push(new Ye(n,e.source,`source "${e.source}" not found`))}else c.push(new Ye(n,e,'terrain is missing required property "source"'));return c}function Q_(t){const e=t.value,n=t.style,i=t.styleSpec,a=i.fog;let l=[];const c=on(e);if(void 0===e)return l;if("object"!==c)return l=l.concat([new Ye("fog",e,`object expected, ${c} found`)]),l;for(const h in e){const f=h.match(/^(.*)-transition$/);l=l.concat(f&&a[f[1]]&&a[f[1]].transition?br({key:h,value:e[h],valueSpec:i.transition,style:n,styleSpec:i}):a[h]?br({key:h,value:e[h],valueSpec:a[h],style:n,styleSpec:i}):[new tc(h,e[h],`unknown property "${h}"`)])}return l}const E1={"*":()=>[],array:p1,boolean:function(t){const e=t.value,n=t.key,i=on(e);return"boolean"!==i?[new Ye(n,e,`boolean expected, ${i} found`)]:[]},number:m1,color:function(t){const e=t.key,n=t.value,i=on(n);return"string"!==i?[new Ye(e,n,`color expected, ${i} found`)]:null===ic(n)?[new Ye(e,n,`color expected, "${n}" found`)]:[]},enum:uu,filter:w1,function:g1,layer:K_,object:Rs,source:b1,model:lm,light:mf,"light-3d":lD,terrain:J_,fog:Q_,string:hu,formatted:function(t){return 0===hu(t).length?[]:cu(t)},resolvedImage:function(t){return 0===hu(t).length?[]:cu(t)},projection:function(t){const e=t.value,n=t.styleSpec,i=n.projection,a=t.style;let l=[];const c=on(e);if("object"===c)for(const h in e)l=l.concat(br({key:h,value:e[h],valueSpec:i[h],style:a,styleSpec:n}));else"string"!==c&&(l=l.concat([new Ye("projection",e,`object or string expected, ${c} found`)]));return l},import:function(t){const{value:e,styleSpec:n}=t,{data:i,...a}=e;Object.defineProperty(a,"__line__",{value:e.__line__,enumerable:!1});let l=Rs(xi({},t,{value:a,valueSpec:n.import}));return""===Ur(a.id)&&l.push(new Ye(`${t.key}.id`,a,"import id can't be an empty string")),i&&(l=l.concat(wh(i,n,{key:`${t.key}.data`}))),l}};function br(t,e=!1){const n=t.value,i=t.valueSpec,a=t.styleSpec;if(i.expression&&cf(Ur(n)))return g1(t);if(i.expression&&_h(Oa(n)))return cu(t);if(i.type&&E1[i.type]){const l=E1[i.type](t);return!0===e&&l.length>0&&"array"===on(t.value)?cu(t):l}return Rs(xi({},t,{valueSpec:i.type?a[i.type]:i}))}function cD(t){const e=t.value,n=t.key,i=hu(t);return i.length||(-1===e.indexOf("{fontstack}")&&i.push(new Ye(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&i.push(new Ye(n,e,'"glyphs" url must include a "{range}" token'))),i}function wh(t,e=le,n={}){return br({key:n.key||"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:cD,"*":()=>[]}})}function mc(t,e=le){return bo(wh(t,e))}const ey=t=>bo(b1(t)),cm=t=>bo(mf(t)),um=t=>bo(lD(t)),uD=t=>bo(J_(t)),C1=t=>bo(Q_(t)),T1=t=>bo(K_(t)),hm=t=>bo(w1(t)),D1=t=>bo(Y_(t)),hD=t=>bo(pf(t)),dm=t=>bo(lm(t));function bo(t){return t.slice().sort((e,n)=>e.line&&n.line?e.line-n.line:0)}function fm(t,e){let n=!1;if(e&&e.length)for(const i of e)i instanceof tc?ee(i.message):(t.fire(new xt(new Error(i.message))),n=!0);return n}var M1=Eo;function Eo(t,e,n){var i=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var a=new Int32Array(this.arrayBuffer);t=a[0],this.d=(e=a[1])+2*(n=a[2]);for(var l=0;l<this.d*this.d;l++){var c=a[3+l],h=a[3+l+1];i.push(c===h?null:a.subarray(c,h))}var f=a[3+i.length+1];this.keys=a.subarray(a[3+i.length],f),this.bboxes=a.subarray(f),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var p=0;p<this.d*this.d;p++)i.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var g=n/e*t;this.min=-g,this.max=t+g}Eo.prototype.insert=function(t,e,n,i,a){this._forEachCell(e,n,i,a,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(a)},Eo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Eo.prototype._insertCell=function(t,e,n,i,a,l){this.cells[a].push(l)},Eo.prototype.query=function(t,e,n,i,a){var l=this.min,c=this.max;if(t<=l&&e<=l&&c<=n&&c<=i&&!a)return Array.prototype.slice.call(this.keys);var h=[];return this._forEachCell(t,e,n,i,this._queryCell,h,{},a),h},Eo.prototype._queryCell=function(t,e,n,i,a,l,c,h){var f=this.cells[a];if(null!==f)for(var p=this.keys,g=this.bboxes,_=0;_<f.length;_++){var y=f[_];if(void 0===c[y]){var v=4*y;(h?h(g[v+0],g[v+1],g[v+2],g[v+3]):t<=g[v+2]&&e<=g[v+3]&&n>=g[v+0]&&i>=g[v+1])?(c[y]=!0,l.push(p[y])):c[y]=!1}}},Eo.prototype._forEachCell=function(t,e,n,i,a,l,c,h){for(var f=this._convertToCellCoord(t),p=this._convertToCellCoord(e),g=this._convertToCellCoord(n),_=this._convertToCellCoord(i),y=f;y<=g;y++)for(var v=p;v<=_;v++){var w=this.d*v+y;if((!h||h(this._convertFromCellCoord(y),this._convertFromCellCoord(v),this._convertFromCellCoord(y+1),this._convertFromCellCoord(v+1)))&&a.call(this,t,e,n,i,w,l,c,h))return}},Eo.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Eo.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Eo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,n=0,i=0;i<this.cells.length;i++)n+=this.cells[i].length;var a=new Int32Array(e+n+this.keys.length+this.bboxes.length);a[0]=this.extent,a[1]=this.n,a[2]=this.padding;for(var l=e,c=0;c<t.length;c++){var h=t[c];a[3+c]=l,a.set(h,l),l+=h.length}return a[3+t.length]=l,a.set(this.keys,l),a[3+t.length+1]=l+=this.keys.length,a.set(this.bboxes,l),l+=this.bboxes.length,a.buffer};var bh=oo(M1);const Ti={};function Qe(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Ti[e]={klass:t,omit:n.omit||[]}}Qe(Object,"Object"),bh.serialize=function(t,e){const n=t.toArrayBuffer();return e&&e.add(n),{buffer:n}},bh.deserialize=function(t){return new bh(t.buffer)},Object.defineProperty(bh,"name",{value:"Grid"}),Qe(bh,"Grid"),Qe(yt,"Color"),Qe(Error,"Error"),Qe(ye,"AJAXError"),Qe($r,"ResolvedImage"),Qe(Rr,"StylePropertyFunction"),Qe(sm,"StyleExpression",{omit:["_evaluator"]}),Qe(ei,"ZoomDependentExpression"),Qe(q_,"ZoomConstantExpression"),Qe(Yr,"CompoundExpression",{omit:["_evaluate"]});for(const t in Ba)Ti[Ba[t]._classRegistryKey]||Qe(Ba[t],`Expression${t}`);function S1(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function ty(t){return ce.ImageBitmap&&t instanceof ce.ImageBitmap}function Ua(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(S1(t)||ty(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){const n=t;return e&&e.add(n.buffer),n}if(t instanceof ce.ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){const n=[];for(const i of t)n.push(Ua(i,e));return n}if(t instanceof Map){const n={$name:"Map"};for(const[i,a]of t.entries())n[i]=Ua(a);return n}if("object"==typeof t){const n=t.constructor,i=n._classRegistryKey;if(!i)throw new Error(`can't serialize object of unregistered class ${i}`);const a=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(const l in t)t.hasOwnProperty(l)&&(Ti[i].omit.indexOf(l)>=0||(a[l]=Ua(t[l],e)));t instanceof Error&&(a.message=t.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==i&&(a.$name=i),a}throw new Error("can't serialize object of type "+typeof t)}function oa(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||S1(t)||ty(t)||ArrayBuffer.isView(t)||t instanceof ce.ImageData)return t;if(Array.isArray(t))return t.map(oa);if("object"==typeof t){const e=t.$name||"Object";if("Map"===e){const a=new Map;for(const l of Object.keys(t))"$name"!==l&&a.set(l,oa(t[l]));return a}const{klass:n}=Ti[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);const i=Object.create(n.prototype);for(const a of Object.keys(t))"$name"!==a&&(i[a]=oa(t[a]));return i}throw new Error("can't deserialize object of type "+typeof t)}const nt_Latin_1_Supplement=t=>t>=128&&t<=255,nt_Arabic=t=>t>=1536&&t<=1791,nt_Arabic_Supplement=t=>t>=1872&&t<=1919,nt_Arabic_Extended_A=t=>t>=2208&&t<=2303,nt_Hangul_Jamo=t=>t>=4352&&t<=4607,nt_Unified_Canadian_Aboriginal_Syllabics=t=>t>=5120&&t<=5759,nt_Khmer=t=>t>=6016&&t<=6143,nt_Unified_Canadian_Aboriginal_Syllabics_Extended=t=>t>=6320&&t<=6399,nt_General_Punctuation=t=>t>=8192&&t<=8303,nt_Letterlike_Symbols=t=>t>=8448&&t<=8527,nt_Number_Forms=t=>t>=8528&&t<=8591,nt_Miscellaneous_Technical=t=>t>=8960&&t<=9215,nt_Control_Pictures=t=>t>=9216&&t<=9279,nt_Optical_Character_Recognition=t=>t>=9280&&t<=9311,nt_Enclosed_Alphanumerics=t=>t>=9312&&t<=9471,nt_Geometric_Shapes=t=>t>=9632&&t<=9727,nt_Miscellaneous_Symbols=t=>t>=9728&&t<=9983,nt_Miscellaneous_Symbols_and_Arrows=t=>t>=11008&&t<=11263,nt_CJK_Radicals_Supplement=t=>t>=11904&&t<=12031,nt_Kangxi_Radicals=t=>t>=12032&&t<=12255,nt_Ideographic_Description_Characters=t=>t>=12272&&t<=12287,nt_CJK_Symbols_and_Punctuation=t=>t>=12288&&t<=12351,nt_Hiragana=t=>t>=12352&&t<=12447,nt_Katakana=t=>t>=12448&&t<=12543,nt_Bopomofo=t=>t>=12544&&t<=12591,nt_Hangul_Compatibility_Jamo=t=>t>=12592&&t<=12687,nt_Kanbun=t=>t>=12688&&t<=12703,nt_Bopomofo_Extended=t=>t>=12704&&t<=12735,nt_CJK_Strokes=t=>t>=12736&&t<=12783,nt_Katakana_Phonetic_Extensions=t=>t>=12784&&t<=12799,nt_Enclosed_CJK_Letters_and_Months=t=>t>=12800&&t<=13055,nt_CJK_Compatibility=t=>t>=13056&&t<=13311,nt_CJK_Unified_Ideographs_Extension_A=t=>t>=13312&&t<=19903,nt_Yijing_Hexagram_Symbols=t=>t>=19904&&t<=19967,nt_CJK_Unified_Ideographs=t=>t>=19968&&t<=40959,nt_Yi_Syllables=t=>t>=40960&&t<=42127,nt_Yi_Radicals=t=>t>=42128&&t<=42191,nt_Hangul_Jamo_Extended_A=t=>t>=43360&&t<=43391,nt_Hangul_Syllables=t=>t>=44032&&t<=55215,nt_Hangul_Jamo_Extended_B=t=>t>=55216&&t<=55295,nt_Private_Use_Area=t=>t>=57344&&t<=63743,nt_CJK_Compatibility_Ideographs=t=>t>=63744&&t<=64255,nt_Arabic_Presentation_Forms_A=t=>t>=64336&&t<=65023,nt_Vertical_Forms=t=>t>=65040&&t<=65055,nt_CJK_Compatibility_Forms=t=>t>=65072&&t<=65103,nt_Small_Form_Variants=t=>t>=65104&&t<=65135,nt_Arabic_Presentation_Forms_B=t=>t>=65136&&t<=65279,nt_Halfwidth_and_Fullwidth_Forms=t=>t>=65280&&t<=65519,nt_CJK_Unified_Ideographs_Extension_B=t=>t>=131072&&t<=173791;function gc(t){for(const e of t)if(_c(e.charCodeAt(0)))return!0;return!1}function A1(t){for(const e of t)if(!ny(e.charCodeAt(0)))return!1;return!0}function ny(t){return!(nt_Arabic(t)||nt_Arabic_Supplement(t)||nt_Arabic_Extended_A(t)||nt_Arabic_Presentation_Forms_A(t)||nt_Arabic_Presentation_Forms_B(t))}function _c(t){return!(746!==t&&747!==t&&(t<4352||!(nt_Bopomofo_Extended(t)||nt_Bopomofo(t)||nt_CJK_Compatibility_Forms(t)&&!(t>=65097&&t<=65103)||nt_CJK_Compatibility_Ideographs(t)||nt_CJK_Compatibility(t)||nt_CJK_Radicals_Supplement(t)||nt_CJK_Strokes(t)||!(!nt_CJK_Symbols_and_Punctuation(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||nt_CJK_Unified_Ideographs_Extension_A(t)||nt_CJK_Unified_Ideographs(t)||nt_Enclosed_CJK_Letters_and_Months(t)||nt_Hangul_Compatibility_Jamo(t)||nt_Hangul_Jamo_Extended_A(t)||nt_Hangul_Jamo_Extended_B(t)||nt_Hangul_Jamo(t)||nt_Hangul_Syllables(t)||nt_Hiragana(t)||nt_Ideographic_Description_Characters(t)||nt_Kanbun(t)||nt_Kangxi_Radicals(t)||nt_Katakana_Phonetic_Extensions(t)||nt_Katakana(t)&&12540!==t||!(!nt_Halfwidth_and_Fullwidth_Forms(t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!nt_Small_Form_Variants(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||nt_Unified_Canadian_Aboriginal_Syllabics(t)||nt_Unified_Canadian_Aboriginal_Syllabics_Extended(t)||nt_Vertical_Forms(t)||nt_Yijing_Hexagram_Symbols(t)||nt_Yi_Syllables(t)||nt_Yi_Radicals(t))))}function dD(t){return!(_c(t)||(e=t,nt_Latin_1_Supplement(e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||nt_General_Punctuation(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||nt_Letterlike_Symbols(e)||nt_Number_Forms(e)||nt_Miscellaneous_Technical(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||nt_Control_Pictures(e)&&9251!==e||nt_Optical_Character_Recognition(e)||nt_Enclosed_Alphanumerics(e)||nt_Geometric_Shapes(e)||nt_Miscellaneous_Symbols(e)&&!(e>=9754&&e<=9759)||nt_Miscellaneous_Symbols_and_Arrows(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||nt_CJK_Symbols_and_Punctuation(e)||nt_Katakana(e)||nt_Private_Use_Area(e)||nt_CJK_Compatibility_Forms(e)||nt_Small_Form_Variants(e)||nt_Halfwidth_and_Fullwidth_Forms(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e}function I1(t){return t>=1424&&t<=2303||nt_Arabic_Presentation_Forms_A(t)||nt_Arabic_Presentation_Forms_B(t)}function Ht(t,e){return!(!e&&I1(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||nt_Khmer(t))}function nI(t){for(const e of t)if(I1(e.charCodeAt(0)))return!0;return!1}const P1="deferred",R1="loading",k1="loaded";let O1=null,hs="unavailable",fu=null;const Eh=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(hs="error"),O1&&O1(t)};function L1(){F1.fire(new Se("pluginStateChange",{pluginStatus:hs,pluginURL:fu}))}const F1=new Mn,ci=function(){return hs},pm=function(){if(hs!==P1||!fu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");hs=R1,L1(),fu&&je({url:fu},t=>{t?Eh(t):(hs=k1,L1())})},mo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>hs===k1||null!=mo.applyArabicShaping,isLoading:()=>hs===R1,setState(t){hs=t.pluginStatus,fu=t.pluginURL},isParsed:()=>null!=mo.applyArabicShaping&&null!=mo.processBidirectionalText&&null!=mo.processStyledBidirectionalText,getPluginURL:()=>fu};class pr{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,i){for(const a of n)if(!Ht(a.charCodeAt(0),i))return!1;return!0}(e,mo.isLoaded())}}class mm{constructor(e,n,i){this.property=e,this.value=n,this.expression=function(a,l,c){if(cf(a))return new Rr(a,l);if(_h(a)||Array.isArray(a)&&a.length>0){const h=ja(a,l,c);if("error"===h.result)throw new Error(h.value.map(f=>`${f.key}: ${f.message}`).join(", "));return h.value}{let h=a;return"string"==typeof a&&"color"===l.type&&(h=yt.parse(a)),{kind:"constant",isConfigDependent:!1,evaluate:()=>h}}}(void 0===n?e.specification.default:n,e.specification,i)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,n,i){return this.property.possiblyEvaluate(this,e,n,i)}}class Co{constructor(e,n){this.property=e,this.value=new mm(e,void 0,n)}transitioned(e,n){return new ry(this.property,this.value,n,Ke({},e.transition,this.transition),e.now)}untransitioned(){return new ry(this.property,this.value,null,{},0)}}class ds{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._options=n,this.isConfigDependent=!1}getValue(e){return q(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Co(this._values[e].property,this._options)),this._values[e].value=new mm(this._values[e].property,null===n?void 0:q(n),this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,n){n&&(this._options=n);const i=this._properties.properties;if(e)for(const a in e){const l=e[a];if(Pa(a,"-transition")){const c=a.slice(0,-11);i[c]&&this.setTransition(c,l)}else i[a]&&this.setValue(a,l)}}getTransition(e){return q(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Co(this._values[e].property)),this._values[e].transition=q(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const i=this.getValue(n);void 0!==i&&(e[n]=i);const a=this.getTransition(n);void 0!==a&&(e[`${n}-transition`]=a)}return e}transitioned(e,n){const i=new gf(this._properties);for(const a of Object.keys(this._values))i._values[a]=this._values[a].transitioned(e,n._values[a]);return i}untransitioned(){const e=new gf(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class ry{constructor(e,n,i,a,l){const c=a.delay||0,h=a.duration||0;l=l||0,this.property=e,this.value=n,this.begin=l+c,this.end=this.begin+h,e.specification.transition&&(a.delay||a.duration)&&(this.prior=i)}possiblyEvaluate(e,n,i){const a=e.now||0,l=this.value.possiblyEvaluate(e,n,i),c=this.prior;if(c){if(a>this.end)return this.prior=null,l;if(this.value.isDataDriven())return this.prior=null,l;if(a<this.begin)return c.possiblyEvaluate(e,n,i);{const h=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(c.possiblyEvaluate(e,n,i),l,Aa(h))}}return l}}class gf{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,i){const a=new yf(this._properties);for(const l of Object.keys(this._values))a._values[l]=this._values[l].possiblyEvaluate(e,n,i);return a}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class _f{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._options=n,this.isConfigDependent=!1}getValue(e){return q(this._values[e].value)}setValue(e,n){this._values[e]=new mm(this._values[e].property,null===n?void 0:q(n),this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const n of Object.keys(this._values)){const i=this.getValue(n);void 0!==i&&(e[n]=i)}return e}possiblyEvaluate(e,n,i){const a=new yf(this._properties);for(const l of Object.keys(this._values))a._values[l]=this._values[l].possiblyEvaluate(e,n,i);return a}}class pu{constructor(e,n,i){this.property=e,this.value=n,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,n,i,a){return this.property.evaluate(this.value,this.parameters,e,n,i,a)}}class yf{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Re{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,i){const a=ph[this.specification.type];return a?a(e,n,i):e}}class lt{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,i,a){return new pu(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(n,null,{},i,a)}:e.expression,n)}interpolate(e,n,i){if("constant"!==e.value.kind||"constant"!==n.value.kind)return e;if(void 0===e.value.value||void 0===n.value.value)return new pu(this,{kind:"constant",value:void 0},e.parameters);const a=ph[this.specification.type];return a?new pu(this,{kind:"constant",value:a(e.value.value,n.value.value,i)},e.parameters):e}evaluate(e,n,i,a,l,c){return"constant"===e.kind?e.value:e.evaluate(n,i,a,l,c)}}class gm{constructor(e){this.specification=e}possiblyEvaluate(e,n,i,a){return!!e.expression.evaluate(n,null,{},i,a)}interpolate(){return!1}}class mr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new pr(0,{});for(const i in e){const a=e[i];a.specification.overridable&&this.overridableProperties.push(i);const l=this.defaultPropertyValues[i]=new mm(a,void 0),c=this.defaultTransitionablePropertyValues[i]=new Co(a);this.defaultTransitioningPropertyValues[i]=c.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=l.possiblyEvaluate(n)}}}function gr(t,e){return e?`${t}\x1f${e}`:t}function vf(t){const e=t.indexOf("\x1f");return e>=0?t.slice(0,e):t}Qe(lt,"DataDrivenProperty"),Qe(Re,"DataConstantProperty"),Qe(gm,"ColorRampProperty");const mu="-transition";class ks extends Mn{constructor(e,n,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&"slot"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),this.options=i,e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new _f(n.layout,i),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),n.paint)){this._transitionablePaint=new ds(n.paint,i);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new yf(n.paint)}}setScope(e){this.scope=e,this.fqid=gr(this.id,e)}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,i={}){if(null!=n&&this._validate(hD,`layers.${this.id}.layout.${e}`,e,n,i))return;if("custom"===this.type&&"visibility"===e)return void(this.visibility=n);const a=this._unevaluatedLayout;a._properties.properties[e]&&(a.setValue(e,n),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,"visibility"===e&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return Pa(e,mu)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,i={}){if(null!=n&&this._validate(D1,`layers.${this.id}.paint.${e}`,e,n,i))return!1;const a=this._transitionablePaint,l=a._properties.properties;if(Pa(e,mu)){const y=e.slice(0,-11);return l[y]&&a.setTransition(y,n||void 0),!1}if(!l[e])return!1;const c=a._values[e],h=c.value.isDataDriven(),f=c.value;a.setValue(e,n),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const p=a._values[e].value,g=p.isDataDriven(),_=Pa(e,"pattern")||"line-dasharray"===e;return g||h||_||this._handleOverridablePaintPropertyUpdate(e,f,p)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n){return null}_handleOverridablePaintPropertyUpdate(e,n,i){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return ke({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(void 0===e||"layout"===n&&!Object.keys(e).length||"paint"===n&&!Object.keys(e).length))}_validate(e,n,i,a,l={}){return(!l||!1!==l.validate)&&fm(this,e.call(mc,{key:n,layerType:this.type,objectKey:i,value:a,styleSpec:le,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof pu&&lu(n.property.specification)&&("source"===n.value.kind||"composite"===n.value.kind)&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=vh(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}class N1{constructor(){this.changed=!1,this._updatedLayers={},this._removedLayers={},this.updatedSourceCaches={},this.updatedPaintProps=new Set,this.changedImages=new Set}updateLayer(e){const n=e.scope;this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._updatedLayers[n].add(e.id)}removeLayer(e){const n=e.scope;this._removedLayers[n]=this._removedLayers[n]||{},this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._removedLayers[n][e.id]=e,this._updatedLayers[n].delete(e.id),this.updatedPaintProps.delete(e.fqid)}getRemovedLayer(e){return this._removedLayers[e.scope]?this._removedLayers[e.scope][e.id]:null}discardLayerRemoval(e){this._removedLayers[e.scope]&&delete this._removedLayers[e.scope][e.id]}getLayerUpdatesByScope(){const e={};for(const n in this._updatedLayers)e[n]=e[n]||{},e[n].updatedIds=Array.from(this._updatedLayers[n].values());for(const n in this._removedLayers)e[n]=e[n]||{},e[n].removedIds=Object.keys(this._removedLayers[n]);return e}reset(){this.changed=!1,this._updatedLayers={},this._removedLayers={},this.updatedSourceCaches={},this.updatedPaintProps.clear(),this.changedImages.clear()}}const fD={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class _m{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class lr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function wn(t,e=1){let n=0,i=0;return{members:t.map(a=>{const l=fD[a.type].BYTES_PER_ELEMENT,c=n=z1(n,Math.max(e,l)),h=a.components||1;return i=Math.max(i,l),n+=l*h,{name:a.name,type:a.type,components:h,offset:c}}),size:z1(n,Math.max(i,e)),alignment:e}}function z1(t,e){return Math.ceil(t/e)*e}class jo extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,n)}emplace(e,n,i){const a=2*e;return this.int16[a+0]=n,this.int16[a+1]=i,e}}jo.prototype.bytesPerElement=4,Qe(jo,"StructArrayLayout2i4");class Ch extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,n,i)}emplace(e,n,i,a){const l=3*e;return this.int16[l+0]=n,this.int16[l+1]=i,this.int16[l+2]=a,e}}Ch.prototype.bytesPerElement=6,Qe(Ch,"StructArrayLayout3i6");class $a extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,n,i,a)}emplace(e,n,i,a,l){const c=4*e;return this.int16[c+0]=n,this.int16[c+1]=i,this.int16[c+2]=a,this.int16[c+3]=l,e}}$a.prototype.bytesPerElement=8,Qe($a,"StructArrayLayout4i8");class B1 extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,i,a,l)}emplace(e,n,i,a,l,c){const h=5*e;return this.int16[h+0]=n,this.int16[h+1]=i,this.int16[h+2]=a,this.int16[h+3]=l,this.int16[h+4]=c,e}}B1.prototype.bytesPerElement=10,Qe(B1,"StructArrayLayout5i10");class gu extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l,c,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,i,a,l,c,h)}emplace(e,n,i,a,l,c,h,f){const p=6*e,g=12*e,_=3*e;return this.int16[p+0]=n,this.int16[p+1]=i,this.uint8[g+4]=a,this.uint8[g+5]=l,this.uint8[g+6]=c,this.uint8[g+7]=h,this.float32[_+2]=f,e}}gu.prototype.bytesPerElement=12,Qe(gu,"StructArrayLayout2i4ub1f12");class Ha extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,n,i,a)}emplace(e,n,i,a,l){const c=4*e;return this.float32[c+0]=n,this.float32[c+1]=i,this.float32[c+2]=a,this.float32[c+3]=l,e}}Ha.prototype.bytesPerElement=16,Qe(Ha,"StructArrayLayout4f16");class sa extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,i,a,l)}emplace(e,n,i,a,l,c){const h=6*e,f=3*e;return this.uint16[h+0]=n,this.uint16[h+1]=i,this.uint16[h+2]=a,this.uint16[h+3]=l,this.float32[f+2]=c,e}}sa.prototype.bytesPerElement=12,Qe(sa,"StructArrayLayout4ui1f12");class ym extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,n,i,a)}emplace(e,n,i,a,l){const c=4*e;return this.uint16[c+0]=n,this.uint16[c+1]=i,this.uint16[c+2]=a,this.uint16[c+3]=l,e}}ym.prototype.bytesPerElement=8,Qe(ym,"StructArrayLayout4ui8");class vm extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,i,a,l,c)}emplace(e,n,i,a,l,c,h){const f=6*e;return this.int16[f+0]=n,this.int16[f+1]=i,this.int16[f+2]=a,this.int16[f+3]=l,this.int16[f+4]=c,this.int16[f+5]=h,e}}vm.prototype.bytesPerElement=12,Qe(vm,"StructArrayLayout6i12");class iy extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l,c,h,f,p,g,_,y){const v=this.length;return this.resize(v+1),this.emplace(v,e,n,i,a,l,c,h,f,p,g,_,y)}emplace(e,n,i,a,l,c,h,f,p,g,_,y,v){const w=12*e;return this.int16[w+0]=n,this.int16[w+1]=i,this.int16[w+2]=a,this.int16[w+3]=l,this.uint16[w+4]=c,this.uint16[w+5]=h,this.uint16[w+6]=f,this.uint16[w+7]=p,this.int16[w+8]=g,this.int16[w+9]=_,this.int16[w+10]=y,this.int16[w+11]=v,e}}iy.prototype.bytesPerElement=24,Qe(iy,"StructArrayLayout4i4ui4i24");class xm extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,i,a,l,c)}emplace(e,n,i,a,l,c,h){const f=10*e,p=5*e;return this.int16[f+0]=n,this.int16[f+1]=i,this.int16[f+2]=a,this.float32[p+2]=l,this.float32[p+3]=c,this.float32[p+4]=h,e}}xm.prototype.bytesPerElement=20,Qe(xm,"StructArrayLayout3i3f20");class _u extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}_u.prototype.bytesPerElement=4,Qe(_u,"StructArrayLayout1ul4");class fs extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,n)}emplace(e,n,i){const a=2*e;return this.uint16[a+0]=n,this.uint16[a+1]=i,e}}fs.prototype.bytesPerElement=4,Qe(fs,"StructArrayLayout2ui4");class oy extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l,c,h,f,p,g,_,y,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,n,i,a,l,c,h,f,p,g,_,y,v)}emplace(e,n,i,a,l,c,h,f,p,g,_,y,v,w){const E=20*e,T=10*e;return this.int16[E+0]=n,this.int16[E+1]=i,this.int16[E+2]=a,this.int16[E+3]=l,this.int16[E+4]=c,this.float32[T+3]=h,this.float32[T+4]=f,this.float32[T+5]=p,this.float32[T+6]=g,this.int16[E+14]=_,this.uint32[T+8]=y,this.uint16[E+18]=v,this.uint16[E+19]=w,e}}oy.prototype.bytesPerElement=40,Qe(oy,"StructArrayLayout5i4f1i1ul2ui40");class Tt extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l,c,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,i,a,l,c,h)}emplace(e,n,i,a,l,c,h,f){const p=8*e;return this.int16[p+0]=n,this.int16[p+1]=i,this.int16[p+2]=a,this.int16[p+4]=l,this.int16[p+5]=c,this.int16[p+6]=h,this.int16[p+7]=f,e}}Tt.prototype.bytesPerElement=16,Qe(Tt,"StructArrayLayout3i2i2i16");class wm extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,i,a,l)}emplace(e,n,i,a,l,c){const h=4*e,f=8*e;return this.float32[h+0]=n,this.float32[h+1]=i,this.float32[h+2]=a,this.int16[f+6]=l,this.int16[f+7]=c,e}}wm.prototype.bytesPerElement=16,Qe(wm,"StructArrayLayout2f1f2i16");class Kr extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,n,i,a)}emplace(e,n,i,a,l){const c=12*e,h=3*e;return this.uint8[c+0]=n,this.uint8[c+1]=i,this.float32[h+1]=a,this.float32[h+2]=l,e}}Kr.prototype.bytesPerElement=12,Qe(Kr,"StructArrayLayout2ub2f12");class Ga extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,n,i)}emplace(e,n,i,a){const l=3*e;return this.float32[l+0]=n,this.float32[l+1]=i,this.float32[l+2]=a,e}}Ga.prototype.bytesPerElement=12,Qe(Ga,"StructArrayLayout3f12");class Tr extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,n,i)}emplace(e,n,i,a){const l=3*e;return this.uint16[l+0]=n,this.uint16[l+1]=i,this.uint16[l+2]=a,e}}Tr.prototype.bytesPerElement=6,Qe(Tr,"StructArrayLayout3ui6");class sy extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l,c,h,f,p,g,_,y,v,w,E,T,C,S,I,R,A){const k=this.length;return this.resize(k+1),this.emplace(k,e,n,i,a,l,c,h,f,p,g,_,y,v,w,E,T,C,S,I,R,A)}emplace(e,n,i,a,l,c,h,f,p,g,_,y,v,w,E,T,C,S,I,R,A,k){const L=30*e,B=15*e,j=60*e;return this.int16[L+0]=n,this.int16[L+1]=i,this.int16[L+2]=a,this.float32[B+2]=l,this.float32[B+3]=c,this.uint16[L+8]=h,this.uint16[L+9]=f,this.uint32[B+5]=p,this.uint32[B+6]=g,this.uint32[B+7]=_,this.uint16[L+16]=y,this.uint16[L+17]=v,this.uint16[L+18]=w,this.float32[B+10]=E,this.float32[B+11]=T,this.uint8[j+48]=C,this.uint8[j+49]=S,this.uint8[j+50]=I,this.uint32[B+13]=R,this.int16[L+28]=A,this.uint8[j+58]=k,e}}sy.prototype.bytesPerElement=60,Qe(sy,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ay extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l,c,h,f,p,g,_,y,v,w,E,T,C,S,I,R,A,k,L,B,j,U,G,$,W,H,J,te){const oe=this.length;return this.resize(oe+1),this.emplace(oe,e,n,i,a,l,c,h,f,p,g,_,y,v,w,E,T,C,S,I,R,A,k,L,B,j,U,G,$,W,H,J,te)}emplace(e,n,i,a,l,c,h,f,p,g,_,y,v,w,E,T,C,S,I,R,A,k,L,B,j,U,G,$,W,H,J,te,oe){const K=20*e,Q=40*e,ae=80*e;return this.float32[K+0]=n,this.float32[K+1]=i,this.int16[Q+4]=a,this.int16[Q+5]=l,this.int16[Q+6]=c,this.int16[Q+7]=h,this.int16[Q+8]=f,this.int16[Q+9]=p,this.int16[Q+10]=g,this.int16[Q+11]=_,this.int16[Q+12]=y,this.uint16[Q+13]=v,this.uint16[Q+14]=w,this.uint16[Q+15]=E,this.uint16[Q+16]=T,this.uint16[Q+17]=C,this.uint16[Q+18]=S,this.uint16[Q+19]=I,this.uint16[Q+20]=R,this.uint16[Q+21]=A,this.uint16[Q+22]=k,this.uint16[Q+23]=L,this.uint16[Q+24]=B,this.uint16[Q+25]=j,this.uint16[Q+26]=U,this.uint16[Q+27]=G,this.uint32[K+14]=$,this.float32[K+15]=W,this.float32[K+16]=H,this.float32[K+17]=J,this.float32[K+18]=te,this.uint8[ae+76]=oe,e}}ay.prototype.bytesPerElement=80,Qe(ay,"StructArrayLayout2f9i15ui1ul4f1ub80");class xf extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}xf.prototype.bytesPerElement=4,Qe(xf,"StructArrayLayout1f4");class Dl extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,i,a,l)}emplace(e,n,i,a,l,c){const h=5*e;return this.float32[h+0]=n,this.float32[h+1]=i,this.float32[h+2]=a,this.float32[h+3]=l,this.float32[h+4]=c,e}}Dl.prototype.bytesPerElement=20,Qe(Dl,"StructArrayLayout5f20");class yu extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l,c,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,i,a,l,c,h)}emplace(e,n,i,a,l,c,h,f){const p=7*e;return this.float32[p+0]=n,this.float32[p+1]=i,this.float32[p+2]=a,this.float32[p+3]=l,this.float32[p+4]=c,this.float32[p+5]=h,this.float32[p+6]=f,e}}yu.prototype.bytesPerElement=28,Qe(yu,"StructArrayLayout7f28");class bm extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,n,i,a)}emplace(e,n,i,a,l){const c=6*e;return this.uint32[3*e+0]=n,this.uint16[c+2]=i,this.uint16[c+3]=a,this.uint16[c+4]=l,e}}bm.prototype.bytesPerElement=12,Qe(bm,"StructArrayLayout1ul3ui12");class Ml extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Ml.prototype.bytesPerElement=2,Qe(Ml,"StructArrayLayout1ui2");class wf extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,n)}emplace(e,n,i){const a=2*e;return this.float32[a+0]=n,this.float32[a+1]=i,e}}wf.prototype.bytesPerElement=8,Qe(wf,"StructArrayLayout2f8");class Em extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l,c,h,f,p,g,_,y,v,w,E,T){const C=this.length;return this.resize(C+1),this.emplace(C,e,n,i,a,l,c,h,f,p,g,_,y,v,w,E,T)}emplace(e,n,i,a,l,c,h,f,p,g,_,y,v,w,E,T,C){const S=16*e;return this.float32[S+0]=n,this.float32[S+1]=i,this.float32[S+2]=a,this.float32[S+3]=l,this.float32[S+4]=c,this.float32[S+5]=h,this.float32[S+6]=f,this.float32[S+7]=p,this.float32[S+8]=g,this.float32[S+9]=_,this.float32[S+10]=y,this.float32[S+11]=v,this.float32[S+12]=w,this.float32[S+13]=E,this.float32[S+14]=T,this.float32[S+15]=C,e}}Em.prototype.bytesPerElement=64,Qe(Em,"StructArrayLayout16f64");class yc extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l,c,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,i,a,l,c,h)}emplace(e,n,i,a,l,c,h,f){const p=10*e,g=5*e;return this.uint16[p+0]=n,this.uint16[p+1]=i,this.uint16[p+2]=a,this.uint16[p+3]=l,this.float32[g+2]=c,this.float32[g+3]=h,this.float32[g+4]=f,e}}yc.prototype.bytesPerElement=20,Qe(yc,"StructArrayLayout4ui3f20");class Th extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}Th.prototype.bytesPerElement=1,Qe(Th,"StructArrayLayout1ub1");class ly extends _m{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ly.prototype.size=40;class cy extends oy{get(e){return new ly(this,e)}}Qe(cy,"CollisionBoxArray");class V1 extends _m{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}V1.prototype.size=60;class vu extends sy{get(e){return new V1(this,e)}}Qe(vu,"PlacedSymbolArray");class Dh extends _m{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Dh.prototype.size=80;class j1 extends ay{get(e){return new Dh(this,e)}}Qe(j1,"SymbolInstanceArray");class pD extends xf{getoffsetX(e){return this.float32[1*e+0]}}Qe(pD,"GlyphOffsetArray");class uy extends jo{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Qe(uy,"SymbolLineVertexArray");class U1 extends _m{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}U1.prototype.size=12;class mD extends bm{get(e){return new U1(this,e)}}Qe(mD,"FeatureIndexArray");class $1 extends fs{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Qe($1,"FillExtrusionCentroidArray");const gD=wn([{name:"a_pos",components:2,type:"Int16"}],4),_D=wn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Cn{constructor(e=[]){this.segments=e}_prepareSegment(e,n,i,a){let l=this.segments[this.segments.length-1];return e>Cn.MAX_VERTEX_ARRAY_LENGTH&&ee(`Max vertices per segment is ${Cn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!l||l.vertexLength+e>Cn.MAX_VERTEX_ARRAY_LENGTH||l.sortKey!==a)&&(l={vertexOffset:n,primitiveOffset:i,vertexLength:0,primitiveLength:0},void 0!==a&&(l.sortKey=a),this.segments.push(l)),l}prepareSegment(e,n,i,a){return this._prepareSegment(e,n.length,i.length,a)}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,i,a){return new Cn([{vertexOffset:e,primitiveOffset:n,vertexLength:i,primitiveLength:a,vaos:{},sortKey:0}])}}function hy(t,e){return 256*(t=et(Math.floor(t),0,255))+et(Math.floor(e),0,255)}Cn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Qe(Cn,"SegmentVector");const yD=wn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),H1=wn([{name:"a_dash",components:4,type:"Uint16"}]);var dy={exports:{}},rI={exports:function(e,n){var i,a,l,c,h,f,p,g;for(a=e.length-(i=3&e.length),l=n,h=3432918353,f=461845907,g=0;g<a;)p=255&e.charCodeAt(g)|(255&e.charCodeAt(++g))<<8|(255&e.charCodeAt(++g))<<16|(255&e.charCodeAt(++g))<<24,++g,l=27492+(65535&(c=5*(65535&(l=(l^=p=(65535&(p=(p=(65535&p)*h+(((p>>>16)*h&65535)<<16)&4294967295)<<15|p>>>17))*f+(((p>>>16)*f&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(c>>>16)&65535)<<16);switch(p=0,i){case 3:p^=(255&e.charCodeAt(g+2))<<16;case 2:p^=(255&e.charCodeAt(g+1))<<8;case 1:l^=p=(65535&(p=(p=(65535&(p^=255&e.charCodeAt(g)))*h+(((p>>>16)*h&65535)<<16)&4294967295)<<15|p>>>17))*f+(((p>>>16)*f&65535)<<16)&4294967295}return l^=e.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0}}.exports,G1={exports:{}};G1.exports=function(e,n){for(var i,a=e.length,l=n^a,c=0;a>=4;)i=1540483477*(65535&(i=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24))+((1540483477*(i>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),a-=4,++c;switch(a){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:l=1540483477*(65535&(l^=255&e.charCodeAt(c)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0};var q1=rI,py=G1.exports;dy.exports=q1,dy.exports.murmur3=q1,dy.exports.murmur2=py;var W1=oo(dy.exports);class Cm{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,i,a){this.ids.push(Tm(e)),this.positions.push(n,i,a)}eachPosition(e,n){const i=Tm(e);let a=0,l=this.ids.length-1;for(;a<l;){const c=a+l>>1;this.ids[c]>=i?l=c:a=c+1}for(;this.ids[a]===i;)n(this.positions[3*a],this.positions[3*a+1],this.positions[3*a+2]),a++}static serialize(e,n){const i=new Float64Array(e.ids),a=new Uint32Array(e.positions);return Z1(i,a,0,i.length-1),n&&(n.add(i.buffer),n.add(a.buffer)),{ids:i,positions:a}}static deserialize(e){const n=new Cm;let i;n.ids=e.ids,n.positions=e.positions;for(const a of n.ids)a!==i&&n.uniqueIds.push(a),i=a;return n.indexed=!0,n}}function Tm(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:W1(String(t))}function Z1(t,e,n,i){for(;n<i;){const a=t[n+i>>1];let l=n-1,c=i+1;for(;;){do{l++}while(t[l]<a);do{c--}while(t[c]>a);if(l>=c)break;my(t,l,c),my(e,3*l,3*c),my(e,3*l+1,3*c+1),my(e,3*l+2,3*c+2)}c-n<i-c?(Z1(t,e,n,c),n=c+1):(Z1(t,e,c+1,i),i=c)}}function my(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}Qe(Cm,"FeaturePositionMap");class vc{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}}class Xt extends vc{constructor(e){super(e),this.current=0}set(e,n,i){this.fetchUniformLocation(e,n)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}}class Pe extends vc{constructor(e){super(e),this.current=0}set(e,n,i){this.fetchUniformLocation(e,n)&&this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class Jt extends vc{constructor(e){super(e),this.current=[0,0]}set(e,n,i){this.fetchUniformLocation(e,n)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}}class kt extends vc{constructor(e){super(e),this.current=[0,0,0]}set(e,n,i){this.fetchUniformLocation(e,n)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}}class go extends vc{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,i){this.fetchUniformLocation(e,n)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3])))}}class xu extends vc{constructor(e){super(e),this.current=yt.transparent}set(e,n,i){this.fetchUniformLocation(e,n)&&(i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a)))}}const X1=new Float32Array(16);class It extends vc{constructor(e){super(e),this.current=X1}set(e,n,i){if(this.fetchUniformLocation(e,n)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let a=1;a<16;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}}const Uo=new Float32Array(9);class Y1 extends vc{constructor(e){super(e),this.current=Uo}set(e,n,i){if(this.fetchUniformLocation(e,n))for(let a=0;a<9;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}const vD=new Float32Array(4);class gy extends vc{constructor(e){super(e),this.current=vD}set(e,n,i){if(this.fetchUniformLocation(e,n))for(let a=0;a<4;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}function Dm(t){return[hy(255*t.r,255*t.g),hy(255*t.b,255*t.a)]}class wu{constructor(e,n,i){this.value=e,this.uniformNames=n.map(a=>`u_${a}`),this.type=i}setUniform(e,n,i,a,l){n.set(e,l,a.constantOr(this.value))}getBinding(e,n){return"color"===this.type?new xu(e):new Pe(e)}}class Mh{constructor(e,n){this.uniformNames=n.map(i=>`u_${i}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,i,a,l){const c="u_pattern"===l||"u_dash"===l?this.pattern:"u_pixel_ratio"===l?this.pixelRatio:null;c&&n.set(e,l,c)}getBinding(e,n){return"u_pattern"===n||"u_dash"===n?new go(e):new Pe(e)}}class Sl{constructor(e,n,i,a){this.expression=e,this.type=i,this.maxValue=0,this.paintVertexAttributes=n.map(l=>({name:`a_${l}`,type:"Float32",components:"color"===i?2:1,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,n,i,a,l,c,h){const f=this.paintVertexArray.length,p=this.expression.evaluate(new pr(0,{brightness:c}),n,{},l,a,h);this.paintVertexArray.resize(e),this._setPaintValue(f,e,p)}updatePaintArray(e,n,i,a,l,c,h){const f=this.expression.evaluate({zoom:0,brightness:h},i,a,void 0,l);this._setPaintValue(e,n,f)}_setPaintValue(e,n,i){if("color"===this.type){const a=Dm(i);for(let l=e;l<n;l++)this.paintVertexArray.emplace(l,a[0],a[1])}else{for(let a=e;a<n;a++)this.paintVertexArray.emplace(a,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class aa{constructor(e,n,i,a,l,c){this.expression=e,this.uniformNames=n.map(h=>`u_${h}_t`),this.type=i,this.useIntegerZoom=a,this.zoom=l,this.maxValue=0,this.paintVertexAttributes=n.map(h=>({name:`a_${h}`,type:"Float32",components:"color"===i?4:2,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,n,i,a,l,c,h){const f=this.expression.evaluate(new pr(this.zoom,{brightness:c}),n,{},l,a,h),p=this.expression.evaluate(new pr(this.zoom+1,{brightness:c}),n,{},l,a,h),g=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(g,e,f,p)}updatePaintArray(e,n,i,a,l,c,h){const f=this.expression.evaluate({zoom:this.zoom,brightness:h},i,a,void 0,l),p=this.expression.evaluate({zoom:this.zoom+1,brightness:h},i,a,void 0,l);this._setPaintValue(e,n,f,p)}_setPaintValue(e,n,i,a){if("color"===this.type){const l=Dm(i),c=Dm(a);for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,l[0],l[1],c[0],c[1])}else{for(let l=e;l<n;l++)this.paintVertexArray.emplace(l,i,a);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,i,a,l){const c=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,h=et(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);n.set(e,l,h)}getBinding(e,n){return new Pe(e)}}class Al{constructor(e,n,i,a,l){this.expression=e,this.layerId=l,this.paintVertexAttributes=("array"===i?H1:yD).members;for(let c=0;c<n.length;++c);this.paintVertexArray=new a}populatePaintArray(e,n,i){const a=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(a,e,n.patterns&&n.patterns[this.layerId],i)}updatePaintArray(e,n,i,a,l,c,h){this._setPaintValues(e,n,i.patterns&&i.patterns[this.layerId],c)}_setPaintValues(e,n,i,a){if(!a||!i)return;const l=a[i];if(!l)return;const{tl:c,br:h,pixelRatio:f}=l;for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,c[0],c[1],h[0],h[1],f)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class bu{constructor(e,n,i=(()=>!0)){this.binders={},this._buffers=[];const a=[];for(const l in e.paint._values){const c=e.paint.get(l);if(!i(l)||!(c instanceof pu&&lu(c.property.specification)))continue;const h=_y(l,e.type),f=c.value,p=c.property.specification.type,g=!!c.property.useIntegerZoom,_="line-dasharray"===l||l.endsWith("pattern"),y="line-dasharray"===l&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==f.kind||y)if("source"===f.kind||y||_){const v=Ki(l,p,"source");this.binders[l]=_?new Al(f,h,p,v,e.id):new Sl(f,h,p,v),a.push(`/a_${l}`)}else{const v=Ki(l,p,"composite");this.binders[l]=new aa(f,h,p,g,n,v),a.push(`/z_${l}`)}else this.binders[l]=_?new Mh(f.value,h):new wu(f.value,h,p),a.push(`/u_${l}`)}this.cacheKey=a.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof Sl||n instanceof aa?n.maxValue:0}populatePaintArrays(e,n,i,a,l,c,h){for(const f in this.binders){const p=this.binders[f];(p instanceof Sl||p instanceof aa||p instanceof Al)&&p.populatePaintArray(e,n,i,a,l,c,h)}}setConstantPatternPositions(e){for(const n in this.binders){const i=this.binders[n];i instanceof Mh&&i.setConstantPatternPositions(e)}}updatePaintArrays(e,n,i,a,l,c,h,f){let p=!1;const g=Object.keys(e),_=0!==g.length,y=_?g:n.uniqueIds;for(const v in this.binders){const w=this.binders[v];if((w instanceof Sl||w instanceof aa||w instanceof Al)&&(!0===w.expression.isStateDependent||!1===w.expression.isLightConstant)){const E=l.paint.get(v);w.expression=E.value;for(const T of y){const C=e[T.toString()];n.eachPosition(T,(S,I,R)=>{const A=a.feature(S);w.updatePaintArray(I,R,A,C,c,h,f)})}if(!_)for(const T of i.uniqueIds){const C=e[T.toString()];i.eachPosition(T,(S,I,R)=>{const A=a.feature(S);w.updatePaintArray(I,R,A,C,c,h,f)})}p=!0}}return p}defines(){const e=[];for(const n in this.binders){const i=this.binders[n];(i instanceof wu||i instanceof Mh)&&e.push(...i.uniformNames.map(a=>`#define HAS_UNIFORM_${a}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const i=this.binders[n];if(i instanceof Sl||i instanceof aa||i instanceof Al)for(let a=0;a<i.paintVertexAttributes.length;a++)e.push(i.paintVertexAttributes[a].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const i=this.binders[n];if(i instanceof wu||i instanceof Mh||i instanceof aa)for(const a of i.uniformNames)e.push(a)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof wu||a instanceof Mh||a instanceof aa)for(const l of a.uniformNames)n.push({name:l,property:i,binding:a.getBinding(e,l)})}return n}setUniforms(e,n,i,a,l){for(const{name:c,property:h,binding:f}of i)this.binders[h].setUniform(e,f,l,a.get(h),c)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof Sl||n instanceof aa||n instanceof Al)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const n in this.binders){const i=this.binders[n];(i instanceof Sl||i instanceof aa||i instanceof Al)&&i.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof Sl||n instanceof aa||n instanceof Al)&&n.destroy()}}}class xc{constructor(e,n,i=(()=>!0)){this.programConfigurations={};for(const a of e)this.programConfigurations[a.id]=new bu(a,n,i);this.needsUpload=!1,this._featureMap=new Cm,this._featureMapWithoutIds=new Cm,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,i,a,l,c,h,f){for(const p in this.programConfigurations)this.programConfigurations[p].populatePaintArrays(e,n,a,l,c,h,f);void 0!==n.id?this._featureMap.add(n.id,i,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,i,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,i,a,l,c){for(const h of i)this.needsUpload=this.programConfigurations[h.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,h,a,l,c||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const To={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function _y(t,e){return To[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const K1={"line-pattern":{source:sa,composite:sa},"fill-pattern":{source:sa,composite:sa},"fill-extrusion-pattern":{source:sa,composite:sa},"line-dasharray":{source:ym,composite:ym}},yy={color:{source:wf,composite:Ha},number:{source:xf,composite:wf}};function Ki(t,e,n){const i=K1[t];return i&&i[n]||yy[e][n]}Qe(wu,"ConstantBinder"),Qe(Mh,"PatternConstantBinder"),Qe(Sl,"SourceExpressionBinder"),Qe(Al,"PatternCompositeBinder"),Qe(aa,"CompositeExpressionBinder"),Qe(bu,"ProgramConfiguration",{omit:["_buffers"]}),Qe(xc,"ProgramConfigurationSet");class Ji{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof bt?new bt(e.lng,e.lat):bt.convert(e),this}setSouthWest(e){return this._sw=e instanceof bt?new bt(e.lng,e.lat):bt.convert(e),this}extend(e){const n=this._sw,i=this._ne;let a,l;if(e instanceof bt)a=e,l=e;else{if(!(e instanceof Ji))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Ji.convert(e)):this.extend(bt.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(bt.convert(e)):this;if(a=e._sw,l=e._ne,!a||!l)return this}return n||i?(n.lng=Math.min(a.lng,n.lng),n.lat=Math.min(a.lat,n.lat),i.lng=Math.max(l.lng,i.lng),i.lat=Math.max(l.lat,i.lat)):(this._sw=new bt(a.lng,a.lat),this._ne=new bt(l.lng,l.lat)),this}getCenter(){return new bt((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new bt(this.getWest(),this.getNorth())}getSouthEast(){return new bt(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:i}=bt.convert(e);let a=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&a}static convert(e){return!e||e instanceof Ji?e:new Ji(e)}}var ti={},ui={};Object.defineProperty(ui,"__esModule",{value:!0}),ui.setMatrixArrayType=function(t){ui.ARRAY_TYPE=vy=t},ui.toRadian=function(t){return t*Q1},ui.equals=function(t,e){return Math.abs(t-e)<=J1*Math.max(1,Math.abs(t),Math.abs(e))},ui.RANDOM=ui.ARRAY_TYPE=ui.EPSILON=void 0;var J1=1e-6;ui.EPSILON=J1;var vy=typeof Float32Array<"u"?Float32Array:Array;ui.ARRAY_TYPE=vy;var xD=Math.random;ui.RANDOM=xD;var Q1=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var cr={};function Mm(t){return(Mm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(cr,"__esModule",{value:!0}),cr.create=function(){var t=new wc.ARRAY_TYPE(4);return wc.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},cr.clone=function(t){var e=new wc.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},cr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},cr.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},cr.fromValues=function(t,e,n,i){var a=new wc.ARRAY_TYPE(4);return a[0]=t,a[1]=e,a[2]=n,a[3]=i,a},cr.set=function(t,e,n,i,a){return t[0]=e,t[1]=n,t[2]=i,t[3]=a,t},cr.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},cr.invert=function(t,e){var n=e[0],i=e[1],a=e[2],l=e[3],c=n*l-a*i;return c?(t[0]=l*(c=1/c),t[1]=-i*c,t[2]=-a*c,t[3]=n*c,t):null},cr.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},cr.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},cr.multiply=Sm,cr.rotate=function(t,e,n){var i=e[0],a=e[1],l=e[2],c=e[3],h=Math.sin(n),f=Math.cos(n);return t[0]=i*f+l*h,t[1]=a*f+c*h,t[2]=i*-h+l*f,t[3]=a*-h+c*f,t},cr.scale=function(t,e,n){var i=e[1],a=e[2],l=e[3],c=n[0],h=n[1];return t[0]=e[0]*c,t[1]=i*c,t[2]=a*h,t[3]=l*h,t},cr.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=-n,t[3]=i,t},cr.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},cr.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},cr.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},cr.LDU=function(t,e,n,i){return t[2]=i[2]/i[0],n[0]=i[0],n[1]=i[1],n[3]=i[3]-t[2]*n[1],[t,e,n]},cr.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},cr.subtract=Am,cr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},cr.equals=function(t,e){var n=t[0],i=t[1],a=t[2],l=t[3],c=e[0],h=e[1],f=e[2],p=e[3];return Math.abs(n-c)<=wc.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(i-h)<=wc.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(a-f)<=wc.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(l-p)<=wc.EPSILON*Math.max(1,Math.abs(l),Math.abs(p))},cr.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},cr.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t},cr.sub=cr.mul=void 0;var wc=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==Mm(t)&&"function"!=typeof t)return{default:t};var n=ew(void 0);if(n&&n.has(t))return n.get(t);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if("default"!==l&&Object.prototype.hasOwnProperty.call(t,l)){var c=a?Object.getOwnPropertyDescriptor(t,l):null;c&&(c.get||c.set)?Object.defineProperty(i,l,c):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}(ui);function ew(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(ew=function(i){return i?n:e})(t)}function Sm(t,e,n){var i=e[0],a=e[1],l=e[2],c=e[3],h=n[0],f=n[1],p=n[2],g=n[3];return t[0]=i*h+l*f,t[1]=a*h+c*f,t[2]=i*p+l*g,t[3]=a*p+c*g,t}function Am(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}cr.mul=Sm,cr.sub=Am;var _r={};function Im(t){return(Im="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(_r,"__esModule",{value:!0}),_r.create=function(){var t=new qa.ARRAY_TYPE(6);return qa.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},_r.clone=function(t){var e=new qa.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},_r.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},_r.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},_r.fromValues=function(t,e,n,i,a,l){var c=new qa.ARRAY_TYPE(6);return c[0]=t,c[1]=e,c[2]=n,c[3]=i,c[4]=a,c[5]=l,c},_r.set=function(t,e,n,i,a,l,c){return t[0]=e,t[1]=n,t[2]=i,t[3]=a,t[4]=l,t[5]=c,t},_r.invert=function(t,e){var n=e[0],i=e[1],a=e[2],l=e[3],c=e[4],h=e[5],f=n*l-i*a;return f?(t[0]=l*(f=1/f),t[1]=-i*f,t[2]=-a*f,t[3]=n*f,t[4]=(a*h-l*c)*f,t[5]=(i*c-n*h)*f,t):null},_r.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},_r.multiply=tw,_r.rotate=function(t,e,n){var i=e[0],a=e[1],l=e[2],c=e[3],h=e[4],f=e[5],p=Math.sin(n),g=Math.cos(n);return t[0]=i*g+l*p,t[1]=a*g+c*p,t[2]=i*-p+l*g,t[3]=a*-p+c*g,t[4]=h,t[5]=f,t},_r.scale=function(t,e,n){var i=e[1],a=e[2],l=e[3],c=e[4],h=e[5],f=n[0],p=n[1];return t[0]=e[0]*f,t[1]=i*f,t[2]=a*p,t[3]=l*p,t[4]=c,t[5]=h,t},_r.translate=function(t,e,n){var i=e[0],a=e[1],l=e[2],c=e[3],h=e[4],f=e[5],p=n[0],g=n[1];return t[0]=i,t[1]=a,t[2]=l,t[3]=c,t[4]=i*p+l*g+h,t[5]=a*p+c*g+f,t},_r.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=-n,t[3]=i,t[4]=0,t[5]=0,t},_r.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},_r.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},_r.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},_r.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},_r.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},_r.subtract=nw,_r.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},_r.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t},_r.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},_r.equals=function(t,e){var n=t[0],i=t[1],a=t[2],l=t[3],c=t[4],h=t[5],f=e[0],p=e[1],g=e[2],_=e[3],y=e[4],v=e[5];return Math.abs(n-f)<=qa.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(i-p)<=qa.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(a-g)<=qa.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(l-_)<=qa.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(c-y)<=qa.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(h-v)<=qa.EPSILON*Math.max(1,Math.abs(h),Math.abs(v))},_r.sub=_r.mul=void 0;var qa=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==Im(t)&&"function"!=typeof t)return{default:t};var n=Sh(void 0);if(n&&n.has(t))return n.get(t);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if("default"!==l&&Object.prototype.hasOwnProperty.call(t,l)){var c=a?Object.getOwnPropertyDescriptor(t,l):null;c&&(c.get||c.set)?Object.defineProperty(i,l,c):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}(ui);function Sh(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(Sh=function(i){return i?n:e})(t)}function tw(t,e,n){var i=e[0],a=e[1],l=e[2],c=e[3],h=e[4],f=e[5],p=n[0],g=n[1],_=n[2],y=n[3],v=n[4],w=n[5];return t[0]=i*p+l*g,t[1]=a*p+c*g,t[2]=i*_+l*y,t[3]=a*_+c*y,t[4]=i*v+l*w+h,t[5]=a*v+c*w+f,t}function nw(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}_r.mul=tw,_r.sub=nw;var An={};function bf(t){return(bf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(An,"__esModule",{value:!0}),An.create=function(){var t=new $o.ARRAY_TYPE(9);return $o.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},An.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},An.clone=function(t){var e=new $o.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},An.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},An.fromValues=function(t,e,n,i,a,l,c,h,f){var p=new $o.ARRAY_TYPE(9);return p[0]=t,p[1]=e,p[2]=n,p[3]=i,p[4]=a,p[5]=l,p[6]=c,p[7]=h,p[8]=f,p},An.set=function(t,e,n,i,a,l,c,h,f,p){return t[0]=e,t[1]=n,t[2]=i,t[3]=a,t[4]=l,t[5]=c,t[6]=h,t[7]=f,t[8]=p,t},An.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},An.transpose=function(t,e){if(t===e){var n=e[1],i=e[2],a=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=i,t[7]=a}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},An.invert=function(t,e){var n=e[0],i=e[1],a=e[2],l=e[3],c=e[4],h=e[5],f=e[6],p=e[7],g=e[8],_=g*c-h*p,y=-g*l+h*f,v=p*l-c*f,w=n*_+i*y+a*v;return w?(t[0]=_*(w=1/w),t[1]=(-g*i+a*p)*w,t[2]=(h*i-a*c)*w,t[3]=y*w,t[4]=(g*n-a*f)*w,t[5]=(-h*n+a*l)*w,t[6]=v*w,t[7]=(-p*n+i*f)*w,t[8]=(c*n-i*l)*w,t):null},An.adjoint=function(t,e){var n=e[0],i=e[1],a=e[2],l=e[3],c=e[4],h=e[5],f=e[6],p=e[7],g=e[8];return t[0]=c*g-h*p,t[1]=a*p-i*g,t[2]=i*h-a*c,t[3]=h*f-l*g,t[4]=n*g-a*f,t[5]=a*l-n*h,t[6]=l*p-c*f,t[7]=i*f-n*p,t[8]=n*c-i*l,t},An.determinant=function(t){var e=t[3],n=t[4],i=t[5],a=t[6],l=t[7],c=t[8];return t[0]*(c*n-i*l)+t[1]*(-c*e+i*a)+t[2]*(l*e-n*a)},An.multiply=Eu,An.translate=function(t,e,n){var i=e[0],a=e[1],l=e[2],c=e[3],h=e[4],f=e[5],p=e[6],g=e[7],_=e[8],y=n[0],v=n[1];return t[0]=i,t[1]=a,t[2]=l,t[3]=c,t[4]=h,t[5]=f,t[6]=y*i+v*c+p,t[7]=y*a+v*h+g,t[8]=y*l+v*f+_,t},An.rotate=function(t,e,n){var i=e[0],a=e[1],l=e[2],c=e[3],h=e[4],f=e[5],p=e[6],g=e[7],_=e[8],y=Math.sin(n),v=Math.cos(n);return t[0]=v*i+y*c,t[1]=v*a+y*h,t[2]=v*l+y*f,t[3]=v*c-y*i,t[4]=v*h-y*a,t[5]=v*f-y*l,t[6]=p,t[7]=g,t[8]=_,t},An.scale=function(t,e,n){var i=n[0],a=n[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=a*e[3],t[4]=a*e[4],t[5]=a*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},An.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},An.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=-n,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},An.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},An.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},An.fromQuat=function(t,e){var n=e[0],i=e[1],a=e[2],l=e[3],c=n+n,h=i+i,f=a+a,p=n*c,g=i*c,_=i*h,y=a*c,v=a*h,w=a*f,E=l*c,T=l*h,C=l*f;return t[0]=1-_-w,t[3]=g-C,t[6]=y+T,t[1]=g+C,t[4]=1-p-w,t[7]=v-E,t[2]=y-T,t[5]=v+E,t[8]=1-p-_,t},An.normalFromMat4=function(t,e){var n=e[0],i=e[1],a=e[2],l=e[3],c=e[4],h=e[5],f=e[6],p=e[7],g=e[8],_=e[9],y=e[10],v=e[11],w=e[12],E=e[13],T=e[14],C=e[15],S=n*h-i*c,I=n*f-a*c,R=n*p-l*c,A=i*f-a*h,k=i*p-l*h,L=a*p-l*f,B=g*E-_*w,j=g*T-y*w,U=g*C-v*w,G=_*T-y*E,$=_*C-v*E,W=y*C-v*T,H=S*W-I*$+R*G+A*U-k*j+L*B;return H?(t[0]=(h*W-f*$+p*G)*(H=1/H),t[1]=(f*U-c*W-p*j)*H,t[2]=(c*$-h*U+p*B)*H,t[3]=(a*$-i*W-l*G)*H,t[4]=(n*W-a*U+l*j)*H,t[5]=(i*U-n*$-l*B)*H,t[6]=(E*L-T*k+C*A)*H,t[7]=(T*R-w*L-C*I)*H,t[8]=(w*k-E*R+C*S)*H,t):null},An.projection=function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},An.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},An.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},An.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},An.subtract=Pm,An.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},An.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t[6]=e[6]+n[6]*i,t[7]=e[7]+n[7]*i,t[8]=e[8]+n[8]*i,t},An.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},An.equals=function(t,e){var n=t[0],i=t[1],a=t[2],l=t[3],c=t[4],h=t[5],f=t[6],p=t[7],g=t[8],_=e[0],y=e[1],v=e[2],w=e[3],E=e[4],T=e[5],C=e[6],S=e[7],I=e[8];return Math.abs(n-_)<=$o.EPSILON*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(i-y)<=$o.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(a-v)<=$o.EPSILON*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(l-w)<=$o.EPSILON*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(c-E)<=$o.EPSILON*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(h-T)<=$o.EPSILON*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(f-C)<=$o.EPSILON*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(p-S)<=$o.EPSILON*Math.max(1,Math.abs(p),Math.abs(S))&&Math.abs(g-I)<=$o.EPSILON*Math.max(1,Math.abs(g),Math.abs(I))},An.sub=An.mul=void 0;var $o=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==bf(t)&&"function"!=typeof t)return{default:t};var n=wD(void 0);if(n&&n.has(t))return n.get(t);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if("default"!==l&&Object.prototype.hasOwnProperty.call(t,l)){var c=a?Object.getOwnPropertyDescriptor(t,l):null;c&&(c.get||c.set)?Object.defineProperty(i,l,c):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}(ui);function wD(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(wD=function(i){return i?n:e})(t)}function Eu(t,e,n){var i=e[0],a=e[1],l=e[2],c=e[3],h=e[4],f=e[5],p=e[6],g=e[7],_=e[8],y=n[0],v=n[1],w=n[2],E=n[3],T=n[4],C=n[5],S=n[6],I=n[7],R=n[8];return t[0]=y*i+v*c+w*p,t[1]=y*a+v*h+w*g,t[2]=y*l+v*f+w*_,t[3]=E*i+T*c+C*p,t[4]=E*a+T*h+C*g,t[5]=E*l+T*f+C*_,t[6]=S*i+I*c+R*p,t[7]=S*a+I*h+R*g,t[8]=S*l+I*f+R*_,t}function Pm(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}An.mul=Eu,An.sub=Pm;var Lt={};function xy(t){return(xy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.create=function(){var t=new yr.ARRAY_TYPE(16);return yr.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},Lt.clone=function(t){var e=new yr.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Lt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Lt.fromValues=function(t,e,n,i,a,l,c,h,f,p,g,_,y,v,w,E){var T=new yr.ARRAY_TYPE(16);return T[0]=t,T[1]=e,T[2]=n,T[3]=i,T[4]=a,T[5]=l,T[6]=c,T[7]=h,T[8]=f,T[9]=p,T[10]=g,T[11]=_,T[12]=y,T[13]=v,T[14]=w,T[15]=E,T},Lt.set=function(t,e,n,i,a,l,c,h,f,p,g,_,y,v,w,E,T){return t[0]=e,t[1]=n,t[2]=i,t[3]=a,t[4]=l,t[5]=c,t[6]=h,t[7]=f,t[8]=p,t[9]=g,t[10]=_,t[11]=y,t[12]=v,t[13]=w,t[14]=E,t[15]=T,t},Lt.identity=iw,Lt.transpose=function(t,e){if(t===e){var n=e[1],i=e[2],a=e[3],l=e[6],c=e[7],h=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=l,t[11]=e[14],t[12]=a,t[13]=c,t[14]=h}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},Lt.invert=function(t,e){var n=e[0],i=e[1],a=e[2],l=e[3],c=e[4],h=e[5],f=e[6],p=e[7],g=e[8],_=e[9],y=e[10],v=e[11],w=e[12],E=e[13],T=e[14],C=e[15],S=n*h-i*c,I=n*f-a*c,R=n*p-l*c,A=i*f-a*h,k=i*p-l*h,L=a*p-l*f,B=g*E-_*w,j=g*T-y*w,U=g*C-v*w,G=_*T-y*E,$=_*C-v*E,W=y*C-v*T,H=S*W-I*$+R*G+A*U-k*j+L*B;return H?(t[0]=(h*W-f*$+p*G)*(H=1/H),t[1]=(a*$-i*W-l*G)*H,t[2]=(E*L-T*k+C*A)*H,t[3]=(y*k-_*L-v*A)*H,t[4]=(f*U-c*W-p*j)*H,t[5]=(n*W-a*U+l*j)*H,t[6]=(T*R-w*L-C*I)*H,t[7]=(g*L-y*R+v*I)*H,t[8]=(c*$-h*U+p*B)*H,t[9]=(i*U-n*$-l*B)*H,t[10]=(w*k-E*R+C*S)*H,t[11]=(_*R-g*k-v*S)*H,t[12]=(h*j-c*G-f*B)*H,t[13]=(n*G-i*j+a*B)*H,t[14]=(E*I-w*A-T*S)*H,t[15]=(g*A-_*I+y*S)*H,t):null},Lt.adjoint=function(t,e){var n=e[0],i=e[1],a=e[2],l=e[3],c=e[4],h=e[5],f=e[6],p=e[7],g=e[8],_=e[9],y=e[10],v=e[11],w=e[12],E=e[13],T=e[14],C=e[15];return t[0]=h*(y*C-v*T)-_*(f*C-p*T)+E*(f*v-p*y),t[1]=-(i*(y*C-v*T)-_*(a*C-l*T)+E*(a*v-l*y)),t[2]=i*(f*C-p*T)-h*(a*C-l*T)+E*(a*p-l*f),t[3]=-(i*(f*v-p*y)-h*(a*v-l*y)+_*(a*p-l*f)),t[4]=-(c*(y*C-v*T)-g*(f*C-p*T)+w*(f*v-p*y)),t[5]=n*(y*C-v*T)-g*(a*C-l*T)+w*(a*v-l*y),t[6]=-(n*(f*C-p*T)-c*(a*C-l*T)+w*(a*p-l*f)),t[7]=n*(f*v-p*y)-c*(a*v-l*y)+g*(a*p-l*f),t[8]=c*(_*C-v*E)-g*(h*C-p*E)+w*(h*v-p*_),t[9]=-(n*(_*C-v*E)-g*(i*C-l*E)+w*(i*v-l*_)),t[10]=n*(h*C-p*E)-c*(i*C-l*E)+w*(i*p-l*h),t[11]=-(n*(h*v-p*_)-c*(i*v-l*_)+g*(i*p-l*h)),t[12]=-(c*(_*T-y*E)-g*(h*T-f*E)+w*(h*y-f*_)),t[13]=n*(_*T-y*E)-g*(i*T-a*E)+w*(i*y-a*_),t[14]=-(n*(h*T-f*E)-c*(i*T-a*E)+w*(i*f-a*h)),t[15]=n*(h*y-f*_)-c*(i*y-a*_)+g*(i*f-a*h),t},Lt.determinant=function(t){var e=t[0],n=t[1],i=t[2],a=t[3],l=t[4],c=t[5],h=t[6],f=t[7],p=t[8],g=t[9],_=t[10],y=t[11],v=t[12],w=t[13],E=t[14],T=t[15];return(e*c-n*l)*(_*T-y*E)-(e*h-i*l)*(g*T-y*w)+(e*f-a*l)*(g*E-_*w)+(n*h-i*c)*(p*T-y*v)-(n*f-a*c)*(p*E-_*v)+(i*f-a*h)*(p*w-g*v)},Lt.multiply=ow,Lt.translate=function(t,e,n){var i,a,l,c,h,f,p,g,_,y,v,w,E=n[0],T=n[1],C=n[2];return e===t?(t[12]=e[0]*E+e[4]*T+e[8]*C+e[12],t[13]=e[1]*E+e[5]*T+e[9]*C+e[13],t[14]=e[2]*E+e[6]*T+e[10]*C+e[14],t[15]=e[3]*E+e[7]*T+e[11]*C+e[15]):(a=e[1],l=e[2],c=e[3],h=e[4],f=e[5],p=e[6],g=e[7],_=e[8],y=e[9],v=e[10],w=e[11],t[0]=i=e[0],t[1]=a,t[2]=l,t[3]=c,t[4]=h,t[5]=f,t[6]=p,t[7]=g,t[8]=_,t[9]=y,t[10]=v,t[11]=w,t[12]=i*E+h*T+_*C+e[12],t[13]=a*E+f*T+y*C+e[13],t[14]=l*E+p*T+v*C+e[14],t[15]=c*E+g*T+w*C+e[15]),t},Lt.scale=function(t,e,n){var i=n[0],a=n[1],l=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*l,t[9]=e[9]*l,t[10]=e[10]*l,t[11]=e[11]*l,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Lt.rotate=function(t,e,n,i){var a,l,c,h,f,p,g,_,y,v,w,E,T,C,S,I,R,A,k,L,B,j,U,G,$=i[0],W=i[1],H=i[2],J=Math.hypot($,W,H);return J<yr.EPSILON?null:($*=J=1/J,W*=J,H*=J,a=Math.sin(n),l=Math.cos(n),f=e[1],p=e[2],g=e[3],y=e[5],v=e[6],w=e[7],T=e[9],C=e[10],S=e[11],k=$*W*(c=1-l)-H*a,L=W*W*c+l,B=H*W*c+$*a,j=$*H*c+W*a,U=W*H*c-$*a,G=H*H*c+l,t[0]=(h=e[0])*(I=$*$*c+l)+(_=e[4])*(R=W*$*c+H*a)+(E=e[8])*(A=H*$*c-W*a),t[1]=f*I+y*R+T*A,t[2]=p*I+v*R+C*A,t[3]=g*I+w*R+S*A,t[4]=h*k+_*L+E*B,t[5]=f*k+y*L+T*B,t[6]=p*k+v*L+C*B,t[7]=g*k+w*L+S*B,t[8]=h*j+_*U+E*G,t[9]=f*j+y*U+T*G,t[10]=p*j+v*U+C*G,t[11]=g*j+w*U+S*G,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},Lt.rotateX=function(t,e,n){var i=Math.sin(n),a=Math.cos(n),l=e[4],c=e[5],h=e[6],f=e[7],p=e[8],g=e[9],_=e[10],y=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=l*a+p*i,t[5]=c*a+g*i,t[6]=h*a+_*i,t[7]=f*a+y*i,t[8]=p*a-l*i,t[9]=g*a-c*i,t[10]=_*a-h*i,t[11]=y*a-f*i,t},Lt.rotateY=function(t,e,n){var i=Math.sin(n),a=Math.cos(n),l=e[0],c=e[1],h=e[2],f=e[3],p=e[8],g=e[9],_=e[10],y=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*a-p*i,t[1]=c*a-g*i,t[2]=h*a-_*i,t[3]=f*a-y*i,t[8]=l*i+p*a,t[9]=c*i+g*a,t[10]=h*i+_*a,t[11]=f*i+y*a,t},Lt.rotateZ=function(t,e,n){var i=Math.sin(n),a=Math.cos(n),l=e[0],c=e[1],h=e[2],f=e[3],p=e[4],g=e[5],_=e[6],y=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*a+p*i,t[1]=c*a+g*i,t[2]=h*a+_*i,t[3]=f*a+y*i,t[4]=p*a-l*i,t[5]=g*a-c*i,t[6]=_*a-h*i,t[7]=y*a-f*i,t},Lt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},Lt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Lt.fromRotation=function(t,e,n){var i,a,l,c=n[0],h=n[1],f=n[2],p=Math.hypot(c,h,f);return p<yr.EPSILON?null:(c*=p=1/p,h*=p,f*=p,i=Math.sin(e),a=Math.cos(e),t[0]=c*c*(l=1-a)+a,t[1]=h*c*l+f*i,t[2]=f*c*l-h*i,t[3]=0,t[4]=c*h*l-f*i,t[5]=h*h*l+a,t[6]=f*h*l+c*i,t[7]=0,t[8]=c*f*l+h*i,t[9]=h*f*l-c*i,t[10]=f*f*l+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},Lt.fromXRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Lt.fromYRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Lt.fromZRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Lt.fromRotationTranslation=sw,Lt.fromQuat2=function(t,e){var n=new yr.ARRAY_TYPE(3),i=-e[0],a=-e[1],l=-e[2],c=e[3],h=e[4],f=e[5],p=e[6],g=e[7],_=i*i+a*a+l*l+c*c;return _>0?(n[0]=2*(h*c+g*i+f*l-p*a)/_,n[1]=2*(f*c+g*a+p*i-h*l)/_,n[2]=2*(p*c+g*l+h*a-f*i)/_):(n[0]=2*(h*c+g*i+f*l-p*a),n[1]=2*(f*c+g*a+p*i-h*l),n[2]=2*(p*c+g*l+h*a-f*i)),sw(t,e,n),t},Lt.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},Lt.getScaling=aw,Lt.getRotation=function(t,e){var n=new yr.ARRAY_TYPE(3);aw(n,e);var i=1/n[0],a=1/n[1],l=1/n[2],c=e[0]*i,h=e[1]*a,f=e[2]*l,p=e[4]*i,g=e[5]*a,_=e[6]*l,y=e[8]*i,v=e[9]*a,w=e[10]*l,E=c+g+w,T=0;return E>0?(T=2*Math.sqrt(E+1),t[3]=.25*T,t[0]=(_-v)/T,t[1]=(y-f)/T,t[2]=(h-p)/T):c>g&&c>w?(T=2*Math.sqrt(1+c-g-w),t[3]=(_-v)/T,t[0]=.25*T,t[1]=(h+p)/T,t[2]=(y+f)/T):g>w?(T=2*Math.sqrt(1+g-c-w),t[3]=(y-f)/T,t[0]=(h+p)/T,t[1]=.25*T,t[2]=(_+v)/T):(T=2*Math.sqrt(1+w-c-g),t[3]=(h-p)/T,t[0]=(y+f)/T,t[1]=(_+v)/T,t[2]=.25*T),t},Lt.fromRotationTranslationScale=function(t,e,n,i){var a=e[0],l=e[1],c=e[2],h=e[3],f=a+a,p=l+l,g=c+c,_=a*f,y=a*p,v=a*g,w=l*p,E=l*g,T=c*g,C=h*f,S=h*p,I=h*g,R=i[0],A=i[1],k=i[2];return t[0]=(1-(w+T))*R,t[1]=(y+I)*R,t[2]=(v-S)*R,t[3]=0,t[4]=(y-I)*A,t[5]=(1-(_+T))*A,t[6]=(E+C)*A,t[7]=0,t[8]=(v+S)*k,t[9]=(E-C)*k,t[10]=(1-(_+w))*k,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},Lt.fromRotationTranslationScaleOrigin=function(t,e,n,i,a){var l=e[0],c=e[1],h=e[2],f=e[3],p=l+l,g=c+c,_=h+h,y=l*p,v=l*g,w=l*_,E=c*g,T=c*_,C=h*_,S=f*p,I=f*g,R=f*_,A=i[0],k=i[1],L=i[2],B=a[0],j=a[1],U=a[2],G=(1-(E+C))*A,$=(v+R)*A,W=(w-I)*A,H=(v-R)*k,J=(1-(y+C))*k,te=(T+S)*k,oe=(w+I)*L,K=(T-S)*L,Q=(1-(y+E))*L;return t[0]=G,t[1]=$,t[2]=W,t[3]=0,t[4]=H,t[5]=J,t[6]=te,t[7]=0,t[8]=oe,t[9]=K,t[10]=Q,t[11]=0,t[12]=n[0]+B-(G*B+H*j+oe*U),t[13]=n[1]+j-($*B+J*j+K*U),t[14]=n[2]+U-(W*B+te*j+Q*U),t[15]=1,t},Lt.fromQuat=function(t,e){var n=e[0],i=e[1],a=e[2],l=e[3],c=n+n,h=i+i,f=a+a,p=n*c,g=i*c,_=i*h,y=a*c,v=a*h,w=a*f,E=l*c,T=l*h,C=l*f;return t[0]=1-_-w,t[1]=g+C,t[2]=y-T,t[3]=0,t[4]=g-C,t[5]=1-p-w,t[6]=v+E,t[7]=0,t[8]=y+T,t[9]=v-E,t[10]=1-p-_,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Lt.frustum=function(t,e,n,i,a,l,c){var h=1/(n-e),f=1/(a-i),p=1/(l-c);return t[0]=2*l*h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*l*f,t[6]=0,t[7]=0,t[8]=(n+e)*h,t[9]=(a+i)*f,t[10]=(c+l)*p,t[11]=-1,t[12]=0,t[13]=0,t[14]=c*l*2*p,t[15]=0,t},Lt.perspectiveNO=lw,Lt.perspectiveZO=function(t,e,n,i,a){var l,c=1/Math.tan(e/2);return t[0]=c/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=a&&a!==1/0?(t[10]=a*(l=1/(i-a)),t[14]=a*i*l):(t[10]=-1,t[14]=-i),t},Lt.perspectiveFromFieldOfView=function(t,e,n,i){var a=Math.tan(e.upDegrees*Math.PI/180),l=Math.tan(e.downDegrees*Math.PI/180),c=Math.tan(e.leftDegrees*Math.PI/180),h=Math.tan(e.rightDegrees*Math.PI/180),f=2/(c+h),p=2/(a+l);return t[0]=f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=-(c-h)*f*.5,t[9]=(a-l)*p*.5,t[10]=i/(n-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*n/(n-i),t[15]=0,t},Lt.orthoNO=wy,Lt.orthoZO=function(t,e,n,i,a,l,c){var h=1/(e-n),f=1/(i-a),p=1/(l-c);return t[0]=-2*h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=p,t[11]=0,t[12]=(e+n)*h,t[13]=(a+i)*f,t[14]=l*p,t[15]=1,t},Lt.lookAt=function(t,e,n,i){var a,l,c,h,f,p,g,_,y,v,w=e[0],E=e[1],T=e[2],C=i[0],S=i[1],I=i[2],R=n[0],A=n[1],k=n[2];return Math.abs(w-R)<yr.EPSILON&&Math.abs(E-A)<yr.EPSILON&&Math.abs(T-k)<yr.EPSILON?iw(t):(g=w-R,_=E-A,y=T-k,a=S*(y*=v=1/Math.hypot(g,_,y))-I*(_*=v),l=I*(g*=v)-C*y,c=C*_-S*g,(v=Math.hypot(a,l,c))?(a*=v=1/v,l*=v,c*=v):(a=0,l=0,c=0),h=_*c-y*l,f=y*a-g*c,p=g*l-_*a,(v=Math.hypot(h,f,p))?(h*=v=1/v,f*=v,p*=v):(h=0,f=0,p=0),t[0]=a,t[1]=h,t[2]=g,t[3]=0,t[4]=l,t[5]=f,t[6]=_,t[7]=0,t[8]=c,t[9]=p,t[10]=y,t[11]=0,t[12]=-(a*w+l*E+c*T),t[13]=-(h*w+f*E+p*T),t[14]=-(g*w+_*E+y*T),t[15]=1,t)},Lt.targetTo=function(t,e,n,i){var a=e[0],l=e[1],c=e[2],h=i[0],f=i[1],p=i[2],g=a-n[0],_=l-n[1],y=c-n[2],v=g*g+_*_+y*y;v>0&&(g*=v=1/Math.sqrt(v),_*=v,y*=v);var w=f*y-p*_,E=p*g-h*y,T=h*_-f*g;return(v=w*w+E*E+T*T)>0&&(w*=v=1/Math.sqrt(v),E*=v,T*=v),t[0]=w,t[1]=E,t[2]=T,t[3]=0,t[4]=_*T-y*E,t[5]=y*w-g*T,t[6]=g*E-_*w,t[7]=0,t[8]=g,t[9]=_,t[10]=y,t[11]=0,t[12]=a,t[13]=l,t[14]=c,t[15]=1,t},Lt.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},Lt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},Lt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},Lt.subtract=Rm,Lt.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},Lt.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t[6]=e[6]+n[6]*i,t[7]=e[7]+n[7]*i,t[8]=e[8]+n[8]*i,t[9]=e[9]+n[9]*i,t[10]=e[10]+n[10]*i,t[11]=e[11]+n[11]*i,t[12]=e[12]+n[12]*i,t[13]=e[13]+n[13]*i,t[14]=e[14]+n[14]*i,t[15]=e[15]+n[15]*i,t},Lt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},Lt.equals=function(t,e){var n=t[0],i=t[1],a=t[2],l=t[3],c=t[4],h=t[5],f=t[6],p=t[7],g=t[8],_=t[9],y=t[10],v=t[11],w=t[12],E=t[13],T=t[14],C=t[15],S=e[0],I=e[1],R=e[2],A=e[3],k=e[4],L=e[5],B=e[6],j=e[7],U=e[8],G=e[9],$=e[10],W=e[11],H=e[12],J=e[13],te=e[14],oe=e[15];return Math.abs(n-S)<=yr.EPSILON*Math.max(1,Math.abs(n),Math.abs(S))&&Math.abs(i-I)<=yr.EPSILON*Math.max(1,Math.abs(i),Math.abs(I))&&Math.abs(a-R)<=yr.EPSILON*Math.max(1,Math.abs(a),Math.abs(R))&&Math.abs(l-A)<=yr.EPSILON*Math.max(1,Math.abs(l),Math.abs(A))&&Math.abs(c-k)<=yr.EPSILON*Math.max(1,Math.abs(c),Math.abs(k))&&Math.abs(h-L)<=yr.EPSILON*Math.max(1,Math.abs(h),Math.abs(L))&&Math.abs(f-B)<=yr.EPSILON*Math.max(1,Math.abs(f),Math.abs(B))&&Math.abs(p-j)<=yr.EPSILON*Math.max(1,Math.abs(p),Math.abs(j))&&Math.abs(g-U)<=yr.EPSILON*Math.max(1,Math.abs(g),Math.abs(U))&&Math.abs(_-G)<=yr.EPSILON*Math.max(1,Math.abs(_),Math.abs(G))&&Math.abs(y-$)<=yr.EPSILON*Math.max(1,Math.abs(y),Math.abs($))&&Math.abs(v-W)<=yr.EPSILON*Math.max(1,Math.abs(v),Math.abs(W))&&Math.abs(w-H)<=yr.EPSILON*Math.max(1,Math.abs(w),Math.abs(H))&&Math.abs(E-J)<=yr.EPSILON*Math.max(1,Math.abs(E),Math.abs(J))&&Math.abs(T-te)<=yr.EPSILON*Math.max(1,Math.abs(T),Math.abs(te))&&Math.abs(C-oe)<=yr.EPSILON*Math.max(1,Math.abs(C),Math.abs(oe))},Lt.sub=Lt.mul=Lt.ortho=Lt.perspective=void 0;var yr=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==xy(t)&&"function"!=typeof t)return{default:t};var n=rw(void 0);if(n&&n.has(t))return n.get(t);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if("default"!==l&&Object.prototype.hasOwnProperty.call(t,l)){var c=a?Object.getOwnPropertyDescriptor(t,l):null;c&&(c.get||c.set)?Object.defineProperty(i,l,c):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}(ui);function rw(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(rw=function(i){return i?n:e})(t)}function iw(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ow(t,e,n){var i=e[0],a=e[1],l=e[2],c=e[3],h=e[4],f=e[5],p=e[6],g=e[7],_=e[8],y=e[9],v=e[10],w=e[11],E=e[12],T=e[13],C=e[14],S=e[15],I=n[0],R=n[1],A=n[2],k=n[3];return t[0]=I*i+R*h+A*_+k*E,t[1]=I*a+R*f+A*y+k*T,t[2]=I*l+R*p+A*v+k*C,t[3]=I*c+R*g+A*w+k*S,t[4]=(I=n[4])*i+(R=n[5])*h+(A=n[6])*_+(k=n[7])*E,t[5]=I*a+R*f+A*y+k*T,t[6]=I*l+R*p+A*v+k*C,t[7]=I*c+R*g+A*w+k*S,t[8]=(I=n[8])*i+(R=n[9])*h+(A=n[10])*_+(k=n[11])*E,t[9]=I*a+R*f+A*y+k*T,t[10]=I*l+R*p+A*v+k*C,t[11]=I*c+R*g+A*w+k*S,t[12]=(I=n[12])*i+(R=n[13])*h+(A=n[14])*_+(k=n[15])*E,t[13]=I*a+R*f+A*y+k*T,t[14]=I*l+R*p+A*v+k*C,t[15]=I*c+R*g+A*w+k*S,t}function sw(t,e,n){var i=e[0],a=e[1],l=e[2],c=e[3],h=i+i,f=a+a,p=l+l,g=i*h,_=i*f,y=i*p,v=a*f,w=a*p,E=l*p,T=c*h,C=c*f,S=c*p;return t[0]=1-(v+E),t[1]=_+S,t[2]=y-C,t[3]=0,t[4]=_-S,t[5]=1-(g+E),t[6]=w+T,t[7]=0,t[8]=y+C,t[9]=w-T,t[10]=1-(g+v),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function aw(t,e){var n=e[4],i=e[5],a=e[6],l=e[8],c=e[9],h=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(n,i,a),t[2]=Math.hypot(l,c,h),t}function lw(t,e,n,i,a){var l,c=1/Math.tan(e/2);return t[0]=c/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=a&&a!==1/0?(t[10]=(a+i)*(l=1/(i-a)),t[14]=2*a*i*l):(t[10]=-1,t[14]=-2*i),t}function wy(t,e,n,i,a,l,c){var h=1/(e-n),f=1/(i-a),p=1/(l-c);return t[0]=-2*h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*p,t[11]=0,t[12]=(e+n)*h,t[13]=(a+i)*f,t[14]=(c+l)*p,t[15]=1,t}function Rm(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}Lt.perspective=lw,Lt.ortho=wy,Lt.mul=ow,Lt.sub=Rm;var St={},Pt={};function by(t){return(by="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.create=Cy,Pt.clone=function(t){var e=new Il.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Pt.length=bc,Pt.fromValues=function(t,e,n){var i=new Il.ARRAY_TYPE(3);return i[0]=t,i[1]=e,i[2]=n,i},Pt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Pt.set=function(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t},Pt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},Pt.subtract=Ty,Pt.multiply=Dy,Pt.divide=cw,Pt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},Pt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},Pt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},Pt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},Pt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},Pt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},Pt.scaleAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t},Pt.distance=bD,Pt.squaredDistance=Ef,Pt.squaredLength=uw,Pt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},Pt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},Pt.normalize=function(t,e){var n=e[0],i=e[1],a=e[2],l=n*n+i*i+a*a;return l>0&&(l=1/Math.sqrt(l)),t[0]=e[0]*l,t[1]=e[1]*l,t[2]=e[2]*l,t},Pt.dot=My,Pt.cross=function(t,e,n){var i=e[0],a=e[1],l=e[2],c=n[0],h=n[1],f=n[2];return t[0]=a*f-l*h,t[1]=l*c-i*f,t[2]=i*h-a*c,t},Pt.lerp=function(t,e,n,i){var a=e[0],l=e[1],c=e[2];return t[0]=a+i*(n[0]-a),t[1]=l+i*(n[1]-l),t[2]=c+i*(n[2]-c),t},Pt.hermite=function(t,e,n,i,a,l){var c=l*l,h=c*(2*l-3)+1,f=c*(l-2)+l,p=c*(l-1),g=c*(3-2*l);return t[0]=e[0]*h+n[0]*f+i[0]*p+a[0]*g,t[1]=e[1]*h+n[1]*f+i[1]*p+a[1]*g,t[2]=e[2]*h+n[2]*f+i[2]*p+a[2]*g,t},Pt.bezier=function(t,e,n,i,a,l){var c=1-l,h=c*c,f=l*l,p=h*c,g=3*l*h,_=3*f*c,y=f*l;return t[0]=e[0]*p+n[0]*g+i[0]*_+a[0]*y,t[1]=e[1]*p+n[1]*g+i[1]*_+a[1]*y,t[2]=e[2]*p+n[2]*g+i[2]*_+a[2]*y,t},Pt.random=function(t,e){e=e||1;var n=2*Il.RANDOM()*Math.PI,i=2*Il.RANDOM()-1,a=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(n)*a,t[1]=Math.sin(n)*a,t[2]=i*e,t},Pt.transformMat4=function(t,e,n){var i=e[0],a=e[1],l=e[2],c=n[3]*i+n[7]*a+n[11]*l+n[15];return t[0]=(n[0]*i+n[4]*a+n[8]*l+n[12])/(c=c||1),t[1]=(n[1]*i+n[5]*a+n[9]*l+n[13])/c,t[2]=(n[2]*i+n[6]*a+n[10]*l+n[14])/c,t},Pt.transformMat3=function(t,e,n){var i=e[0],a=e[1],l=e[2];return t[0]=i*n[0]+a*n[3]+l*n[6],t[1]=i*n[1]+a*n[4]+l*n[7],t[2]=i*n[2]+a*n[5]+l*n[8],t},Pt.transformQuat=function(t,e,n){var i=n[0],a=n[1],l=n[2],c=e[0],h=e[1],f=e[2],p=a*f-l*h,g=l*c-i*f,_=i*h-a*c,y=a*_-l*g,v=l*p-i*_,w=i*g-a*p,E=2*n[3];return g*=E,_*=E,v*=2,w*=2,t[0]=c+(p*=E)+(y*=2),t[1]=h+g+v,t[2]=f+_+w,t},Pt.rotateX=function(t,e,n,i){var a=[],l=[];return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a[2]=e[2]-n[2],l[0]=a[0],l[1]=a[1]*Math.cos(i)-a[2]*Math.sin(i),l[2]=a[1]*Math.sin(i)+a[2]*Math.cos(i),t[0]=l[0]+n[0],t[1]=l[1]+n[1],t[2]=l[2]+n[2],t},Pt.rotateY=function(t,e,n,i){var a=[],l=[];return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a[2]=e[2]-n[2],l[0]=a[2]*Math.sin(i)+a[0]*Math.cos(i),l[1]=a[1],l[2]=a[2]*Math.cos(i)-a[0]*Math.sin(i),t[0]=l[0]+n[0],t[1]=l[1]+n[1],t[2]=l[2]+n[2],t},Pt.rotateZ=function(t,e,n,i){var a=[],l=[];return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a[2]=e[2]-n[2],l[0]=a[0]*Math.cos(i)-a[1]*Math.sin(i),l[1]=a[0]*Math.sin(i)+a[1]*Math.cos(i),l[2]=a[2],t[0]=l[0]+n[0],t[1]=l[1]+n[1],t[2]=l[2]+n[2],t},Pt.angle=function(t,e){var n=t[0],i=t[1],a=t[2],l=e[0],c=e[1],h=e[2],f=Math.sqrt(n*n+i*i+a*a)*Math.sqrt(l*l+c*c+h*h),p=f&&My(t,e)/f;return Math.acos(Math.min(Math.max(p,-1),1))},Pt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},Pt.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},Pt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},Pt.equals=function(t,e){var n=t[0],i=t[1],a=t[2],l=e[0],c=e[1],h=e[2];return Math.abs(n-l)<=Il.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-c)<=Il.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(a-h)<=Il.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))},Pt.forEach=Pt.sqrLen=Pt.len=Pt.sqrDist=Pt.dist=Pt.div=Pt.mul=Pt.sub=void 0;var Il=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==by(t)&&"function"!=typeof t)return{default:t};var n=Ey(void 0);if(n&&n.has(t))return n.get(t);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if("default"!==l&&Object.prototype.hasOwnProperty.call(t,l)){var c=a?Object.getOwnPropertyDescriptor(t,l):null;c&&(c.get||c.set)?Object.defineProperty(i,l,c):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}(ui);function Ey(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(Ey=function(i){return i?n:e})(t)}function Cy(){var t=new Il.ARRAY_TYPE(3);return Il.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function bc(t){return Math.hypot(t[0],t[1],t[2])}function Ty(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Dy(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function cw(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function bD(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function Ef(t,e){var n=e[0]-t[0],i=e[1]-t[1],a=e[2]-t[2];return n*n+i*i+a*a}function uw(t){var e=t[0],n=t[1],i=t[2];return e*e+n*n+i*i}function My(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Pt.sub=Ty,Pt.mul=Dy,Pt.div=cw,Pt.dist=bD,Pt.sqrDist=Ef,Pt.len=bc,Pt.sqrLen=uw;var Wa,hw=(Wa=Cy(),function(t,e,n,i,a,l){var c,h;for(e||(e=3),n||(n=0),h=i?Math.min(i*e+n,t.length):t.length,c=n;c<h;c+=e)Wa[0]=t[c],Wa[1]=t[c+1],Wa[2]=t[c+2],a(Wa,Wa,l),t[c]=Wa[0],t[c+1]=Wa[1],t[c+2]=Wa[2];return t});Pt.forEach=hw;var Gt={};function km(t){return(km="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.create=Sy,Gt.clone=function(t){var e=new Do.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Gt.fromValues=function(t,e,n,i){var a=new Do.ARRAY_TYPE(4);return a[0]=t,a[1]=e,a[2]=n,a[3]=i,a},Gt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Gt.set=function(t,e,n,i,a){return t[0]=e,t[1]=n,t[2]=i,t[3]=a,t},Gt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Gt.subtract=Om,Gt.multiply=Lm,Gt.divide=Fm,Gt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},Gt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},Gt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},Gt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},Gt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},Gt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Gt.scaleAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t},Gt.distance=Ah,Gt.squaredDistance=dw,Gt.length=Ay,Gt.squaredLength=fw,Gt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Gt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},Gt.normalize=function(t,e){var n=e[0],i=e[1],a=e[2],l=e[3],c=n*n+i*i+a*a+l*l;return c>0&&(c=1/Math.sqrt(c)),t[0]=n*c,t[1]=i*c,t[2]=a*c,t[3]=l*c,t},Gt.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Gt.cross=function(t,e,n,i){var a=n[0]*i[1]-n[1]*i[0],l=n[0]*i[2]-n[2]*i[0],c=n[0]*i[3]-n[3]*i[0],h=n[1]*i[2]-n[2]*i[1],f=n[1]*i[3]-n[3]*i[1],p=n[2]*i[3]-n[3]*i[2],g=e[0],_=e[1],y=e[2],v=e[3];return t[0]=_*p-y*f+v*h,t[1]=-g*p+y*c-v*l,t[2]=g*f-_*c+v*a,t[3]=-g*h+_*l-y*a,t},Gt.lerp=function(t,e,n,i){var a=e[0],l=e[1],c=e[2],h=e[3];return t[0]=a+i*(n[0]-a),t[1]=l+i*(n[1]-l),t[2]=c+i*(n[2]-c),t[3]=h+i*(n[3]-h),t},Gt.random=function(t,e){var n,i,a,l,c,h;e=e||1;do{c=(n=2*Do.RANDOM()-1)*n+(i=2*Do.RANDOM()-1)*i}while(c>=1);do{h=(a=2*Do.RANDOM()-1)*a+(l=2*Do.RANDOM()-1)*l}while(h>=1);var f=Math.sqrt((1-c)/h);return t[0]=e*n,t[1]=e*i,t[2]=e*a*f,t[3]=e*l*f,t},Gt.transformMat4=function(t,e,n){var i=e[0],a=e[1],l=e[2],c=e[3];return t[0]=n[0]*i+n[4]*a+n[8]*l+n[12]*c,t[1]=n[1]*i+n[5]*a+n[9]*l+n[13]*c,t[2]=n[2]*i+n[6]*a+n[10]*l+n[14]*c,t[3]=n[3]*i+n[7]*a+n[11]*l+n[15]*c,t},Gt.transformQuat=function(t,e,n){var i=e[0],a=e[1],l=e[2],c=n[0],h=n[1],f=n[2],p=n[3],g=p*i+h*l-f*a,_=p*a+f*i-c*l,y=p*l+c*a-h*i,v=-c*i-h*a-f*l;return t[0]=g*p+v*-c+_*-f-y*-h,t[1]=_*p+v*-h+y*-c-g*-f,t[2]=y*p+v*-f+g*-h-_*-c,t[3]=e[3],t},Gt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},Gt.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Gt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Gt.equals=function(t,e){var n=t[0],i=t[1],a=t[2],l=t[3],c=e[0],h=e[1],f=e[2],p=e[3];return Math.abs(n-c)<=Do.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(i-h)<=Do.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(a-f)<=Do.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(l-p)<=Do.EPSILON*Math.max(1,Math.abs(l),Math.abs(p))},Gt.forEach=Gt.sqrLen=Gt.len=Gt.sqrDist=Gt.dist=Gt.div=Gt.mul=Gt.sub=void 0;var Do=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==km(t)&&"function"!=typeof t)return{default:t};var n=Cf(void 0);if(n&&n.has(t))return n.get(t);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if("default"!==l&&Object.prototype.hasOwnProperty.call(t,l)){var c=a?Object.getOwnPropertyDescriptor(t,l):null;c&&(c.get||c.set)?Object.defineProperty(i,l,c):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}(ui);function Cf(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(Cf=function(i){return i?n:e})(t)}function Sy(){var t=new Do.ARRAY_TYPE(4);return Do.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Om(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function Lm(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function Fm(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function Ah(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function dw(t,e){var n=e[0]-t[0],i=e[1]-t[1],a=e[2]-t[2],l=e[3]-t[3];return n*n+i*i+a*a+l*l}function Ay(t){return Math.hypot(t[0],t[1],t[2],t[3])}function fw(t){var e=t[0],n=t[1],i=t[2],a=t[3];return e*e+n*n+i*i+a*a}Gt.sub=Om,Gt.mul=Lm,Gt.div=Fm,Gt.dist=Ah,Gt.sqrDist=dw,Gt.len=Ay,Gt.sqrLen=fw;var ED=function(){var t=Sy();return function(e,n,i,a,l,c){var h,f;for(n||(n=4),i||(i=0),f=a?Math.min(a*n+i,e.length):e.length,h=i;h<f;h+=n)t[0]=e[h],t[1]=e[h+1],t[2]=e[h+2],t[3]=e[h+3],l(t,t,c),e[h]=t[0],e[h+1]=t[1],e[h+2]=t[2],e[h+3]=t[3];return e}}();function Nm(t){return(Nm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Gt.forEach=ED,Object.defineProperty(St,"__esModule",{value:!0}),St.create=mw,St.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},St.setAxisAngle=gw,St.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),i=Math.sin(n/2);return i>Pl.EPSILON?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),n},St.getAngle=function(t,e){var n=Ry(t,e);return Math.acos(2*n*n-1)},St.multiply=Vm,St.rotateX=function(t,e,n){n*=.5;var i=e[0],a=e[1],l=e[2],c=e[3],h=Math.sin(n),f=Math.cos(n);return t[0]=i*f+c*h,t[1]=a*f+l*h,t[2]=l*f-a*h,t[3]=c*f-i*h,t},St.rotateY=function(t,e,n){n*=.5;var i=e[0],a=e[1],l=e[2],c=e[3],h=Math.sin(n),f=Math.cos(n);return t[0]=i*f-l*h,t[1]=a*f+c*h,t[2]=l*f+i*h,t[3]=c*f-a*h,t},St.rotateZ=function(t,e,n){n*=.5;var i=e[0],a=e[1],l=e[2],c=e[3],h=Math.sin(n),f=Math.cos(n);return t[0]=i*f+a*h,t[1]=a*f-i*h,t[2]=l*f+c*h,t[3]=c*f-l*h,t},St.calculateW=function(t,e){var n=e[0],i=e[1],a=e[2];return t[0]=n,t[1]=i,t[2]=a,t[3]=Math.sqrt(Math.abs(1-n*n-i*i-a*a)),t},St.exp=_w,St.ln=Iy,St.pow=function(t,e,n){return Iy(t,e),Py(t,t,n),_w(t,t),t},St.slerp=Cu,St.random=function(t){var e=Pl.RANDOM(),n=Pl.RANDOM(),i=Pl.RANDOM(),a=Math.sqrt(1-e),l=Math.sqrt(e);return t[0]=a*Math.sin(2*Math.PI*n),t[1]=a*Math.cos(2*Math.PI*n),t[2]=l*Math.sin(2*Math.PI*i),t[3]=l*Math.cos(2*Math.PI*i),t},St.invert=function(t,e){var n=e[0],i=e[1],a=e[2],l=e[3],c=n*n+i*i+a*a+l*l,h=c?1/c:0;return t[0]=-n*h,t[1]=-i*h,t[2]=-a*h,t[3]=l*h,t},St.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},St.fromMat3=jm,St.fromEuler=function(t,e,n,i){var a=.5*Math.PI/180;e*=a,n*=a,i*=a;var l=Math.sin(e),c=Math.cos(e),h=Math.sin(n),f=Math.cos(n),p=Math.sin(i),g=Math.cos(i);return t[0]=l*f*g-c*h*p,t[1]=c*h*g+l*f*p,t[2]=c*f*p-l*h*g,t[3]=c*f*g+l*h*p,t},St.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},St.setAxes=St.sqlerp=St.rotationTo=St.equals=St.exactEquals=St.normalize=St.sqrLen=St.squaredLength=St.len=St.length=St.lerp=St.dot=St.scale=St.mul=St.add=St.set=St.copy=St.fromValues=St.clone=void 0;var Pl=Bm(ui),zm=Bm(An),la=Bm(Pt),Di=Bm(Gt);function pw(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(pw=function(i){return i?n:e})(t)}function Bm(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==Nm(t)&&"function"!=typeof t)return{default:t};var n=pw(e);if(n&&n.has(t))return n.get(t);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if("default"!==l&&Object.prototype.hasOwnProperty.call(t,l)){var c=a?Object.getOwnPropertyDescriptor(t,l):null;c&&(c.get||c.set)?Object.defineProperty(i,l,c):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}function mw(){var t=new Pl.ARRAY_TYPE(4);return Pl.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function gw(t,e,n){n*=.5;var i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function Vm(t,e,n){var i=e[0],a=e[1],l=e[2],c=e[3],h=n[0],f=n[1],p=n[2],g=n[3];return t[0]=i*g+c*h+a*p-l*f,t[1]=a*g+c*f+l*h-i*p,t[2]=l*g+c*p+i*f-a*h,t[3]=c*g-i*h-a*f-l*p,t}function _w(t,e){var n=e[0],i=e[1],a=e[2],l=e[3],c=Math.sqrt(n*n+i*i+a*a),h=Math.exp(l),f=c>0?h*Math.sin(c)/c:0;return t[0]=n*f,t[1]=i*f,t[2]=a*f,t[3]=h*Math.cos(c),t}function Iy(t,e){var n=e[0],i=e[1],a=e[2],l=e[3],c=Math.sqrt(n*n+i*i+a*a),h=c>0?Math.atan2(c,l)/c:0;return t[0]=n*h,t[1]=i*h,t[2]=a*h,t[3]=.5*Math.log(n*n+i*i+a*a+l*l),t}function Cu(t,e,n,i){var a,l,c,h,f,p=e[0],g=e[1],_=e[2],y=e[3],v=n[0],w=n[1],E=n[2],T=n[3];return(l=p*v+g*w+_*E+y*T)<0&&(l=-l,v=-v,w=-w,E=-E,T=-T),1-l>Pl.EPSILON?(a=Math.acos(l),c=Math.sin(a),h=Math.sin((1-i)*a)/c,f=Math.sin(i*a)/c):(h=1-i,f=i),t[0]=h*p+f*v,t[1]=h*g+f*w,t[2]=h*_+f*E,t[3]=h*y+f*T,t}function jm(t,e){var n,i=e[0]+e[4]+e[8];if(i>0)n=Math.sqrt(i+1),t[3]=.5*n,t[0]=(e[5]-e[7])*(n=.5/n),t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var a=0;e[4]>e[0]&&(a=1),e[8]>e[3*a+a]&&(a=2);var l=(a+1)%3,c=(a+2)%3;n=Math.sqrt(e[3*a+a]-e[3*l+l]-e[3*c+c]+1),t[a]=.5*n,t[3]=(e[3*l+c]-e[3*c+l])*(n=.5/n),t[l]=(e[3*l+a]+e[3*a+l])*n,t[c]=(e[3*c+a]+e[3*a+c])*n}return t}St.clone=Di.clone,St.fromValues=Di.fromValues,St.copy=Di.copy,St.set=Di.set,St.add=Di.add,St.mul=Vm;var Py=Di.scale;St.scale=Py;var Ry=Di.dot;St.dot=Ry,St.lerp=Di.lerp;var ky=Di.length;St.length=ky,St.len=ky;var Oy=Di.squaredLength;St.squaredLength=Oy,St.sqrLen=Oy;var Ly=Di.normalize;St.normalize=Ly,St.exactEquals=Di.exactEquals,St.equals=Di.equals;var ca,yw,vw,CD=(ca=la.create(),yw=la.fromValues(1,0,0),vw=la.fromValues(0,1,0),function(t,e,n){var i=la.dot(e,n);return i<-.999999?(la.cross(ca,yw,e),la.len(ca)<1e-6&&la.cross(ca,vw,e),la.normalize(ca,ca),gw(t,ca,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(la.cross(ca,e,n),t[0]=ca[0],t[1]=ca[1],t[2]=ca[2],t[3]=1+i,Ly(t,t))});St.rotationTo=CD;var Za,Tu,TD=(Za=mw(),Tu=mw(),function(t,e,n,i,a,l){return Cu(Za,e,a,l),Cu(Tu,n,i,l),Cu(t,Za,Tu,2*l*(1-l)),t});St.sqlerp=TD;var Xa,iI=(Xa=zm.create(),function(t,e,n,i){return Xa[0]=n[0],Xa[3]=n[1],Xa[6]=n[2],Xa[1]=i[0],Xa[4]=i[1],Xa[7]=i[2],Xa[2]=-e[0],Xa[5]=-e[1],Xa[8]=-e[2],Ly(t,jm(t,Xa))});St.setAxes=iI;var sn={};function xw(t){return(xw="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(sn,"__esModule",{value:!0}),sn.create=function(){var t=new Ho.ARRAY_TYPE(8);return Ho.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},sn.clone=function(t){var e=new Ho.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},sn.fromValues=function(t,e,n,i,a,l,c,h){var f=new Ho.ARRAY_TYPE(8);return f[0]=t,f[1]=e,f[2]=n,f[3]=i,f[4]=a,f[5]=l,f[6]=c,f[7]=h,f},sn.fromRotationTranslationValues=function(t,e,n,i,a,l,c){var h=new Ho.ARRAY_TYPE(8);h[0]=t,h[1]=e,h[2]=n,h[3]=i;var f=.5*a,p=.5*l,g=.5*c;return h[4]=f*i+p*n-g*e,h[5]=p*i+g*t-f*n,h[6]=g*i+f*e-p*t,h[7]=-f*t-p*e-g*n,h},sn.fromRotationTranslation=Ew,sn.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},sn.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},sn.fromMat4=function(t,e){var n=Ya.create();ww.getRotation(n,e);var i=new Ho.ARRAY_TYPE(3);return ww.getTranslation(i,e),Ew(t,n,i),t},sn.copy=Um,sn.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},sn.set=function(t,e,n,i,a,l,c,h,f){return t[0]=e,t[1]=n,t[2]=i,t[3]=a,t[4]=l,t[5]=c,t[6]=h,t[7]=f,t},sn.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},sn.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},sn.getTranslation=function(t,e){var n=e[4],i=e[5],a=e[6],l=e[7],c=-e[0],h=-e[1],f=-e[2],p=e[3];return t[0]=2*(n*p+l*c+i*f-a*h),t[1]=2*(i*p+l*h+a*c-n*f),t[2]=2*(a*p+l*f+n*h-i*c),t},sn.translate=function(t,e,n){var i=e[0],a=e[1],l=e[2],c=e[3],h=.5*n[0],f=.5*n[1],p=.5*n[2],g=e[4],_=e[5],y=e[6],v=e[7];return t[0]=i,t[1]=a,t[2]=l,t[3]=c,t[4]=c*h+a*p-l*f+g,t[5]=c*f+l*h-i*p+_,t[6]=c*p+i*f-a*h+y,t[7]=-i*h-a*f-l*p+v,t},sn.rotateX=function(t,e,n){var i=-e[0],a=-e[1],l=-e[2],c=e[3],h=e[4],f=e[5],p=e[6],g=e[7],_=h*c+g*i+f*l-p*a,y=f*c+g*a+p*i-h*l,v=p*c+g*l+h*a-f*i,w=g*c-h*i-f*a-p*l;return Ya.rotateX(t,e,n),t[4]=_*(c=t[3])+w*(i=t[0])+y*(l=t[2])-v*(a=t[1]),t[5]=y*c+w*a+v*i-_*l,t[6]=v*c+w*l+_*a-y*i,t[7]=w*c-_*i-y*a-v*l,t},sn.rotateY=function(t,e,n){var i=-e[0],a=-e[1],l=-e[2],c=e[3],h=e[4],f=e[5],p=e[6],g=e[7],_=h*c+g*i+f*l-p*a,y=f*c+g*a+p*i-h*l,v=p*c+g*l+h*a-f*i,w=g*c-h*i-f*a-p*l;return Ya.rotateY(t,e,n),t[4]=_*(c=t[3])+w*(i=t[0])+y*(l=t[2])-v*(a=t[1]),t[5]=y*c+w*a+v*i-_*l,t[6]=v*c+w*l+_*a-y*i,t[7]=w*c-_*i-y*a-v*l,t},sn.rotateZ=function(t,e,n){var i=-e[0],a=-e[1],l=-e[2],c=e[3],h=e[4],f=e[5],p=e[6],g=e[7],_=h*c+g*i+f*l-p*a,y=f*c+g*a+p*i-h*l,v=p*c+g*l+h*a-f*i,w=g*c-h*i-f*a-p*l;return Ya.rotateZ(t,e,n),t[4]=_*(c=t[3])+w*(i=t[0])+y*(l=t[2])-v*(a=t[1]),t[5]=y*c+w*a+v*i-_*l,t[6]=v*c+w*l+_*a-y*i,t[7]=w*c-_*i-y*a-v*l,t},sn.rotateByQuatAppend=function(t,e,n){var i=n[0],a=n[1],l=n[2],c=n[3],h=e[0],f=e[1],p=e[2],g=e[3];return t[0]=h*c+g*i+f*l-p*a,t[1]=f*c+g*a+p*i-h*l,t[2]=p*c+g*l+h*a-f*i,t[3]=g*c-h*i-f*a-p*l,t[4]=(h=e[4])*c+(g=e[7])*i+(f=e[5])*l-(p=e[6])*a,t[5]=f*c+g*a+p*i-h*l,t[6]=p*c+g*l+h*a-f*i,t[7]=g*c-h*i-f*a-p*l,t},sn.rotateByQuatPrepend=function(t,e,n){var i=e[0],a=e[1],l=e[2],c=e[3],h=n[0],f=n[1],p=n[2],g=n[3];return t[0]=i*g+c*h+a*p-l*f,t[1]=a*g+c*f+l*h-i*p,t[2]=l*g+c*p+i*f-a*h,t[3]=c*g-i*h-a*f-l*p,t[4]=i*(g=n[7])+c*(h=n[4])+a*(p=n[6])-l*(f=n[5]),t[5]=a*g+c*f+l*h-i*p,t[6]=l*g+c*p+i*f-a*h,t[7]=c*g-i*h-a*f-l*p,t},sn.rotateAroundAxis=function(t,e,n,i){if(Math.abs(i)<Ho.EPSILON)return Um(t,e);var a=Math.hypot(n[0],n[1],n[2]);i*=.5;var l=Math.sin(i),c=l*n[0]/a,h=l*n[1]/a,f=l*n[2]/a,p=Math.cos(i),g=e[0],_=e[1],y=e[2],v=e[3];t[0]=g*p+v*c+_*f-y*h,t[1]=_*p+v*h+y*c-g*f,t[2]=y*p+v*f+g*h-_*c,t[3]=v*p-g*c-_*h-y*f;var w=e[4],E=e[5],T=e[6],C=e[7];return t[4]=w*p+C*c+E*f-T*h,t[5]=E*p+C*h+T*c-w*f,t[6]=T*p+C*f+w*h-E*c,t[7]=C*p-w*c-E*h-T*f,t},sn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t},sn.multiply=Ka,sn.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t},sn.lerp=function(t,e,n,i){var a=1-i;return Ih(e,n)<0&&(i=-i),t[0]=e[0]*a+n[0]*i,t[1]=e[1]*a+n[1]*i,t[2]=e[2]*a+n[2]*i,t[3]=e[3]*a+n[3]*i,t[4]=e[4]*a+n[4]*i,t[5]=e[5]*a+n[5]*i,t[6]=e[6]*a+n[6]*i,t[7]=e[7]*a+n[7]*i,t},sn.invert=function(t,e){var n=Tf(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t},sn.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},sn.normalize=function(t,e){var n=Tf(e);if(n>0){n=Math.sqrt(n);var i=e[0]/n,a=e[1]/n,l=e[2]/n,c=e[3]/n,h=e[4],f=e[5],p=e[6],g=e[7],_=i*h+a*f+l*p+c*g;t[0]=i,t[1]=a,t[2]=l,t[3]=c,t[4]=(h-i*_)/n,t[5]=(f-a*_)/n,t[6]=(p-l*_)/n,t[7]=(g-c*_)/n}return t},sn.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},sn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},sn.equals=function(t,e){var n=t[0],i=t[1],a=t[2],l=t[3],c=t[4],h=t[5],f=t[6],p=t[7],g=e[0],_=e[1],y=e[2],v=e[3],w=e[4],E=e[5],T=e[6],C=e[7];return Math.abs(n-g)<=Ho.EPSILON*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(i-_)<=Ho.EPSILON*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(a-y)<=Ho.EPSILON*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(l-v)<=Ho.EPSILON*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(c-w)<=Ho.EPSILON*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(h-E)<=Ho.EPSILON*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(f-T)<=Ho.EPSILON*Math.max(1,Math.abs(f),Math.abs(T))&&Math.abs(p-C)<=Ho.EPSILON*Math.max(1,Math.abs(p),Math.abs(C))},sn.sqrLen=sn.squaredLength=sn.len=sn.length=sn.dot=sn.mul=sn.setReal=sn.getReal=void 0;var Ho=Fy(ui),Ya=Fy(St),ww=Fy(Lt);function bw(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(bw=function(i){return i?n:e})(t)}function Fy(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==xw(t)&&"function"!=typeof t)return{default:t};var n=bw(e);if(n&&n.has(t))return n.get(t);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if("default"!==l&&Object.prototype.hasOwnProperty.call(t,l)){var c=a?Object.getOwnPropertyDescriptor(t,l):null;c&&(c.get||c.set)?Object.defineProperty(i,l,c):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}function Ew(t,e,n){var i=.5*n[0],a=.5*n[1],l=.5*n[2],c=e[0],h=e[1],f=e[2],p=e[3];return t[0]=c,t[1]=h,t[2]=f,t[3]=p,t[4]=i*p+a*f-l*h,t[5]=a*p+l*c-i*f,t[6]=l*p+i*h-a*c,t[7]=-i*c-a*h-l*f,t}function Um(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function Ka(t,e,n){var i=e[0],a=e[1],l=e[2],c=e[3],h=n[4],f=n[5],p=n[6],g=n[7],_=e[4],y=e[5],v=e[6],w=e[7],E=n[0],T=n[1],C=n[2],S=n[3];return t[0]=i*S+c*E+a*C-l*T,t[1]=a*S+c*T+l*E-i*C,t[2]=l*S+c*C+i*T-a*E,t[3]=c*S-i*E-a*T-l*C,t[4]=i*g+c*h+a*p-l*f+_*S+w*E+y*C-v*T,t[5]=a*g+c*f+l*h-i*p+y*S+w*T+v*E-_*C,t[6]=l*g+c*p+i*f-a*h+v*S+w*C+_*T-y*E,t[7]=c*g-i*h-a*f-l*p+w*S-_*E-y*T-v*C,t}sn.getReal=Ya.copy,sn.setReal=Ya.copy,sn.mul=Ka;var Ih=Ya.dot;sn.dot=Ih;var Ny=Ya.length;sn.length=Ny,sn.len=Ny;var Tf=Ya.squaredLength;sn.squaredLength=Tf,sn.sqrLen=Tf;var Vt={};function Cw(t){return(Cw="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.create=$m,Vt.clone=function(t){var e=new Ph.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},Vt.fromValues=function(t,e){var n=new Ph.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},Vt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},Vt.set=function(t,e,n){return t[0]=e,t[1]=n,t},Vt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},Vt.subtract=Hm,Vt.multiply=MD,Vt.divide=SD,Vt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},Vt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},Vt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},Vt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},Vt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},Vt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},Vt.scaleAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t},Vt.distance=zy,Vt.squaredDistance=Tw,Vt.length=Dw,Vt.squaredLength=Mw,Vt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},Vt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},Vt.normalize=function(t,e){var n=e[0],i=e[1],a=n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t},Vt.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},Vt.cross=function(t,e,n){var i=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=i,t},Vt.lerp=function(t,e,n,i){var a=e[0],l=e[1];return t[0]=a+i*(n[0]-a),t[1]=l+i*(n[1]-l),t},Vt.random=function(t,e){e=e||1;var n=2*Ph.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},Vt.transformMat2=function(t,e,n){var i=e[0],a=e[1];return t[0]=n[0]*i+n[2]*a,t[1]=n[1]*i+n[3]*a,t},Vt.transformMat2d=function(t,e,n){var i=e[0],a=e[1];return t[0]=n[0]*i+n[2]*a+n[4],t[1]=n[1]*i+n[3]*a+n[5],t},Vt.transformMat3=function(t,e,n){var i=e[0],a=e[1];return t[0]=n[0]*i+n[3]*a+n[6],t[1]=n[1]*i+n[4]*a+n[7],t},Vt.transformMat4=function(t,e,n){var i=e[0],a=e[1];return t[0]=n[0]*i+n[4]*a+n[12],t[1]=n[1]*i+n[5]*a+n[13],t},Vt.rotate=function(t,e,n,i){var a=e[0]-n[0],l=e[1]-n[1],c=Math.sin(i),h=Math.cos(i);return t[0]=a*h-l*c+n[0],t[1]=a*c+l*h+n[1],t},Vt.angle=function(t,e){var n=t[0],i=t[1],a=e[0],l=e[1],c=Math.sqrt(n*n+i*i)*Math.sqrt(a*a+l*l);return Math.acos(Math.min(Math.max(c&&(n*a+i*l)/c,-1),1))},Vt.zero=function(t){return t[0]=0,t[1]=0,t},Vt.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},Vt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Vt.equals=function(t,e){var n=t[0],i=t[1],a=e[0],l=e[1];return Math.abs(n-a)<=Ph.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-l)<=Ph.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))},Vt.forEach=Vt.sqrLen=Vt.sqrDist=Vt.dist=Vt.div=Vt.mul=Vt.sub=Vt.len=void 0;var Ph=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==Cw(t)&&"function"!=typeof t)return{default:t};var n=DD(void 0);if(n&&n.has(t))return n.get(t);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if("default"!==l&&Object.prototype.hasOwnProperty.call(t,l)){var c=a?Object.getOwnPropertyDescriptor(t,l):null;c&&(c.get||c.set)?Object.defineProperty(i,l,c):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}(ui);function DD(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(DD=function(i){return i?n:e})(t)}function $m(){var t=new Ph.ARRAY_TYPE(2);return Ph.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function Hm(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function MD(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function SD(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function zy(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function Tw(t,e){var n=e[0]-t[0],i=e[1]-t[1];return n*n+i*i}function Dw(t){return Math.hypot(t[0],t[1])}function Mw(t){var e=t[0],n=t[1];return e*e+n*n}Vt.len=Dw,Vt.sub=Hm,Vt.mul=MD,Vt.div=SD,Vt.dist=zy,Vt.sqrDist=Tw,Vt.sqrLen=Mw;var AD=function(){var t=$m();return function(e,n,i,a,l,c){var h,f;for(n||(n=2),i||(i=0),f=a?Math.min(a*n+i,e.length):e.length,h=i;h<f;h+=n)t[0]=e[h],t[1]=e[h+1],l(t,t,c),e[h]=t[0],e[h+1]=t[1];return e}}();function Gm(t){return(Gm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Vt.forEach=AD,Object.defineProperty(ti,"__esModule",{value:!0});var bn=ti.vec4=Z=ti.vec3=ti.vec2=ti.quat2=Mi=ti.quat=se=ti.mat4=Mo=ti.mat3=ti.mat2d=Rh=ti.mat2=ti.glMatrix=void 0,ID=Os(ui);ti.glMatrix=ID;var By=Os(cr),Rh=ti.mat2=By,mi=Os(_r);ti.mat2d=mi;var PD=Os(An),Mo=ti.mat3=PD,qm=Os(Lt),se=ti.mat4=qm,RD=Os(St),Mi=ti.quat=RD,kD=Os(sn);ti.quat2=kD;var OD=Os(Vt);ti.vec2=OD;var LD=Os(Pt),Z=ti.vec3=LD,oI=Os(Gt);function kh(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(kh=function(i){return i?n:e})(t)}function Os(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==Gm(t)&&"function"!=typeof t)return{default:t};var n=kh(e);if(n&&n.has(t))return n.get(t);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if("default"!==l&&Object.prototype.hasOwnProperty.call(t,l)){var c=a?Object.getOwnPropertyDescriptor(t,l):null;c&&(c.get||c.set)?Object.defineProperty(i,l,c):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}bn=ti.vec4=oI;const Sw=wn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Df}=Sw,Vy=wn([{name:"a_pos_3",components:3,type:"Int16"}]);var Ec=wn([{name:"a_pos",type:"Int16",components:2}]),jy={};!function(n){function i(l,c,h){var f=a(256*l,256*(c=Math.pow(2,h)-c-1),h),p=a(256*(l+1),256*(c+1),h);return f[0]+","+f[1]+","+p[0]+","+p[1]}function a(l,c,h){var f=2*Math.PI*6378137/256/Math.pow(2,h);return[l*f-2*Math.PI*6378137/2,c*f-2*Math.PI*6378137/2]}n.getURL=function(l,c,h,f,p,g){return g=g||{},l+"?"+["bbox="+i(h,f,p),"format="+(g.format||"image/png"),"service="+(g.service||"WMS"),"version="+(g.version||"1.1.1"),"request="+(g.request||"GetMap"),"srs="+(g.srs||"EPSG:3857"),"width="+(g.width||256),"height="+(g.height||256),"layers="+c].join("&")},n.getTileBBox=i,n.getMercCoords=a,Object.defineProperty(n,"__esModule",{value:!0})}(jy);var Aw=jy;class Ls{constructor(e,n,i){this.z=e,this.x=n,this.y=i,this.key=Du(0,e,e,n,i)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){const i=Aw.getTileBBox(this.x,this.y,this.z),a=function(l,c,h){let f,p="";for(let g=l;g>0;g--)f=1<<g-1,p+=(c&f?1:0)+(h&f?2:0);return p}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===n?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Iw{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Du(e,n.z,n.z,n.x,n.y)}}class _n{constructor(e,n,i,a,l){this.overscaledZ=e,this.wrap=n,this.canonical=new Ls(i,+a,+l),this.key=0===n&&e===i?this.canonical.key:Du(n,e,i,a,l)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new _n(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new _n(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return Du(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const i=this.canonical.z-e;return Du(this.wrap*+n,e,e,this.canonical.x>>i,this.canonical.y>>i)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new _n(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,i=2*this.canonical.x,a=2*this.canonical.y;return[new _n(n,this.wrap,n,i,a),new _n(n,this.wrap,n,i+1,a),new _n(n,this.wrap,n,i,a+1),new _n(n,this.wrap,n,i+1,a+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new _n(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new _n(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Iw(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Du(t,e,n,i,a){const l=1<<Math.min(n,22);let c=l*(a%l)+i%l;return t&&n<22&&(c+=l*l*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*c+n)+(e-n)}const Uy=[t=>{let e=t.canonical.x-1,n=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,n--),new _n(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,n=t.wrap;return e===1<<t.canonical.z&&(e=0,n++),new _n(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>new _n(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(0===t.canonical.y?1<<t.canonical.z:t.canonical.y)-1),t=>new _n(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];Qe(Ls,"CanonicalTileID"),Qe(_n,"OverscaledTileID",{omit:["projMatrix"]});class Mf{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,i){const a=Z.dot(n,this.dir);if(Math.abs(a)<1e-6)return!1;const l=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/a;return i[0]=this.pos[0]+this.dir[0]*l,i[1]=this.pos[1]+this.dir[1]*l,i[2]=this.pos[2]+this.dir[2]*l,!0}closestPointOnSphere(e,n,i){if(Z.equals(this.pos,e)||0===n)return i[0]=i[1]=i[2]=0,!1;const[a,l,c]=this.dir,h=this.pos[0]-e[0],f=this.pos[1]-e[1],p=this.pos[2]-e[2],g=a*a+l*l+c*c,_=2*(h*a+f*l+p*c),y=_*_-4*g*(h*h+f*f+p*p-n*n);if(y<0){const v=Math.max(-_/2,0),w=h+a*v,E=f+l*v,T=p+c*v,C=Math.hypot(w,E,T);return i[0]=w*n/C,i[1]=E*n/C,i[2]=T*n/C,!1}{const v=(-_-Math.sqrt(y))/(2*g);if(v<0){const w=Math.hypot(h,f,p);return i[0]=h*n/w,i[1]=f*n/w,i[2]=p*n/w,!1}return i[0]=h+a*v,i[1]=f+l*v,i[2]=p+c*v,!0}}}class Rl{constructor(e,n,i,a,l){this.TL=e,this.TR=n,this.BR=i,this.BL=a,this.horizon=l}static fromInvProjectionMatrix(e,n,i){const a=[-1,1,1],l=[1,1,1],c=[1,-1,1],h=[-1,-1,1],f=Z.transformMat4(a,a,e),p=Z.transformMat4(l,l,e),g=Z.transformMat4(c,c,e),_=Z.transformMat4(h,h,e);return new Rl(f,p,g,_,n/i)}}function Sf(t,e,n){let i=1/0,a=-1/0;const l=[];for(const c of t){Z.sub(l,c,e);const h=Z.dot(l,n);i=Math.min(i,h),a=Math.max(a,h)}return[i,a]}function Wm(t,e){let n=!0;for(let i=0;i<t.planes.length;i++){const a=t.planes[i];let l=0;for(let c=0;c<e.length;c++)l+=Z.dot(a,e[c])+a[3]>=0;if(0===l)return 0;l!==e.length&&(n=!1)}return n?2:1}function Af(t,e){for(const n of t.projections){const i=Sf(e,t.points[0],n.axis);if(n.projection[1]<i[0]||n.projection[0]>i[1])return 0}return 1}function Pw(t,e){let n=0;const i=[0,0,0,0];for(let a=0;a<t.length;a++)i[0]=t[a][0],i[1]=t[a][1],i[2]=t[a][2],i[3]=1,bn.dot(i,e)>=0&&n++;return n}class ua{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=$n.fromPoints(this.points),this.projections=[],this.frustumEdges=[Z.sub([],this.points[2],this.points[3]),Z.sub([],this.points[0],this.points[3]),Z.sub([],this.points[4],this.points[0]),Z.sub([],this.points[5],this.points[1]),Z.sub([],this.points[6],this.points[2]),Z.sub([],this.points[7],this.points[3])];for(const i of this.frustumEdges){const a=[0,-i[2],i[1]],l=[i[2],0,-i[0]];this.projections.push({axis:a,projection:Sf(this.points,this.points[0],a)}),this.projections.push({axis:l,projection:Sf(this.points,this.points[0],l)})}}static fromInvProjectionMatrix(e,n,i,a){const l=Math.pow(2,i),c=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(p=>{const g=bn.transformMat4([],p,e),_=1/g[3]/n*l;return bn.mul(g,g,[_,_,a?1/g[3]:_,_])}),h=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(p=>{const g=Z.sub([],c[p[0]],c[p[1]]),_=Z.sub([],c[p[2]],c[p[1]]),y=Z.normalize([],Z.cross([],g,_)),v=-Z.dot(y,c[p[1]]);return y.concat(v)}),f=[];for(let p=0;p<c.length;p++)f.push([c[p][0],c[p][1],c[p][2]]);return new ua(f,h)}intersectsPrecise(e,n,i){for(let a=0;a<n.length;a++)if(!Pw(e,n[a]))return 0;for(let a=0;a<this.planes.length;a++)if(!Pw(e,this.planes[a]))return 0;for(const a of i)for(const l of this.frustumEdges){const c=Z.cross([],a,l),h=Z.length(c);if(0===h)continue;Z.scale(c,c,1/h);const f=Sf(this.points,this.points[0],c),p=Sf(e,this.points[0],c);if(f[0]>p[1]||p[0]>f[1])return 0}return 1}}class $n{static fromPoints(e){const n=[1/0,1/0,1/0],i=[-1/0,-1/0,-1/0];for(const a of e)Z.min(n,n,a),Z.max(i,i,a);return new $n(n,i)}static fromTileIdAndHeight(e,n,i){const a=1<<e.canonical.z,l=e.canonical.x,c=e.canonical.y;return new $n([l/a,c/a,n],[(l+1)/a,(c+1)/a,i])}static applyTransform(e,n){const i=e.getCorners();for(let a=0;a<i.length;++a)Z.transformMat4(i[a],i[a],n);return $n.fromPoints(i)}static projectAabbCorners(e,n){const i=e.getCorners();for(let a=0;a<i.length;++a)Z.transformMat4(i[a],i[a],n);return i}constructor(e,n){this.min=e,this.max=n,this.center=Z.scale([],Z.add([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],i=Z.clone(this.min),a=Z.clone(this.max);for(let l=0;l<n.length;l++)i[l]=n[l]?this.min[l]:this.center[l],a[l]=n[l]?this.center[l]:this.max[l];return a[2]=this.max[2],new $n(i,a)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Wm(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Wm(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?Af(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?Af(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Qe($n,"Aabb");const Fi=he/Math.PI/2,Zm=[64,32,16],Qi=-Fi,Ns=Fi,ND=[new $n([Qi,Qi,Qi],[Ns,Ns,Ns]),new $n([Qi,Qi,Qi],[0,0,Ns]),new $n([0,Qi,Qi],[Ns,0,Ns]),new $n([Qi,0,Qi],[0,Ns,Ns]),new $n([0,0,Qi],[Ns,Ns,Ns])];function Xm(t){return t*Fi/da}function Rw(t,e,n,i=!0){const a=Z.scale([],t._camera.position,t.worldSize),l=[e,n,1,1];bn.transformMat4(l,l,t.pixelMatrixInverse),bn.scale(l,l,1/l[3]);const c=Z.sub([],l,a),h=Z.normalize([],c),f=t.globeMatrix,p=[f[12],f[13],f[14]],g=Z.sub([],p,a),_=Z.length(g),y=Z.normalize([],g),v=t.worldSize/(2*Math.PI),w=Z.dot(y,h),E=Math.asin(v/_);if(E<Math.acos(w)){if(!i)return null;const G=[],$=[];Z.scale(G,h,_/w),Z.normalize($,Z.sub($,G,g)),Z.normalize(h,Z.add(h,g,Z.scale(h,$,Math.tan(E)*_)))}const T=[];new Mf(a,h).closestPointOnSphere(p,v,T);const C=Z.normalize([],Zn(f,0)),S=Z.normalize([],Zn(f,1)),I=Z.normalize([],Zn(f,2)),R=Z.dot(C,T),A=Z.dot(S,T),k=Z.dot(I,T),L=kr(Math.asin(-A/v));let B=kr(Math.atan2(R,k));B=t.center.lng+function(G,$){const W=($-G+180)%360-180;return W<-180?W+360:W}(t.center.lng,B);const j=Si(B),U=et(gi(L),0,1);return new nn(j,U)}class $y{constructor(e,n,i){this.a=Z.sub([],e,i),this.b=Z.sub([],n,i),this.center=i;const a=Z.normalize([],this.a),l=Z.normalize([],this.b);this.angle=Math.acos(Z.dot(a,l))}}function Hy(t,e){if(0===t.angle)return null;let n;return n=0===t.a[e]?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(i,a,l,c){const h=Math.sin(l);return i*(Math.sin((1-c)*l)/h)+a*(Math.sin(c*l)/h)}(t.a[e],t.b[e],t.angle,et(n,0,1))+t.center[e]}function ps(t){if(t.z<=1)return ND[t.z+2*t.y+t.x];const e=Wy(Cc(t));return $n.fromPoints(e)}function Ol(t,e,n){return Z.scale(t,t,1-n),Z.scaleAndAdd(t,t,e,n)}function Gy(t,e){const n=ni(e.zoom);if(0===n)return ps(t);const i=Cc(t),a=Wy(i),l=Si(i.getWest())*e.worldSize,c=Si(i.getEast())*e.worldSize,h=gi(i.getNorth())*e.worldSize,f=gi(i.getSouth())*e.worldSize,p=[l,h,0],g=[c,h,0],_=[l,f,0],y=[c,f,0],v=se.invert([],e.globeMatrix);return Z.transformMat4(p,p,v),Z.transformMat4(g,g,v),Z.transformMat4(_,_,v),Z.transformMat4(y,y,v),a[0]=Ol(a[0],_,n),a[1]=Ol(a[1],y,n),a[2]=Ol(a[2],g,n),a[3]=Ol(a[3],p,n),$n.fromPoints(a)}function zD(t,e,n){for(const i of t)Z.transformMat4(i,i,e),Z.scale(i,i,n)}function qy(t,e,n,i){const a=e/t.worldSize,l=t.globeMatrix;if(n.z<=1){const j=ps(n).getCorners();return zD(j,l,a),$n.fromPoints(j)}const c=Cc(n,i),h=Wy(c);zD(h,l,a);const f=Number.MAX_VALUE,p=[-f,-f,-f],g=[f,f,f];if(c.contains(t.center)){for(const G of h)Z.min(g,g,G),Z.max(p,p,G);p[2]=0;const j=t.point,U=[j.x*a,j.y*a,0];return Z.min(g,g,U),Z.max(p,p,U),new $n(g,p)}const _=[l[12]*a,l[13]*a,l[14]*a],y=c.getCenter(),v=et(t.center.lat,-Mr,Mr),w=et(y.lat,-Mr,Mr),E=Si(t.center.lng),T=gi(v);let C=E-Si(y.lng);const S=T-gi(w);C>.5?C-=1:C<-.5&&(C+=1);let I=0;if(Math.abs(C)>Math.abs(S))I=C>=0?1:3;else{I=S>=0?0:2;const j=[l[4]*a,l[5]*a,l[6]*a],U=-Math.sin(At(S>=0?c.getSouth():c.getNorth()))*Fi;Z.scaleAndAdd(_,_,j,U)}const R=h[I],A=h[(I+1)%4],k=new $y(R,A,_),L=[Hy(k,0)||R[0],Hy(k,1)||R[1],Hy(k,2)||R[2]],B=ni(t.zoom);if(B>0){const j=function({x:G,y:$,z:W},H,J,te,oe){const K=1/(1<<W);let Q=G*K,ae=Q+K,ue=$*K,fe=ue+K,ge=0;const ve=(Q+ae)/2-te;return ve>.5?ge=-1:ve<-.5&&(ge=1),Q=((Q+ge)*H-(te*=H))*J+te,ae=((ae+ge)*H-te)*J+te,ue=(ue*H-(oe*=H))*J+oe,fe=(fe*H-oe)*J+oe,[[Q,fe,0],[ae,fe,0],[ae,ue,0],[Q,ue,0]]}(n,e,t._pixelsPerMercatorPixel,E,T);for(let G=0;G<h.length;G++)Ol(h[G],j[G],B);const U=Z.add([],j[I],j[(I+1)%4]);Z.scale(U,U,.5),Ol(L,U,B)}for(const j of h)Z.min(g,g,j),Z.max(p,p,j);return g[2]=Math.min(R[2],A[2]),Z.min(g,g,L),Z.max(p,p,L),new $n(g,p)}function Cc({x:t,y:e,z:n},i=!1){const a=1/(1<<n),l=new bt(Ao(t*a),e===(1<<n)-1&&i?-90:Gr((e+1)*a)),c=new bt(Ao((t+1)*a),0===e&&i?90:Gr(e*a));return new Ji(l,c)}function Wy(t){const e=At(t.getNorth()),n=At(t.getSouth()),i=Math.cos(e),a=Math.cos(n),l=Math.sin(e),c=Math.sin(n),h=t.getWest(),f=t.getEast();return[ha(a,c,h),ha(a,c,f),ha(i,l,f),ha(i,l,h)]}function ha(t,e,n,i=Fi){return n=At(n),[t*Math.sin(n)*i,-e*i,t*Math.cos(n)*i]}function Dr(t,e,n){return ha(Math.cos(At(t)),Math.sin(At(t)),e,n)}function If(t,e,n,i){const a=1<<n.z,l=(t/he+n.x)/a;return Dr(Gr((e/he+n.y)/a),Ao(l),i)}function Zy({min:t,max:e}){return 16383/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Xy=new Float64Array(16);function So(t){const e=Zy(t),n=se.fromScaling(Xy,[e,e,e]);return se.translate(n,n,Z.negate([],t.min))}function Yy(t){const e=se.fromTranslation(Xy,t.min),n=1/Zy(t);return se.scale(e,e,[n,n,n])}function Ky(t){const e=he/(2*Math.PI);return t/(2*Math.PI)/e}function Lh(t,e){return he/(512*Math.pow(2,t))*Zy(ps(e))}function kw(t,e,n,i,a){const l=Ky(n),c=[t,e,-n/(2*Math.PI)],h=se.identity(new Float64Array(16));return se.translate(h,h,c),se.scale(h,h,[l,l,l]),se.rotateX(h,h,At(-a)),se.rotateY(h,h,At(-i)),h}function ni(t){return Cs(5,6,t)}function Ym(t,e,n){const i=se.identity(new Float64Array(16)),a=(e/(1<<t)-.5)*Math.PI*2;return se.rotateY(i,n.globeMatrix,a),Float32Array.from(i)}function Ow(t,e,n){const i=ni(n.zoom),a=t.style.map._antialias,l=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return 0===i&&!a&&!l}function Jy(t,e,n,i){const a=e.getNorth(),l=e.getSouth(),c=e.getWest(),h=e.getEast(),f=1<<t.z,p=h-c,g=a-l,_=p/64,y=-g/Zm[n],v=[0,_,0,y,0,0,a,c,0];if(t.z>0){const w=180/i;Mo.multiply(v,v,[w/p+1,0,0,0,w/g+1,0,-.5*w/_,.5*w/y,1])}return v[2]=f,v[5]=t.x,v[8]=t.y,v}function Fh(t){const e=Mr-5;t=et(t,-e,e)/e*90;const n=Math.pow(Math.abs(Math.sin(At(t))),3);return Math.round(n*(Zm.length-1))}function Lw(t){const e=[0,0,0],n=se.identity(new Float64Array(16));return se.multiply(n,t.pixelMatrix,t.globeMatrix),Z.transformMat4(e,e,n),new ie(e[0],e[1])}function Fw(t,e){const n=Dr(e.lat,e.lng),i=function(l){const c=Dr(l._center.lat,l._center.lng),h=Z.fromValues(0,1,0);let f=Z.cross([],h,c);const p=se.fromRotation([],-l.angle,c);f=Z.transformMat4(f,f,p),se.fromRotation(p,-l._pitch,f);const g=Z.normalize([],c);return Z.scale(g,g,Xm(l.cameraToCenterDistance/l.pixelsPerMeter)),Z.transformMat4(g,g,p),Z.add([],c,g)}(t),a=Z.subtract([],i,n);return Z.angle(a,n)}function Km(t,e){return Fw(t,e)>Math.PI/2*1.01}const Nw=At(85),BD=Math.cos(Nw),VD=Math.sin(Nw);class jD{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy()}_fillGridMeshWithLods(e,n){const i=new jo,a=new Tr,l=[],c=e+1+2,h=n[0]+1,f=n[0]+1+(1+n.length),p=(g,_,y)=>{let v=g===c-1?g-2:0===g?g:g-1;return v+=y?24575:0,[v,_]};for(let g=0;g<c;++g)i.emplaceBack(...p(g,0,!0));for(let g=0;g<h;++g)for(let _=0;_<c;++_)i.emplaceBack(...p(_,g,(0===_||_===c-1)&&!0));for(let g=0;g<n.length;++g){const _=n[g];for(let y=0;y<c;++y)i.emplaceBack(...p(y,_,!0))}for(let g=0;g<n.length;++g){const _=a.length,y=n[g]+1+2,v=new Tr;for(let T=0;T<y-1;T++){const C=T===y-2,S=C?c*(f-n.length+g-T):c;for(let I=0;I<c-1;I++){const R=T*c+I;0===T||C||0===I||I===c-2?(v.emplaceBack(R+1,R,R+S),v.emplaceBack(R+S,R+S+1,R+1)):(a.emplaceBack(R+1,R,R+S),a.emplaceBack(R+S,R+S+1,R+1))}}const w=Cn.simpleSegment(0,_,i.length,a.length-_);for(let T=0;T<v.uint16.length;T+=3)a.emplaceBack(v.uint16[T],v.uint16[T+1],v.uint16[T+2]);const E=Cn.simpleSegment(0,_,i.length,a.length-_);l.push({withoutSkirts:w,withSkirts:E})}return{vertices:i,indices:a,segments:l}}_createGrid(e){const n=this._fillGridMeshWithLods(64,Zm);this._gridSegments=n.segments,this._gridBuffer=e.createVertexBuffer(n.vertices,Ec.members),this._gridIndexBuffer=e.createIndexBuffer(n.indices,!0)}_createPoles(e){const n=new Tr;for(let h=0;h<=64;h++)n.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=e.createIndexBuffer(n,!0);const i=new Dl,a=new Dl,l=new Dl,c=new Dl;this._poleSegments=[];for(let h=0,f=0;h<5;h++){const p=360/(1<<h);i.emplaceBack(0,-Fi,0,.5,0),a.emplaceBack(0,-Fi,0,.5,1),l.emplaceBack(0,-Fi,0,.5,.5),c.emplaceBack(0,-Fi,0,.5,.5);for(let g=0;g<=64;g++){let _=g/64,y=0;const v=wt(0,p,_),[w,E,T]=ha(BD,VD,v,Fi);i.emplaceBack(w,E,T,_,y),a.emplaceBack(w,E,T,_,1-y);const C=At(v);_=.5+.5*Math.sin(C),y=.5+.5*Math.cos(C),l.emplaceBack(w,E,T,_,y),c.emplaceBack(w,E,T,_,1-y)}this._poleSegments.push(Cn.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(i,Df,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(a,Df,!1),this._texturedPoleNorthVertexBuffer=e.createVertexBuffer(l,Df,!1),this._texturedPoleSouthVertexBuffer=e.createVertexBuffer(c,Df,!1)}getGridBuffers(e,n){return[this._gridBuffer,this._gridIndexBuffer,n?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e,n){return[n?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,n?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}}const da=6371008.8,fa=2*Math.PI*da;class Tc{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Tc(ts(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,i=this.lat*n,a=e.lat*n,l=Math.sin(i)*Math.sin(a)+Math.cos(i)*Math.cos(a)*Math.cos((e.lng-this.lng)*n);return da*Math.acos(Math.min(l,1))}toBounds(e=0){const n=360*e/40075017,i=n/Math.cos(Math.PI/180*this.lat);return new Ji(new Tc(this.lng-i,this.lat-n),new Tc(this.lng+i,this.lat+n))}toEcef(e){const n=Xm(e);return Dr(this.lat,this.lng,Fi+n)}static convert(e){if(e instanceof Tc)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Tc(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Tc(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var bt=Tc;function Pf(t){return fa*Math.cos(t*Math.PI/180)}function Si(t){return(180+t)/360}function gi(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function kn(t,e){return t/Pf(e)}function Ao(t){return 360*t-180}function Gr(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Qy(t,e){return t*Pf(Gr(e))}const Mr=85.051129;function zw(t){return Math.cos(At(et(t,-Mr,Mr)))}function Ni(t,e){const n=et(e,0,25.5),i=Math.pow(2,n);return zw(t)*fa/(512*i)}function ev(t){return 1/Math.cos(t*Math.PI/180)}function Nh(t,e=0){const n=Math.exp(Math.PI*(1-(t.y+e/he)/(1<<t.z)*2));return 80150034*n/(n*n+1)/he/(1<<t.z)}class nn{constructor(e,n,i=0){this.x=+e,this.y=+n,this.z=+i}static fromLngLat(e,n=0){const i=bt.convert(e);return new nn(Si(i.lng),gi(i.lat),kn(n,i.lat))}toLngLat(){return new bt(Ao(this.x),Gr(this.y))}toAltitude(){return Qy(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/fa*ev(Gr(this.y))}}function tv(t,e,n,i,a,l,c,h,f){const p=(e+i)/2,g=(n+a)/2,_=new ie(p,g);h(_),function(y,v,w,E,T,C){const S=w-T,I=E-C;return Math.abs((E-v)*S-(w-y)*I)/Math.hypot(S,I)}(_.x,_.y,l.x,l.y,c.x,c.y)>=f?(tv(t,e,n,p,g,l,_,h,f),tv(t,p,g,i,a,_,c,h,f)):t.push(c)}function Bw(t,e,n){let i=t[0],a=i.x,l=i.y;e(i);const c=[i];for(let h=1;h<t.length;h++){const f=t[h],{x:p,y:g}=f;e(f),tv(c,a,l,p,g,i,f,e,n),a=p,l=g,i=f}return c}function nv(t,e,n,i){if(i(e,n)){const a=e.add(n)._mult(.5);nv(t,e,a,i),nv(t,a,n,i)}else t.push(n)}function Vw(t,e){let n=t[0];const i=[n];for(let a=1;a<t.length;a++){const l=t[a];nv(i,n,l,e),n=l}return i}const rv=Math.pow(2,14)-1,jw=-rv-1;function UD(t,e){const n=Math.round(t.x*e),i=Math.round(t.y*e);return t.x=et(n,jw,rv),t.y=et(i,jw,rv),(n<t.x||n>t.x+1||i<t.y||i>t.y+1)&&ee("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Yt(t,e,n){const i=t.loadGeometry(),a=t.extent,l=he/a;if(e&&n&&n.projection.isReprojectedInTileSpace){const c=1<<e.z,{scale:h,x:f,y:p,projection:g}=n,_=y=>{const v=Ao((e.x+y.x/a)/c),w=Gr((e.y+y.y/a)/c),E=g.project(v,w);y.x=(E.x*h-f)*a,y.y=(E.y*h-p)*a};for(let y=0;y<i.length;y++)if(1!==t.type)i[y]=Bw(i[y],_,1);else{const v=[];for(const w of i[y])w.x<0||w.x>=a||w.y<0||w.y>=a||(_(w),v.push(w));i[y]=v}}for(const c of i)for(const h of c)UD(h,l);return i}function _o(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Yt(t):[]}}function Rf(t,e,n,i,a){t.emplaceBack(2*e+(i+1)/2,2*n+(a+1)/2)}function kf(t,e,n){t.emplaceBack(e.x,e.y,e.z,16384*n[0],16384*n[1],16384*n[2])}class iv{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new jo,this.indexArray=new Tr,this.segments=new Cn,this.programConfigurations=new xc(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,i,a){const l=this.layers[0],c=[];let h=null;"circle"===l.type&&(h=l.layout.get("circle-sort-key"));for(const{feature:p,id:g,index:_,sourceLayerIndex:y}of e){const v=this.layers[0]._featureFilter.needGeometry,w=_o(p,v);if(!this.layers[0]._featureFilter.filter(new pr(this.zoom),w,i))continue;const E=h?h.evaluate(w,{},i):void 0,T={id:g,properties:p.properties,type:p.type,sourceLayerIndex:y,index:_,geometry:v?w.geometry:Yt(p,i,a),patterns:{},sortKey:E};c.push(T)}h&&c.sort((p,g)=>p.sortKey-g.sortKey);let f=null;"globe"===a.projection.name&&(this.globeExtVertexArray=new vm,f=a.projection);for(const p of c){const{geometry:g,index:_,sourceLayerIndex:y}=p,v=e[_].feature;this.addFeature(p,g,_,n.availableImages,i,f,n.brightness),n.featureIndex.insert(v,g,_,y,this.index)}}update(e,n,i,a,l){const c=0!==Object.keys(e).length;c&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,c?this.stateDependentLayers:this.layers,i,a,l)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,gD.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,_D.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,i,a,l,c,h){for(const f of n)for(const p of f){const g=p.x,_=p.y;if(g<0||g>=he||_<0||_>=he)continue;if(c){const w=c.projectTilePoint(g,_,l),E=c.upVector(l,g,_),T=this.globeExtVertexArray;kf(T,w,E),kf(T,w,E),kf(T,w,E),kf(T,w,E)}const y=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),v=y.vertexLength;Rf(this.layoutVertexArray,g,_,-1,-1),Rf(this.layoutVertexArray,g,_,1,-1),Rf(this.layoutVertexArray,g,_,1,1),Rf(this.layoutVertexArray,g,_,-1,1),this.indexArray.emplaceBack(v,v+1,v+2),this.indexArray.emplaceBack(v,v+2,v+3),y.vertexLength+=4,y.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,{},a,l,h)}}function Uw(t,e){for(let n=0;n<t.length;n++)if(_i(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(_i(t,e[n]))return!0;return!!ov(t,e)}function $w(t,e,n){return!!_i(t,e)||!!qw(e,t,n)}function Hw(t,e){if(1===t.length)return av(e,t[0]);for(let n=0;n<e.length;n++){const i=e[n];for(let a=0;a<i.length;a++)if(_i(t,i[a]))return!0}for(let n=0;n<t.length;n++)if(av(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(ov(t,e[n]))return!0;return!1}function Gw(t,e,n){if(t.length>1){if(ov(t,e))return!0;for(let i=0;i<e.length;i++)if(qw(e[i],t,n))return!0}for(let i=0;i<t.length;i++)if(qw(t[i],e,n))return!0;return!1}function ov(t,e){if(0===t.length||0===e.length)return!1;for(let n=0;n<t.length-1;n++){const i=t[n],a=t[n+1];for(let l=0;l<e.length-1;l++)if($D(i,a,e[l],e[l+1]))return!0}return!1}function $D(t,e,n,i){return be(t,n,i)!==be(e,n,i)&&be(t,e,n)!==be(t,e,i)}function qw(t,e,n){const i=n*n;if(1===e.length)return t.distSqr(e[0])<i;for(let a=1;a<e.length;a++)if(sv(t,e[a-1],e[a])<i)return!0;return!1}function sv(t,e,n){const i=e.distSqr(n);if(0===i)return t.distSqr(e);const a=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/i;return t.distSqr(a<0?e:a>1?n:n.sub(e)._mult(a)._add(e))}function av(t,e){let n,i,a,l=!1;for(let c=0;c<t.length;c++){n=t[c];for(let h=0,f=n.length-1;h<n.length;f=h++)i=n[h],a=n[f],i.y>e.y!=a.y>e.y&&e.x<(a.x-i.x)*(e.y-i.y)/(a.y-i.y)+i.x&&(l=!l)}return l}function _i(t,e){let n=!1;for(let i=0,a=t.length-1;i<t.length;a=i++){const l=t[i],c=t[a];l.y>e.y!=c.y>e.y&&e.x<(c.x-l.x)*(e.y-l.y)/(c.y-l.y)+l.x&&(n=!n)}return n}function Ww(t,e,n,i,a){for(const c of t)if(e<=c.x&&n<=c.y&&i>=c.x&&a>=c.y)return!0;const l=[new ie(e,n),new ie(e,a),new ie(i,a),new ie(i,n)];if(t.length>2)for(const c of l)if(_i(t,c))return!0;for(let c=0;c<t.length-1;c++)if(lv(t[c],t[c+1],l))return!0;return!1}function lv(t,e,n){const i=n[0],a=n[2];if(t.x<i.x&&e.x<i.x||t.x>a.x&&e.x>a.x||t.y<i.y&&e.y<i.y||t.y>a.y&&e.y>a.y)return!1;const l=be(t,e,n[0]);return l!==be(t,e,n[1])||l!==be(t,e,n[2])||l!==be(t,e,n[3])}function Dc(t,e,n,i,a,l){let c=e.y-t.y,h=t.x-e.x;if(l=l||0){const f=c*c+h*h;if(0===f)return!0;const p=Math.sqrt(f);c/=p,h/=p}return!((n.x-t.x)*c+(n.y-t.y)*h-l<0||(i.x-t.x)*c+(i.y-t.y)*h-l<0||(a.x-t.x)*c+(a.y-t.y)*h-l<0)}function cv(t,e,n,i,a,l,c){return!(Dc(t,e,i,a,l,c)||Dc(e,n,i,a,l,c)||Dc(n,t,i,a,l,c)||Dc(i,a,t,e,n,c)||Dc(a,l,t,e,n,c)||Dc(l,i,t,e,n,c))}function Of(t,e,n){const i=e.paint.get(t).value;return"constant"===i.kind?i.value:n.programConfigurations.get(e.id).getMaxValue(t)}function uv(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function HD(t,e,n,i,a){if(!e[0]&&!e[1])return t;const l=ie.convert(e)._mult(a);"viewport"===n&&l._rotate(-i);const c=[];for(let h=0;h<t.length;h++)c.push(t[h].sub(l));return c}function Zw(t,e,n,i){const a=ie.convert(t)._mult(i);return"viewport"===e&&a._rotate(-n),a}Qe(iv,"CircleBucket",{omit:["layers"]});const Xw=new mr({"circle-sort-key":new lt(le.layout_circle["circle-sort-key"]),visibility:new Re(le.layout_circle.visibility)});var lI={paint:new mr({"circle-radius":new lt(le.paint_circle["circle-radius"]),"circle-color":new lt(le.paint_circle["circle-color"]),"circle-blur":new lt(le.paint_circle["circle-blur"]),"circle-opacity":new lt(le.paint_circle["circle-opacity"]),"circle-translate":new Re(le.paint_circle["circle-translate"]),"circle-translate-anchor":new Re(le.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Re(le.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Re(le.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new lt(le.paint_circle["circle-stroke-width"]),"circle-stroke-color":new lt(le.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new lt(le.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Re(le.paint_circle["circle-emissive-strength"])}),layout:Xw};const GD=se.create(),zh=(t,e,n,i,a,l)=>{const c=t.transform,h="globe"===c.projection.name;let f;if("map"===l.paint.get("circle-pitch-alignment"))if(h){const g=Lh(c.zoom,e.canonical)*c._pixelsPerMercatorPixel;f=Float32Array.from([g,0,0,g])}else f=c.calculatePixelsToTileUnitsMatrix(n);else f=new Float32Array([c.pixelsToGLUnits[0],0,0,c.pixelsToGLUnits[1]]);const p={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(c.projection),u_matrix:t.translatePosMatrix(e.projMatrix,n,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Ct.devicePixelRatio,u_extrude_scale:f,u_inv_rot_matrix:GD,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:l.paint.get("circle-emissive-strength")};if(h){p.u_inv_rot_matrix=i,p.u_merc_center=a,p.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],p.u_zoom_transition=ni(c.zoom);const g=a[0]*he,_=a[1]*he;p.u_up_dir=c.projection.upVector(new Ls(0,0,0),g,_)}return p},Yw=t=>{const e=[];return"map"===t.paint.get("circle-pitch-alignment")&&e.push("PITCH_WITH_MAP"),"map"===t.paint.get("circle-pitch-scale")&&e.push("SCALE_WITH_MAP"),e};function hv(t,e,n,i,a,l,c,h,f){if(l&&t.queryGeometry.isAboveHorizon)return!1;l&&(f*=t.pixelToTileUnitsFactor);const p=t.tileID.canonical,g=n.projection.upVectorScale(p,n.center.lat,n.worldSize).metersToTile;for(const _ of e)for(const y of _){const v=y.add(h),w=a&&n.elevation?n.elevation.exaggeration()*a.getElevationAt(v.x,v.y,!0):0,E=n.projection.projectTilePoint(v.x,v.y,p);if(w>0){const I=n.projection.upVector(p,v.x,v.y);E.x+=I[0]*g*w,E.y+=I[1]*g*w,E.z+=I[2]*g*w}const T=l?v:Jm(E.x,E.y,E.z,i),C=l?t.tilespaceRays.map(I=>qD(I,w)):t.queryGeometry.screenGeometry,S=bn.transformMat4([],[E.x,E.y,E.z,1],i);if(!c&&l?f*=S[3]/n.cameraToCenterDistance:c&&!l&&(f*=n.cameraToCenterDistance/S[3]),l){const I=Gr((y.y/he+p.y)/(1<<p.z));f/=n.projection.pixelsPerMeter(I,1)/kn(1,I)}if($w(C,T,f))return!0}return!1}function Jm(t,e,n,i){const a=bn.transformMat4([],[t,e,n,1],i);return new ie(a[0]/a[3],a[1]/a[3])}const Kw=Z.fromValues(0,0,0),Jw=Z.fromValues(0,0,1);function qD(t,e){const n=Z.create();return Kw[2]=e,t.intersectsPlane(Kw,Jw,n),new ie(n[0],n[1])}class Qw extends iv{}function eb(t,{width:e,height:n},i,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==e*n*i)throw new RangeError("mismatched image size")}else a=new Uint8Array(e*n*i);return t.width=e,t.height=n,t.data=a,t}function tb(t,e,n){const{width:i,height:a}=e;i===t.width&&a===t.height||(dv(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,i),height:Math.min(t.height,a)},n),t.width=i,t.height=a,t.data=e.data)}function dv(t,e,n,i,a,l){if(0===a.width||0===a.height)return e;if(a.width>t.width||a.height>t.height||n.x>t.width-a.width||n.y>t.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>e.width||a.height>e.height||i.x>e.width-a.width||i.y>e.height-a.height)throw new RangeError("out of range destination coordinates for image copy");const c=t.data,h=e.data;for(let f=0;f<a.height;f++){const p=((n.y+f)*t.width+n.x)*l,g=((i.y+f)*e.width+i.x)*l;for(let _=0;_<a.width*l;_++)h[g+_]=c[p+_]}return e}Qe(Qw,"HeatmapBucket",{omit:["layers"]});class Ja{constructor(e,n){eb(this,e,1,n)}resize(e){tb(this,new Ja(e),1)}clone(){return new Ja({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,i,a,l){dv(e,n,i,a,l,1)}}class Sr{constructor(e,n){eb(this,e,4,n)}resize(e){tb(this,new Sr(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Sr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,i,a,l){dv(e,n,i,a,l,4)}}class fv{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}Qe(Ja,"AlphaImage"),Qe(Sr,"RGBAImage");const nb=new mr({visibility:new Re(le.layout_heatmap.visibility)});var pv={paint:new mr({"heatmap-radius":new lt(le.paint_heatmap["heatmap-radius"]),"heatmap-weight":new lt(le.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Re(le.paint_heatmap["heatmap-intensity"]),"heatmap-color":new gm(le.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Re(le.paint_heatmap["heatmap-opacity"])}),layout:nb};function mv(t){const e={},n=t.resolution||256,i=t.clips?t.clips.length:1,a=t.image||new Sr({width:n,height:i}),l=(c,h,f)=>{e[t.evaluationKey]=f;const p=t.expression.evaluate(e);p&&(a.data[c+h+0]=Math.floor(255*p.r/p.a),a.data[c+h+1]=Math.floor(255*p.g/p.a),a.data[c+h+2]=Math.floor(255*p.b/p.a),a.data[c+h+3]=Math.floor(255*p.a))};if(t.clips)for(let c=0,h=0;c<i;++c,h+=4*n)for(let f=0,p=0;f<n;f++,p+=4){const g=f/(n-1),{start:_,end:y}=t.clips[c];l(h,p,_*(1-g)+y*g)}else for(let c=0,h=0;c<n;c++,h+=4)l(0,h,c/(n-1));return a}const gv=new mr({visibility:new Re(le.layout_hillshade.visibility)});var WD={paint:new mr({"hillshade-illumination-direction":new Re(le.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Re(le.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Re(le.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Re(le.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Re(le.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Re(le.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Re(le.paint_hillshade["hillshade-emissive-strength"])}),layout:gv};const cI=wn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ze}=cI;var Lf={exports:{}};function Ff(t,e,n){n=n||2;var i,a,l,c,h,f,p,g=e&&e.length,_=g?e[0]*n:t.length,y=Nf(t,0,_,n,!0),v=[];if(!y||y.next===y.prev)return v;if(g&&(y=function(E,T,C,S){var I,R,A,k=[];for(I=0,R=T.length;I<R;I++)(A=Nf(E,T[I]*S,I<R-1?T[I+1]*S:E.length,S,!1))===A.next&&(A.steiner=!0),k.push(hI(A));for(k.sort(rb),I=0;I<k.length;I++)C=vv(k[I],C);return C}(t,e,y,n)),t.length>80*n){i=l=t[0],a=c=t[1];for(var w=n;w<_;w+=n)(h=t[w])<i&&(i=h),(f=t[w+1])<a&&(a=f),h>l&&(l=h),f>c&&(c=f);p=0!==(p=Math.max(l-i,c-a))?32767/p:0}return Bh(y,v,n,i,a,p,0),v}function Nf(t,e,n,i,a){var l,c;if(a===wv(t,e,n,i)>0)for(l=e;l<n;l+=i)c=ob(l,t[l],t[l+1],c);else for(l=n-i;l>=e;l-=i)c=ob(l,t[l],t[l+1],c);return c&&Vh(c,c.next)&&(jh(c),c=c.next),c}function eo(t,e){if(!t)return t;e||(e=t);var n,i=t;do{if(n=!1,i.steiner||!Vh(i,i.next)&&0!==Lr(i.prev,i,i.next))i=i.next;else{if(jh(i),(i=e=i.prev)===i.next)break;n=!0}}while(n||i!==e);return e}function Bh(t,e,n,i,a,l,c){if(t){!c&&l&&function(g,_,y,v){var w=g;do{0===w.z&&(w.z=Qm(w.x,w.y,_,y,v)),w.prevZ=w.prev,w.nextZ=w.next,w=w.next}while(w!==g);w.prevZ.nextZ=null,w.prevZ=null,function(E){var T,C,S,I,R,A,k,L,B=1;do{for(C=E,E=null,R=null,A=0;C;){for(A++,S=C,k=0,T=0;T<B&&(k++,S=S.nextZ);T++);for(L=B;k>0||L>0&&S;)0!==k&&(0===L||!S||C.z<=S.z)?(I=C,C=C.nextZ,k--):(I=S,S=S.nextZ,L--),R?R.nextZ=I:E=I,I.prevZ=R,R=I;C=S}R.nextZ=null,B*=2}while(A>1)}(w)}(t,i,a,l);for(var h,f,p=t;t.prev!==t.next;)if(h=t.prev,f=t.next,l?_v(t,i,a,l):ZD(t))e.push(h.i/n|0),e.push(t.i/n|0),e.push(f.i/n|0),jh(t),t=f.next,p=f.next;else if((t=f)===p){c?1===c?Bh(t=Ll(eo(t),e,n),e,n,i,a,l,2):2===c&&yv(t,e,n,i,a,l):Bh(eo(t),e,n,i,a,l,1);break}}}function ZD(t){var e=t.prev,n=t,i=t.next;if(Lr(e,n,i)>=0)return!1;for(var a=e.x,l=n.x,c=i.x,h=e.y,f=n.y,p=i.y,g=a<l?a<c?a:c:l<c?l:c,_=h<f?h<p?h:p:f<p?f:p,y=a>l?a>c?a:c:l>c?l:c,v=h>f?h>p?h:p:f>p?f:p,w=i.next;w!==e;){if(w.x>=g&&w.x<=y&&w.y>=_&&w.y<=v&&Fl(a,h,l,f,c,p,w.x,w.y)&&Lr(w.prev,w,w.next)>=0)return!1;w=w.next}return!0}function _v(t,e,n,i){var a=t.prev,l=t,c=t.next;if(Lr(a,l,c)>=0)return!1;for(var h=a.x,f=l.x,p=c.x,g=a.y,_=l.y,y=c.y,v=h<f?h<p?h:p:f<p?f:p,w=g<_?g<y?g:y:_<y?_:y,E=h>f?h>p?h:p:f>p?f:p,T=g>_?g>y?g:y:_>y?_:y,C=Qm(v,w,e,n,i),S=Qm(E,T,e,n,i),I=t.prevZ,R=t.nextZ;I&&I.z>=C&&R&&R.z<=S;){if(I.x>=v&&I.x<=E&&I.y>=w&&I.y<=T&&I!==a&&I!==c&&Fl(h,g,f,_,p,y,I.x,I.y)&&Lr(I.prev,I,I.next)>=0||(I=I.prevZ,R.x>=v&&R.x<=E&&R.y>=w&&R.y<=T&&R!==a&&R!==c&&Fl(h,g,f,_,p,y,R.x,R.y)&&Lr(R.prev,R,R.next)>=0))return!1;R=R.nextZ}for(;I&&I.z>=C;){if(I.x>=v&&I.x<=E&&I.y>=w&&I.y<=T&&I!==a&&I!==c&&Fl(h,g,f,_,p,y,I.x,I.y)&&Lr(I.prev,I,I.next)>=0)return!1;I=I.prevZ}for(;R&&R.z<=S;){if(R.x>=v&&R.x<=E&&R.y>=w&&R.y<=T&&R!==a&&R!==c&&Fl(h,g,f,_,p,y,R.x,R.y)&&Lr(R.prev,R,R.next)>=0)return!1;R=R.nextZ}return!0}function Ll(t,e,n){var i=t;do{var a=i.prev,l=i.next.next;!Vh(a,l)&&tg(a,i,i.next,l)&&zf(a,l)&&zf(l,a)&&(e.push(a.i/n|0),e.push(i.i/n|0),e.push(l.i/n|0),jh(i),jh(i.next),i=t=l),i=i.next}while(i!==t);return eo(i)}function yv(t,e,n,i,a,l){var c=t;do{for(var h=c.next.next;h!==c.prev;){if(c.i!==h.i&&eg(c,h)){var f=ib(c,h);return c=eo(c,c.next),f=eo(f,f.next),Bh(c,e,n,i,a,l,0),void Bh(f,e,n,i,a,l,0)}h=h.next}c=c.next}while(c!==t)}function rb(t,e){return t.x-e.x}function vv(t,e){var n=function(a,l){var c,h=l,f=a.x,p=a.y,g=-1/0;do{if(p<=h.y&&p>=h.next.y&&h.next.y!==h.y){var _=h.x+(p-h.y)*(h.next.x-h.x)/(h.next.y-h.y);if(_<=f&&_>g&&(g=_,c=h.x<h.next.x?h:h.next,_===f))return c}h=h.next}while(h!==l);if(!c)return null;var y,v=c,w=c.x,E=c.y,T=1/0;h=c;do{f>=h.x&&h.x>=w&&f!==h.x&&Fl(p<E?f:g,p,w,E,p<E?g:f,p,h.x,h.y)&&(y=Math.abs(p-h.y)/(f-h.x),zf(h,a)&&(y<T||y===T&&(h.x>c.x||h.x===c.x&&uI(c,h)))&&(c=h,T=y)),h=h.next}while(h!==v);return c}(t,e);if(!n)return e;var i=ib(n,t);return eo(i,i.next),eo(n,n.next)}function uI(t,e){return Lr(t.prev,t,e.prev)<0&&Lr(e.next,t,t.next)<0}function Qm(t,e,n,i,a){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*a|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function hI(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Fl(t,e,n,i,a,l,c,h){return(a-c)*(e-h)>=(t-c)*(l-h)&&(t-c)*(i-h)>=(n-c)*(e-h)&&(n-c)*(l-h)>=(a-c)*(i-h)}function eg(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,i){var a=n;do{if(a.i!==n.i&&a.next.i!==n.i&&a.i!==i.i&&a.next.i!==i.i&&tg(a,a.next,n,i))return!0;a=a.next}while(a!==n);return!1}(t,e)&&(zf(t,e)&&zf(e,t)&&function(n,i){var a=n,l=!1,c=(n.x+i.x)/2,h=(n.y+i.y)/2;do{a.y>h!=a.next.y>h&&a.next.y!==a.y&&c<(a.next.x-a.x)*(h-a.y)/(a.next.y-a.y)+a.x&&(l=!l),a=a.next}while(a!==n);return l}(t,e)&&(Lr(t.prev,t,e.prev)||Lr(t,e.prev,e))||Vh(t,e)&&Lr(t.prev,t,t.next)>0&&Lr(e.prev,e,e.next)>0)}function Lr(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Vh(t,e){return t.x===e.x&&t.y===e.y}function tg(t,e,n,i){var a=ng(Lr(t,e,n)),l=ng(Lr(t,e,i)),c=ng(Lr(n,i,t)),h=ng(Lr(n,i,e));return a!==l&&c!==h||!(0!==a||!xv(t,n,e))||!(0!==l||!xv(t,i,e))||!(0!==c||!xv(n,t,i))||!(0!==h||!xv(n,e,i))}function xv(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function ng(t){return t>0?1:t<0?-1:0}function zf(t,e){return Lr(t.prev,t,t.next)<0?Lr(t,e,t.next)>=0&&Lr(t,t.prev,e)>=0:Lr(t,e,t.prev)<0||Lr(t,t.next,e)<0}function ib(t,e){var n=new sb(t.i,t.x,t.y),i=new sb(e.i,e.x,e.y),a=t.next,l=e.prev;return t.next=e,e.prev=t,n.next=a,a.prev=n,i.next=n,n.prev=i,l.next=i,i.prev=l,i}function ob(t,e,n,i){var a=new sb(t,e,n);return i?(a.next=i.next,a.prev=i,i.next.prev=a,i.next=a):(a.prev=a,a.next=a),a}function jh(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function sb(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function wv(t,e,n,i){for(var a=0,l=e,c=n-i;l<n;l+=i)a+=(t[c]-t[l])*(t[l+1]+t[c+1]),c=l;return a}Lf.exports=Ff,Lf.exports.default=Ff,Ff.deviation=function(t,e,n,i){var a=e&&e.length,l=Math.abs(wv(t,0,a?e[0]*n:t.length,n));if(a)for(var c=0,h=e.length;c<h;c++)l-=Math.abs(wv(t,e[c]*n,c<h-1?e[c+1]*n:t.length,n));var f=0;for(c=0;c<i.length;c+=3){var p=i[c]*n,g=i[c+1]*n,_=i[c+2]*n;f+=Math.abs((t[p]-t[_])*(t[g+1]-t[p+1])-(t[p]-t[g])*(t[_+1]-t[p+1]))}return 0===l&&0===f?0:Math.abs((f-l)/l)},Ff.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,a=0;a<t.length;a++){for(var l=0;l<t[a].length;l++)for(var c=0;c<e;c++)n.vertices.push(t[a][l][c]);a>0&&n.holes.push(i+=t[a-1].length)}return n};var bv=oo(Lf.exports);function rg(t,e){const n=t.length;if(n<=1)return[t];const i=[];let a,l;for(let c=0;c<n;c++){const h=we(t[c]);0!==h&&(t[c].area=Math.abs(h),void 0===l&&(l=h<0),l===h<0?(a&&i.push(a),a=[t[c]]):a.push(t[c]))}if(a&&i.push(a),e>1)for(let c=0;c<i.length;c++)i[c].length<=e||(Qt(i[c],e,1,i[c].length-1,ab),i[c]=i[c].slice(0,e));return i}function ab(t,e){return e.area-t.area}function Ev(t,e,n){const i=n.patternDependencies;let a=!1;for(const l of e){const c=l.paint.get(`${t}-pattern`);c.isConstant()||(a=!0);const h=c.constantOr(null);h&&(a=!0,i[h]=!0)}return a}function Bf(t,e,n,i,a){const l=a.patternDependencies;for(const c of e){const h=c.paint.get(`${t}-pattern`).value;if("constant"!==h.kind){let f=h.evaluate({zoom:i},n,{},a.availableImages);f=f&&f.name?f.name:f,l[f]=!0,n.patterns[c.id]=f}}return n}class Cv{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new jo,this.indexArray=new Tr,this.indexArray2=new fs,this.programConfigurations=new xc(e.layers,e.zoom),this.segments=new Cn,this.segments2=new Cn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,i,a){this.hasPattern=Ev("fill",this.layers,n);const l=this.layers[0].layout.get("fill-sort-key"),c=[];for(const{feature:h,id:f,index:p,sourceLayerIndex:g}of e){const _=this.layers[0]._featureFilter.needGeometry,y=_o(h,_);if(!this.layers[0]._featureFilter.filter(new pr(this.zoom),y,i))continue;const v=l?l.evaluate(y,{},i,n.availableImages):void 0,w={id:f,properties:h.properties,type:h.type,sourceLayerIndex:g,index:p,geometry:_?y.geometry:Yt(h,i,a),patterns:{},sortKey:v};c.push(w)}l&&c.sort((h,f)=>h.sortKey-f.sortKey);for(const h of c){const{geometry:f,index:p,sourceLayerIndex:g}=h;if(this.hasPattern){const _=Bf("fill",this.layers,h,this.zoom,n);this.patternFeatures.push(_)}else this.addFeature(h,f,p,i,{},n.availableImages,n.brightness);n.featureIndex.insert(e[p].feature,f,p,g,this.index)}}update(e,n,i,a,l){const c=0!==Object.keys(e).length;c&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,c?this.stateDependentLayers:this.layers,i,a,l)}addFeatures(e,n,i,a,l,c){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,n,i,a,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ze),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,i,a,l,c=[],h){for(const f of rg(n,500)){let p=0;for(const E of f)p+=E.length;const g=this.segments.prepareSegment(p,this.layoutVertexArray,this.indexArray),_=g.vertexLength,y=[],v=[];for(const E of f){if(0===E.length)continue;E!==f[0]&&v.push(y.length/2);const T=this.segments2.prepareSegment(E.length,this.layoutVertexArray,this.indexArray2),C=T.vertexLength;this.layoutVertexArray.emplaceBack(E[0].x,E[0].y),this.indexArray2.emplaceBack(C+E.length-1,C),y.push(E[0].x),y.push(E[0].y);for(let S=1;S<E.length;S++)this.layoutVertexArray.emplaceBack(E[S].x,E[S].y),this.indexArray2.emplaceBack(C+S-1,C+S),y.push(E[S].x),y.push(E[S].y);T.vertexLength+=E.length,T.primitiveLength+=E.length}const w=bv(y,v);for(let E=0;E<w.length;E+=3)this.indexArray.emplaceBack(_+w[E],_+w[E+1],_+w[E+2]);g.vertexLength+=p,g.primitiveLength+=w.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,l,c,a,h)}}Qe(Cv,"FillBucket",{omit:["layers","patternFeatures"]});const dI=new mr({"fill-sort-key":new lt(le.layout_fill["fill-sort-key"]),visibility:new Re(le.layout_fill.visibility)});var fI={paint:new mr({"fill-antialias":new Re(le.paint_fill["fill-antialias"]),"fill-opacity":new lt(le.paint_fill["fill-opacity"]),"fill-color":new lt(le.paint_fill["fill-color"]),"fill-outline-color":new lt(le.paint_fill["fill-outline-color"]),"fill-translate":new Re(le.paint_fill["fill-translate"]),"fill-translate-anchor":new Re(le.paint_fill["fill-translate-anchor"]),"fill-pattern":new lt(le.paint_fill["fill-pattern"]),"fill-emissive-strength":new Re(le.paint_fill["fill-emissive-strength"])}),layout:dI};const pI=wn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),mI=wn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),gI=wn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),_I=wn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),yI=wn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:vI}=pI;var Tv={},Mc=Sa,ig=Uh;function Uh(t,e,n,i,a){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=a,t.readFields(lb,this,e)}function lb(t,e,n){1==t?e.id=n.readVarint():2==t?function(i,a){for(var l=i.readVarint()+i.pos;i.pos<l;){var c=a._keys[i.readVarint()],h=a._values[i.readVarint()];a.properties[c]=h}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function Dv(t){for(var e,n,i=0,a=0,l=t.length,c=l-1;a<l;c=a++)i+=((n=t[c]).x-(e=t[a]).x)*(e.y+n.y);return i}Uh.types=["Unknown","Point","LineString","Polygon"],Uh.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,i=1,a=0,l=0,c=0,h=[];t.pos<n;){if(a<=0){var f=t.readVarint();i=7&f,a=f>>3}if(a--,1===i||2===i)l+=t.readSVarint(),c+=t.readSVarint(),1===i&&(e&&h.push(e),e=[]),e.push(new Mc(l,c));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&h.push(e),h},Uh.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,i=0,a=0,l=0,c=1/0,h=-1/0,f=1/0,p=-1/0;t.pos<e;){if(i<=0){var g=t.readVarint();n=7&g,i=g>>3}if(i--,1===n||2===n)(a+=t.readSVarint())<c&&(c=a),a>h&&(h=a),(l+=t.readSVarint())<f&&(f=l),l>p&&(p=l);else if(7!==n)throw new Error("unknown command "+n)}return[c,f,h,p]},Uh.prototype.toGeoJSON=function(t,e,n){var i,a,l=this.extent*Math.pow(2,n),c=this.extent*t,h=this.extent*e,f=this.loadGeometry(),p=Uh.types[this.type];function g(v){for(var w=0;w<v.length;w++){var E=v[w];v[w]=[360*(E.x+c)/l-180,360/Math.PI*Math.atan(Math.exp((180-360*(E.y+h)/l)*Math.PI/180))-90]}}switch(this.type){case 1:var _=[];for(i=0;i<f.length;i++)_[i]=f[i][0];g(f=_);break;case 2:for(i=0;i<f.length;i++)g(f[i]);break;case 3:for(f=function(v){var w=v.length;if(w<=1)return[v];for(var E,T,C=[],S=0;S<w;S++){var I=Dv(v[S]);0!==I&&(void 0===T&&(T=I<0),T===I<0?(E&&C.push(E),E=[v[S]]):E.push(v[S]))}return E&&C.push(E),C}(f),i=0;i<f.length;i++)for(a=0;a<f[i].length;a++)g(f[i][a])}1===f.length?f=f[0]:p="Multi"+p;var y={type:"Feature",geometry:{type:p,coordinates:f},properties:this.properties};return"id"in this&&(y.id=this.id),y};var cb=ig,og=ub;function ub(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Sc,this,e),this.length=this._features.length}function Sc(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(i){for(var a=null,l=i.readVarint()+i.pos;i.pos<l;){var c=i.readVarint()>>3;a=1===c?i.readString():2===c?i.readFloat():3===c?i.readDouble():4===c?i.readVarint64():5===c?i.readVarint():6===c?i.readSVarint():7===c?i.readBoolean():null}return a}(n))}ub.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new cb(this._pbf,e,this.extent,this._keys,this._values)};var hb=og;function XD(t,e,n){if(3===t){var i=new hb(n,n.readVarint()+n.pos);i.length&&(e[i.name]=i)}}var Mv=Tv.VectorTile=function(t,e){this.layers=t.readFields(XD,{},e)},Vf=Tv.VectorTileFeature=ig;function sg(t,e,n,i){const a=[],l=0===i?(c,h,f,p,g,_)=>{c.push(new ie(_,f+(_-h)/(p-h)*(g-f)))}:(c,h,f,p,g,_)=>{c.push(new ie(h+(_-f)/(g-f)*(p-h),_))};for(const c of t){const h=[];for(const f of c){if(f.length<=2)continue;const p=[];for(let y=0;y<f.length-1;y++){const v=f[y].x,w=f[y].y,E=f[y+1].x,T=f[y+1].y,C=0===i?v:w,S=0===i?E:T;C<e?S>e&&l(p,v,w,E,T,e):C>n?S<n&&l(p,v,w,E,T,n):p.push(f[y]),S<e&&C>=e&&l(p,v,w,E,T,e),S>n&&C<=n&&l(p,v,w,E,T,n)}let g=f[f.length-1];const _=0===i?g.x:g.y;_>=e&&_<=n&&p.push(g),p.length&&(g=p[p.length-1],p[0].x===g.x&&p[0].y===g.y||p.push(p[0]),h.push(p))}h.length&&a.push(h)}return a}Tv.VectorTileLayer=og;class db{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const i=e[n];this._stringToNumber[i]=n,this._numberToString[n]=i}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var ag={read:function(t,e,n,i,a){var l,c,h=8*a-i-1,f=(1<<h)-1,p=f>>1,g=-7,_=n?a-1:0,y=n?-1:1,v=t[e+_];for(_+=y,l=v&(1<<-g)-1,v>>=-g,g+=h;g>0;l=256*l+t[e+_],_+=y,g-=8);for(c=l&(1<<-g)-1,l>>=-g,g+=i;g>0;c=256*c+t[e+_],_+=y,g-=8);if(0===l)l=1-p;else{if(l===f)return c?NaN:1/0*(v?-1:1);c+=Math.pow(2,i),l-=p}return(v?-1:1)*c*Math.pow(2,l-i)},write:function(t,e,n,i,a,l){var c,h,f,p=8*l-a-1,g=(1<<p)-1,_=g>>1,y=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,v=i?0:l-1,w=i?1:-1,E=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(h=isNaN(e)?1:0,c=g):(c=Math.floor(Math.log(e)/Math.LN2),e*(f=Math.pow(2,-c))<1&&(c--,f*=2),(e+=c+_>=1?y/f:y*Math.pow(2,1-_))*f>=2&&(c++,f/=2),c+_>=g?(h=0,c=g):c+_>=1?(h=(e*f-1)*Math.pow(2,a),c+=_):(h=e*Math.pow(2,_-1)*Math.pow(2,a),c=0));a>=8;t[n+v]=255&h,v+=w,h/=256,a-=8);for(c=c<<a|h,p+=a;p>0;t[n+v]=255&c,v+=w,c/=256,p-=8);t[n+v-w]|=128*E}},Mu=Nn,$h=ag;function Nn(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Nn.Varint=0,Nn.Fixed64=1,Nn.Bytes=2,Nn.Fixed32=5;var jf=4294967296,Uf=1/jf,Sv=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Qa(t){return t.type===Nn.Bytes?t.readVarint()+t.pos:t.pos+1}function lg(t,e,n){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(i);for(var a=n.pos-1;a>=t;a--)n.buf[a+i]=n.buf[a]}function fb(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function Av(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function YD(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function xI(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function KD(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function pb(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function JD(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function mb(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function gb(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function cg(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function zi(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function Iv(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Nn.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),a=i>>3,l=this.pos;this.type=7&i,t(a,e,this),this.pos===l&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=cg(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Iv(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=cg(this.buf,this.pos)+cg(this.buf,this.pos+4)*jf;return this.pos+=8,t},readSFixed64:function(){var t=cg(this.buf,this.pos)+Iv(this.buf,this.pos+4)*jf;return this.pos+=8,t},readFloat:function(){var t=$h.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=$h.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,i=this.buf;return e=127&(n=i[this.pos++]),n<128?e:(e|=(127&(n=i[this.pos++]))<<7,n<128?e:(e|=(127&(n=i[this.pos++]))<<14,n<128?e:(e|=(127&(n=i[this.pos++]))<<21,n<128?e:function(a,l,c){var h,f,p=c.buf;if(h=(112&(f=p[c.pos++]))>>4,f<128||(h|=(127&(f=p[c.pos++]))<<3,f<128)||(h|=(127&(f=p[c.pos++]))<<10,f<128)||(h|=(127&(f=p[c.pos++]))<<17,f<128)||(h|=(127&(f=p[c.pos++]))<<24,f<128)||(h|=(1&(f=p[c.pos++]))<<31,f<128))return function Ac(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}(a,h,l);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Sv?Sv.decode(this.buf.subarray(e,t)):function(n,i,a){for(var l="",c=i;c<a;){var h,f,p,g=n[c],_=null,y=g>239?4:g>223?3:g>191?2:1;if(c+y>a)break;1===y?g<128&&(_=g):2===y?128==(192&(h=n[c+1]))&&(_=(31&g)<<6|63&h)<=127&&(_=null):3===y?(f=n[c+2],128==(192&(h=n[c+1]))&&128==(192&f)&&((_=(15&g)<<12|(63&h)<<6|63&f)<=2047||_>=55296&&_<=57343)&&(_=null)):4===y&&(f=n[c+2],p=n[c+3],128==(192&(h=n[c+1]))&&128==(192&f)&&128==(192&p)&&((_=(15&g)<<18|(63&h)<<12|(63&f)<<6|63&p)<=65535||_>=1114112)&&(_=null)),null===_?(_=65533,y=1):_>65535&&(_-=65536,l+=String.fromCharCode(_>>>10&1023|55296),_=56320|1023&_),l+=String.fromCharCode(_),c+=y}return l}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Nn.Bytes)return t.push(this.readVarint(e));var n=Qa(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Nn.Bytes)return t.push(this.readSVarint());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Nn.Bytes)return t.push(this.readBoolean());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Nn.Bytes)return t.push(this.readFloat());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Nn.Bytes)return t.push(this.readDouble());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Nn.Bytes)return t.push(this.readFixed32());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Nn.Bytes)return t.push(this.readSFixed32());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Nn.Bytes)return t.push(this.readFixed64());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Nn.Bytes)return t.push(this.readSFixed64());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Nn.Varint)for(;this.buf[this.pos++]>127;);else if(e===Nn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Nn.Fixed32)this.pos+=4;else{if(e!==Nn.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),zi(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),zi(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),zi(this.buf,-1&t,this.pos),zi(this.buf,Math.floor(t*Uf),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),zi(this.buf,-1&t,this.pos),zi(this.buf,Math.floor(t*Uf),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var i,a,l,h;if(e>=0?(i=e%4294967296|0,a=e/4294967296|0):(a=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,a=a+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),l=i,(h=n).buf[h.pos++]=127&l|128,l>>>=7,h.buf[h.pos++]=127&l|128,l>>>=7,h.buf[h.pos++]=127&l|128,l>>>=7,h.buf[h.pos++]=127&l|128,h.buf[h.pos]=127&(l>>>=7),function(l,c){var h=(7&l)<<4;c.buf[c.pos++]|=h|((l>>>=3)?128:0),l&&(c.buf[c.pos++]=127&l|((l>>>=7)?128:0),l&&(c.buf[c.pos++]=127&l|((l>>>=7)?128:0),l&&(c.buf[c.pos++]=127&l|((l>>>=7)?128:0),l&&(c.buf[c.pos++]=127&l|((l>>>=7)?128:0),l&&(c.buf[c.pos++]=127&l)))))}(a,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(i,a,l){for(var c,h,f=0;f<a.length;f++){if((c=a.charCodeAt(f))>55295&&c<57344){if(!h){c>56319||f+1===a.length?(i[l++]=239,i[l++]=191,i[l++]=189):h=c;continue}if(c<56320){i[l++]=239,i[l++]=191,i[l++]=189,h=c;continue}c=h-55296<<10|c-56320|65536,h=null}else h&&(i[l++]=239,i[l++]=191,i[l++]=189,h=null);c<128?i[l++]=c:(c<2048?i[l++]=c>>6|192:(c<65536?i[l++]=c>>12|224:(i[l++]=c>>18|240,i[l++]=c>>12&63|128),i[l++]=c>>6&63|128),i[l++]=63&c|128)}return l}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&lg(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),$h.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),$h.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var i=this.pos-n;i>=128&&lg(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,n){this.writeTag(t,Nn.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,fb,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Av,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,KD,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,YD,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,xI,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,pb,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,JD,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,mb,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,gb,e)},writeBytesField:function(t,e){this.writeTag(t,Nn.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Nn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Nn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Nn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Nn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Nn.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Nn.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Nn.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Nn.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Nn.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var ug=oo(Mu);const wI=["tile","layer","source","sourceLayer","state"];class _b{constructor(e,n,i,a,l){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=i,this._y=a,this.properties=e.properties,this.id=l}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const n of wI)void 0!==this[n]&&(e[n]=this[n]);return e}}class Pv{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,i){const a=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][a]=this.stateChanges[e][a]||{},Ke(this.stateChanges[e][a],i),null===this.deletedStates[e]){this.deletedStates[e]={};for(const l in this.state[e])l!==a&&(this.deletedStates[e][l]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][a]){this.deletedStates[e][a]={};for(const l in this.state[e][a])i[l]||(this.deletedStates[e][a][l]=null)}else for(const l in i)this.deletedStates[e]&&this.deletedStates[e][a]&&null===this.deletedStates[e][a][l]&&delete this.deletedStates[e][a][l]}removeFeatureState(e,n,i){if(null===this.deletedStates[e])return;const a=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},i&&void 0!==n)null!==this.deletedStates[e][a]&&(this.deletedStates[e][a]=this.deletedStates[e][a]||{},this.deletedStates[e][a][i]=null);else if(void 0!==n)if(this.stateChanges[e]&&this.stateChanges[e][a])for(i in this.deletedStates[e][a]={},this.stateChanges[e][a])this.deletedStates[e][a][i]=null;else this.deletedStates[e][a]=null;else this.deletedStates[e]=null}getState(e,n){const i=String(n),a=Ke({},(this.state[e]||{})[i],(this.stateChanges[e]||{})[i]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const l=this.deletedStates[e][n];if(null===l)return{};for(const c in l)delete a[c]}return a}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const i={};for(const a in this.stateChanges){this.state[a]=this.state[a]||{};const l={};for(const c in this.stateChanges[a])this.state[a][c]||(this.state[a][c]={}),Ke(this.state[a][c],this.stateChanges[a][c]),l[c]=this.state[a][c];i[a]=l}for(const a in this.deletedStates){this.state[a]=this.state[a]||{};const l={};if(null===this.deletedStates[a])for(const c in this.state[a])l[c]={},this.state[a][c]={};else for(const c in this.deletedStates[a]){if(null===this.deletedStates[a][c])this.state[a][c]={};else if(this.state[a][c])for(const h of Object.keys(this.deletedStates[a][c]))delete this.state[a][c][h];l[c]=this.state[a][c]}i[a]=i[a]||{},Ke(i[a],l)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(const a in e)e[a].setFeatureState(i,n)}}class Rv{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const i=this.toIdx(e,n);return{min:this.minimums[i],max:this.maximums[i]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function yb(t,e,n,i){let a=0,l=Number.MAX_VALUE;for(let c=0;c<3;c++)if(Math.abs(i[c])<1e-15){if(n[c]<t[c]||n[c]>e[c])return null}else{const h=1/i[c];let f=(t[c]-n[c])*h,p=(e[c]-n[c])*h;if(f>p){const g=f;f=p,p=g}if(f>a&&(a=f),p<l&&(l=p),a>l)return null}return a}function vb(t,e,n,i,a,l,c,h,f,p,g){const _=i-t,y=a-e,v=l-n,w=c-t,E=h-e,T=f-n,C=g[1]*T-g[2]*E,S=g[2]*w-g[0]*T,I=g[0]*E-g[1]*w,R=_*C+y*S+v*I;if(Math.abs(R)<1e-15)return null;const A=1/R,k=p[0]-t,L=p[1]-e,B=p[2]-n,j=(k*C+L*S+B*I)*A;if(j<0||j>1)return null;const U=L*v-B*y,G=B*_-k*v,$=k*y-L*_,W=(g[0]*U+g[1]*G+g[2]*$)*A;return W<0||j+W>1?null:(w*U+E*G+T*$)*A}function xb(t,e,n){return(t-e)/(n-e)}function kv(t,e,n,i,a,l,c,h,f){const p=1<<n,g=l-i,_=c-a,y=(t+1)/p*g+i,v=(e+0)/p*_+a,w=(e+1)/p*_+a;h[0]=(t+0)/p*g+i,h[1]=v,f[0]=y,f[1]=w}class wb{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(l){const c=Math.ceil(Math.log2(l.dim/8)),h=[];let f=Math.ceil(Math.pow(2,c));const p=1/f,g=(v,w,E,T,C)=>{const S=T?1:0,I=(v+1)*E-S,R=w*E,A=(w+1)*E-S;C[0]=v*E,C[1]=R,C[2]=I,C[3]=A};let _=new Rv(f);const y=[];for(let v=0;v<f*f;v++){g(v%f,Math.floor(v/f),p,!1,y);const w=Ic(y[0],y[1],l),E=Ic(y[2],y[1],l),T=Ic(y[2],y[3],l),C=Ic(y[0],y[3],l);_.minimums.push(Math.min(w,E,T,C)),_.maximums.push(Math.max(w,E,T,C)),_.leaves.push(1)}for(h.push(_),f/=2;f>=1;f/=2){const v=h[h.length-1];_=new Rv(f);for(let w=0;w<f*f;w++){g(w%f,Math.floor(w/f),2,!0,y);const E=v.getElevation(y[0],y[1]),T=v.getElevation(y[2],y[1]),C=v.getElevation(y[2],y[3]),S=v.getElevation(y[0],y[3]),I=v.isLeaf(y[0],y[1]),R=v.isLeaf(y[2],y[1]),A=v.isLeaf(y[2],y[3]),k=v.isLeaf(y[0],y[3]),L=Math.min(E.min,T.min,C.min,S.min),B=Math.max(E.max,T.max,C.max,S.max),j=I&&R&&A&&k;_.maximums.push(B),_.minimums.push(L),_.leaves.push(B-L<=5&&j?1:0)}h.push(_)}return h}(this.dem),i=n.length-1,a=n[i];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(n,0,0,i,0)}raycastRoot(e,n,i,a,l,c,h=1){return yb([e,n,-100],[i,a,this.maximums[0]*h],l,c)}raycast(e,n,i,a,l,c,h=1){if(!this.nodeCount)return null;const f=this.raycastRoot(e,n,i,a,l,c,h);if(null==f)return null;const p=[],g=[],_=[],y=[],v=[{idx:0,t:f,nodex:0,nodey:0,depth:0}];for(;v.length>0;){const{idx:w,t:E,nodex:T,nodey:C,depth:S}=v.pop();if(this.leaves[w]){kv(T,C,S,e,n,i,a,_,y);const R=1<<S,A=(T+0)/R,k=(T+1)/R,L=(C+0)/R,B=(C+1)/R,j=Ic(A,L,this.dem)*h,U=Ic(k,L,this.dem)*h,G=Ic(k,B,this.dem)*h,$=Ic(A,B,this.dem)*h,W=vb(_[0],_[1],j,y[0],_[1],U,y[0],y[1],G,l,c),H=vb(y[0],y[1],G,_[0],y[1],$,_[0],_[1],j,l,c),J=Math.min(null!==W?W:Number.MAX_VALUE,null!==H?H:Number.MAX_VALUE);if(J!==Number.MAX_VALUE)return J;{const te=Z.scaleAndAdd([],l,c,E);if(Ov(j,U,$,G,xb(te[0],_[0],y[0]),xb(te[1],_[1],y[1]))>=te[2])return E}continue}let I=0;for(let R=0;R<this._siblingOffset.length;R++){kv((T<<1)+this._siblingOffset[R][0],(C<<1)+this._siblingOffset[R][1],S+1,e,n,i,a,_,y),_[2]=-100,y[2]=this.maximums[this.childOffsets[w]+R]*h;const A=yb(_,y,l,c);if(null!=A){const k=A;p[R]=k;let L=!1;for(let B=0;B<I&&!L;B++)k>=p[g[B]]&&(g.splice(B,0,R),L=!0);L||(g[I]=R),I++}}for(let R=0;R<I;R++){const A=g[R];v.push({idx:this.childOffsets[w]+A,t:p[A],nodex:(T<<1)+this._siblingOffset[A][0],nodey:(C<<1)+this._siblingOffset[A][1],depth:S+1})}}return null}_addNode(e,n,i){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,i,a,l){if(1===e[a].isLeaf(n,i))return;this.childOffsets[l]||(this.childOffsets[l]=this.nodeCount);const c=a-1,h=e[c];let f=0,p=0;for(let g=0;g<this._siblingOffset.length;g++){const _=2*n+this._siblingOffset[g][0],y=2*i+this._siblingOffset[g][1],v=h.getElevation(_,y),w=h.isLeaf(_,y),E=this._addNode(v.min,v.max,w);w&&(f|=1<<g),p||(p=E)}for(let g=0;g<this._siblingOffset.length;g++)f&1<<g||this._construct(e,2*n+this._siblingOffset[g][0],2*i+this._siblingOffset[g][1],c,p+g)}}function Ov(t,e,n,i,a,l){return wt(wt(t,n,l),wt(e,i,l),a)}function Ic(t,e,n){const i=n.dim,a=et(t*i-.5,0,i-1),l=et(e*i-.5,0,i-1),c=Math.floor(a),h=Math.floor(l),f=Math.min(c+1,i-1),p=Math.min(h+1,i-1);return Ov(n.get(c,h),n.get(f,h),n.get(c,p),n.get(f,p),a-c,l-h)}const bb={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768],float:[1,1,1,1]};function hg(t,e,n){return(256*t*256+256*e+n)/10-1e4}function dg(t,e,n){return 256*t+e+n/256-32768}class Su{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,i,a,l=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(i&&"mapbox"!==i&&"terrarium"!==i)return ee(`"${i}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const c=this.dim=n.height-2,h=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.encoding=i||"mapbox",this.borderReady=l,this._modifiedForSources={},!l){for(let f=0;f<c;f++)h[this._idx(-1,f)]=h[this._idx(0,f)],h[this._idx(c,f)]=h[this._idx(c-1,f)],h[this._idx(f,-1)]=h[this._idx(f,0)],h[this._idx(f,c)]=h[this._idx(f,c-1)];h[this._idx(-1,-1)]=h[this._idx(0,0)],h[this._idx(c,-1)]=h[this._idx(c-1,0)],h[this._idx(-1,c)]=h[this._idx(0,c-1)],h[this._idx(c,c)]=h[this._idx(c-1,c-1)]}if(a){const f=new Float32Array(n.data.buffer),p="terrarium"===this.encoding?dg:hg;for(let g=0;g<h.length;++g){const _=4*g;f[g]=p(this.pixels[_],this.pixels[_+1],this.pixels[_+2])}this.encoding="float"}this._timestamp=Ct.now()}_buildQuadTree(){this._tree=new wb(this)}get(e,n,i=!1){i&&(e=et(e,-1,this.dim),n=et(n,-1,this.dim));const a=this._idx(e,n);if("float"===this.encoding)return this.floatView||(this.floatView=new Float32Array(this.pixels.buffer)),this.floatView[a];const l=4*a;return("terrarium"===this.encoding?dg:hg)(this.pixels[l],this.pixels[l+1],this.pixels[l+2])}set(e,n,i){const a=this._idx(e,n);if("float"===this.encoding){this.floatView||(this.floatView=new Float32Array(this.pixels.buffer));const f=this.floatView[a];return this.floatView[a]=i,i-f}const l=4*a,c=("terrarium"===this.encoding?dg:hg)(this.pixels[l],this.pixels[l+1],this.pixels[l+2]),h=Su.pack(i,"terrarium"===this.encoding?"terrarium":"mapbox");return this.pixels[l]=h[0],this.pixels[l+1]=h[1],this.pixels[l+2]=h[2],i-c}static getUnpackVector(e){return bb[e]}get unpackVector(){return bb[this.encoding]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){const i=[0,0,0,0],a=Su.getUnpackVector(n);let l=Math.floor((e+a[3])/a[2]);return i[2]=l%256,l=Math.floor(l/256),i[1]=l%256,l=Math.floor(l/256),i[0]=l,i}getPixels(){return"float"===this.encoding?new fv({width:this.stride,height:this.stride},this.pixels):new Sr({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,i){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let a=n*this.dim,l=n*this.dim+this.dim,c=i*this.dim,h=i*this.dim+this.dim;switch(n){case-1:a=l-1;break;case 1:l=a+1}switch(i){case-1:c=h-1;break;case 1:h=c+1}const f=-n*this.dim,p=-i*this.dim;for(let g=c;g<h;g++)for(let _=a;_<l;_++){const y=4*this._idx(_,g),v=4*this._idx(_+f,g+p);this.pixels[y+0]=e.pixels[v+0],this.pixels[y+1]=e.pixels[v+1],this.pixels[y+2]=e.pixels[v+2],this.pixels[y+3]=e.pixels[v+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Qe(Su,"DEMData"),Qe(wb,"DemMinMaxQuadTree",{omit:["dem"]});class Pc{constructor(e,n,i){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=i}static create(e,n,i){const a=i||e.findDEMTileFor(n);if(!a||!a.dem)return;const l=a.dem,c=a.tileID,h=1<<n.canonical.z-c.canonical.z;return new Pc(a,l.dim/he/h,[(n.canonical.x/h-c.canonical.x)*l.dim,(n.canonical.y/h-c.canonical.y)*l.dim])}tileCoordToPixel(e,n){const i=n*this._scale+this._offset[1],a=Math.floor(e*this._scale+this._offset[0]),l=Math.floor(i);return new ie(a,l)}getElevationAt(e,n,i,a){const l=e*this._scale+this._offset[0],c=n*this._scale+this._offset[1],h=Math.floor(l),f=Math.floor(c),p=this._dem;return a=!!a,i?wt(wt(p.get(h,f,a),p.get(h,f+1,a),c-f),wt(p.get(h+1,f,a),p.get(h+1,f+1,a),c-f),l-h):p.get(h,f,a)}getElevationAtPixel(e,n,i){return this._dem.get(e,n,!!i)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*kn(1,e)*this._dem.stride}}class Lv{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new bh(he,16,0),this.featureIndexArray=new mD,this.promoteId=n}insert(e,n,i,a,l,c=0){const h=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,a,l,c);const f=this.grid;for(let p=0;p<n.length;p++){const g=n[p],_=[1/0,1/0,-1/0,-1/0];for(let y=0;y<g.length;y++){const v=g[y];_[0]=Math.min(_[0],v.x),_[1]=Math.min(_[1],v.y),_[2]=Math.max(_[2],v.x),_[3]=Math.max(_[3],v.y)}_[0]<he&&_[1]<he&&_[2]>=0&&_[3]>=0&&f.insert(h,_[0],_[1],_[2],_[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Mv(new ug(this.rawTileData)).layers,this.sourceLayerCoder=new db(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,i,a){this.loadVTLayers();const l=e.params||{},c=vh(l.filter),h=e.tileResult,f=e.transform,p=h.bufferedTilespaceBounds,g=this.grid.query(p.min.x,p.min.y,p.max.x,p.max.y,(w,E,T,C)=>Ww(h.bufferedTilespaceGeometry,w,E,T,C));g.sort(bI);let _=null;f.elevation&&g.length>0&&(_=Pc.create(f.elevation,this.tileID));const y={};let v;for(let w=0;w<g.length;w++){const E=g[w];if(E===v)continue;v=E;const T=this.featureIndexArray.get(E);let C=null;this.loadMatchingFeature(y,T,c,l.layers,l.availableImages,n,i,a,(S,I,R,A=0)=>(C||(C=Yt(S,this.tileID.canonical,e.tileTransform)),I.queryIntersectsFeature(h,S,R,C,this.z,e.transform,e.pixelPosMatrix,_,A)))}return y}loadMatchingFeature(e,n,i,a,l,c,h,f,p){const{featureIndex:g,bucketIndex:_,sourceLayerIndex:y,layoutVertexArrayOffset:v}=n,w=this.bucketLayerIDs[_];if(a&&!function(S,I){for(let R=0;R<S.length;R++)if(I.indexOf(S[R])>=0)return!0;return!1}(a,w))return;const E=this.sourceLayerCoder.decode(y),T=this.vtLayers[E].feature(g);if(i.needGeometry){const S=_o(T,!0);if(!i.filter(new pr(this.tileID.overscaledZ),S,this.tileID.canonical))return}else if(!i.filter(new pr(this.tileID.overscaledZ),T))return;const C=this.getId(T,E);for(let S=0;S<w.length;S++){const I=w[S];if(a&&a.indexOf(I)<0)continue;const R=c[I];if(!R)continue;let A={};void 0!==C&&f&&(A=f.getState(R.sourceLayer||"_geojsonTileLayer",C));const k=Ke({},h[I]);k.paint=Eb(k.paint,R.paint,T,A,l),k.layout=Eb(k.layout,R.layout,T,A,l);const L=!p||p(T,R,A,v);if(!L)continue;const B=new _b(T,this.z,this.x,this.y,C);B.layer=k;let j=e[I];void 0===j&&(j=e[I]=[]),j.push({featureIndex:g,feature:B,intersectionZ:L})}}lookupSymbolFeatures(e,n,i,a,l,c,h,f){const p={};this.loadVTLayers();const g=vh(l);for(const _ of e)this.loadMatchingFeature(p,{bucketIndex:i,sourceLayerIndex:a,featureIndex:_,layoutVertexArrayOffset:0},g,c,h,f,n);return p}loadFeature(e){const{featureIndex:n,sourceLayerIndex:i}=e;this.loadVTLayers();const a=this.sourceLayerCoder.decode(i),l=this.vtFeatures[a];if(l[n])return l[n];const c=this.vtLayers[a].feature(n);return l[n]=c,c}hasLayer(e){for(const n of this.bucketLayerIDs)for(const i of n)if(e===i)return!0;return!1}getId(e,n){let i=e.id;if(this.promoteId){const a="string"==typeof this.promoteId?this.promoteId:this.promoteId[n];null!=a&&(i=e.properties[a]),"boolean"==typeof i&&(i=Number(i))}return i}}function Eb(t,e,n,i,a){return Ws(t,(l,c)=>{const h=e instanceof yf?e.get(c):null;return h&&h.evaluate?h.evaluate(n,i,a):h})}function bI(t,e){return e-t}Qe(Lv,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Cb=wn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),QD=wn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),eM=wn([{name:"a_projected_pos",components:4,type:"Float32"}],4);wn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const tM=wn([{name:"a_z_offset",components:1,type:"Float32"}],4),Fv=wn([{name:"a_texb",components:2,type:"Uint16"}]),nM=wn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),rM=wn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);wn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const $f=wn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Nv=wn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);wn([{name:"triangle",components:3,type:"Uint16"}]),wn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),wn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),wn([{type:"Float32",name:"offsetX"}]),wn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);const tl=128;function Hf(t,e){const{expression:n}=e;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new pr(t+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:i,interpolationType:a}=n;let l=0;for(;l<i.length&&i[l]<=t;)l++;l=Math.max(0,l-1);let c=l;for(;c<i.length&&i[c]<t+1;)c++;c=Math.min(i.length-1,c);const h=i[l],f=i[c];return"composite"===n.kind?{kind:"composite",minZoom:h,maxZoom:f,interpolationType:a}:{kind:"camera",minZoom:h,maxZoom:f,minSize:n.evaluate(new pr(h)),maxSize:n.evaluate(new pr(f)),interpolationType:a}}}function fg(t,{uSize:e,uSizeT:n},{lowerSize:i,upperSize:a}){return"source"===t.kind?i/tl:"composite"===t.kind?wt(i/tl,a/tl,n):e}function pa(t,e){let n=0,i=0;if("constant"===t.kind)i=t.layoutSize;else if("source"!==t.kind){const{interpolationType:a,minZoom:l,maxZoom:c}=t,h=a?et(Is.interpolationFactor(a,e,l,c),0,1):0;"camera"===t.kind?i=wt(t.minSize,t.maxSize,h):n=h}return{uSizeT:n,uSize:i}}var Tb=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:tl,evaluateSizeForFeature:fg,evaluateSizeForZoom:pa,getSizeData:Hf});function Db(t,e,n){return t.sections.forEach(i=>{i.text=function(a,l,c){const h=l.layout.get("text-transform").evaluate(c,{});return"uppercase"===h?a=a.toLocaleUpperCase():"lowercase"===h&&(a=a.toLocaleLowerCase()),mo.applyArabicShaping&&(a=mo.applyArabicShaping(a)),a}(i.text,e,n)}),t}const Hh={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function zv(t){return"\ufe36"===t||"\ufe48"===t||"\ufe38"===t||"\ufe44"===t||"\ufe42"===t||"\ufe3e"===t||"\ufe3c"===t||"\ufe3a"===t||"\ufe18"===t||"\ufe40"===t||"\ufe10"===t||"\ufe13"===t||"\ufe14"===t||"\uff40"===t||"\uffe3"===t||"\ufe11"===t||"\ufe12"===t}function Nl(t){return"\ufe35"===t||"\ufe47"===t||"\ufe37"===t||"\ufe43"===t||"\ufe41"===t||"\ufe3d"===t||"\ufe3b"===t||"\ufe39"===t||"\ufe17"===t||"\ufe3f"===t}function pg(t,e,n){e.glyphs=[],1===t&&n.readMessage(Gf,e)}function Gf(t,e,n){if(3===t){const{id:i,bitmap:a,width:l,height:c,left:h,top:f,advance:p}=n.readMessage(iM,{});e.glyphs.push({id:i,bitmap:new Ja({width:l+6,height:c+6},a),metrics:{width:l,height:c,left:h,top:f,advance:p}})}else 4===t?e.ascender=n.readSVarint():5===t&&(e.descender=n.readSVarint())}function iM(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}function gg(t){let e=0,n=0;for(const c of t)e+=c.w*c.h,n=Math.max(n,c.w);t.sort((c,h)=>h.h-c.h);const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let a=0,l=0;for(const c of t)for(let h=i.length-1;h>=0;h--){const f=i[h];if(!(c.w>f.w||c.h>f.h)){if(c.x=f.x,c.y=f.y,l=Math.max(l,c.y+c.h),a=Math.max(a,c.x+c.w),c.w===f.w&&c.h===f.h){const p=i.pop();h<i.length&&(i[h]=p)}else c.h===f.h?(f.x+=c.w,f.w-=c.w):c.w===f.w?(f.y+=c.h,f.h-=c.h):(i.push({x:f.x+c.w,y:f.y,w:f.w-c.w,h:c.h}),f.y+=c.h,f.h-=c.h);break}}return{w:a,h:l,fill:e/(a*l)||0}}class Bv{constructor(e,{pixelRatio:n,version:i,stretchX:a,stretchY:l,content:c}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=a,this.stretchY=l,this.content=c,this.version=i}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class qh{constructor(e,n){const i={},a={};this.haveRenderCallbacks=[];const l=[];this.addImages(e,i,l),this.addImages(n,a,l);const{w:c,h}=gg(l),f=new Sr({width:c||1,height:h||1});for(const p in e){const g=e[p],_=i[p].paddedRect;Sr.copy(g.data,f,{x:0,y:0},{x:_.x+1,y:_.y+1},g.data)}for(const p in n){const g=n[p],_=a[p].paddedRect,y=_.x+1,v=_.y+1,w=g.data.width,E=g.data.height;Sr.copy(g.data,f,{x:0,y:0},{x:y,y:v},g.data),Sr.copy(g.data,f,{x:0,y:E-1},{x:y,y:v-1},{width:w,height:1}),Sr.copy(g.data,f,{x:0,y:0},{x:y,y:v+E},{width:w,height:1}),Sr.copy(g.data,f,{x:w-1,y:0},{x:y-1,y:v},{width:1,height:E}),Sr.copy(g.data,f,{x:0,y:0},{x:y+w,y:v},{width:1,height:E})}this.image=f,this.iconPositions=i,this.patternPositions=a}addImages(e,n,i){for(const a in e){const l=e[a],c={x:0,y:0,w:l.data.width+2,h:l.data.height+2};i.push(c),n[a]=new Bv(c,l),l.hasRenderCallback&&this.haveRenderCallbacks.push(a)}}patchUpdatedImages(e,n,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>e.hasImage(a,i)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,i);for(const a in e.getUpdatedImages(i))this.patchUpdatedImage(this.iconPositions[a],e.getImage(a,i),n),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a,i),n)}patchUpdatedImage(e,n,i){if(!e||!n||e.version===n.version)return;e.version=n.version;const[a,l]=e.tl;i.update(n.data,void 0,{x:a,y:l})}}Qe(Bv,"ImagePosition"),Qe(qh,"ImageAtlas");const or={horizontal:1,vertical:2,horizontalOnly:3};class qf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const i=new qf;return i.scale=e||1,i.fontStack=n,i}static forImage(e){const n=new qf;return n.imageName=e,n}}class Wf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const i=new Wf;for(let a=0;a<e.sections.length;a++){const l=e.sections[a];l.image?i.addImageSection(l):i.addTextSection(l,n)}return i}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,i){let a="";for(let l=0;l<n.length;l++){const c=n.charCodeAt(l+1)||null,h=n.charCodeAt(l-1)||null;a+=!i&&(c&&dD(c)&&!Hh[n[l+1]]||h&&dD(h)&&!Hh[n[l-1]])||!Hh[n[l]]?n[l]:Hh[n[l]]}return a}(this.text,e)}trim(){let e=0;for(let i=0;i<this.text.length&&_g[this.text.charCodeAt(i)];i++)e++;let n=this.text.length;for(let i=this.text.length-1;i>=0&&i>=e&&_g[this.text.charCodeAt(i)];i--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const i=new Wf;return i.text=this.text.substring(e,n),i.sectionIndex=this.sectionIndex.slice(e,n),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(qf.forText(e.scale,e.fontStack||n));const i=this.sections.length-1;for(let a=0;a<e.text.length;++a)this.sectionIndex.push(i)}addImageSection(e){const n=e.image?e.image.namePrimary:"";if(0===n.length)return void ee("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCodePoint(i),this.sections.push(qf.forImage(n)),this.sectionIndex.push(this.sections.length-1)):ee("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Vv(t,e,n,i,a,l,c,h,f,p,g,_,y,v,w){const E=Wf.fromFeature(t,a);_===or.vertical&&E.verticalizePunctuation(y);let T=[];const C=function(k,L,B,j,U,G){if(!k)return[];const $=[],W=function(oe,K,Q,ae,ue,fe){let ge=0;for(let ve=0;ve<oe.length();ve++){const de=oe.getSection(ve);ge+=jv(oe.getCodePoint(ve),de,ae,ue,K,fe)}return ge/Math.max(1,Math.ceil(ge/Q))}(k,L,B,j,U,G),H=k.text.indexOf("\u200b")>=0;let J=0;for(let oe=0;oe<k.length();oe++){const K=k.getSection(oe),Q=k.getCodePoint(oe);if(_g[Q]||(J+=jv(Q,K,j,U,L,G)),oe<k.length()-1){const ae=!((te=Q)<11904||!(nt_Bopomofo_Extended(te)||nt_Bopomofo(te)||nt_CJK_Compatibility_Forms(te)||nt_CJK_Compatibility_Ideographs(te)||nt_CJK_Compatibility(te)||nt_CJK_Radicals_Supplement(te)||nt_CJK_Strokes(te)||nt_CJK_Symbols_and_Punctuation(te)||nt_CJK_Unified_Ideographs_Extension_A(te)||nt_CJK_Unified_Ideographs(te)||nt_Enclosed_CJK_Letters_and_Months(te)||nt_Halfwidth_and_Fullwidth_Forms(te)||nt_Hiragana(te)||nt_Ideographic_Description_Characters(te)||nt_Kangxi_Radicals(te)||nt_Katakana_Phonetic_Extensions(te)||nt_Katakana(te)||nt_Vertical_Forms(te)||nt_Yi_Radicals(te)||nt_Yi_Syllables(te)));(sM[Q]||ae||K.imageName)&&$.push(yg(oe+1,J,W,$,aM(Q,k.getCodePoint(oe+1),ae&&H),!1))}}var te;return Mb(yg(k.length(),J,W,$,0,!0))}(E,p,l,e,i,v),{processBidirectionalText:S,processStyledBidirectionalText:I}=mo;if(S&&1===E.sections.length){const k=S(E.toString(),C);for(const L of k){const B=new Wf;B.text=L,B.sections=E.sections;for(let j=0;j<L.length;j++)B.sectionIndex.push(0);T.push(B)}}else if(I){const k=I(E.text,E.sectionIndex,C);for(const L of k){const B=new Wf;B.text=L[0],B.sectionIndex=L[1],B.sections=E.sections,T.push(B)}}else T=function(k,L){const B=[],j=k.text;let U=0;for(const G of L)B.push(k.substring(U,G)),U=G;return U<j.length&&B.push(k.substring(U,j.length)),B}(E,C);const R=[],A={positionedLines:R,text:E.toString(),top:g[1],bottom:g[1],left:g[0],right:g[0],writingMode:_,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(k,L,B,j,U,G,$,W,H,J,te,oe){let K=0,Q=0,ae=0;const ue="right"===W?1:"left"===W?0:.5;let fe=!1;for(const qe of U){const Ge=qe.getSections();for(const We of Ge){if(We.imageName)continue;const it=L[We.fontStack];if(it&&(fe=void 0!==it.ascender&&void 0!==it.descender,!fe))break}if(!fe)break}let ge=0;for(const qe of U){qe.trim();const Ge=qe.getMaxScale(),We=24*(Ge-1),it={positionedGlyphs:[],lineOffset:0};k.positionedLines[ge]=it;const gt=it.positionedGlyphs;let zt=0;if(!qe.length()){Q+=G,++ge;continue}let an=0,Ft=0;for(let pt=0;pt<qe.length();pt++){const ut=qe.getSection(pt),Kt=qe.getSectionIndex(pt),dn=qe.getCodePoint(pt);let Bt=ut.scale,Rn=null,Jn=null,Xn=null,Hn=24,Nr=0;const Qn=!(H===or.horizontal||!te&&!_c(dn)||te&&(_g[dn]||(ve=dn,nt_Arabic(ve)||nt_Arabic_Supplement(ve)||nt_Arabic_Extended_A(ve)||nt_Arabic_Presentation_Forms_A(ve)||nt_Arabic_Presentation_Forms_B(ve))));if(ut.imageName){const sr=j[ut.imageName];if(!sr)continue;Xn=ut.imageName,k.iconsInText=k.iconsInText||!0,Jn=sr.paddedRect;const In=sr.displaySize;Bt=24*Bt/oe,Rn={width:In[0],height:In[1],left:1,top:-3,advance:Qn?In[1]:In[0],localGlyph:!1},Nr=fe?-Rn.height*Bt:24*Ge-17-In[1]*Bt,Hn=Rn.advance;const xo=(Qn?In[0]:In[1])*Bt-24*Ge;xo>0&&xo>zt&&(zt=xo)}else{const sr=B[ut.fontStack];if(!sr)continue;sr[dn]&&(Jn=sr[dn]);const In=L[ut.fontStack];if(!In)continue;const xo=In.glyphs[dn];if(!xo)continue;if(Rn=xo.metrics,Hn=8203!==dn?24:0,fe){const ul=void 0!==In.ascender?Math.abs(In.ascender):0,Bc=void 0!==In.descender?Math.abs(In.descender):0,hl=(ul+Bc)*Bt;an<hl&&(an=hl,Ft=(ul-Bc)/2*Bt),Nr=-ul*Bt}else Nr=24*(Ge-Bt)-17}Qn?(k.verticalizable=!0,gt.push({glyph:dn,imageName:Xn,x:K,y:Q+Nr,vertical:Qn,scale:Bt,localGlyph:Rn.localGlyph,fontStack:ut.fontStack,sectionIndex:Kt,metrics:Rn,rect:Jn}),K+=Hn*Bt+J):(gt.push({glyph:dn,imageName:Xn,x:K,y:Q+Nr,vertical:Qn,scale:Bt,localGlyph:Rn.localGlyph,fontStack:ut.fontStack,sectionIndex:Kt,metrics:Rn,rect:Jn}),K+=Rn.advance*Bt+J)}0!==gt.length&&(ae=Math.max(K-J,ae),fe?Sb(gt,ue,zt,Ft,G*Ge/2):Sb(gt,ue,zt,0,G/2)),K=0;const Dt=G*Ge+zt;it.lineOffset=Math.max(zt,We),Q+=Dt,++ge}var ve;const de=Q,{horizontalAlign:me,verticalAlign:Oe}=vg($);(function(qe,Ge,We,it,gt,zt){const an=(Ge-We)*gt,Ft=-zt*it;for(const Dt of qe)for(const pt of Dt.positionedGlyphs)pt.x+=an,pt.y+=Ft})(k.positionedLines,ue,me,Oe,ae,de),k.top+=-Oe*de,k.bottom=k.top+de,k.left+=-me*ae,k.right=k.left+ae,k.hasBaseline=fe}(A,e,n,i,T,c,h,f,_,p,y,w),!function(k){for(const L of k)if(0!==L.positionedGlyphs.length)return!1;return!0}(R)&&A}const _g={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},sM={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function jv(t,e,n,i,a,l){if(e.imageName){const c=i[e.imageName];return c?c.displaySize[0]*e.scale*24/l+a:0}{const c=n[e.fontStack],h=c&&c.glyphs[t];return h?h.metrics.advance*e.scale+a:0}}function ur(t,e,n,i){const a=Math.pow(t-e,2);return i?t<e?a/2:2*a:a+Math.abs(n)*n}function aM(t,e,n){let i=0;return 10===t&&(i-=1e4),n&&(i+=150),40!==t&&65288!==t||(i+=50),41!==e&&65289!==e||(i+=50),i}function yg(t,e,n,i,a,l){let c=null,h=ur(e,n,a,l);for(const f of i){const p=ur(e-f.x,n,a,l)+f.badness;p<=h&&(c=f,h=p)}return{index:t,x:e,priorBreak:c,badness:h}}function Mb(t){return t?Mb(t.priorBreak).concat(t.index):[]}function vg(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function Sb(t,e,n,i,a){if(!(e||n||i||a))return;const l=t.length-1,c=t[l],h=(c.x+c.metrics.advance*c.scale)*e;for(let f=0;f<=l;f++)t[f].x-=h,t[f].y+=n+i+a}function lM(t,e,n,i){const{horizontalAlign:a,verticalAlign:l}=vg(i),c=n[0]-t.displaySize[0]*a,h=n[1]-t.displaySize[1]*l;return{imagePrimary:t,imageSecondary:e,top:h,bottom:h+t.displaySize[1],left:c,right:c+t.displaySize[0]}}function Ab(t,e,n,i,a,l){const c=t.imagePrimary;let h;if(c.content){const T=c.content,C=c.pixelRatio||1;h=[T[0]/C,T[1]/C,c.displaySize[0]-T[2]/C,c.displaySize[1]-T[3]/C]}const f=e.left*l,p=e.right*l;let g,_,y,v;"width"===n||"both"===n?(v=a[0]+f-i[3],_=a[0]+p+i[1]):(v=a[0]+(f+p-c.displaySize[0])/2,_=v+c.displaySize[0]);const w=e.top*l,E=e.bottom*l;return"height"===n||"both"===n?(g=a[1]+w-i[0],y=a[1]+E+i[2]):(g=a[1]+(w+E-c.displaySize[1])/2,y=g+c.displaySize[1]),{imagePrimary:c,imageSecondary:void 0,top:g,right:_,bottom:y,left:v,collisionPadding:h}}class zl extends ie{constructor(e,n,i,a,l){super(e,n),this.angle=a,this.z=i,void 0!==l&&(this.segment=l)}clone(){return new zl(this.x,this.y,this.z,this.angle,this.segment)}}function Zf(t,e,n,i,a){if(void 0===e.segment)return!0;let l=e,c=e.segment+1,h=0;for(;h>-n/2;){if(c--,c<0)return!1;h-=t[c].dist(l),l=t[c]}h+=t[c].dist(t[c+1]),c++;const f=[];let p=0;for(;h<n/2;){const g=t[c],_=t[c+1];if(!_)return!1;let y=t[c-1].angleTo(g)-g.angleTo(_);for(y=Math.abs((y+3*Math.PI)%(2*Math.PI)-Math.PI),f.push({distance:h,angleDelta:y}),p+=y;h-f[0].distance>i;)p-=f.shift().angleDelta;if(p>a)return!1;c++,h+=g.dist(_)}return!0}function Rc(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function cM(t,e,n){return t?.6*e*n:0}function Wh(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function uM(t,e,n,i,a,l){const c=cM(n,a,l),h=Wh(n,i)*l;let f=0;const p=Rc(t)/2;for(let g=0;g<t.length-1;g++){const _=t[g],y=t[g+1],v=_.dist(y);if(f+v>p){const w=(p-f)/v,E=wt(_.x,y.x,w),T=wt(_.y,y.y,w),C=new zl(E,T,0,y.angleTo(_),g);return!c||Zf(t,C,h,c,e)?C:void 0}f+=v}}function hM(t,e,n,i,a,l,c,h,f){const p=cM(i,l,c),g=Wh(i,a),_=g*c,y=0===t[0].x||t[0].x===f||0===t[0].y||t[0].y===f;return e-_<e/4&&(e=_+e/4),xg(t,y?e/2*h%e:(g/2+2*l)*c*h%e,e,p,n,_,y,!1,f)}function xg(t,e,n,i,a,l,c,h,f){const p=l/2,g=Rc(t);let _=0,y=e-n,v=[];for(let w=0;w<t.length-1;w++){const E=t[w],T=t[w+1],C=E.dist(T),S=T.angleTo(E);for(;y+n<_+C;){y+=n;const I=(y-_)/C,R=wt(E.x,T.x,I),A=wt(E.y,T.y,I);if(R>=0&&R<f&&A>=0&&A<f&&y-p>=0&&y+p<=g){const k=new zl(R,A,0,S,w);i&&!Zf(t,k,l,i,a)||v.push(k)}}_+=C}return h||v.length||c||(v=xg(t,_/2,n,i,a,l,c,!0,f)),v}function Ib(t,e,n,i,a){const l=[];for(let c=0;c<t.length;c++){const h=t[c];let f;for(let p=0;p<h.length-1;p++){let g=h[p],_=h[p+1];g.x<e&&_.x<e||(g.x<e?g=new ie(e,g.y+(e-g.x)/(_.x-g.x)*(_.y-g.y))._round():_.x<e&&(_=new ie(e,g.y+(e-g.x)/(_.x-g.x)*(_.y-g.y))._round()),g.y<n&&_.y<n||(g.y<n?g=new ie(g.x+(n-g.y)/(_.y-g.y)*(_.x-g.x),n)._round():_.y<n&&(_=new ie(g.x+(n-g.y)/(_.y-g.y)*(_.x-g.x),n)._round()),g.x>=i&&_.x>=i||(g.x>=i?g=new ie(i,g.y+(i-g.x)/(_.x-g.x)*(_.y-g.y))._round():_.x>=i&&(_=new ie(i,g.y+(i-g.x)/(_.x-g.x)*(_.y-g.y))._round()),g.y>=a&&_.y>=a||(g.y>=a?g=new ie(g.x+(a-g.y)/(_.y-g.y)*(_.x-g.x),a)._round():_.y>=a&&(_=new ie(g.x+(a-g.y)/(_.y-g.y)*(_.x-g.x),a)._round()),f&&g.equals(f[f.length-1])||(f=[g],l.push(f)),f.push(_)))))}}return l}Qe(zl,"Anchor");const Go=1e20;function Zh(t,e,n,i,a,l,c,h,f){for(let p=e;p<e+i;p++)to(t,n*l+p,l,a,c,h,f);for(let p=n;p<n+a;p++)to(t,p*l+e,1,i,c,h,f)}function to(t,e,n,i,a,l,c){l[0]=0,c[0]=-Go,c[1]=Go,a[0]=t[e];for(let h=1,f=0,p=0;h<i;h++){a[h]=t[e+h*n];const g=h*h;do{const _=l[f];p=(a[h]-a[_]+g-_*_)/(h-_)/2}while(p<=c[f]&&--f>-1);f++,l[f]=h,c[f]=p,c[f+1]=Go}for(let h=0,f=0;h<i;h++){for(;c[f+1]<h;)f++;const p=l[f],g=h-p;t[e+h*n]=a[p]+g*g}}class Bl{constructor(e,n,i){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=i,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,i){const a=[],l=this.urls[n]||Rt.GLYPHS_URL;for(const c in e)for(const h of e[c])a.push({stack:c,id:h});gl(a,({stack:c,id:h},f)=>{let p=this.entries[c];p||(p=this.entries[c]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let g=p.glyphs[h];if(void 0!==g)return void f(null,{stack:c,id:h,glyph:g});if(g=this._tinySDF(p,c,h),g)return p.glyphs[h]=g,void f(null,{stack:c,id:h,glyph:g});const _=Math.floor(h/256);if(256*_>65535)return void f(new Error("glyphs > 65535 not supported"));if(p.ranges[_])return void f(null,{stack:c,id:h,glyph:g});let y=p.requests[_];y||(y=p.requests[_]=[],Bl.loadGlyphRange(c,_,l,this.requestManager,(v,w)=>{if(w){p.ascender=w.ascender,p.descender=w.descender;for(const E in w.glyphs)this._doesCharSupportLocalGlyph(+E)||(p.glyphs[+E]=w.glyphs[+E]);p.ranges[_]=!0}for(const E of y)E(v,w);delete p.requests[_]})),y.push((v,w)=>{v?f(v):w&&f(null,{stack:c,id:h,glyph:w.glyphs[h]||null})})},(c,h)=>{if(c)i(c);else if(h){const f={};for(const{stack:p,id:g,glyph:_}of h)void 0===f[p]&&(f[p]={}),void 0===f[p].glyphs&&(f[p].glyphs={}),f[p].glyphs[g]=_&&{id:_.id,bitmap:_.bitmap.clone(),metrics:_.metrics},f[p].ascender=this.entries[p].ascender,f[p].descender=this.entries[p].descender;i(null,f)}})}_doesCharSupportLocalGlyph(e){return 0!==this.localGlyphMode&&(2===this.localGlyphMode?!!this.localFontFamily:!!this.localFontFamily&&(nt_CJK_Unified_Ideographs(e)||nt_Hangul_Syllables(e)||nt_Hiragana(e)||nt_Katakana(e)||nt_CJK_Symbols_and_Punctuation(e)||nt_CJK_Unified_Ideographs_Extension_A(e)||nt_CJK_Unified_Ideographs_Extension_B(e)))}_tinySDF(e,n,i){const a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(i))return;let l=e.tinySDF;if(!l){let E="400";/bold/i.test(n)?E="900":/medium/i.test(n)?E="500":/light/i.test(n)&&(E="200"),l=e.tinySDF=new Bl.TinySDF({fontFamily:a,fontWeight:E,fontSize:48,buffer:6,radius:16}),l.fontWeight=E}if(this.localGlyphs[l.fontWeight][i])return this.localGlyphs[l.fontWeight][i];const c=String.fromCodePoint(i),{data:h,width:f,height:p,glyphWidth:g,glyphHeight:_,glyphLeft:y,glyphTop:v,glyphAdvance:w}=l.draw(c);return this.localGlyphs[l.fontWeight][i]={id:i,bitmap:new Ja({width:f,height:p},h),metrics:{width:g/2,height:_/2,left:y/2,top:v/2-27,advance:w/2,localGlyph:!0}}}}Bl.loadGlyphRange=function(t,e,n,i,a){const l=256*e,c=l+255,h=i.transformRequest(i.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${l}-${c}`),_e.Glyphs);je(h,(f,p)=>{if(f)a(f);else if(p){const g={},_=new ug(p).readFields(pg,{});for(const y of _.glyphs)g[y.id]=y;a(null,{glyphs:g,ascender:_.ascender,descender:_.descender})}})},Bl.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:i=.25,fontFamily:a="sans-serif",fontWeight:l="normal",fontStyle:c="normal"}={}){this.buffer=e,this.cutoff=i,this.radius=n;const h=this.size=t+4*e,f=this._createCanvas(h),p=this.ctx=f.getContext("2d",{willReadFrequently:!0});p.font=`${c} ${l} ${t}px ${a}`,p.textBaseline="alphabetic",p.textAlign="left",p.fillStyle="black",this.gridOuter=new Float64Array(h*h),this.gridInner=new Float64Array(h*h),this.f=new Float64Array(h),this.z=new Float64Array(h+1),this.v=new Uint16Array(h)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:a,actualBoundingBoxRight:l}=this.ctx.measureText(t),c=Math.ceil(n),h=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(l-a))),f=Math.min(this.size-this.buffer,c+Math.ceil(i)),p=h+2*this.buffer,g=f+2*this.buffer,_=Math.max(p*g,0),y=new Uint8ClampedArray(_),v={data:y,width:p,height:g,glyphWidth:h,glyphHeight:f,glyphTop:c,glyphLeft:0,glyphAdvance:e};if(0===h||0===f)return v;const{ctx:w,buffer:E,gridInner:T,gridOuter:C}=this;w.clearRect(E,E,h,f),w.fillText(t,E,E+c);const S=w.getImageData(E,E,h,f);C.fill(Go,0,_),T.fill(0,0,_);for(let I=0;I<f;I++)for(let R=0;R<h;R++){const A=S.data[4*(I*h+R)+3]/255;if(0===A)continue;const k=(I+E)*p+R+E;if(1===A)C[k]=0,T[k]=Go;else{const L=.5-A;C[k]=L>0?L*L:0,T[k]=L<0?L*L:0}}Zh(C,0,0,p,g,p,this.f,this.v,this.z),Zh(T,E,E,h,f,p,this.f,this.v,this.z);for(let I=0;I<_;I++){const R=Math.sqrt(C[I])-Math.sqrt(T[I]);y[I]=Math.round(255-255*(R/this.radius+this.cutoff))}return v}};function ma(t,e,n,i){const a=[],l=t.imagePrimary,c=l.pixelRatio,h=l.paddedRect.w-2,f=l.paddedRect.h-2,p=t.right-t.left,g=t.bottom-t.top,_=l.stretchX||[[0,h]],y=l.stretchY||[[0,f]],v=(G,$)=>G+$[1]-$[0],w=_.reduce(v,0),E=y.reduce(v,0),T=h-w,C=f-E;let S=0,I=w,R=0,A=E,k=0,L=T,B=0,j=C;if(l.content&&i){const G=l.content;S=Vl(_,0,G[0]),R=Vl(y,0,G[1]),I=Vl(_,G[0],G[2]),A=Vl(y,G[1],G[3]),k=G[0]-S,B=G[1]-R,L=G[2]-G[0]-I,j=G[3]-G[1]-A}const U=(G,$,W,H)=>{const J=jl(G.stretch-S,I,p,t.left),te=Ul(G.fixed-k,L,G.stretch,w),oe=jl($.stretch-R,A,g,t.top),K=Ul($.fixed-B,j,$.stretch,E),Q=jl(W.stretch-S,I,p,t.left),ae=Ul(W.fixed-k,L,W.stretch,w),ue=jl(H.stretch-R,A,g,t.top),fe=Ul(H.fixed-B,j,H.stretch,E),ge=new ie(J,oe),ve=new ie(Q,oe),de=new ie(Q,ue),me=new ie(J,ue),Oe=new ie(te/c,K/c),qe=new ie(ae/c,fe/c),Ge=e*Math.PI/180;if(Ge){const Ft=Math.sin(Ge),Dt=Math.cos(Ge),pt=[Dt,-Ft,Ft,Dt];ge._matMult(pt),ve._matMult(pt),me._matMult(pt),de._matMult(pt)}const We=G.stretch+G.fixed,it=W.stretch+W.fixed,gt=$.stretch+$.fixed,zt=H.stretch+H.fixed,an=t.imageSecondary;return{tl:ge,tr:ve,bl:me,br:de,texPrimary:{x:l.paddedRect.x+1+We,y:l.paddedRect.y+1+gt,w:it-We,h:zt-gt},texSecondary:an?{x:an.paddedRect.x+1+We,y:an.paddedRect.y+1+gt,w:it-We,h:zt-gt}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Oe,pixelOffsetBR:qe,minFontScaleX:L/c/p,minFontScaleY:j/c/g,isSDF:n}};if(i&&(l.stretchX||l.stretchY)){const G=Au(_,T,w),$=Au(y,C,E);for(let W=0;W<G.length-1;W++){const H=G[W],J=G[W+1];for(let te=0;te<$.length-1;te++)a.push(U(H,$[te],J,$[te+1]))}}else a.push(U({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:h+1},{fixed:0,stretch:f+1}));return a}function Vl(t,e,n){let i=0;for(const a of t)i+=Math.max(e,Math.min(n,a[1]))-Math.max(e,Math.min(n,a[0]));return i}function Au(t,e,n){const i=[{fixed:-1,stretch:0}];for(const[a,l]of t){const c=i[i.length-1];i.push({fixed:a-c.stretch,stretch:c.stretch}),i.push({fixed:a-c.stretch,stretch:c.stretch+(l-a)})}return i.push({fixed:e+1,stretch:n}),i}function jl(t,e,n,i){return t/e*n+i}function Ul(t,e,n,i){return t-e*n/i}function Xh(t,e,n,i){const a=e+t.positionedLines[i].lineOffset;return 0===i?n+a/2:n+(a+(e+t.positionedLines[i-1].lineOffset))/2}function Yh(t,e=1,n=!1){let i=1/0,a=1/0,l=-1/0,c=-1/0;const h=t[0];for(let v=0;v<h.length;v++){const w=h[v];(!v||w.x<i)&&(i=w.x),(!v||w.y<a)&&(a=w.y),(!v||w.x>l)&&(l=w.x),(!v||w.y>c)&&(c=w.y)}const f=Math.min(l-i,c-a);let p=f/2;const g=new El([],Kh);if(0===f)return new ie(i,a);for(let v=i;v<l;v+=f)for(let w=a;w<c;w+=f)g.push(new ga(v+p,w+p,p,t));let _=function(v){let w=0,E=0,T=0;const C=v[0];for(let S=0,I=C.length,R=I-1;S<I;R=S++){const A=C[S],k=C[R],L=A.x*k.y-k.x*A.y;E+=(A.x+k.x)*L,T+=(A.y+k.y)*L,w+=3*L}return new ga(E/w,T/w,0,v)}(t),y=g.length;for(;g.length;){const v=g.pop();(v.d>_.d||!_.d)&&(_=v,n&&console.log("found best %d after %d probes",Math.round(1e4*v.d)/1e4,y)),v.max-_.d<=e||(p=v.h/2,g.push(new ga(v.p.x-p,v.p.y-p,p,t)),g.push(new ga(v.p.x+p,v.p.y-p,p,t)),g.push(new ga(v.p.x-p,v.p.y+p,p,t)),g.push(new ga(v.p.x+p,v.p.y+p,p,t)),y+=4)}return n&&(console.log(`num probes: ${y}`),console.log(`best distance: ${_.d}`)),_.p}function Kh(t,e){return e.max-t.max}class ga{constructor(e,n,i,a){this.p=new ie(e,n),this.h=i,this.d=function(l,c){let h=!1,f=1/0;for(let p=0;p<c.length;p++){const g=c[p];for(let _=0,y=g.length,v=y-1;_<y;v=_++){const w=g[_],E=g[v];w.y>l.y!=E.y>l.y&&l.x<(E.x-w.x)*(l.y-w.y)/(E.y-w.y)+w.x&&(h=!h),f=Math.min(f,sv(l,w,E))}}return(h?1:-1)*Math.sqrt(f)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}}const wg=Number.POSITIVE_INFINITY,Pb=Math.sqrt(2);function bg(t,[e,n]){let i=0,a=0;if(n===wg){e<0&&(e=0);const l=e/Pb;switch(t){case"top-right":case"top-left":a=l-7;break;case"bottom-right":case"bottom-left":a=7-l;break;case"bottom":a=7-e;break;case"top":a=e-7}switch(t){case"top-right":case"bottom-right":i=-l;break;case"top-left":case"bottom-left":i=l;break;case"left":i=e;break;case"right":i=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":a=n-7;break;case"bottom-right":case"bottom-left":case"bottom":a=7-n}switch(t){case"top-right":case"bottom-right":case"right":i=-e;break;case"top-left":case"bottom-left":case"left":i=e}}return[i,a]}function Rb(t,e,n,i,a,l,c,h,f,p,g){t.createArrays(),t.tilePixelRatio=he/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const _=t.layers[0].layout,y=t.layers[0]._unevaluatedLayout._values,v={};if("composite"===t.textSizeData.kind){const{minZoom:C,maxZoom:S}=t.textSizeData;v.compositeTextSizes=[y["text-size"].possiblyEvaluate(new pr(C),h),y["text-size"].possiblyEvaluate(new pr(S),h)]}if("composite"===t.iconSizeData.kind){const{minZoom:C,maxZoom:S}=t.iconSizeData;v.compositeIconSizes=[y["icon-size"].possiblyEvaluate(new pr(C),h),y["icon-size"].possiblyEvaluate(new pr(S),h)]}v.layoutTextSize=y["text-size"].possiblyEvaluate(new pr(f+1),h),v.layoutIconSize=y["icon-size"].possiblyEvaluate(new pr(f+1),h),v.textMaxSize=y["text-size"].possiblyEvaluate(new pr(18),h);const w="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement"),E=_.get("text-size");let T=!1;for(const C of t.features)if(C.icon&&C.icon.nameSecondary){T=!0;break}for(const C of t.features){const S=_.get("text-font").evaluate(C,{},h).join(","),I=E.evaluate(C,{},h),R=v.layoutTextSize.evaluate(C,{},h),A=(v.layoutIconSize.evaluate(C,{},h),{horizontal:{},vertical:void 0}),k=C.text;let L,B=[0,0];if(k){const G=k.toString(),$=24*_.get("text-letter-spacing").evaluate(C,{},h),W=24*_.get("text-line-height").evaluate(C,{},h),H=A1(G)?$:0,J=_.get("text-anchor").evaluate(C,{},h),te=_.get("text-variable-anchor");if(!te){const ue=_.get("text-radial-offset").evaluate(C,{},h);B=ue?bg(J,[24*ue,wg]):_.get("text-offset").evaluate(C,{},h).map(fe=>24*fe)}let oe=w?"center":_.get("text-justify").evaluate(C,{},h);const K="point"===_.get("symbol-placement"),Q=K?24*_.get("text-max-width").evaluate(C,{},h):1/0,ae=ue=>{t.allowVerticalPlacement&&gc(G)&&(A.vertical=Vv(k,e,n,a,S,Q,W,J,ue,H,B,or.vertical,!0,R,I))};if(!w&&te){const ue="auto"===oe?te.map(ge=>Eg(ge)):[oe];let fe=!1;for(let ge=0;ge<ue.length;ge++){const ve=ue[ge];if(!A.horizontal[ve])if(fe)A.horizontal[ve]=A.horizontal[0];else{const de=Vv(k,e,n,a,S,Q,W,"center",ve,H,B,or.horizontal,!1,R,I);de&&(A.horizontal[ve]=de,fe=1===de.positionedLines.length)}}ae("left")}else{if("auto"===oe&&(oe=Eg(J)),K||_.get("text-writing-mode").indexOf("horizontal")>=0||!gc(G)){const ue=Vv(k,e,n,a,S,Q,W,J,oe,H,B,or.horizontal,!1,R,I);ue&&(A.horizontal[oe]=ue)}ae(K?"left":oe)}}let j=!1;if(C.icon&&C.icon.namePrimary){const G=i[C.icon.namePrimary];G&&(L=lM(a[C.icon.namePrimary],C.icon.nameSecondary?a[C.icon.nameSecondary]:void 0,_.get("icon-offset").evaluate(C,{},h),_.get("icon-anchor").evaluate(C,{},h)),j=G.sdf,void 0===t.sdfIcons?t.sdfIcons=G.sdf:t.sdfIcons!==G.sdf&&ee("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(G.pixelRatio!==t.pixelRatio||0!==_.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const U=Ob(A.horizontal)||A.vertical;t.iconsInText||(t.iconsInText=!!U&&U.iconsInText),(U||L)&&kb(t,C,A,L,i,v,R,0,B,j,c,h,p,g,T)}l&&t.generateCollisionDebugBuffers(f,t.collisionBoxArray)}function Eg(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function kb(t,e,n,i,a,l,c,h,f,p,g,_,y,v,w){let E=l.textMaxSize.evaluate(e,{},_);void 0===E&&(E=c);const T=t.layers[0].layout,C=T.get("icon-offset").evaluate(e,{},_),S=Ob(n.horizontal)||n.vertical,I="globe"===y.name,A=c/24,k=t.tilePixelRatio*E/24,L=(J=t.overscaling,t.zoom>18&&J>2&&(J>>=1),Math.max(he/(512*J),1)*T.get("symbol-spacing")),B=T.get("text-padding")*t.tilePixelRatio,j=T.get("icon-padding")*t.tilePixelRatio,U=At(T.get("text-max-angle")),G="map"===T.get("text-rotation-alignment")&&"point"!==T.get("symbol-placement"),$="map"===T.get("icon-rotation-alignment")&&"point"!==T.get("symbol-placement"),W=T.get("symbol-placement"),H=L/2;var J;const te=T.get("icon-text-fit").evaluate(e,{},_),oe=T.get("icon-text-fit-padding").evaluate(e,{},_),K="none"!==te;let Q;!1===t.hasAnyIconTextFit&&K&&(t.hasAnyIconTextFit=!0),i&&K&&(t.allowVerticalPlacement&&n.vertical&&(Q=Ab(i,n.vertical,te,oe,C,A)),S&&(i=Ab(i,S,te,oe,C,A)));const ae=(ue,fe,ge)=>{if(fe.x<0||fe.x>=he||fe.y<0||fe.y>=he)return;let ve=null;if(I){const{x:de,y:me,z:Oe}=y.projectTilePoint(fe.x,fe.y,ge);ve={anchor:new zl(de,me,Oe,0,void 0),up:y.upVector(ge,fe.x,fe.y)}}!function(de,me,Oe,qe,Ge,We,it,gt,zt,an,Ft,Dt,pt,ut,Kt,dn,Bt,Rn,Jn,Xn,Hn,Nr,Qn,sr,In,xo,ul){const Bc=de.addToLineVertexArray(me,qe);let hl,Ap,Ip,C_,SS,Hs,uT,hT=0,dT=0,fT=0,pT=0,Ax=-1,Ix=-1;const dl={};let mT=W1("");const Wu=Oe?Oe.anchor:me,Px="none"!==zt.layout.get("icon-text-fit").evaluate(Hn,{},In);let Rx=0,kx=0;if(void 0===zt._unevaluatedLayout.getValue("text-radial-offset")?[Rx,kx]=zt.layout.get("text-offset").evaluate(Hn,{},In).map(Xo=>24*Xo):(Rx=24*zt.layout.get("text-radial-offset").evaluate(Hn,{},In),kx=wg),de.allowVerticalPlacement&&Ge.vertical){const Xo=Ge.vertical;if(Kt)Hs=Tg(Xo),gt&&(uT=Tg(gt));else{const Fo=zt.layout.get("text-rotate").evaluate(Hn,{},In)+90;Ip=Cg(an,Wu,me,Ft,Dt,pt,Xo,ut,Fo,dn),gt&&(C_=Cg(an,Wu,me,Ft,Dt,pt,gt,Rn,Fo))}}if(We){const Xo=zt.layout.get("icon-rotate").evaluate(Hn,{},In),Fo=ma(We,Xo,Qn,Px),Ed=gt?ma(gt,Xo,Qn,Px):void 0;Ap=Cg(an,Wu,me,Ft,Dt,pt,We,Rn,Xo),hT=4*Fo.length;const gT=de.iconSizeData;let Zu=null;"source"===gT.kind?(Zu=[tl*zt.layout.get("icon-size").evaluate(Hn,{},In)],Zu[0]>$l&&ee(`${de.layerIds[0]}: Value for "icon-size" is >= ${Jh}. Reduce your "icon-size".`)):"composite"===gT.kind&&(Zu=[tl*Nr.compositeIconSizes[0].evaluate(Hn,{},In),tl*Nr.compositeIconSizes[1].evaluate(Hn,{},In)],(Zu[0]>$l||Zu[1]>$l)&&ee(`${de.layerIds[0]}: Value for "icon-size" is >= ${Jh}. Reduce your "icon-size".`)),de.addSymbols(de.icon,Fo,Zu,Xn,Jn,Hn,!1,Oe,me,Bc.lineStartIndex,Bc.lineLength,-1,sr,In,xo,ul),Ax=de.icon.placedSymbolArray.length-1,Ed&&(dT=4*Ed.length,de.addSymbols(de.icon,Ed,Zu,Xn,Jn,Hn,or.vertical,Oe,me,Bc.lineStartIndex,Bc.lineLength,-1,sr,In,xo,ul),Ix=de.icon.placedSymbolArray.length-1)}for(const Xo in Ge.horizontal){const Fo=Ge.horizontal[Xo];hl||(mT=W1(Fo.text),Kt?SS=Tg(Fo):hl=Cg(an,Wu,me,Ft,Dt,pt,Fo,ut,zt.layout.get("text-rotate").evaluate(Hn,{},In),dn));const Ed=1===Fo.positionedLines.length;if(fT+=Uv(de,Oe,me,Fo,it,zt,Kt,Hn,dn,Bc,Ge.vertical?or.horizontal:or.horizontalOnly,Ed?Object.keys(Ge.horizontal):[Xo],dl,Ax,Nr,sr,In,xo),Ed)break}Ge.vertical&&(pT+=Uv(de,Oe,me,Ge.vertical,it,zt,Kt,Hn,dn,Bc,or.vertical,["vertical"],dl,Ix,Nr,sr,In,xo));let Vc=-1;const Ox=(Xo,Fo)=>Xo?Math.max(Xo,Fo):Fo;Vc=Ox(SS,Vc),Vc=Ox(Hs,Vc),Vc=Ox(uT,Vc);const AS=Vc>-1?1:0;de.glyphOffsetArray.length>=nd.MAX_GLYPHS&&ee("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Hn.sortKey&&de.addToSortKeyRanges(de.symbolInstances.length,Hn.sortKey),de.symbolInstances.emplaceBack(me.x,me.y,Wu.x,Wu.y,Wu.z,dl.right>=0?dl.right:-1,dl.center>=0?dl.center:-1,dl.left>=0?dl.left:-1,dl.vertical>=0?dl.vertical:-1,Ax,Ix,mT,void 0!==hl?hl:de.collisionBoxArray.length,void 0!==hl?hl+1:de.collisionBoxArray.length,void 0!==Ip?Ip:de.collisionBoxArray.length,void 0!==Ip?Ip+1:de.collisionBoxArray.length,void 0!==Ap?Ap:de.collisionBoxArray.length,void 0!==Ap?Ap+1:de.collisionBoxArray.length,C_||de.collisionBoxArray.length,C_?C_+1:de.collisionBoxArray.length,Ft,fT,pT,hT,dT,AS,0,Rx,kx,Vc,0,Px?1:0)}(t,fe,ve,ue,n,i,a,Q,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,B,G,f,0,j,$,C,e,l,p,g,_,v,w)};if("line"===W)for(const ue of Ib(e.geometry,0,0,he,he)){const fe=hM(ue,L,U,n.vertical||S,i,24,k,t.overscaling,he);for(const ge of fe)S&&dM(t,S.text,H,ge)||ae(ue,ge,_)}else if("line-center"===W){for(const ue of e.geometry)if(ue.length>1){const fe=uM(ue,U,n.vertical||S,i,24,k);fe&&ae(ue,fe,_)}}else if("Polygon"===e.type)for(const ue of rg(e.geometry,0)){const fe=Yh(ue,16);ae(ue[0],new zl(fe.x,fe.y,0,0,void 0),_)}else if("LineString"===e.type)for(const ue of e.geometry)ae(ue,new zl(ue[0].x,ue[0].y,0,0,void 0),_);else if("Point"===e.type)for(const ue of e.geometry)for(const fe of ue)ae([fe],new zl(fe.x,fe.y,0,0,void 0),_)}const Jh=255,$l=Jh*tl;function Uv(t,e,n,i,a,l,c,h,f,p,g,_,y,v,w,E,T,C){const S=function(A,k,L,B,j,U,G,$){const W=[];if(0===k.positionedLines.length)return W;const H=B.layout.get("text-rotate").evaluate(U,{})*Math.PI/180,J=function(ae){const ue=ae[0],fe=ae[1],ge=ue*fe;return ge>0?[ue,-fe]:ge<0?[-ue,fe]:0===ue?[fe,ue]:[fe,-ue]}(L);let te=Math.abs(k.top-k.bottom);for(const ae of k.positionedLines)te-=ae.lineOffset;const oe=k.positionedLines.length,K=te/oe;let Q=k.top-L[1];for(let ae=0;ae<oe;++ae){const ue=k.positionedLines[ae];Q=Xh(k,K,Q,ae);for(const fe of ue.positionedGlyphs){if(!fe.rect)continue;const ge=fe.rect||{};let ve=4,de=!0,me=1,Oe=0;if(fe.imageName){const Xn=G[fe.imageName];if(!Xn)continue;if(Xn.sdf){ee("SDF images are not supported in formatted text and will be ignored.");continue}de=!1,me=Xn.pixelRatio,ve=1/me}const qe=(j||$)&&fe.vertical,Ge=fe.metrics.advance*fe.scale/2,We=fe.metrics,it=fe.rect;if(null===it)continue;$&&k.verticalizable&&(Oe=fe.imageName?Ge-fe.metrics.width*fe.scale/2:0);const gt=j?[fe.x+Ge,fe.y]:[0,0];let zt=[0,0],an=[0,0],Ft=!1;j||(qe?(an=[fe.x+Ge+J[0],fe.y+J[1]-Oe],Ft=!0):zt=[fe.x+Ge+L[0],fe.y+L[1]-Oe]);const Dt=it.w*fe.scale/(me*(fe.localGlyph?2:1)),pt=it.h*fe.scale/(me*(fe.localGlyph?2:1));let ut,Kt,dn,Bt;if(qe){const Xn=fe.y-Q,Hn=new ie(-Ge,Ge-Xn),Nr=-Math.PI/2,Qn=new ie(...an);ut=new ie(-Ge+zt[0],zt[1]),ut._rotateAround(Nr,Hn)._add(Qn),ut.x+=-Xn+Ge,ut.y-=(We.left-ve)*fe.scale;const sr=fe.imageName?We.advance*fe.scale:24*fe.scale,In=String.fromCodePoint(fe.glyph);zv(In)?ut.x+=(1-ve)*fe.scale:Nl(In)?ut.x+=sr-We.height*fe.scale+(-ve-1)*fe.scale:ut.x+=fe.imageName||We.width+2*ve===it.w&&We.height+2*ve===it.h?(sr-pt)/2:(sr-(We.height+2*ve)*fe.scale)/2,Kt=new ie(ut.x,ut.y-Dt),dn=new ie(ut.x+pt,ut.y),Bt=new ie(ut.x+pt,ut.y-Dt)}else{const Xn=(We.left-ve)*fe.scale-Ge+zt[0],Hn=(-We.top-ve)*fe.scale+zt[1],Nr=Xn+Dt,Qn=Hn+pt;ut=new ie(Xn,Hn),Kt=new ie(Nr,Hn),dn=new ie(Xn,Qn),Bt=new ie(Nr,Qn)}if(H){let Xn;Xn=j?new ie(0,0):Ft?new ie(J[0],J[1]):new ie(L[0],L[1]),ut._rotateAround(H,Xn),Kt._rotateAround(H,Xn),dn._rotateAround(H,Xn),Bt._rotateAround(H,Xn)}const Rn=new ie(0,0),Jn=new ie(0,0);W.push({tl:ut,tr:Kt,bl:dn,br:Bt,texPrimary:ge,texSecondary:void 0,writingMode:k.writingMode,glyphOffset:gt,sectionIndex:fe.sectionIndex,isSDF:de,pixelOffsetTL:Rn,pixelOffsetBR:Jn,minFontScaleX:0,minFontScaleY:0})}}return W}(0,i,f,l,c,h,a,t.allowVerticalPlacement),I=t.textSizeData;let R=null;"source"===I.kind?(R=[tl*l.layout.get("text-size").evaluate(h,{},T)],R[0]>$l&&ee(`${t.layerIds[0]}: Value for "text-size" is >= ${Jh}. Reduce your "text-size".`)):"composite"===I.kind&&(R=[tl*w.compositeTextSizes[0].evaluate(h,{},T),tl*w.compositeTextSizes[1].evaluate(h,{},T)],(R[0]>$l||R[1]>$l)&&ee(`${t.layerIds[0]}: Value for "text-size" is >= ${Jh}. Reduce your "text-size".`)),t.addSymbols(t.text,S,R,f,c,h,g,e,n,p.lineStartIndex,p.lineLength,v,E,T,C,!1);for(const A of _)y[A]=t.text.placedSymbolArray.length-1;return 4*S.length}function Ob(t){for(const e in t)return t[e];return null}function Cg(t,e,n,i,a,l,c,h,f,p){let g=c.top,_=c.bottom,y=c.left,v=c.right;const w=c.collisionPadding;if(w&&(y-=w[0],g-=w[1],v+=w[2],_+=w[3]),f){const E=new ie(y,g),T=new ie(v,g),C=new ie(y,_),S=new ie(v,_),I=At(f);let R=new ie(0,0);p&&(R=new ie(p[0],p[1])),E._rotateAround(I,R),T._rotateAround(I,R),C._rotateAround(I,R),S._rotateAround(I,R),y=Math.min(E.x,T.x,C.x,S.x),v=Math.max(E.x,T.x,C.x,S.x),g=Math.min(E.y,T.y,C.y,S.y),_=Math.max(E.y,T.y,C.y,S.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,y,g,v,_,h,i,a,l),t.length-1}function Tg(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function dM(t,e,n,i){const a=t.compareText;if(e in a){const l=a[e];for(let c=l.length-1;c>=0;c--)if(i.dist(l[c])<n)return!0}else a[e]=[];return a[e].push(i),!1}function Lb(t,e){const n=t.fovAboveCenter,i=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,a=(t._camera.position[2]*t.worldSize-i)/Math.cos(t._pitch),l=Math.sin(n)*a/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),c=Math.sin(t._pitch)*l+a;return Math.min(1.01*c,a*(1/t._horizonShift))}function Po(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const n=Math.pow(2,-t.z),i=t.x*n,a=(t.x+1)*n,l=t.y*n,c=(t.y+1)*n,h=Ao(i),f=Ao(a),p=Gr(l),g=Gr(c),_=e.project(h,p),y=e.project(f,p),v=e.project(f,g),w=e.project(h,g);let E=Math.min(_.x,y.x,v.x,w.x),T=Math.min(_.y,y.y,v.y,w.y),C=Math.max(_.x,y.x,v.x,w.x),S=Math.max(_.y,y.y,v.y,w.y);const I=n/16;function R(k,L,B,j,U,G){const $=(B+U)/2,W=(j+G)/2,H=e.project(Ao($),Gr(W)),J=Math.max(0,E-H.x,T-H.y,H.x-C,H.y-S);E=Math.min(E,H.x),C=Math.max(C,H.x),T=Math.min(T,H.y),S=Math.max(S,H.y),J>I&&(R(k,H,B,j,$,W),R(H,L,$,W,U,G))}R(_,y,i,l,a,l),R(y,v,a,l,a,c),R(v,w,a,c,i,c),R(w,_,i,c,i,l),E-=I,T-=I,C+=I,S+=I;const A=1/Math.max(C-E,S-T);return{scale:A,x:E*A,y:T*A,x2:C*A,y2:S*A,projection:e}}function Dg(t,e,n,i,a,l,c,h,f){if("globe"===f.name)return qy(t,e,new Ls(n,i,a),!1);const p=Po({z:n,x:i,y:a},f);return new $n([(l+p.x/p.scale)*e,e*(p.y/p.scale),c],[(l+p.x2/p.scale)*e,e*(p.y2/p.scale),h])}function Fb(t,{x:e,y:n},i=0){return new ie(((e-i)*t.scale-t.x)*he,(n*t.scale-t.y)*he)}function yo(t,e,n=0){return Z.fromValues(((e.x-n)*t.scale-t.x)*he,(e.y*t.scale-t.y)*he,Qy(e.z,e.y))}const Ro=se.identity(new Float32Array(16));class ko{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new bt(0,0)}projectTilePoint(e,n,i){return{x:e,y:n,z:0}}locationPoint(e,n,i=!0){return e._coordinatePoint(e.locationCoordinate(n),i)}pixelsPerMeter(e,n){return kn(1,e)*n}pixelSpaceConversion(e,n,i){return 1}farthestPixelDistance(e){return Lb(e,e.pixelsPerMeter)}pointCoordinate(e,n,i,a){const l=e.horizonLineFromTop(!1),c=new ie(n,Math.max(l,i));return e.rayIntersectionCoordinate(e.pointRayIntersection(c,a))}pointCoordinate3D(e,n,i){const a=new ie(n,i);if(e.elevation)return e.elevation.pointCoordinate(a);{const l=this.pointCoordinate(e,a.x,a.y,0);return[l.x,l.y,l.z]}}isPointAboveHorizon(e,n){if(e.elevation)return!this.pointCoordinate3D(e,n.x,n.y);const i=e.horizonLineFromTop();return n.y<i}createInversionMatrix(e,n){return Ro}createTileMatrix(e,n,i){let a,l,c;const h=i.canonical,f=se.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const p=Po(h,this);a=1,l=p.x+i.wrap*p.scale,c=p.y,se.scale(f,f,[a/p.scale,a/p.scale,e.pixelsPerMeter/n])}else a=n/e.zoomScale(h.z),l=(h.x+Math.pow(2,h.z)*i.wrap)*a,c=h.y*a;return se.translate(f,f,[l,c,0]),se.scale(f,f,[a/he,a/he,1]),f}upVector(e,n,i){return[0,0,1]}upVectorScale(e,n,i){return{metersToTile:1}}}class fM extends ko{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,i]=this.parallels=e.parallels||[29.5,45.5],a=Math.sin(At(n));this.n=(a+Math.sin(At(i)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:i,c:a,r0:l}=this,c=At(e-this.center[0]),h=At(n),f=Math.sqrt(a-2*i*Math.sin(h))/i;return{x:f*Math.sin(c*i),y:f*Math.cos(c*i)-l,z:0}}unproject(e,n){const{n:i,c:a,r0:l}=this,c=l+n;let h=Math.atan2(e,Math.abs(c))*Math.sign(c);c*i<0&&(h-=Math.PI*Math.sign(e)*Math.sign(c));const f=At(this.center[0])*i;h=ts(h,-Math.PI-f,Math.PI-f);const p=et(kr(h/i)+this.center[0],-180,180),g=Math.asin(et((a-(e*e+c*c)*i*i)/(2*i),-1,1)),_=et(kr(g),-Mr,Mr);return new bt(p,_)}}const Iu=1.340264,Pu=-.081106,Qh=893e-6,Xf=.003796,kc=Math.sqrt(3)/2;class Nb extends ko{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const i=Math.asin(kc*Math.sin(n)),a=i*i,l=a*a*a;return{x:.5*(e*Math.cos(i)/(kc*(Iu+3*Pu*a+l*(7*Qh+9*Xf*a)))/Math.PI+.5),y:1-.5*(i*(Iu+Pu*a+l*(Qh+Xf*a))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let i=n=(2*(1-n)-1)*Math.PI,a=i*i,l=a*a*a;for(let g,_,y,v=0;v<12&&(_=i*(Iu+Pu*a+l*(Qh+Xf*a))-n,y=Iu+3*Pu*a+l*(7*Qh+9*Xf*a),g=_/y,i=et(i-g,-Math.PI/3,Math.PI/3),a=i*i,l=a*a*a,!(Math.abs(g)<1e-12));++v);const c=kc*e*(Iu+3*Pu*a+l*(7*Qh+9*Xf*a))/Math.cos(i),h=Math.asin(Math.sin(i)/kc),f=et(180*c/Math.PI,-180,180),p=et(180*h/Math.PI,-Mr,Mr);return new bt(f,p)}}class $v extends ko{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const i=360*(e-.5),a=et(360*(.5-n),-Mr,Mr);return new bt(i,a)}}const ri=Math.PI/2;function Yf(t){return Math.tan((ri+t)/2)}class pM extends ko{constructor(e){super(e),this.center=e.center||[0,30];const[n,i]=this.parallels=e.parallels||[30,30];let a=At(n),l=At(i);this.southernCenter=a+l<0,this.southernCenter&&(a=-a,l=-l);const c=Math.cos(a),h=Yf(a);this.n=a===l?Math.sin(a):Math.log(c/Math.cos(l))/Math.log(Yf(l)/h),this.f=c*Math.pow(Yf(a),this.n)/this.n}project(e,n){n=At(n),this.southernCenter&&(n=-n),e=At(e-this.center[0]);const i=1e-6,{n:a,f:l}=this;l>0?n<-ri+i&&(n=-ri+i):n>ri-i&&(n=ri-i);const c=l/Math.pow(Yf(n),a);let h=c*Math.sin(a*e),f=l-c*Math.cos(a*e);return h=.5*(h/Math.PI+.5),f=.5*(f/Math.PI+.5),{x:h,y:this.southernCenter?f:1-f,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:i,f:a}=this,l=a-n,c=Math.sign(l),h=Math.sign(i)*Math.sqrt(e*e+l*l);let f=Math.atan2(e,Math.abs(l))*c;l*i<0&&(f-=Math.PI*Math.sign(e)*c);const p=et(kr(f/i)+this.center[0],-180,180),g=et(kr(2*Math.atan(Math.pow(a/h,1/i))-ri),-Mr,Mr);return new bt(p,this.southernCenter?-g:g)}}class Hv extends ko{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:Si(e),y:gi(n),z:0}}unproject(e,n){const i=Ao(e),a=Gr(n);return new bt(i,a)}}const Gv=At(Mr);class zb extends ko{project(e,n){const i=(n=At(n))*n,a=i*i;return{x:.5*((e=At(e))*(.8707-.131979*i+a*(a*(.003971*i-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+i*(.015085+a*(.028874*i-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let i=n=(2*(1-n)-1)*Math.PI,a=25,l=0,c=i*i;do{c=i*i;const p=c*c;l=(i*(1.007226+c*(.015085+p*(.028874*c-.044475-.005916*p)))-n)/(1.007226+c*(.045255+p*(.259866*c-.311325-.005916*11*p))),i=et(i-l,-Gv,Gv)}while(Math.abs(l)>1e-6&&--a>0);c=i*i;const h=et(kr(e/(.8707+c*(c*(c*c*c*(.003971-.001529*c)-.013791)-.131979))),-180,180),f=kr(i);return new bt(h,f)}}const Bb=At(Mr);class mM extends ko{project(e,n){n=At(n),e=At(e);const i=Math.cos(n),a=2/Math.PI,l=Math.acos(i*Math.cos(e/2)),c=Math.sin(l)/l,h=.5*(e*a+2*i*Math.sin(e/2)/c)||0,f=.5*(n+Math.sin(n)/c)||0;return{x:.5*(h/Math.PI+.5),y:1-.5*(f/Math.PI+1),z:0}}unproject(e,n){let i=e=(2*e-.5)*Math.PI,a=n=(2*(1-n)-1)*Math.PI,l=25;const c=1e-6;let h=0,f=0;do{const p=Math.cos(a),g=Math.sin(a),_=2*g*p,y=g*g,v=p*p,w=Math.cos(i/2),E=Math.sin(i/2),T=2*w*E,C=E*E,S=1-v*w*w,I=S?1/S:0,R=S?Math.acos(p*w)*Math.sqrt(1/S):0,A=.5*(2*R*p*E+2*i/Math.PI)-e,k=.5*(R*g+a)-n,L=.5*I*(v*C+R*p*w*y)+1/Math.PI,B=I*(T*_/4-R*g*E),j=.125*I*(_*E-R*g*v*T),U=.5*I*(y*w+R*C*p)+.5,G=B*j-U*L;h=(k*B-A*U)/G,f=(A*j-k*L)/G,i=et(i-h,-Math.PI,Math.PI),a=et(a-f,-Bb,Bb)}while((Math.abs(h)>c||Math.abs(f)>c)&&--l>0);return new bt(kr(i),kr(a))}}class Vb extends ko{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(At(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:i,cosPhi:a}=this;return{x:At(e)*a*i+.5,y:-Math.sin(At(n))/a*i+.5,z:0}}unproject(e,n){const{scale:i,cosPhi:a}=this,l=-(n-.5)/i,c=et(kr((e-.5)/i)/a,-180,180),h=Math.asin(et(l*a,-1,1)),f=et(kr(h),-Mr,Mr);return new bt(c,f)}}class gM extends Hv{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,i){const a=If(e,n,i),l=So(ps(i));return Z.transformMat4(a,a,l),{x:a[0],y:a[1],z:a[2]}}locationPoint(e,n){const i=Dr(n.lat,n.lng),a=Z.normalize([],i),l=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,c=kn(1,0)*he*l;Z.scaleAndAdd(i,i,a,c);const h=se.identity(new Float64Array(16));return se.multiply(h,e.pixelMatrix,e.globeMatrix),Z.transformMat4(i,i,h),new ie(i[0],i[1])}pixelsPerMeter(e,n){return kn(1,0)*n}pixelSpaceConversion(e,n,i){const a=kn(1,e)*n,l=wt(kn(1,45)*n,a,i);return this.pixelsPerMeter(e,n)/l}createTileMatrix(e,n,i){const a=Yy(ps(i.canonical));return se.multiply(new Float64Array(16),e.globeMatrix,a)}createInversionMatrix(e,n){const{center:i}=e,a=So(ps(n));return se.rotateY(a,a,At(i.lng)),se.rotateX(a,a,At(i.lat)),se.scale(a,a,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(a)}pointCoordinate(e,n,i,a){return Rw(e,n,i,!0)||new nn(0,0)}pointCoordinate3D(e,n,i){const a=this.pointCoordinate(e,n,i,0);return[a.x,a.y,a.z]}isPointAboveHorizon(e,n){return!Rw(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=function(a,l){const c=a.cameraToCenterDistance,h=a._centerAltitude*l,f=a._camera,p=a._camera.forward(),g=Z.add([],Z.scale([],p,-c),[0,0,h]),_=a.worldSize/(2*Math.PI),y=[0,0,-_],v=a.width/a.height,w=Math.tan(a.fovAboveCenter),E=Z.scale([],f.up(),w),T=Z.scale([],f.right(),w*v),C=Z.normalize([],Z.add([],Z.add([],p,E),T)),S=[];let I;if(new Mf(g,C).closestPointOnSphere(y,_,S)){const R=Z.add([],S,y),A=Z.sub([],R,g);I=Math.cos(a.fovAboveCenter)*Z.length(A)}else{const R=Z.sub([],g,y),A=Z.sub([],y,g);Z.normalize(A,A);const k=Z.length(R)-_;I=Math.sqrt(k*(k+2*_));const L=Math.acos(I/(_+k))-Math.acos(Z.dot(p,A));I*=Math.cos(L)}return 1.01*I}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),i=ni(e.zoom);if(i>0){const a=Lb(e,kn(1,e.center.lat)*e.worldSize),l=e.worldSize/(2*Math.PI),c=Math.max(e.width,e.height)/e.worldSize*Math.PI;return wt(n,a+l*(1-Math.cos(c)),Math.pow(i,10))}return n}upVector(e,n,i){return If(n,i,e,1)}upVectorScale(e){return{metersToTile:Xm(Zy(ps(e)))}}}function ed(t){const e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new Hv(t);case"equirectangular":return new $v(t);case"naturalEarth":return new zb(t);case"equalEarth":return new Nb(t);case"winkelTripel":return new mM(t);case"albers":return n?new Vb(t):new fM(t);case"lambertConformalConic":return n?new Vb(t):new pM(t);case"globe":return new gM(t)}throw new Error(`Invalid projection name: ${t.name}`)}const qv=new mr({"symbol-placement":new Re(le.layout_symbol["symbol-placement"]),"symbol-spacing":new Re(le.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Re(le.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new lt(le.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Re(le.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Re(le.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Re(le.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Re(le.layout_symbol["icon-ignore-placement"]),"icon-optional":new Re(le.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Re(le.layout_symbol["icon-rotation-alignment"]),"icon-size":new lt(le.layout_symbol["icon-size"]),"icon-text-fit":new lt(le.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new lt(le.layout_symbol["icon-text-fit-padding"]),"icon-image":new lt(le.layout_symbol["icon-image"]),"icon-rotate":new lt(le.layout_symbol["icon-rotate"]),"icon-padding":new Re(le.layout_symbol["icon-padding"]),"icon-keep-upright":new Re(le.layout_symbol["icon-keep-upright"]),"icon-offset":new lt(le.layout_symbol["icon-offset"]),"icon-anchor":new lt(le.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Re(le.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Re(le.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Re(le.layout_symbol["text-rotation-alignment"]),"text-field":new lt(le.layout_symbol["text-field"]),"text-font":new lt(le.layout_symbol["text-font"]),"text-size":new lt(le.layout_symbol["text-size"]),"text-max-width":new lt(le.layout_symbol["text-max-width"]),"text-line-height":new lt(le.layout_symbol["text-line-height"]),"text-letter-spacing":new lt(le.layout_symbol["text-letter-spacing"]),"text-justify":new lt(le.layout_symbol["text-justify"]),"text-radial-offset":new lt(le.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Re(le.layout_symbol["text-variable-anchor"]),"text-anchor":new lt(le.layout_symbol["text-anchor"]),"text-max-angle":new Re(le.layout_symbol["text-max-angle"]),"text-writing-mode":new Re(le.layout_symbol["text-writing-mode"]),"text-rotate":new lt(le.layout_symbol["text-rotate"]),"text-padding":new Re(le.layout_symbol["text-padding"]),"text-keep-upright":new Re(le.layout_symbol["text-keep-upright"]),"text-transform":new lt(le.layout_symbol["text-transform"]),"text-offset":new lt(le.layout_symbol["text-offset"]),"text-allow-overlap":new Re(le.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Re(le.layout_symbol["text-ignore-placement"]),"text-optional":new Re(le.layout_symbol["text-optional"]),visibility:new Re(le.layout_symbol.visibility)});var Mg={paint:new mr({"icon-opacity":new lt(le.paint_symbol["icon-opacity"]),"icon-emissive-strength":new lt(le.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new lt(le.paint_symbol["text-emissive-strength"]),"icon-color":new lt(le.paint_symbol["icon-color"]),"icon-halo-color":new lt(le.paint_symbol["icon-halo-color"]),"icon-halo-width":new lt(le.paint_symbol["icon-halo-width"]),"icon-halo-blur":new lt(le.paint_symbol["icon-halo-blur"]),"icon-translate":new Re(le.paint_symbol["icon-translate"]),"icon-translate-anchor":new Re(le.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new lt(le.paint_symbol["icon-image-cross-fade"]),"text-opacity":new lt(le.paint_symbol["text-opacity"]),"text-color":new lt(le.paint_symbol["text-color"],{runtimeType:Oi,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new lt(le.paint_symbol["text-halo-color"]),"text-halo-width":new lt(le.paint_symbol["text-halo-width"]),"text-halo-blur":new lt(le.paint_symbol["text-halo-blur"]),"text-translate":new Re(le.paint_symbol["text-translate"]),"text-translate-anchor":new Re(le.paint_symbol["text-translate-anchor"])}),layout:qv};class Wv{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:nc,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Qe(Wv,"FormatSectionOverride",{omit:["defaultValue"]});class Kf extends ks{constructor(e,n){super(e,Mg,n)}recalculate(e,n){super.recalculate(e,n),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const i=this.layout.get("text-writing-mode");if(i){const a=[];for(const l of i)a.indexOf(l)<0&&a.push(l);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,i,a){const l=this.layout.get(e).evaluate(n,{},i,a),c=this._unevaluatedLayout._values[e];return c.isDataDriven()||_h(c.value)||!l?l:(h=n.properties,l.replace(/{([^{}]+)}/g,(p,g)=>g in h?String(h[g]):""));var h}createBucket(e){return new nd(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Mg.paint.overridableProperties){if(!Kf.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),i=new Wv(n),a=new sm(i,n.property.specification);let l=null;l="constant"===n.value.kind||"source"===n.value.kind?new q_("source",a):new ei("composite",a,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new pu(n.property,l,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,i){return!(!this.layout||n.isDataDriven()||i.isDataDriven())&&Kf.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const i=e.get("text-field"),a=Mg.paint.properties[n];let l=!1;const c=h=>{for(const f of h)if(a.overrides&&a.overrides.hasOverride(f))return void(l=!0)};if("constant"===i.value.kind&&i.value.value instanceof xr)c(i.value.value.sections);else if("source"===i.value.kind){const h=p=>{l||(p instanceof Kc&&Yn(p.value)===Wc?c(p.value.sections):p instanceof La?c(p.sections):p.eachChild(h))},f=i.value;f._styleExpression&&h(f._styleExpression.expression)}return l}getProgramIds(){const e=0!==this.paint.get("icon-opacity").constantOr(1),n=0!==this.paint.get("text-opacity").constantOr(1),i=[];return e&&i.push("symbolIcon"),n&&i.push("symbolSDF"),i}getDefaultProgramParams(e,n){return{config:new bu(this,n),overrideFog:!1}}}const jb=Vf.types,Ub=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Jf(t,e,n,i,a,l,c,h,f,p,g,_,y){const v=h?Math.min($l,Math.round(h[0])):0,w=h?Math.min($l,Math.round(h[1])):0;t.emplaceBack(e,n,Math.round(32*i),Math.round(32*a),l,c,(v<<1)+(f?1:0),w,16*p,16*g,256*_,256*y)}function Qf(t,e,n){t.emplaceBack(e,n)}function ep(t,e,n,i,a,l,c){t.emplaceBack(e,n,i,a,l,c)}function Zv(t,e,n,i,a){const l=5*e+2;t.float32[l+0]=n,t.float32[l+1]=i,t.float32[l+2]=a}function td(t,e,n,i,a){t.emplaceBack(e,n,i,a),t.emplaceBack(e,n,i,a),t.emplaceBack(e,n,i,a),t.emplaceBack(e,n,i,a)}function _M(t){for(const e of t.sections)if(nI(e.text))return!0;return!1}class Sg{constructor(e){this.layoutVertexArray=new iy,this.indexArray=new Tr,this.programConfigurations=e,this.segments=new Cn,this.dynamicLayoutVertexArray=new Ha,this.opacityVertexArray=new _u,this.placedSymbolArray=new vu,this.iconTransitioningVertexArray=new fs,this.globeExtVertexArray=new xm,this.zOffsetVertexArray=new xf}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(e,n,i,a,l){this.isEmpty()||(i&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Cb.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,eM.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Ub,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,Fv.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,QD.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||l)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,tM.members,!0)),this.opacityVertexBuffer.itemSize=1),(i||a)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Qe(Sg,"SymbolBuffers");class Xv{constructor(e,n,i){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new i,this.segments=new Cn,this.collisionVertexArray=new Kr,this.collisionVertexArrayExt=new Ga}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,nM.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,rM.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Qe(Xv,"CollisionBuffers");class ii{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=se.identity([]),this.placementViewportMatrix=se.identity([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Hf(this.zoom,n["text-size"]),this.iconSizeData=Hf(this.zoom,n["icon-size"]);const i=this.layers[0].layout,a=i.get("symbol-sort-key"),l=i.get("symbol-z-order");this.canOverlap=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==l&&void 0!==a.constantOr(1),this.sortFeaturesByY=("viewport-y"===l||"auto"===l&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=i.get("text-writing-mode").map(c=>or[c]),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=i.get("symbol-z-elevate")}createArrays(){this.text=new Sg(new xc(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Sg(new xc(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new pD,this.lineVertexArray=new uy,this.symbolInstances=new j1}calculateGlyphDependencies(e,n,i,a,l){for(let c=0;c<e.length;c++){const h=e.codePointAt(c);if(void 0===h)break;if(n[h]=!0,a&&l&&h<=65535){const f=Hh[e.charAt(c)];f&&(n[f.charCodeAt(0)]=!0)}}}populate(e,n,i,a){const l=this.layers[0],c=l.layout,h="globe"===this.projection.name,f=c.get("text-font"),p=c.get("text-field"),g=c.get("icon-image"),_=("constant"!==p.value.kind||p.value.value instanceof xr&&!p.value.value.isEmpty()||p.value.value.toString().length>0)&&("constant"!==f.value.kind||f.value.value.length>0),y="constant"!==g.value.kind||!!g.value.value||Object.keys(g.parameters).length>0,v=c.get("symbol-sort-key");if(this.features=[],!_&&!y)return;const w=n.iconDependencies,E=n.glyphDependencies,T=n.availableImages,C=new pr(this.zoom);for(const{feature:S,id:I,index:R,sourceLayerIndex:A}of e){const k=l._featureFilter.needGeometry,L=_o(S,k);if(!l._featureFilter.filter(C,L,i))continue;if(k||(L.geometry=Yt(S,i,a)),h&&1!==S.type&&i.z<=5){const G=L.geometry,$=.98078528056,W=(H,J)=>{const te=If(H.x,H.y,i,1),oe=If(J.x,J.y,i,1);return Z.dot(te,oe)<$};for(let H=0;H<G.length;H++)G[H]=Vw(G[H],W)}let B,j;if(_){const G=l.getValueAndResolveTokens("text-field",L,i,T),$=xr.factory(G);_M($)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===ci()||this.hasRTLText&&mo.isParsed())&&(B=Db($,l,L))}if(y){const G=l.getValueAndResolveTokens("icon-image",L,i,T);j=G instanceof $r?G:$r.fromString(G)}if(!B&&!j)continue;const U=this.sortFeaturesByKey?v.evaluate(L,{},i):void 0;if(this.features.push({id:I,text:B,icon:j,index:R,sourceLayerIndex:A,geometry:L.geometry,properties:S.properties,type:jb[S.type],sortKey:U}),j&&(w[j.namePrimary]=!0,j.nameSecondary&&(w[j.nameSecondary]=!0)),B){const G=f.evaluate(L,{},i).join(","),$="map"===c.get("text-rotation-alignment")&&"point"!==c.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(or.vertical)>=0;for(const W of B.sections)if(W.image)w[W.image.namePrimary]=!0;else{const H=gc(B.toString()),J=W.fontStack||G,te=E[J]=E[J]||{};this.calculateGlyphDependencies(W.text,te,$,this.allowVerticalPlacement,H)}}}"line"===c.get("symbol-placement")&&(this.features=function(S){const I={},R={},A=[];let k=0;function L(G){A.push(S[G]),k++}function B(G,$,W){const H=R[G];return delete R[G],R[$]=H,A[H].geometry[0].pop(),A[H].geometry[0]=A[H].geometry[0].concat(W[0]),H}function j(G,$,W){const H=I[$];return delete I[$],I[G]=H,A[H].geometry[0].shift(),A[H].geometry[0]=W[0].concat(A[H].geometry[0]),H}function U(G,$,W){const H=W?$[0][$[0].length-1]:$[0][0];return`${G}:${H.x}:${H.y}`}for(let G=0;G<S.length;G++){const $=S[G],W=$.geometry,H=$.text?$.text.toString():null;if(!H){L(G);continue}const J=U(H,W),te=U(H,W,!0);if(J in R&&te in I&&R[J]!==I[te]){const oe=j(J,te,W),K=B(J,te,A[oe].geometry);delete I[J],delete R[te],R[U(H,A[K].geometry,!0)]=K,A[oe].geometry=null}else J in R?B(J,te,W):te in I?j(J,te,W):(L(G),I[J]=k-1,R[te]=k-1)}return A.filter(G=>G.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((S,I)=>S.sortKey-I.sortKey)}update(e,n,i,a,l){const c=0!==Object.keys(e).length;if(c&&!this.stateDependentLayers.length)return;const h=c?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,n,h,i,a,l),this.icon.programConfigurations.updatePaintArrays(e,n,h,i,a,l)}updateZOffset(){const e=(l,c,h)=>{i+=c,i>l.length&&l.resize(i);for(let f=-c;f<0;f++)l.emplace(f+i,h)},n=(l,c,h)=>{a+=c,a>l.length&&l.resize(a);for(let f=-c;f<0;f++)l.emplace(f+a,h)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let i=0,a=0;for(let l=0;l<this.symbolInstances.length;l++){const c=this.symbolInstances.get(l),{numHorizontalGlyphVertices:h,numVerticalGlyphVertices:f,numIconVertices:p}=c,g=c.zOffset,_=p>0;if((h>0||f>0)&&(e(this.text.zOffsetVertexArray,h,g),e(this.text.zOffsetVertexArray,f,g)),_){const{placedIconSymbolIndex:y,verticalPlacedIconSymbolIndex:v}=c;y>=0&&n(this.icon.zOffsetVertexArray,p,g),v>=0&&n(this.icon.zOffsetVertexArray,c.numVerticalIconVertices,g)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=ed(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const i=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:a,y:l}of n)this.lineVertexArray.emplaceBack(a,l);return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(e,n,i,a,l,c,h,f,p,g,_,y,v,w,E,T){const C=e.indexArray,S=e.layoutVertexArray,I=e.globeExtVertexArray,R=e.segments.prepareSegment(4*n.length,S,C,this.canOverlap?c.sortKey:void 0),A=this.glyphOffsetArray.length,k=R.vertexLength,L=this.allowVerticalPlacement&&h===or.vertical?Math.PI/2:0,B=c.text&&c.text.sections;for(let U=0;U<n.length;U++){const{tl:G,tr:$,bl:W,br:H,texPrimary:J,texSecondary:te,pixelOffsetTL:oe,pixelOffsetBR:K,minFontScaleX:Q,minFontScaleY:ae,glyphOffset:ue,isSDF:fe,sectionIndex:ge}=n[U],ve=R.vertexLength,de=ue[1];if(Jf(S,p.x,p.y,G.x,de+G.y,J.x,J.y,i,fe,oe.x,oe.y,Q,ae),Jf(S,p.x,p.y,$.x,de+$.y,J.x+J.w,J.y,i,fe,K.x,oe.y,Q,ae),Jf(S,p.x,p.y,W.x,de+W.y,J.x,J.y+J.h,i,fe,oe.x,K.y,Q,ae),Jf(S,p.x,p.y,H.x,de+H.y,J.x+J.w,J.y+J.h,i,fe,K.x,K.y,Q,ae),f){const{x:me,y:Oe,z:qe}=f.anchor,[Ge,We,it]=f.up;ep(I,me,Oe,qe,Ge,We,it),ep(I,me,Oe,qe,Ge,We,it),ep(I,me,Oe,qe,Ge,We,it),ep(I,me,Oe,qe,Ge,We,it),td(e.dynamicLayoutVertexArray,me,Oe,qe,L)}else td(e.dynamicLayoutVertexArray,p.x,p.y,p.z,L);if(T){const me=te||J;Qf(e.iconTransitioningVertexArray,me.x,me.y),Qf(e.iconTransitioningVertexArray,me.x+me.w,me.y),Qf(e.iconTransitioningVertexArray,me.x,me.y+me.h),Qf(e.iconTransitioningVertexArray,me.x+me.w,me.y+me.h)}C.emplaceBack(ve,ve+1,ve+2),C.emplaceBack(ve+1,ve+2,ve+3),R.vertexLength+=4,R.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ue[0]),U!==n.length-1&&ge===n[U+1].sectionIndex||e.programConfigurations.populatePaintArrays(S.length,c,c.index,{},v,w,E,B&&B[ge])}const j=f?f.anchor:p;e.placedSymbolArray.emplaceBack(j.x,j.y,j.z,p.x,p.y,A,this.glyphOffsetArray.length-A,k,g,_,p.segment,i?i[0]:0,i?i[1]:0,a[0],a[1],h,0,!1,0,y,0)}_commitLayoutVertex(e,n,i,a,l,c,h){e.emplaceBack(n,i,a,l,c,Math.round(h.x),Math.round(h.y))}_addCollisionDebugVertices(e,n,i,a,l,c,h){const f=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),p=f.vertexLength,g=h.tileAnchorX,_=h.tileAnchorY;for(let v=0;v<4;v++)i.collisionVertexArray.emplaceBack(0,0,0,0);i.collisionVertexArrayExt.emplaceBack(n,-e.padding,-e.padding),i.collisionVertexArrayExt.emplaceBack(n,e.padding,-e.padding),i.collisionVertexArrayExt.emplaceBack(n,e.padding,e.padding),i.collisionVertexArrayExt.emplaceBack(n,-e.padding,e.padding),this._commitLayoutVertex(i.layoutVertexArray,a,l,c,g,_,new ie(e.x1,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,a,l,c,g,_,new ie(e.x2,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,a,l,c,g,_,new ie(e.x2,e.y2)),this._commitLayoutVertex(i.layoutVertexArray,a,l,c,g,_,new ie(e.x1,e.y2)),f.vertexLength+=4;const y=i.indexArray;y.emplaceBack(p,p+1),y.emplaceBack(p+1,p+2),y.emplaceBack(p+2,p+3),y.emplaceBack(p+3,p),f.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,i,a,l,c){for(let h=a;h<l;h++){const f=i.get(h),p=this.getSymbolInstanceTextSize(e,c,n,h);this._addCollisionDebugVertices(f,p,this.textCollisionBox,f.projectedAnchorX,f.projectedAnchorY,f.projectedAnchorZ,c)}}_addIconDebugCollisionBoxes(e,n,i,a,l,c){for(let h=a;h<l;h++){const f=i.get(h),p=this.getSymbolInstanceIconSize(e,n,c.placedIconSymbolIndex);this._addCollisionDebugVertices(f,p,this.iconCollisionBox,f.projectedAnchorX,f.projectedAnchorY,f.projectedAnchorZ,c)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Xv(Tt,$f.members,fs),this.iconCollisionBox=new Xv(Tt,$f.members,fs);const i=pa(this.iconSizeData,e),a=pa(this.textSizeData,e);for(let l=0;l<this.symbolInstances.length;l++){const c=this.symbolInstances.get(l);this._addTextDebugCollisionBoxes(a,e,n,c.textBoxStartIndex,c.textBoxEndIndex,c),this._addTextDebugCollisionBoxes(a,e,n,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c),this._addIconDebugCollisionBoxes(i,e,n,c.iconBoxStartIndex,c.iconBoxEndIndex,c),this._addIconDebugCollisionBoxes(i,e,n,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c)}}getSymbolInstanceTextSize(e,n,i,a){const l=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:a),c=fg(this.textSizeData,e,l)/24;return this.tilePixelRatio*c}getSymbolInstanceIconSize(e,n,i){const a=this.icon.placedSymbolArray.get(i),l=fg(this.iconSizeData,e,a);return this.tilePixelRatio*l}_commitDebugCollisionVertexUpdate(e,n,i){e.emplaceBack(n,-i,-i),e.emplaceBack(n,i,-i),e.emplaceBack(n,i,i),e.emplaceBack(n,-i,i)}_updateTextDebugCollisionBoxes(e,n,i,a,l,c){for(let h=a;h<l;h++){const f=i.get(h),p=this.getSymbolInstanceTextSize(e,c,n,h);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,p,f.padding)}}_updateIconDebugCollisionBoxes(e,n,i,a,l,c){for(let h=a;h<l;h++){const f=i.get(h),p=this.getSymbolInstanceIconSize(e,n,c);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,p,f.padding)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const i=pa(this.iconSizeData,e),a=pa(this.textSizeData,e);for(let l=0;l<this.symbolInstances.length;l++){const c=this.symbolInstances.get(l);this._updateTextDebugCollisionBoxes(a,e,n,c.textBoxStartIndex,c.textBoxEndIndex,c),this._updateTextDebugCollisionBoxes(a,e,n,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c),this._updateIconDebugCollisionBoxes(i,e,n,c.iconBoxStartIndex,c.iconBoxEndIndex,c.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(i,e,n,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,i,a,l,c,h,f,p){const g={};if(n<i){const{x1:_,y1:y,x2:v,y2:w,padding:E,projectedAnchorX:T,projectedAnchorY:C,projectedAnchorZ:S,tileAnchorX:I,tileAnchorY:R,featureIndex:A}=e.get(n);g.textBox={x1:_,y1:y,x2:v,y2:w,padding:E,projectedAnchorX:T,projectedAnchorY:C,projectedAnchorZ:S,tileAnchorX:I,tileAnchorY:R},g.textFeatureIndex=A}if(a<l){const{x1:_,y1:y,x2:v,y2:w,padding:E,projectedAnchorX:T,projectedAnchorY:C,projectedAnchorZ:S,tileAnchorX:I,tileAnchorY:R,featureIndex:A}=e.get(a);g.verticalTextBox={x1:_,y1:y,x2:v,y2:w,padding:E,projectedAnchorX:T,projectedAnchorY:C,projectedAnchorZ:S,tileAnchorX:I,tileAnchorY:R},g.verticalTextFeatureIndex=A}if(c<h){const{x1:_,y1:y,x2:v,y2:w,padding:E,projectedAnchorX:T,projectedAnchorY:C,projectedAnchorZ:S,tileAnchorX:I,tileAnchorY:R,featureIndex:A}=e.get(c);g.iconBox={x1:_,y1:y,x2:v,y2:w,padding:E,projectedAnchorX:T,projectedAnchorY:C,projectedAnchorZ:S,tileAnchorX:I,tileAnchorY:R},g.iconFeatureIndex=A}if(f<p){const{x1:_,y1:y,x2:v,y2:w,padding:E,projectedAnchorX:T,projectedAnchorY:C,projectedAnchorZ:S,tileAnchorX:I,tileAnchorY:R,featureIndex:A}=e.get(f);g.verticalIconBox={x1:_,y1:y,x2:v,y2:w,padding:E,projectedAnchorX:T,projectedAnchorY:C,projectedAnchorZ:S,tileAnchorX:I,tileAnchorY:R},g.verticalIconFeatureIndex=A}return g}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const i=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){const i=e.placedSymbolArray.get(n),a=i.vertexStartIndex+4*i.numGlyphs;for(let l=i.vertexStartIndex;l<a;l+=4)e.indexArray.emplaceBack(l,l+1,l+2),e.indexArray.emplaceBack(l+1,l+2,l+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const n=Math.sin(e),i=Math.cos(e),a=[],l=[],c=[];for(let h=0;h<this.symbolInstances.length;++h){c.push(h);const f=this.symbolInstances.get(h);a.push(0|Math.round(n*f.tileAnchorX+i*f.tileAnchorY)),l.push(f.featureIndex)}return c.sort((h,f)=>a[h]-a[f]||l[f]-l[h]),c}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===n?i.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const i=this.symbolInstances.get(n);this.featureSortOrder.push(i.featureIndex);const{rightJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:l,leftJustifiedTextSymbolIndex:c,verticalPlacedTextSymbolIndex:h,placedIconSymbolIndex:f,verticalPlacedIconSymbolIndex:p}=i;a>=0&&this.addIndicesForPlacedSymbol(this.text,a),l>=0&&l!==a&&this.addIndicesForPlacedSymbol(this.text,l),c>=0&&c!==l&&c!==a&&this.addIndicesForPlacedSymbol(this.text,c),h>=0&&this.addIndicesForPlacedSymbol(this.text,h),f>=0&&this.addIndicesForPlacedSymbol(this.icon,f),p>=0&&this.addIndicesForPlacedSymbol(this.icon,p)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Qe(ii,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),ii.MAX_GLYPHS=65535,ii.addDynamicAttributes=td;var nd=ii;const yM=wn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:vM}=yM,$b=wn([{name:"a_packed",components:4,type:"Float32"}]),{members:xM}=$b,Hb=Vf.types,Gb=Math.cos(Math.PI/180*37.5);class Hl{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new gu,this.layoutVertexArray2=new Ha,this.indexArray=new Tr,this.programConfigurations=new xc(e.layers,e.zoom),this.segments=new Cn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,i,a){this.hasPattern=Ev("line",this.layers,n);const l=this.layers[0].layout.get("line-sort-key"),c=[];for(const{feature:g,id:_,index:y,sourceLayerIndex:v}of e){const w=this.layers[0]._featureFilter.needGeometry,E=_o(g,w);if(!this.layers[0]._featureFilter.filter(new pr(this.zoom),E,i))continue;const T=l?l.evaluate(E,{},i):void 0,C={id:_,properties:g.properties,type:g.type,sourceLayerIndex:v,index:y,geometry:w?E.geometry:Yt(g,i,a),patterns:{},sortKey:T};c.push(C)}l&&c.sort((g,_)=>g.sortKey-_.sortKey);const{lineAtlas:h,featureIndex:f}=n,p=this.addConstantDashes(h);for(const g of c){const{geometry:_,index:y,sourceLayerIndex:v}=g;if(p&&this.addFeatureDashes(g,h),this.hasPattern){const w=Bf("line",this.layers,g,this.zoom,n);this.patternFeatures.push(w)}else this.addFeature(g,_,y,i,h.positions,n.availableImages,n.brightness);f.insert(e[y].feature,_,y,v,this.index)}}addConstantDashes(e){let n=!1;for(const i of this.layers){const a=i.paint.get("line-dasharray").value,l=i.layout.get("line-cap").value;if("constant"!==a.kind||"constant"!==l.kind)n=!0;else{const c=l.value,h=a.value;if(!h)continue;e.addDash(h,c)}}return n}addFeatureDashes(e,n){const i=this.zoom;for(const a of this.layers){const l=a.paint.get("line-dasharray").value,c=a.layout.get("line-cap").value;if("constant"===l.kind&&"constant"===c.kind)continue;let h,f;if("constant"===l.kind){if(h=l.value,!h)continue}else h=l.evaluate({zoom:i},e);f="constant"===c.kind?c.value:c.evaluate({zoom:i},e),n.addDash(h,f),e.patterns[a.id]=n.getKey(h,f)}}update(e,n,i,a,l){const c=0!==Object.keys(e).length;c&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,c?this.stateDependentLayers:this.layers,i,a,l)}addFeatures(e,n,i,a,l,c){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,n,i,a,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,xM)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,vM),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,i,a,l,c,h){const f=this.layers[0].layout,p=f.get("line-join").evaluate(e,{}),g=f.get("line-cap").evaluate(e,{}),_=f.get("line-miter-limit"),y=f.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const v of n)this.addLine(v,e,p,g,_,y);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,l,c,a,h)}addLine(e,n,i,a,l,c){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let C=0;C<e.length-1;C++)this.totalDistance+=e[C].dist(e[C+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const h="Polygon"===Hb[n.type];let f=e.length;for(;f>=2&&e[f-1].equals(e[f-2]);)f--;let p=0;for(;p<f-1&&e[p].equals(e[p+1]);)p++;if(f<(h?3:2))return;"bevel"===i&&(l=1.05);const g=this.overscaling<=16?15*he/(512*this.overscaling):0,_=this.segments.prepareSegment(10*f,this.layoutVertexArray,this.indexArray);let y,v,w,E,T;this.e1=this.e2=-1,h&&(y=e[f-2],T=e[p].sub(y)._unit()._perp());for(let C=p;C<f;C++){if(w=C===f-1?h?e[p+1]:void 0:e[C+1],w&&e[C].equals(w))continue;T&&(E=T),y&&(v=y),y=e[C],T=w?w.sub(y)._unit()._perp():E,E=E||T;let S=E.add(T);0===S.x&&0===S.y||S._unit();const I=E.x*T.x+E.y*T.y,R=S.x*T.x+S.y*T.y,A=0!==R?1/R:1/0,k=2*Math.sqrt(2-2*R),L=R<Gb&&v&&w,B=E.x*T.y-E.y*T.x>0;if(L&&C>p){const G=y.dist(v);if(G>2*g){const $=y.sub(y.sub(v)._mult(g/G)._round());this.updateDistance(v,$),this.addCurrentVertex($,E,0,0,_),v=$}}const j=v&&w;let U=j?i:h?"butt":a;if(j&&"round"===U&&(A<c?U="miter":A<=2&&(U="fakeround")),"miter"===U&&A>l&&(U="bevel"),"bevel"===U&&(A>2&&(U="flipbevel"),A<l&&(U="miter")),v&&this.updateDistance(v,y),"miter"===U)S._mult(A),this.addCurrentVertex(y,S,0,0,_);else if("flipbevel"===U){if(A>100)S=T.mult(-1);else{const G=A*E.add(T).mag()/E.sub(T).mag();S._perp()._mult(G*(B?-1:1))}this.addCurrentVertex(y,S,0,0,_),this.addCurrentVertex(y,S.mult(-1),0,0,_)}else if("bevel"===U||"fakeround"===U){const G=-Math.sqrt(A*A-1),$=B?G:0,W=B?0:G;if(v&&this.addCurrentVertex(y,E,$,W,_),"fakeround"===U){const H=Math.round(180*k/Math.PI/20);for(let J=1;J<H;J++){let te=J/H;if(.5!==te){const K=te-.5;te+=te*K*(te-1)*((1.0904+I*(I*(3.55645-1.43519*I)-3.2452))*K*K+(.848013+I*(.215638*I-1.06021)))}const oe=T.sub(E)._mult(te)._add(E)._unit()._mult(B?-1:1);this.addHalfVertex(y,oe.x,oe.y,!1,B,0,_)}}w&&this.addCurrentVertex(y,T,-$,-W,_)}else if("butt"===U)this.addCurrentVertex(y,S,0,0,_);else if("square"===U){const G=v?1:-1;v||this.addCurrentVertex(y,S,G,G,_),this.addCurrentVertex(y,S,0,0,_),v&&this.addCurrentVertex(y,S,G,G,_)}else"round"===U&&(v&&(this.addCurrentVertex(y,E,0,0,_),this.addCurrentVertex(y,E,1,1,_,!0)),w&&(this.addCurrentVertex(y,T,-1,-1,_,!0),this.addCurrentVertex(y,T,0,0,_)));if(L&&C<f-1){const G=y.dist(w);if(G>2*g){const $=y.add(w.sub(y)._mult(g/G)._round());this.updateDistance(y,$),this.addCurrentVertex($,T,0,0,_),y=$}}}}addCurrentVertex(e,n,i,a,l,c=!1){const h=n.y*a-n.x,f=-n.y-n.x*a;this.addHalfVertex(e,n.x+n.y*i,n.y-n.x*i,c,!1,i,l),this.addHalfVertex(e,h,f,c,!0,-a,l)}addHalfVertex({x:e,y:n},i,a,l,c,h,f){this.layoutVertexArray.emplaceBack((e<<1)+(l?1:0),(n<<1)+(c?1:0),Math.round(63*i)+128,Math.round(63*a)+128,1+(0===h?0:h<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const p=f.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,p),f.primitiveLength++),c?this.e2=p:this.e1=p}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}Qe(Hl,"LineBucket",{omit:["layers","patternFeatures"]});class Wr{constructor(e,n,i,a){this.context=e,this.format=i,this.texture=e.gl.createTexture(),this.update(n,a)}update(e,n,i){const{width:a,height:l}=e,{context:c}=this,{gl:h}=c,{HTMLImageElement:f,HTMLCanvasElement:p,HTMLVideoElement:g,ImageData:_,ImageBitmap:y}=ce;if(h.bindTexture(h.TEXTURE_2D,this.texture),c.pixelStoreUnpackFlipY.set(!1),c.pixelStoreUnpack.set(1),c.pixelStoreUnpackPremultiplyAlpha.set(this.format===h.RGBA&&(!n||!1!==n.premultiply)),i||this.size&&this.size[0]===a&&this.size[1]===l){const{x:v,y:w}=i||{x:0,y:0};if(e instanceof f||e instanceof p||e instanceof g||e instanceof _||y&&e instanceof y)h.texSubImage2D(h.TEXTURE_2D,0,v,w,h.RGBA,h.UNSIGNED_BYTE,e);else{let E=this.format,T=h.UNSIGNED_BYTE;this.format===h.R32F&&(E=h.RED,T=h.FLOAT),h.texSubImage2D(h.TEXTURE_2D,0,v,w,a,l,E,T,e.data)}}else if(this.size=[a,l],e instanceof f||e instanceof p||e instanceof g||e instanceof _||y&&e instanceof y){let v=this.format;this.format===h.R8&&(v=h.RED),h.texImage2D(h.TEXTURE_2D,0,this.format,v,h.UNSIGNED_BYTE,e)}else{let v=this.format,w=this.format,E=h.UNSIGNED_BYTE;this.format===h.DEPTH_COMPONENT&&(v=h.DEPTH_COMPONENT16,E=h.UNSIGNED_SHORT),this.format===h.R32F&&(E=h.FLOAT,w=h.RED),h.texImage2D(h.TEXTURE_2D,0,v,a,l,0,w,E,e.data)}this.useMipmap=Boolean(n&&n.useMipmap),this.useMipmap&&h.generateMipmap(h.TEXTURE_2D)}bind(e,n){const{context:i}=this,{gl:a}=i;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.useMipmap?e===a.NEAREST?a.NEAREST_MIPMAP_NEAREST:a.LINEAR_MIPMAP_NEAREST:e),this.minFilter=e),n!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,n),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,i,a){const{context:l}=this,{gl:c}=l;c.bindTexture(c.TEXTURE_2D,this.texture),n!==this.magFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap?e===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_NEAREST:e),this.minFilter=e),i!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,i),this.wrapS=i),a!==this.wrapT&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,a),this.wrapT=a)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Ag{constructor(e,n){this.context=e,this.texture=n}bind(e,n){const{context:i}=this,{gl:a}=i;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,n),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,n),this.wrapS=n)}}const Gl=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,i=0,a=0,l=0,c=0,h=0;for(1&e?a=l=c=32:n=i=h=32;(e>>=1)>1;){const p=n+a>>1,g=i+l>>1;1&e?(a=n,l=i,n=c,i=h):(n=a,i=l,a=c,l=h),c=p,h=g}const f=4*t;Gl[f+0]=n,Gl[f+1]=i,Gl[f+2]=a,Gl[f+3]=l}const ql=new Uint16Array(2178),Wl=new Uint8Array(1089),Ru=new Uint16Array(1089);function ya(t){return 0===t?-.03125:32===t?.03125:0}var Yv=wn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const qb={type:2,extent:he,loadGeometry:()=>[[new ie(0,0),new ie(8193,0),new ie(8193,8193),new ie(0,8193),new ie(0,0)]]};class qo{constructor(e,n,i,a,l){this.tileID=e,this.uid=vr(),this.uses=0,this.tileSize=n,this.tileZoom=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=l,a&&a.style&&(this._lastUpdatedBrightness=a.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",a&&a.transform&&(this.projection=a.transform.projection)}registerFadeDuration(e){const n=e+this.timeAdded;n<Ct.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Po(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,i){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(a,l){const c={};if(!l)return c;for(const h of a){const f=h.layerIds.map(p=>l.getLayer(p)).filter(Boolean);if(0!==f.length){h.layers=f,h.stateDependentLayerIds&&(h.stateDependentLayers=h.stateDependentLayerIds.map(p=>f.filter(g=>g.id===p)[0]));for(const p of f)c[p.fqid]=h}}return c}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const a in this.buckets){const l=this.buckets[a];if(l instanceof nd){if(this.hasSymbolBuckets=!0,!i)break;l.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const a in this.buckets){const l=this.buckets[a];if(l instanceof nd&&l.hasRTLText){this.hasRTLText=!0,mo.isLoading()||mo.isLoaded()||"deferred"!==ci()||pm();break}}this.queryPadding=0;for(const a in this.buckets){const l=this.buckets[a],c=n.style.getOwnLayer(a);if(!c)continue;const h=c.queryRadius(l);this.queryPadding=Math.max(this.queryPadding,h)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new cy}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(const i in this.buckets){const a=this.buckets[i];a.uploadPending()&&a.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Wr(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Wr(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Wr(e,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e,n,i){if(this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,i),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const a=n.style.getBrightness();(this._lastUpdatedBrightness||a)&&(this._lastUpdatedBrightness&&a&&Math.abs(this._lastUpdatedBrightness-a)<.001||(this._lastUpdatedBrightness=a,this.updateBuckets(void 0,n)))}queryRenderedFeatures(e,n,i,a,l,c,h,f){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:a,pixelPosMatrix:h,transform:c,params:l,tileTransform:this.tileTransform},e,n,i):{}}querySourceFeatures(e,n){const i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;const a=i.loadVTLayers(),l=n?n.sourceLayer:"",c=a._geojsonTileLayer||a[l];if(!c)return;const h=vh(n&&n.filter),{z:f,x:p,y:g}=this.tileID.canonical,_={z:f,x:p,y:g};for(let y=0;y<c.length;y++){const v=c.feature(y);if(h.needGeometry){const T=_o(v,!0);if(!h.filter(new pr(this.tileID.overscaledZ),T,this.tileID.canonical))continue}else if(!h.filter(new pr(this.tileID.overscaledZ),v))continue;const w=i.getId(v,l),E=new _b(v,f,p,g,w);E.tile=_,e.push(E)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}bucketsLoaded(){for(const e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const i=st(e.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const i=Date.now();let a=!1;if(this.expirationTime>i)a=!1;else if(n)if(this.expirationTime<n)a=!0;else{const l=this.expirationTime-n;l?this.expirationTime=i+Math.max(l,3e4):a=!0}else a=!0;a?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(e).length&&n&&this.updateBuckets(e,n)}updateBuckets(e,n){if(!this.latestFeatureIndex)return;const i=this.latestFeatureIndex.loadVTLayers(),a=n.style.listImages(),l=n.style.getBrightness();for(const c in this.buckets){if(!n.style.hasLayer(c))continue;const h=this.buckets[c],f=h.layers[0].sourceLayer||"_geojsonTileLayer",p=i[f];let g={};if(e&&(g=e[f],!p||!g||0===Object.keys(g).length))continue;if(h.update(g,p,a,this.imageAtlas&&this.imageAtlas.patternPositions||{},l),h instanceof Hl||h instanceof Cv){const y=n.style.getOwnSourceCache(h.layers[0].source);n._terrain&&n._terrain.enabled&&y&&h.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(y.id,this.tileID)}const _=n&&n.style&&n.style.getOwnLayer(c);_&&(this.queryPadding=Math.max(this.queryPadding,_.queryRadius(h)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ct.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Ct.now()+e}setTexture(e,n){const i=n.context,a=i.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Wr(i,e,a.RGBA,{useMipmap:!0}),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE))}setDependencies(e,n){const i={};for(const a of n)i[a]=!0;this.dependencies[e]=i}hasDependency(e,n){for(const i of e){const a=this.dependencies[i];if(a)for(const l of n)if(a[l])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||"mercator"===n.name||this._tileDebugBuffer)return;const i=Yt(qb,this.tileID.canonical,this.tileTransform)[0],a=new jo,l=new Ml;for(let c=0;c<i.length;c++){const{x:h,y:f}=i[c];a.emplaceBack(h,f),l.emplaceBack(c)}l.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(l),this._tileDebugBuffer=e.createVertexBuffer(a,Ec.members),this._tileDebugSegments=Cn.simpleSegment(0,0,a.length,l.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||"mercator"===n.name)return;const i=Yt(qb,this.tileID.canonical,this.tileTransform)[0];let a,l;if(this.isRaster){const c=function(h,f){const p=Po(h,f),g=Math.pow(2,h.z);for(let T=0;T<33;T++)for(let C=0;C<33;C++){const S=Ao((h.x+(C+ya(C))/32)/g),I=Gr((h.y+(T+ya(T))/32)/g),R=f.project(S,I),A=33*T+C;ql[2*A+0]=Math.round((R.x*p.scale-p.x)*he),ql[2*A+1]=Math.round((R.y*p.scale-p.y)*he)}Wl.fill(0),Ru.fill(0);for(let T=2045;T>=0;T--){const C=4*T,S=Gl[C+0],I=Gl[C+1],R=Gl[C+2],A=Gl[C+3],k=S+R>>1,L=I+A>>1,B=k+L-I,j=L+S-k,U=33*I+S,G=33*A+R,$=33*L+k,W=Math.hypot((ql[2*U+0]+ql[2*G+0])/2-ql[2*$+0],(ql[2*U+1]+ql[2*G+1])/2-ql[2*$+1])>=16;Wl[$]=Wl[$]||(W?1:0),T<1022&&(Wl[$]=Wl[$]||Wl[33*(I+j>>1)+(S+B>>1)]||Wl[33*(A+j>>1)+(R+B>>1)])}const _=new $a,y=new Tr;let v=0;function w(T,C){const S=33*C+T;return 0===Ru[S]&&(_.emplaceBack(ql[2*S+0],ql[2*S+1],T*he/32,C*he/32),Ru[S]=++v),Ru[S]-1}function E(T,C,S,I,R,A){const k=T+S>>1,L=C+I>>1;if(Math.abs(T-R)+Math.abs(C-A)>1&&Wl[33*L+k])E(R,A,T,C,k,L),E(S,I,R,A,k,L);else{const B=w(T,C),j=w(S,I),U=w(R,A);y.emplaceBack(B,j,U)}}return E(0,0,32,32,32,0),E(32,32,0,0,0,32),{vertices:_,indices:y}}(this.tileID.canonical,n);a=c.vertices,l=c.indices}else{a=new $a,l=new Tr;for(const{x:h,y:f}of i)a.emplaceBack(h,f,0,0);const c=bv(a.int16,void 0,4);for(let h=0;h<c.length;h+=3)l.emplaceBack(c[h],c[h+1],c[h+2])}this._tileBoundsBuffer=e.createVertexBuffer(a,Yv.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(l),this._tileBoundsSegments=Cn.simpleSegment(0,0,a.length,l.length)}_makeGlobeTileDebugBuffers(e,n){const i=n.projection;if(!i||"globe"!==i.name||n.freezeTileCoverage)return;const a=this.tileID.canonical,l=So(Gy(a,n)),c=ni(n.zoom);let h;c>0&&(h=se.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,a,n,l,h,c),this._makeGlobeTileDebugTextBuffer(e,a,n,l,h,c)}_globePoint(e,n,i,a,l,c,h){let f=If(e,n,i);if(c){const p=1<<i.z,g=Si(a.center.lng),_=gi(a.center.lat),y=(i.x+.5)/p-g;let v=0;y>.5?v=-1:y<-.5&&(v=1);let w=(e/he+i.x)/p+v,E=(n/he+i.y)/p;w=(w-g)*a._pixelsPerMercatorPixel+g,E=(E-_)*a._pixelsPerMercatorPixel+_;const T=[w*a.worldSize,E*a.worldSize,0];Z.transformMat4(T,T,c),f=Ol(f,T,h)}return Z.transformMat4(f,f,l)}_makeGlobeTileDebugBorderBuffer(e,n,i,a,l,c){const h=new jo,f=new Ml,p=new Ch,g=(y,v,w,E,T)=>{const C=(w-y)/(T-1),S=(E-v)/(T-1),I=h.length;for(let R=0;R<T;R++){const A=y+R*C,k=v+R*S;h.emplaceBack(A,k);const L=this._globePoint(A,k,n,i,a,l,c);p.emplaceBack(L[0],L[1],L[2]),f.emplaceBack(I+R)}},_=he;g(0,0,_,0,16),g(_,0,_,_,16),g(_,_,0,_,16),g(0,_,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(f),this._tileDebugBuffer=e.createVertexBuffer(h,Ec.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(p,Vy.members),this._tileDebugSegments=Cn.simpleSegment(0,0,h.length,f.length)}_makeGlobeTileDebugTextBuffer(e,n,i,a,l,c){const f=new jo,p=new Tr,g=new Ch,_=25;p.reserve(32),f.reserve(_),g.reserve(_);const y=(v,w)=>_*v+w;for(let v=0;v<_;v++){const w=2048*v;for(let E=0;E<_;E++){const T=2048*E;f.emplaceBack(T,w);const C=this._globePoint(T,w,n,i,a,l,c);g.emplaceBack(C[0],C[1],C[2])}}for(let v=0;v<4;v++)for(let w=0;w<4;w++){const E=y(v,w),T=y(v,w+1),C=y(v+1,w),S=y(v+1,w+1);p.emplaceBack(E,T,C),p.emplaceBack(C,T,S)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(p),this._tileDebugTextBuffer=e.createVertexBuffer(f,Ec.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(g,Vy.members),this._tileDebugTextSegments=Cn.simpleSegment(0,0,_,32)}}class va{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,i){const a=e.wrapped().key;void 0===this.data[a]&&(this.data[a]=[]);const l={value:n,timeout:void 0};if(void 0!==i&&(l.timeout=setTimeout(()=>{this.remove(e,l)},i)),this.data[a].push(l),this.order.push(a),this.order.length>this.max){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const i=e.wrapped().key,a=void 0===n?0:this.data[i].indexOf(n),l=this.data[i][a];return this.data[i].splice(a,1),l.timeout&&clearTimeout(l.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(l.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const i in this.data)for(const a of this.data[i])e(a.value)||n.push(a);for(const i of n)this.remove(i.value.tileID,i)}}let zs=(()=>{class t{constructor(n,i,a,l){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++,this.context=n;const c=n.gl;this.buffer=c.createBuffer(),this.dynamicDraw=Boolean(a),this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||l||i.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++;const i=this.context.gl;this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return t.uniqueIdxCounter=0,t})();const Wb={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Zb{constructor(e,n,i,a,l,c){this.length=n.length,this.attributes=i,this.itemSize=n.bytesPerElement,this.dynamicDraw=a,this.instanceCount=c,this.context=e;const h=e.gl;this.buffer=h.createBuffer(),e.bindVertexBuffer.set(this.buffer),h.bufferData(h.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||l||n.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,n){for(let i=0;i<this.attributes.length;i++){const a=n.attributes[this.attributes[i].name];void 0!==a&&e.enableVertexAttribArray(a)}}setVertexAttribPointers(e,n,i){for(let a=0;a<this.attributes.length;a++){const l=this.attributes[a],c=n.attributes[l.name];void 0!==c&&e.vertexAttribPointer(c,l.components,e[Wb[l.type]],!1,this.itemSize,l.offset+this.itemSize*(i||0))}}setVertexAttribDivisor(e,n,i){for(let a=0;a<this.attributes.length;a++){const l=n.attributes[this.attributes[a].name];void 0!==l&&this.instanceCount&&this.instanceCount>0&&e.vertexAttribDivisor(l,i)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Kn{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class wM extends Kn{getDefault(){return yt.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class bM extends Kn{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class EM extends Kn{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Kv extends Kn{getDefault(){return[!0,!0,!0,!0]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class tp extends Kn{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class CM extends Kn{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Xb extends Kn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const n=this.current;(e.func!==n.func||e.ref!==n.ref||e.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class TM extends Kn{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Yb extends Kn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=e,this.dirty=!1}}class Kb extends Kn{getDefault(){return[0,1]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Ig extends Kn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=e,this.dirty=!1}}class DM extends Kn{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Jb extends Kn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.BLEND):n.disable(n.BLEND),this.current=e,this.dirty=!1}}class rd extends Kn{getDefault(){const e=this.gl;return[e.ONE,e.ZERO,e.ONE,e.ZERO]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Jv extends Kn{getDefault(){return yt.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Qv extends Kn{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(e,e),this.current=e,this.dirty=!1)}}class Qb extends Kn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=e,this.dirty=!1}}class eE extends Kn{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class tE extends Kn{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}let nE=class extends Kn{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}};class rE extends Kn{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class iE extends Kn{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class oE extends Kn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class sE extends Kn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class MM extends Kn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class SM extends Kn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class AM extends Kn{getDefault(){return null}set(e){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class IM extends Kn{getDefault(){return null}set(e){this.gl&&(e!==this.current||this.dirty)&&(this.gl.bindVertexArray(e),this.current=e,this.dirty=!1)}}class PM extends Kn{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class RM extends Kn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class kM extends Kn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class e0 extends Kn{constructor(e,n){super(e),this.context=e,this.parent=n}getDefault(){return null}}class OM extends e0{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class aE extends e0{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,this.attachment(),n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class LM extends e0{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,this.attachment(),n.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class FM extends aE{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class NM{constructor(e,n,i,a,l){this.context=e,this.width=n,this.height=i;const c=this.framebuffer=e.gl.createFramebuffer();a&&(this.colorAttachment=new OM(e,c)),l&&(this.depthAttachmentType=l,this.depthAttachment="renderbuffer"===l?new aE(e,c):new LM(e,c))}destroy(){const e=this.context.gl;if(this.colorAttachment){const n=this.colorAttachment.get();n&&e.deleteTexture(n)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const n=this.depthAttachment.get();n&&e.deleteRenderbuffer(n)}else{const n=this.depthAttachment.get();n&&e.deleteTexture(n)}e.deleteFramebuffer(this.framebuffer)}}class Et{constructor(e,n,i){this.func=e,this.mask=n,this.range=i}}Et.ReadOnly=!1,Et.ReadWrite=!0,Et.disabled=new Et(519,Et.ReadOnly,[0,1]);class qt{constructor(e,n,i,a,l,c){this.test=e,this.ref=n,this.mask=i,this.fail=a,this.depthFail=l,this.pass=c}}qt.disabled=new qt({func:519,mask:0},0,0,7680,7680,7680);class fn{constructor(e,n,i,a){this.blendFunction=e,this.blendColor=n,this.mask=i,this.blendEquation=a}}fn.Replace=[1,0,1,0],fn.disabled=new fn(fn.Replace,yt.transparent,[!1,!1,!1,!1]),fn.unblended=new fn(fn.Replace,yt.transparent,[!0,!0,!0,!0]),fn.alphaBlended=new fn([1,771,1,771],yt.transparent,[!0,!0,!0,!0]),fn.multiply=new fn([774,0,774,0],yt.transparent,[!0,!0,!0,!0]);class Wt{constructor(e,n,i){this.enable=e,this.mode=n,this.frontFace=i}}Wt.disabled=new Wt(!1,1029,2305),Wt.backCCW=new Wt(!0,1029,2305),Wt.backCW=new Wt(!0,1029,2304),Wt.frontCW=new Wt(!0,1028,2304),Wt.frontCCW=new Wt(!0,1028,2305);class lE{constructor(e){this.gl=e,this.clearColor=new wM(this),this.clearDepth=new bM(this),this.clearStencil=new EM(this),this.colorMask=new Kv(this),this.depthMask=new tp(this),this.stencilMask=new CM(this),this.stencilFunc=new Xb(this),this.stencilOp=new TM(this),this.stencilTest=new Yb(this),this.depthRange=new Kb(this),this.depthTest=new Ig(this),this.depthFunc=new DM(this),this.blend=new Jb(this),this.blendFunc=new rd(this),this.blendColor=new Jv(this),this.blendEquation=new Qv(this),this.cullFace=new Qb(this),this.cullFaceSide=new eE(this),this.frontFace=new tE(this),this.program=new nE(this),this.activeTexture=new rE(this),this.viewport=new iE(this),this.bindFramebuffer=new oE(this),this.bindRenderbuffer=new sE(this),this.bindTexture=new MM(this),this.bindVertexBuffer=new SM(this),this.bindElementBuffer=new AM(this),this.bindVertexArrayOES=new IM(this),this.pixelStoreUnpack=new PM(this),this.pixelStoreUnpackPremultiplyAlpha=new RM(this),this.pixelStoreUnpackFlipY=new kM(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureFloatLinear=e.getExtension("OES_texture_float_linear"),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,n,i){return new zs(this,e,n,i)}createVertexBuffer(e,n,i,a,l){return new Zb(this,e,n,i,a,l)}createRenderbuffer(e,n,i){const a=this.gl,l=a.createRenderbuffer();return this.bindRenderbuffer.set(l),a.renderbufferStorage(a.RENDERBUFFER,e,n,i),this.bindRenderbuffer.set(null),l}createFramebuffer(e,n,i,a){return new NM(this,e,n,i,a)}clear({color:e,depth:n,stencil:i,colorMask:a}){const l=this.gl;let c=0;e&&(c|=l.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set(a||[!0,!0,!0,!0])),void 0!==n&&(c|=l.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),void 0!==i&&(c|=l.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),l.clear(c)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){ln(e.blendFunction,fn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor),e.blendEquation?this.blendEquation.set(e.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(e.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class Bs extends Mn{constructor(e,n,i){super(),this.id=e,this._onlySymbols=i,n.on("data",a=>{"source"===a.dataType&&"metadata"===a.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===a.dataType&&"content"===a.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new va(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Pv,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const n=this._tiles[e];if("errored"!==n.state&&("loaded"!==n.state||!n.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const i=this._tiles[n];i.upload(e),i.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return xe(this._tiles).map(e=>e.tileID).sort(n0).map(e=>e.key)}getRenderableIds(e,n){const i=[];for(const a in this._tiles)this._isIdRenderable(+a,e,n)&&i.push(this._tiles[a]);return e?i.sort((a,l)=>{const c=a.tileID,h=l.tileID,f=new ie(c.canonical.x,c.canonical.y)._rotate(this.transform.angle),p=new ie(h.canonical.x,h.canonical.y)._rotate(this.transform.angle);return c.overscaledZ-h.overscaledZ||p.y-f.y||p.x-f.x}).map(a=>a.tileID.key):i.map(a=>a.tileID).sort(n0).map(a=>a.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())&&(i||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){const i=this._tiles[e];i&&("loading"!==i.state&&(i.state=n),this._loadTile(i,this._tileLoaded.bind(this,i,e,n)))}_tileLoaded(e,n,i,a){if(a)if(e.state="errored",404!==a.status)this._source.fire(new xt(a,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const l=this.map.painter.terrain;this.update(this.transform,l.getScaledDemTileSize(),!0),l.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Ct.now(),"expired"===i&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Se("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const n=this.getRenderableIds();for(let a=0;a<n.length;a++){const l=n[a];if(e.neighboringTiles&&e.neighboringTiles[l]){const c=this.getTileByID(l);i(e,c),i(c,e)}}function i(a,l){if(!a.dem||a.dem.borderReady)return;a.needsHillshadePrepare=!0,a.needsDEMTextureUpload=!0;let c=l.tileID.canonical.x-a.tileID.canonical.x;const h=l.tileID.canonical.y-a.tileID.canonical.y,f=Math.pow(2,a.tileID.canonical.z),p=l.tileID.key;0===c&&0===h||Math.abs(h)>1||(Math.abs(c)>1&&(1===Math.abs(c+f)?c+=f:1===Math.abs(c-f)&&(c-=f)),l.dem&&a.dem&&(a.dem.backfillBorder(l.dem,c,h),a.neighboringTiles&&a.neighboringTiles[p]&&(a.neighboringTiles[p].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,i,a){for(const l in this._tiles){let c=this._tiles[l];if(a[l]||!c.hasData()||c.tileID.overscaledZ<=n||c.tileID.overscaledZ>i)continue;let h=c.tileID;for(;c&&c.tileID.overscaledZ>n+1;){const p=c.tileID.scaledTo(c.tileID.overscaledZ-1);c=this._tiles[p.key],c&&c.hasData()&&(h=p)}let f=h;for(;f.overscaledZ>n;)if(f=f.scaledTo(f.overscaledZ-1),e[f.key]){a[h.key]=h;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const i=this._loadedParentTiles[e.key];return i&&i.tileID.overscaledZ>=n?i:null}for(let i=e.overscaledZ-1;i>=n;i--){const a=e.scaledTo(i),l=this._getLoadedTile(a);if(l)return l}}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;const i=Math.ceil(e.width/n)+1,a=Math.ceil(e.height/n)+1,l=Math.floor(i*a*5),c="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,l):l,h="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(h)}handleWrapJump(e){const n=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,n){const i={};for(const a in this._tiles){const l=this._tiles[a];l.tileID=l.tileID.unwrapTo(l.tileID.wrap+n),i[l.tileID.key]=l}this._tiles=i;for(const a in this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(const a in this._tiles)this._setTileReloadTimer(+a,this._tiles[a])}}update(e,n,i,a){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!i)return;let l;if(this.updateCacheSize(e,n),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(f=>new _n(f.canonical.z,f.wrap,f.canonical.z,f.canonical.x,f.canonical.y)):(l=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(l=l.filter(f=>this._source.hasTile(f)))):l=[],l.length>0&&this.castsShadows&&a&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!Og(this._source.type)){const f=e.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!i}),p=Math.min(f,this._source.maxzoom),g=e.extendTileCoverForShadows(l,a,p);for(const _ of g)this._shadowCasterTiles[_.key]=!0,l.push(_)}const c=this._updateRetainedTiles(l);if(Og(this._source.type)&&0!==l.length){const f={},p={},g=Object.keys(c);for(const y of g){const v=c[y],w=this._tiles[y];if(!w||w.fadeEndTime&&w.fadeEndTime<=Ct.now())continue;const E=this.findLoadedParent(v,Math.max(v.overscaledZ-Bs.maxOverzooming,this._source.minzoom));E&&(this._addTile(E.tileID),f[E.tileID.key]=E.tileID),p[y]=v}const _=l[l.length-1].overscaledZ;for(const y in this._tiles){const v=this._tiles[y];if(c[y]||!v.hasData())continue;let w=v.tileID;for(;w.overscaledZ>_;){w=w.scaledTo(w.overscaledZ-1);const E=this._tiles[w.key];if(E&&E.hasData()&&p[w.key]){c[y]=v.tileID;break}}}for(const y in f)c[y]||(this._coveredTiles[y]=!0,c[y]=f[y])}for(const f in c)this._tiles[f].clearFadeHold();const h=function(f,p){const g=[];for(const _ in f)_ in p||g.push(_);return g}(this._tiles,c);for(const f of h){const p=this._tiles[f];p.hasSymbolBuckets&&!p.holdingForFade()?p.setHoldDuration(this.map._fadeDuration):p.hasSymbolBuckets&&!p.symbolFadeFinished()||this._removeTile(+f)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const n={};if(0===e.length)return n;const i={},a=e.reduce((p,g)=>Math.min(p,g.overscaledZ),1/0),l=e[0].overscaledZ,c=Math.max(l-Bs.maxOverzooming,this._source.minzoom),h=Math.max(l+Bs.maxUnderzooming,this._source.minzoom),f={};for(const p of e){const g=this._addTile(p);n[p.key]=p,g.hasData()||a<this._source.maxzoom&&(f[p.key]=p)}this._retainLoadedChildren(f,a,h,n);for(const p of e){let g=this._tiles[p.key];if(g.hasData())continue;if(p.canonical.z>=this._source.maxzoom){const y=p.children(this._source.maxzoom)[0],v=this.getTile(y);if(v&&v.hasData()){n[y.key]=y;continue}}else{const y=p.children(this._source.maxzoom);if(n[y[0].key]&&n[y[1].key]&&n[y[2].key]&&n[y[3].key])continue}let _=g.wasRequested();for(let y=p.overscaledZ-1;y>=c;--y){const v=p.scaledTo(y);if(i[v.key]||(i[v.key]=!0,g=this.getTile(v),!g&&_&&(g=this._addTile(v)),g&&(n[v.key]=v,_=g.wasRequested(),g.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let i,a=this._tiles[e].tileID;for(;a.overscaledZ>0;){if(a.key in this._loadedParentTiles){i=this._loadedParentTiles[a.key];break}n.push(a.key);const l=a.scaledTo(a.overscaledZ-1);if(i=this._getLoadedTile(l),i)break;a=l}for(const l of n)this._loadedParentTiles[l]=i}}_addTile(e){let n=this._tiles[e.key];if(n)return!0!==n.isExtraShadowCaster||!!this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const i=Boolean(n);if(!i){const a=this.map?this.map.painter:null;n=new qo(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,a,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,i||this._source.fire(new Se("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const i=n.getExpiryTimeout();i&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},i))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&"reloading"!==n.state?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,i){const a=[],l=this.transform;if(!l)return a;const c="globe"===l.projection.name,h=Si(l.center.lng);for(const f in this._tiles){const p=this._tiles[f];if(i&&p.clearQueryDebugViz(),p.holdingForFade())continue;let g;if(c){const _=p.tileID.canonical;if(0===_.z){const y=[Math.abs(et(h,...id(_,-1))-h),Math.abs(et(h,...id(_,1))-h)];g=[0,2*y.indexOf(Math.min(...y))-1]}else{const y=[Math.abs(et(h,...id(_,-1))-h),Math.abs(et(h,...id(_,0))-h),Math.abs(et(h,...id(_,1))-h)];g=[y.indexOf(Math.min(...y))-1]}}else g=[0];for(const _ of g){const y=e.containsTile(p,l,n,_);y&&a.push(y)}}return a}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,n){const i=this.getRenderableIds(e,n).map(a=>this._tiles[a].tileID);for(const a of i)a.projMatrix=this.transform.calculateProjMatrix(a.toUnwrapped());return i}sortCoordinatesByDistance(e){const n=e.slice(),i=this.transform._camera.position,a=this.transform._camera.forward(),l={};for(const c of n){const h=1/(1<<c.canonical.z);l[c.key]=((c.canonical.x+.5)*h+c.wrap-i[0])*a[0]+((c.canonical.y+.5)*h-i[1])*a[1]-i[2]*a[2]}return n.sort((c,h)=>l[c.key]-l[h.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(Og(this._source.type))for(const e in this._tiles){const n=this._tiles[e];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=Ct.now())return!0}return!1}setFeatureState(e,n,i){this._state.updateState(e=e||"_geojsonTileLayer",n,i)}removeFeatureState(e,n,i){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,i)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,i){const a=this._tiles[e];a&&a.setDependencies(n,i)}reloadTilesForDependencies(e,n){for(const i in this._tiles)this._tiles[i].hasDependency(e,n)&&this._reloadTile(+i,"reloading");this._cache.filter(i=>!i.hasDependency(e,n))}_preloadTiles(e,n){if(!this._sourceLoaded){const h=()=>{this._sourceLoaded&&(this._source.off("data",h),this._preloadTiles(e,n))};return void this._source.on("data",h)}const i=new Map,a=Array.isArray(e)?e:[e],l=this.map.painter.terrain,c=this.usedForTerrain&&l?l.getScaledDemTileSize():this._source.tileSize;for(const h of a){const f=h.coveringTiles({tileSize:c,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const p of f)i.set(p.key,p);this.usedForTerrain&&h.updateElevation(!1)}gl(Array.from(i.values()),(h,f)=>{const p=new qo(h,this._source.tileSize*h.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(p,g=>{"raster-dem"===this._source.type&&p.dem&&this._backfillDEM(p),f(g,p)})},n)}}function n0(t,e){const n=Math.abs(2*t.wrap)-+(t.wrap<0),i=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||i-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Og(t){return"raster"===t||"image"===t||"video"===t||"custom"===t}function id(t,e){const n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}Bs.maxOverzooming=10,Bs.maxUnderzooming=3;const cE=wn([{name:"a_pos_3f",components:3,type:"Float32"}]),uE=wn([{name:"a_color_3f",components:3,type:"Float32"}]),hE=wn([{name:"a_color_4f",components:4,type:"Float32"}]),ku=wn([{name:"a_uv_2f",components:2,type:"Float32"}]),zM=wn([{name:"a_normal_3f",components:3,type:"Float32"}]),BM=wn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),od=wn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class dE{constructor(e=0,n=0,i=0,a=0){if(isNaN(e)||e<0||isNaN(n)||n<0||isNaN(i)||i<0||isNaN(a)||a<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=i,this.right=a}interpolate(e,n,i){return null!=n.top&&null!=e.top&&(this.top=wt(e.top,n.top,i)),null!=n.bottom&&null!=e.bottom&&(this.bottom=wt(e.bottom,n.bottom,i)),null!=n.left&&null!=e.left&&(this.left=wt(e.left,n.left,i)),null!=n.right&&null!=e.right&&(this.right=wt(e.right,n.right,i)),this}getCenter(e,n){const i=et((this.left+e-this.right)/2,0,e),a=et((this.top+n-this.bottom)/2,0,n);return new ie(i,a)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new dE(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function vo(t,e){const n=Zn(t,3);se.fromQuat(t,e),tr(t,3,n)}function fE(t,e){const n=Mi.identity([]);return Mi.rotateZ(n,n,-e),Mi.rotateX(n,n,-t),n}function r0(t,e){const n=[t[0],t[1],0],i=[e[0],e[1],0];if(Z.length(n)>=1e-15){const c=Z.normalize([],n);Z.scale(i,c,Z.dot(i,c)),e[0]=i[0],e[1]=i[1]}const a=Z.cross([],e,t);if(Z.len(a)<1e-15)return null;const l=Math.atan2(-a[1],a[0]);return fE(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),l)}class o0{constructor(e,n){this.position=e,this.orientation=n}get position(){return this._position}set position(e){if(e){const n=e instanceof nn?e:new nn(e[0],e[1],e[2]);this._renderWorldCopies&&(n.x=ts(n.x,0,1)),this._position=n}else this._position=null}lookAtPoint(e,n){if(this.orientation=null,!this.position)return;const i=this.position,a=this._elevation?this._elevation.getAtPointOrZero(nn.fromLngLat(e)):0,l=nn.fromLngLat(e,a),c=[l.x-i.x,l.y-i.y,l.z-i.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=r0(c,n)}setPitchBearing(e,n){this.orientation=fE(At(e),At(-n))}}class s0{constructor(e,n){this._transform=se.identity([]),this.orientation=n,this.position=e}get mercatorPosition(){const e=this.position;return new nn(e[0],e[1],e[2])}get position(){const e=Zn(this._transform,3);return[e[0],e[1],e[2]]}set position(e){var n;e&&tr(this._transform,3,[(n=e)[0],n[1],n[2],1])}get orientation(){return this._orientation}set orientation(e){this._orientation=e||Mi.identity([]),e&&vo(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),n=this.right();return{bearing:Math.atan2(-n[1],n[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,n){this._orientation=fE(e,n),vo(this._transform,this._orientation)}forward(){const e=Zn(this._transform,2);return[-e[0],-e[1],-e[2]]}up(){const e=Zn(this._transform,1);return[-e[0],-e[1],-e[2]]}right(){const e=Zn(this._transform,0);return[e[0],e[1],e[2]]}getCameraToWorld(e,n){const i=new Float64Array(16);return se.invert(i,this.getWorldToCamera(e,n)),i}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(e,n,i){const a=this.position;Z.scale(a,a,-e);const l=new Float64Array(16);return se.fromScaling(l,[i,i,i]),se.translate(l,l,a),l[10]*=n,l}getWorldToCamera(e,n){const i=new Float64Array(16),a=new Float64Array(4),l=this.position;return Mi.conjugate(a,this._orientation),Z.scale(l,l,-e),se.fromQuat(i,a),se.translate(i,i,l),i[1]*=-1,i[5]*=-1,i[9]*=-1,i[13]*=-1,i[8]*=n,i[9]*=n,i[10]*=n,i[11]*=n,i}getCameraToClipPerspective(e,n,i,a){const l=new Float64Array(16);return se.perspective(l,e,n,i,a),l}getCameraToClipOrthographic(e,n,i,a,l,c){const h=new Float64Array(16);return se.ortho(h,e,n,i,a,l,c),h}getDistanceToElevation(e,n=!1){const i=0===e?0:kn(e,n?Gr(this.position[1]):this.position[1]),a=this.forward();return(i-this.position[2])/a[2]}clone(){return new s0([...this.position],[...this.orientation])}}function dt(t,e){const n=np(t.projection,t.zoom,t.width,t.height),i=function(l,c,h,f,p){const g=new bt(h.lng-180*Oc,h.lat),_=new bt(h.lng+180*Oc,h.lat),y=l.project(g.lng,g.lat),v=l.project(_.lng,_.lat),w=-Math.atan2(v.y-y.y,v.x-y.x),E=nn.fromLngLat(h);E.y=et(E.y,-1+Oc,1-Oc);const T=E.toLngLat(),C=l.project(T.lng,T.lat),S=nn.fromLngLat(T);S.x+=Oc;const I=S.toLngLat(),R=l.project(I.lng,I.lat),A=mE(R.x-C.x,R.y-C.y,w),k=nn.fromLngLat(T);k.y+=Oc;const L=k.toLngLat(),B=l.project(L.lng,L.lat),j=mE(B.x-C.x,B.y-C.y,w),U=Math.abs(A.x)/Math.abs(j.y),G=se.identity([]);se.rotateZ(G,G,-w*(1-(p?0:f)));const $=se.identity([]);return se.scale($,$,[1,1-(1-U)*f,1]),$[4]=-j.x/j.y*f,se.rotateZ($,$,w),se.multiply($,G,$),$}(t.projection,0,t.center,n,e),a=pE(t);return se.scale(i,i,[a,a,1]),i}function pE(t){const e=t.projection,n=np(t.projection,t.zoom,t.width,t.height),i=Ou(e,t.center),a=Ou(e,bt.convert(e.center));return Math.pow(2,i*n+(1-n)*a)}function np(t,e,n,i,a=1/0){const l=t.range;if(!l)return 0;const c=Math.min(a,Math.max(n,i)),h=Math.log(c/1024)/Math.LN2;return Cs(l[0]+h,l[1]+h,e)}const Oc=1/4e4;function Ou(t,e){const n=et(e.lat,-Mr,Mr),i=new bt(e.lng-180*Oc,n),a=new bt(e.lng+180*Oc,n),l=t.project(i.lng,n),c=t.project(a.lng,n),h=nn.fromLngLat(i),f=nn.fromLngLat(a),p=c.x-l.x,g=c.y-l.y,_=f.x-h.x,y=f.y-h.y,v=Math.sqrt((_*_+y*y)/(p*p+g*g));return Math.log(v)/Math.LN2}function mE(t,e,n){const i=Math.cos(n),a=Math.sin(n);return{x:t*i-e*a,y:t*a+e*i}}function rl(t,e,n){return e*(he/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}const Zl_unknown=0,Zl_flipRequired=1,Zl_flipNotRequired=2,oi=Math.tan(85*Math.PI/180);function a0(t,e,n,i,a,l,c){const h=se.create();if(n)if("globe"===l.name){const f=function(p,g){const{x:_,y}=p.point,v=kw(_,y,p.worldSize/p._pixelsPerMercatorPixel,0,0);return se.multiply(v,v,Yy(ps(g)))}(a,e);se.multiply(h,h,f)}else{const f=Rh.invert([],c);h[0]=f[0],h[1]=f[1],h[4]=f[2],h[5]=f[3],i||se.rotateZ(h,h,a.angle)}else se.multiply(h,a.labelPlaneMatrix,t);return h}function l0(t,e,n,i,a,l,c){const h=a0(t,e,n,i,a,l,c);return"globe"===l.name&&n||(h[2]=h[6]=h[10]=h[14]=0),h}function c0(t,e,n,i,a,l,c){if(n){if("globe"===l.name){const h=a0(t,e,n,i,a,l,c);return se.invert(h,h),se.multiply(h,t,h),h}{const h=se.clone(t),f=se.identity([]);return f[0]=c[0],f[1]=c[1],f[4]=c[2],f[5]=c[3],se.multiply(h,h,f),i||se.rotateZ(h,h,-a.angle),h}}return a.glCoordMatrix}function xa(t,e,n,i){const a=[t,e,n,1];n?bn.transformMat4(a,a,i):wE(a,a,i);const l=a[3];return a[0]/=l,a[1]/=l,a[2]/=l,a}function u0(t,e){return Math.min(.5+t/e*.5,1.5)}function gE(t,e){const n=t[0]/t[3],i=t[1]/t[3];return n>=-e[0]&&n<=e[0]&&i>=-e[1]&&i<=e[1]}function _E(t,e,n,i,a,l,c,h,f,p){const g=n.transform,_=i?t.textSizeData:t.iconSizeData,y=pa(_,n.transform.zoom),v="globe"===g.projection.name,w=[256/n.width*2+1,256/n.height*2+1],E=i?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;E.clear();let T=null;v&&(T=i?t.text.globeExtVertexArray:t.icon.globeExtVertexArray);const C=t.lineVertexArray,S=i?t.text.placedSymbolArray:t.icon.placedSymbolArray,I=n.transform.width/n.transform.height;let R,A=!1;for(let k=0;k<S.length;k++){const L=S.get(k),{numGlyphs:B,writingMode:j}=L;if(j!==or.vertical||A||R===or.horizontal||(A=!0),R=j,(L.hidden||j===or.vertical)&&!A){ad(B,E);continue}A=!1;const U=new ie(L.tileAnchorX,L.tileAnchorY);let{x:G,y:$,z:W}=g.projection.projectTilePoint(U.x,U.y,p.canonical);if(f){const[ge,ve,de]=f(U);G+=ge,$+=ve,W+=de}const H=[G,$,W,1];if(bn.transformMat4(H,H,e),!gE(H,w)){ad(B,E);continue}const J=H[3],te=u0(n.transform.getCameraToCenterDistance(g.projection),J),oe=fg(_,y,L),K=c?oe/te:oe*te,Q=xa(G,$,W,a);if(Q[3]<=0){ad(B,E);continue}let ae={};const ue=c?null:f,fe=vE(L,K,!1,h,e,a,l,t.glyphOffsetArray,C,E,T,Q,U,ae,I,ue,g.projection,p,c);A=fe.useVertical,ue&&fe.needsFlipping&&(ae={}),(fe.notEnoughRoom||A||fe.needsFlipping&&vE(L,K,!0,h,e,a,l,t.glyphOffsetArray,C,E,T,Q,U,ae,I,ue,g.projection,p,c).notEnoughRoom)&&ad(B,E)}i?(t.text.dynamicLayoutVertexBuffer.updateData(E),T&&t.text.globeExtVertexBuffer&&t.text.globeExtVertexBuffer.updateData(T)):(t.icon.dynamicLayoutVertexBuffer.updateData(E),T&&t.icon.globeExtVertexBuffer&&t.icon.globeExtVertexBuffer.updateData(T))}function h0(t,e,n,i,a,l,c,h,f,p,g,_,y,v,w,E){const{lineStartIndex:T,glyphStartIndex:C,segment:S}=h,I=C+h.numGlyphs,R=T+h.lineLength,A=e.getoffsetX(C),k=e.getoffsetX(I-1),L=Lg(t*A,n,i,a,l,c,S,T,R,f,p,g,_,y,!0,v,w,E);if(!L)return null;const B=Lg(t*k,n,i,a,l,c,S,T,R,f,p,g,_,y,!0,v,w,E);return B?{first:L,last:B}:null}function yE(t,e,n,i){return t===or.horizontal&&Math.abs(i)>Math.abs(n)?{useVertical:!0}:t===or.vertical?i>0?{needsFlipping:!0}:null:e!==Zl_unknown&&(0===(a=n)||Math.abs(i/a)>oi)?e===Zl_flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null;var a}function vE(t,e,n,i,a,l,c,h,f,p,g,_,y,v,w,E,T,C,S){const I=e/24,R=t.lineOffsetX*I,A=t.lineOffsetY*I,{lineStartIndex:k,glyphStartIndex:L,numGlyphs:B,segment:j,writingMode:U,flipState:G}=t,$=k+t.lineLength,W=H=>{if(g){const[K,Q,ae]=H.up,ue=p.length;Zv(g,ue+0,K,Q,ae),Zv(g,ue+1,K,Q,ae),Zv(g,ue+2,K,Q,ae),Zv(g,ue+3,K,Q,ae)}const[J,te,oe]=H.point;td(p,J,te,oe,H.angle)};if(B>1){const H=h0(I,h,R,A,n,_,y,t,f,l,v,E,!1,T,C,S);if(!H)return{notEnoughRoom:!0};if(i&&!n){let[J,te,oe]=H.first.point,[K,Q,ae]=H.last.point;[J,te]=xa(J,te,oe,c),[K,Q]=xa(K,Q,ae,c);const ue=yE(U,G,(K-J)*w,Q-te);if(t.flipState=ue&&ue.needsFlipping?Zl_flipRequired:Zl_flipNotRequired,ue)return ue}W(H.first);for(let J=L+1;J<L+B-1;J++){const te=Lg(I*h.getoffsetX(J),R,A,n,_,y,j,k,$,f,l,v,E,!1,!1,T,C,S);if(!te)return p.length-=4*(J-L),{notEnoughRoom:!0};W(te)}W(H.last)}else{if(i&&!n){const J=xa(y.x,y.y,0,a),te=k+j+1,oe=new ie(f.getx(te),f.gety(te)),K=xa(oe.x,oe.y,0,a),Q=K[3]>0?K:sd(y,oe,J,1,a,void 0,T,C.canonical),ae=yE(U,G,(Q[0]-J[0])*w,Q[1]-J[1]);if(t.flipState=ae&&ae.needsFlipping?Zl_flipRequired:Zl_flipNotRequired,ae)return ae}const H=Lg(I*h.getoffsetX(L),R,A,n,_,y,j,k,$,f,l,v,E,!1,!1,T,C,S);if(!H)return{notEnoughRoom:!0};W(H)}return{}}function xE(t,e,n,i,a){const{x:l,y:c,z:h}=i.projectTilePoint(t.x,t.y,e);if(!a)return xa(l,c,h,n);const[f,p,g]=a(t);return xa(l+f,c+p,h+g,n)}function sd(t,e,n,i,a,l,c,h){const f=xE(t.sub(e)._unit()._add(t),h,a,c,l);return Z.sub(f,n,f),Z.normalize(f,f),Z.scaleAndAdd(f,n,f,i)}function Lg(t,e,n,i,a,l,c,h,f,p,g,_,y,v,w,E,T,C){const S=i?t-e:t+e;let I=S>0?1:-1,R=0;i&&(I*=-1,R=Math.PI),I<0&&(R+=Math.PI);let A=h+c+(I>0?0:1)|0,k=a,L=a,B=0,j=0;const U=Math.abs(S),G=[],$=[];let W=l,H=W;const J=()=>sd(H,W,L,U-B+1,g,y,E,T.canonical);for(;B+j<=U;){if(A+=I,A<h||A>=f)return null;if(L=k,H=W,G.push(L),v&&$.push(H),W=new ie(p.getx(A),p.gety(A)),k=_[A],!k){const ve=xE(W,T.canonical,g,E,y);k=ve[3]>0?_[A]=ve:J()}B+=j,j=Z.distance(L,k)}w&&y&&(_[A]&&(k=J(),j=Z.distance(L,k)),_[A]=k);const te=(U-B)/j,oe=W.sub(H)._mult(te)._add(H),K=Z.sub([],k,L),Q=Z.scaleAndAdd([],L,K,te);let ae=[0,0,1],ue=K[0],fe=K[1];if(C&&(ae=E.upVector(T.canonical,oe.x,oe.y),0!==ae[0]||0!==ae[1]||1!==ae[2])){const ve=[ae[2],0,-ae[0]],de=Z.cross([],ae,ve);Z.normalize(ve,ve),Z.normalize(de,de),ue=Z.dot(K,ve),fe=Z.dot(K,de)}if(n){const ve=Z.cross([],ae,K);Z.normalize(ve,ve),Z.scaleAndAdd(Q,Q,ve,n*I)}const ge=R+Math.atan2(fe,ue);return G.push(Q),v&&$.push(oe),{point:Q,angle:ge,path:G,tilePath:$,up:ae}}function ad(t,e){const n=e.length,i=n+4*t;e.resize(i),e.float32.fill(-1/0,4*n,4*i)}function wE(t,e,n){const i=e[0],a=e[1];return t[0]=n[0]*i+n[4]*a+n[12],t[1]=n[1]*i+n[5]*a+n[13],t[3]=n[3]*i+n[7]*a+n[15],t}const rp=(t,e,n)=>(1-n)*t+n*e,d0=t=>t*t*t*t*t;class Fg{constructor(e,n,i,a,l,c,h){this.tileSize=512,this._renderWorldCopies=void 0===l||l,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=i??0,this._maxPitch=a??60,this.setProjection(c),this.setMaxBounds(h),this.width=0,this.height=0,this._center=new bt(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new dE,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new s0,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const e=new Fg(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(e,n=!1){const i=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||i)&&this._updateCameraOnTerrain(),(e||i)&&this._constrainCamera(n),this._calcMatrices()}getProjection(){return fi(this.projection,["name","center","parallels"])}setProjection(e){this.projectionOptions=e||{name:"mercator"};const n=this.projection?this.getProjection():void 0;this.projection=ed(this.projectionOptions);const i=!ln(n,this.getProjection());return i&&this._calcMatrices(),this.mercatorFromTransition=!1,i}setOrthographicProjectionAtLowPitch(e){return this._orthographicProjectionAtLowPitch!==e&&(this._orthographicProjectionAtLowPitch=e,this._calcMatrices(),!0)}setMercatorFromTransition(){const e=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=ed({name:"mercator"});const n=e!==this.projection.name;return n&&this._calcMatrices(),n}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return kn(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new ie(this.width,this.height)}get bearing(){return ts(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(e){const n=-e*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=Rh.create(),Rh.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const n=et(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=At(e),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){const n=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._setZoom(n),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}_updateCameraOnTerrain(){const e=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,n=this.elevation&&e===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||e===Number.NEGATIVE_INFINITY&&(!n||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const i=this._elevation;n||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&i.exaggeration()&&this._centerAltitudeValidForExaggeration!==i.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*i.exaggeration(),this._centerAltitudeValidForExaggeration=i.exaggeration()):(this._centerAltitude=e||0,this._centerAltitudeValidForExaggeration=i.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const e=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],i=this.horizonLineFromTop();let a=0,l=0;for(let c=0;c<n.length;c++){const h=new ie(n[c][0]*this.width,i+n[c][1]*(this.height-i)),f=e.pointCoordinate(h);if(!f)continue;const p=1/Math.hypot(f[0]-this._camera.position[0],f[1]-this._camera.position[1]);a+=f[3]*p,l+=p}return 0===l?NaN:a/l}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const e=this._seaLevelZoom,n=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),i=this.pixelsPerMeter/this.worldSize*n,a=this._mercatorZfromZoom(e),l=this._mercatorZfromZoom(this._maxZoom),c=Math.max(a-i,l);this._setZoom(this._zoomFromMercatorZ(c))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(e){const n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,e.toAltitude()));let i;i=e.z<this._camera.position[2]?[n.x,n.y,n.z]:[e.x,e.y,e.z];const a=Z.length(Z.sub([],this._camera.position,i));return et(this._zoomFromMercatorZ(a),this._minZoom,this._maxZoom)}setFreeCameraOptions(e){if(!this.height||!e.position&&!e.orientation)return;this._updateCameraState();let n=!1;if(e.orientation&&!Mi.exactEquals(e.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(e.orientation)),e.position){const i=[e.position.x,e.position.y,e.position.z];Z.exactEquals(i,this._camera.position)||(this._setCameraPosition(i),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const e=this._camera.position,n=new o0;return n.position=new nn(e[0],e[1],e[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this.renderWorldCopies,n}_setCameraOrientation(e){if(!Mi.length(e))return!1;Mi.normalize(e,e);const n=Z.transformQuat([],[0,0,-1],e),i=Z.transformQuat([],[0,-1,0],e);if(i[2]<0)return!1;const a=r0(n,i);return!!a&&(this._camera.orientation=a,!0)}_setCameraPosition(e){const n=this.zoomScale(this.minZoom)*this.tileSize,i=this.zoomScale(this.maxZoom)*this.tileSize,a=this.cameraToCenterDistance;e[2]=et(e[2],a/i,a/n),this._camera.position=e}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,n,i){this._unmodified=!1,this._edgeInsets.interpolate(e,n,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const n=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(e){const n=[new Iw(0,e)];if(this.renderWorldCopies){const i=this.pointCoordinate(new ie(0,0)),a=this.pointCoordinate(new ie(this.width,0)),l=this.pointCoordinate(new ie(this.width,this.height)),c=this.pointCoordinate(new ie(0,this.height)),h=Math.floor(Math.min(i.x,a.x,l.x,c.x)),f=Math.floor(Math.max(i.x,a.x,l.x,c.x)),p=1;for(let g=h-p;g<=f+p;g++)0!==g&&n.push(new Iw(g,e))}return n}isLODDisabled(e){return(!e||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(e,n,i){let a=[];if(0===n[0]&&0===n[1])return a;for(const c of e){const h=c.canonical,f=c.overscaledZ,p=c.wrap,g=1<<h.z,_=h.x+1<g,y=h.x>0,v=h.y+1<g,w=h.y>0,E=c.wrap-(y?0:1),T=c.wrap+(_?0:1),C=y?h.x-1:g-1,S=_?h.x+1:0;n[0]<0?(a.push(new _n(f,T,h.z,S,h.y)),n[1]<0&&v&&(a.push(new _n(f,p,h.z,h.x,h.y+1)),a.push(new _n(f,T,h.z,S,h.y+1))),n[1]>0&&w&&(a.push(new _n(f,p,h.z,h.x,h.y-1)),a.push(new _n(f,T,h.z,S,h.y-1)))):n[0]>0?(a.push(new _n(f,E,h.z,C,h.y)),n[1]<0&&v&&(a.push(new _n(f,p,h.z,h.x,h.y+1)),a.push(new _n(f,E,h.z,C,h.y+1))),n[1]>0&&w&&(a.push(new _n(f,p,h.z,h.x,h.y-1)),a.push(new _n(f,E,h.z,C,h.y-1)))):n[1]<0&&v?a.push(new _n(f,p,h.z,h.x,h.y+1)):w&&a.push(new _n(f,p,h.z,h.x,h.y-1))}if(a.length>1){a.sort((f,p)=>f.overscaledZ-p.overscaledZ||f.wrap-p.wrap||f.canonical.z-p.canonical.z||f.canonical.x-p.canonical.x||f.canonical.y-p.canonical.y);let c=0,h=0;for(;h<a.length;)a[h].equals(a[c])?++h:a[++c]=a[h++];a.length=c+1}const l=[];for(const c of a)a.some(h=>c.isChildOf(h))||l.push(c);return a=l.filter(c=>!e.some(h=>!!(c.overscaledZ<i&&h.isChildOf(c))||c.equals(h)||c.isChildOf(h))),a}coveringTiles(e){let n=this.coveringZoomLevel(e);const i=n,a=this.elevation&&this.elevation.exaggeration(),l=a&&!e.isTerrainDEM,c="mercator"===this.projection.name;if(void 0!==e.minzoom&&n<e.minzoom)return[];void 0!==e.maxzoom&&n>e.maxzoom&&(n=e.maxzoom);const h=this.locationCoordinate(this.center),f=this.center.lat,p=1<<n,g=[p*h.x,p*h.y,0],_="globe"===this.projection.name,y=!_,v=ua.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,y),w=_?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),E=p*kn(1,this.center.lat),T=this._camera.position[2]/kn(1,this.center.lat),C=[p*w.x,p*w.y,T*(y?1:E)],S=_||a,I=this.cameraToCenterDistance/e.tileSize*(e.roundZoom?1:.502),R=this.isLODDisabled(!0)?n:0,A=e.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,k=e.isTerrainDEM?-A:this._elevation?this._elevation.getMinElevationBelowMSL():0,L=this.projection.isReprojectedInTileSpace?pE(this):1,B=K=>{const ae=new nn(K.x+25e-6,K.y,K.z),ue=new nn(K.x,K.y+25e-6,K.z),fe=K.toLngLat(),ge=ae.toLngLat(),ve=ue.toLngLat(),de=this.locationCoordinate(fe),me=this.locationCoordinate(ge),Oe=this.locationCoordinate(ve),qe=Math.hypot(me.x-de.x,me.y-de.y),Ge=Math.hypot(Oe.x-de.x,Oe.y-de.y);return Math.sqrt(qe*Ge)*L/25e-6},j=K=>{const Q=A,ae=k;return{aabb:Dg(this,p,0,0,0,K,ae,Q,this.projection),zoom:0,x:0,y:0,minZ:ae,maxZ:Q,wrap:K,fullyVisible:!1}},U=[];let G=[];const $=n,W=e.reparseOverscaled?i:n,H=K=>K*K,J=H((T-this._centerAltitude)*E),te=K=>{if(!this._elevation||!K.tileID||!c)return;const Q=this._elevation.getMinMaxForTile(K.tileID),ae=K.aabb;Q?(ae.min[2]=Q.min,ae.max[2]=Q.max,ae.center[2]=(ae.min[2]+ae.max[2])/2):(K.shouldSplit=oe(K),K.shouldSplit||(ae.min[2]=ae.max[2]=ae.center[2]=this._centerAltitude))},oe=K=>{if(K.zoom<R)return!0;if(K.zoom===$)return!1;if(null!=K.shouldSplit)return K.shouldSplit;const Q=K.aabb.distanceX(C),ae=K.aabb.distanceY(C);let ue=J,fe=1;if(_){ue=H(K.aabb.distanceZ(C));const de=Math.pow(2,K.zoom),me=Gr((K.y+1)/de),Oe=Gr(K.y/de),qe=Math.min(Math.max(f,me),Oe),Ge=Pf(qe)/Pf(f);if(fe=qe===f?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Ge/this._mercatorScaleRatio),this.zoom<=5&&K.zoom===$-1&&Ge>=.9)return!0}else if(l&&(ue=H(K.aabb.distanceZ(C)*E)),this.projection.isReprojectedInTileSpace&&i<=5){const de=Math.pow(2,K.zoom),me=B(new nn((K.x+.5)/de,(K.y+.5)/de));fe=me>.85?1:me}const ge=Q*Q+ae*ae+ue;return ge<H((1<<$-K.zoom)*I*fe*((de,me)=>{if(me*H(.707)<de)return 1;const Oe=Math.sqrt(me/de);return Oe/(1.4144271570014144+(Math.pow(1.1,Oe-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ue,J),ge))};if(this.renderWorldCopies)for(let K=1;K<=3;K++)U.push(j(-K)),U.push(j(K));for(U.push(j(0));U.length>0;){const K=U.pop(),Q=K.x,ae=K.y;let ue=K.fullyVisible;const fe=()=>"globe"===this.projection.name&&(0===K.y||K.y===(1<<K.zoom)-1);if(!ue){let ge=S?K.aabb.intersects(v):K.aabb.intersectsFlat(v);if(0===ge&&fe()){const ve=new Ls(K.zoom,Q,ae);ge=qy(this,p,ve,!0).intersects(v)}if(0===ge)continue;ue=2===ge}if(K.zoom!==$&&oe(K))for(let ge=0;ge<4;ge++){const ve=(Q<<1)+ge%2,de=(ae<<1)+(ge>>1),me={aabb:c?K.aabb.quadrant(ge):Dg(this,p,K.zoom+1,ve,de,K.wrap,K.minZ,K.maxZ,this.projection),zoom:K.zoom+1,x:ve,y:de,wrap:K.wrap,fullyVisible:ue,tileID:void 0,shouldSplit:void 0,minZ:K.minZ,maxZ:K.maxZ};l&&!_&&(me.tileID=new _n(K.zoom+1===$?W:K.zoom+1,K.wrap,K.zoom+1,ve,de),te(me)),U.push(me)}else{const ge=K.zoom===$?W:K.zoom;if(e.minzoom&&e.minzoom>ge)continue;if(!ue){let Oe=S?K.aabb.intersectsPrecise(v):K.aabb.intersectsPreciseFlat(v);if(0===Oe&&fe()){const qe=new Ls(K.zoom,Q,ae);Oe=qy(this,p,qe,!0).intersectsPrecise(v)}if(0===Oe)continue}const ve=g[0]-(.5+Q+(K.wrap<<K.zoom))*(1<<n-K.zoom),de=g[1]-.5-ae,me=K.tileID?K.tileID:new _n(ge,K.wrap,K.zoom,Q,ae);G.push({tileID:me,distanceSq:ve*ve+de*de})}}if(this.fogCullDistSq){const K=this.fogCullDistSq,Q=this.horizonLineFromTop();G=G.filter(ae=>{const ue=[0,0,0,1],fe=[he,he,0,1],ge=this.calculateFogTileMatrix(ae.tileID.toUnwrapped());bn.transformMat4(ue,ue,ge),bn.transformMat4(fe,fe,ge);const ve=function(Oe,qe,Ge){let We=0;for(let it=0;it<2;++it)Oe[it]>0&&(We+=(Oe[it]-0)*(Oe[it]-0)),qe[it]<0&&(We+=(0-qe[it])*(0-qe[it]));return We}(bn.min([],ue,fe),bn.max([],ue,fe));if(0===ve)return!0;let de=!1;const me=this._elevation;if(me&&ve>K&&0!==Q){const Oe=this.calculateProjMatrix(ae.tileID.toUnwrapped());let qe;e.isTerrainDEM||(qe=me.getMinMaxForTile(ae.tileID)),qe||(qe={min:k,max:A});const Ge=function(it){const gt=Math.round((it+45+360)%360/90)%4;return Od[gt]}(this.rotation),We=[Ge[0]*he,Ge[1]*he,qe.max];Z.transformMat4(We,We,Oe),de=(1-We[1])*this.height*.5<Q}return ve<K||de})}return G.sort((K,Q)=>K.distanceSq-Q.distanceSq).map(K=>K.tileID)}resize(e,n){this.width=e,this.height=n,this.pixelsToGLUnits=[2/e,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const n=et(e.lat,-Mr,Mr),i=this.projection.project(e.lng,n);return new ie(i.x*this.worldSize,i.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/kn(1,this.center.lat)/this.worldSize}setLocationAtPoint(e,n){let i,a;const l=this.centerPoint;if("globe"===this.projection.name){const h=this.worldSize;i=(n.x-l.x)/h,a=(n.y-l.y)/h}else{const h=this.pointCoordinate(n),f=this.pointCoordinate(l);i=h.x-f.x,a=h.y-f.y}const c=this.locationCoordinate(e);this.setLocation(new nn(c.x-i,c.y-a))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e){return this.projection.locationPoint(this,e)}locationPoint3D(e){return this.projection.locationPoint(this,e,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(e,n){const i=n?kn(n,e.lat):void 0,a=this.projection.project(e.lng,e.lat);return new nn(a.x,a.y,i)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(e,n){const i=n??this._centerAltitude,a=[e.x,e.y,0,1],l=[e.x,e.y,1,1];bn.transformMat4(a,a,this.pixelMatrixInverse),bn.transformMat4(l,l,this.pixelMatrixInverse);const c=l[3];bn.scale(a,a,1/a[3]),bn.scale(l,l,1/c);const h=a[2],f=l[2];return{p0:a,p1:l,t:h===f?0:(i-h)/(f-h)}}screenPointToMercatorRay(e){const n=[e.x,e.y,0,1],i=[e.x,e.y,1,1];return bn.transformMat4(n,n,this.pixelMatrixInverse),bn.transformMat4(i,i,this.pixelMatrixInverse),bn.scale(n,n,1/n[3]),bn.scale(i,i,1/i[3]),n[2]=kn(n[2],this._center.lat)*this.worldSize,i[2]=kn(i[2],this._center.lat)*this.worldSize,bn.scale(n,n,1/this.worldSize),bn.scale(i,i,1/this.worldSize),new Mf([n[0],n[1],n[2]],Z.normalize([],Z.sub([],i,n)))}rayIntersectionCoordinate(e){const{p0:n,p1:i,t:a}=e,l=kn(n[2],this._center.lat),c=kn(i[2],this._center.lat);return new nn(wt(n[0],i[0],a)/this.worldSize,wt(n[1],i[1],a)/this.worldSize,wt(l,c,a))}pointCoordinate(e,n=this._centerAltitude){return this.projection.pointCoordinate(this,e.x,e.y,n)}pointCoordinate3D(e){if(!this.elevation)return this.pointCoordinate(e);let n=this.projection.pointCoordinate3D(this,e.x,e.y);if(n)return new nn(n[0],n[1],n[2]);let i=0,a=this.horizonLineFromTop();if(e.y>a)return this.pointCoordinate(e);const l=.02*a,c=e.clone();for(let h=0;h<10&&a-i>l;h++){c.y=wt(i,a,.66);const f=this.projection.pointCoordinate3D(this,c.x,c.y);f?(a=c.y,n=f):i=c.y}return n?new nn(n[0],n[1],n[2]):this.pointCoordinate(e)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}isPointOnSurface(e){if(e.y<0||e.y>this.height||e.x<0||e.x>this.width)return!1;if(this.elevation||this.zoom>=6)return!this.isPointAboveHorizon(e);const n=this.pointCoordinate(e);return n.y>=0&&n.y<=1}_coordinatePoint(e,n){const i=n&&this.elevation?this.elevation.getAtPointOrZero(e,this._centerAltitude):this._centerAltitude,a=[e.x*this.worldSize,e.y*this.worldSize,i+e.toAltitude(),1];return bn.transformMat4(a,a,this.pixelMatrix),a[3]>0?new ie(a[0]/a[3],a[1]/a[3]):new ie(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:e,left:n}=this._edgeInsets,i=this.height-this._edgeInsets.bottom,a=this.width-this._edgeInsets.right,l=this.pointLocation3D(new ie(n,e)),c=this.pointLocation3D(new ie(a,e)),h=this.pointLocation3D(new ie(a,i)),f=this.pointLocation3D(new ie(n,i));let p=Math.min(l.lng,c.lng,h.lng,f.lng),g=Math.max(l.lng,c.lng,h.lng,f.lng),_=Math.min(l.lat,c.lat,h.lat,f.lat),y=Math.max(l.lat,c.lat,h.lat,f.lat);const v=Math.pow(2,-this.zoom)/16*270,w="globe"===this.projection.name?1:4,E=(T,C,S,I,R)=>{const A=(T+S)/2,k=(C+I)/2,L=new ie(A,k),{lng:B,lat:j}=this.pointLocation3D(L),U=Math.max(0,p-B,_-j,B-g,j-y);p=Math.min(p,B),g=Math.max(g,B),_=Math.min(_,j),y=Math.max(y,j),(R<w||U>v)&&(E(T,C,A,k,R+1),E(A,k,S,I,R+1))};if(E(n,e,a,e,1),E(a,e,a,i,1),E(a,i,n,i,1),E(n,i,n,e,1),"globe"===this.projection.name){const[T,C]=function(S){const I=se.identity(new Float64Array(16));se.multiply(I,S.pixelMatrix,S.globeMatrix);const R=[0,Qi,0],A=[0,Ns,0];return Z.transformMat4(R,R,I),Z.transformMat4(A,A,I),[R[0]>0&&R[0]<=S.width&&R[1]>0&&R[1]<=S.height&&!Km(S,new bt(S.center.lat,90)),A[0]>0&&A[0]<=S.width&&A[1]>0&&A[1]<=S.height&&!Km(S,new bt(S.center.lat,-90))]}(this);T?(y=90,g=180,p=-180):C&&(_=-90,g=180,p=-180)}return new Ji(new bt(p,_),new bt(g,y))}_getBoundsRectangular(e,n){const{top:i,left:a}=this._edgeInsets,l=this.height-this._edgeInsets.bottom,c=this.width-this._edgeInsets.right,h=new ie(a,i),f=new ie(c,i),p=new ie(c,l),g=new ie(a,l);let _=this.pointCoordinate(h,e),y=this.pointCoordinate(f,e);const v=this.pointCoordinate(p,n),w=this.pointCoordinate(g,n),E=(T,C)=>(C.y-T.y)/(C.x-T.x);return _.y>1&&y.y>=0?_=new nn((1-w.y)/E(w,_)+w.x,1):_.y<0&&y.y<=1&&(_=new nn(-w.y/E(w,_)+w.x,0)),y.y>1&&_.y>=0?y=new nn((1-v.y)/E(v,y)+v.x,1):y.y<0&&_.y<=1&&(y=new nn(-v.y/E(v,y)+v.x,0)),(new Ji).extend(this.coordinateLocation(_)).extend(this.coordinateLocation(y)).extend(this.coordinateLocation(w)).extend(this.coordinateLocation(v))}_getBoundsRectangularTerrain(){const e=this.elevation;if(!e.visibleDemTiles.length||e.isUsingMockSource())return this._getBoundsRectangular(0,0);const n=e.visibleDemTiles.reduce((i,a)=>{if(a.dem){const l=a.dem.tree;i.min=Math.min(i.min,l.minimums[0]),i.max=Math.max(i.max,l.maximums[0])}return i},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(n.min*e.exaggeration(),n.max*e.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(e=!0){const n=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,i=this.height/2-n*(1-this._horizonShift);return e?Math.max(0,i):i}getMaxBounds(){return this.maxBounds}setMaxBounds(e){this.maxBounds=e,this.minLat=-Mr,this.maxLat=Mr,this.minLng=-180,this.maxLng=180,e&&(this.minLat=e.getSouth(),this.maxLat=e.getNorth(),this.minLng=e.getWest(),this.maxLng=e.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=Si(this.minLng)*this.tileSize,this.worldMaxX=Si(this.maxLng)*this.tileSize,this.worldMinY=gi(this.maxLat)*this.tileSize,this.worldMaxY=gi(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,n){return this.projection.createTileMatrix(this,n,e)}calculateDistanceTileData(e){const n=e.key,i=this._distanceTileDataCache;if(i[n])return i[n];const a=e.canonical,l=1/this.height,c=this.cameraWorldSize,h=c/this.zoomScale(a.z),f=(a.x+Math.pow(2,a.z)*e.wrap)*h,p=a.y*h,g=this.point;g.x*=c/this.worldSize,g.y*=c/this.worldSize;const _=this.angle,y=Math.sin(-_),v=-Math.cos(-_);return i[n]={bearing:[y,v],center:[(g.x-f)*l,(g.y-p)*l],scale:h/he*l},i[n]}calculateFogTileMatrix(e){const n=e.key,i=this._fogTileMatrixCache;if(i[n])return i[n];const a=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,e);return se.multiply(a,this.worldToFogMatrix,a),i[n]=new Float32Array(a),i[n]}calculateProjMatrix(e,n=!1){const i=e.key,a=n?this._alignedProjMatrixCache:this._projMatrixCache;if(a[i])return a[i];const l=this.calculatePosMatrix(e,this.worldSize);return se.multiply(l,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:n?this.alignedProjMatrix:this.projMatrix,l),a[i]=new Float32Array(l),a[i]}calculatePixelsToTileUnitsMatrix(e){const n=e.tileID.key,i=this._pixelsToTileUnitsCache;if(i[n])return i[n];const a=function(l,c){const{scale:h}=l.tileTransform,f=h*he/(l.tileSize*Math.pow(2,c.zoom-l.tileID.overscaledZ+l.tileID.canonical.z));return Rh.scale(new Float32Array(4),c.inverseAdjustmentMatrix,[f,f])}(e,this);return i[n]=a,i[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const e=1/this.worldSize,n=se.fromScaling([],[e,e,e]);return se.multiply(n,n,this.globeMatrix),n}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const e=this._elevation;this._updateCameraState();const n=kn(1,this._center.lat)*this.worldSize,i=this._computeCameraPosition(n),a=this._camera.forward(),l=kn(1,this._center.lat);i[2]/=l,a[2]/=l,Z.normalize(a,a);const c=e.raycast(i,a,e.exaggeration());if(c){const h=Z.scaleAndAdd([],i,a,c),f=new nn(h[0],h[1],kn(h[2],Gr(h[1]))),p=(f.z+Z.length([f.x-i[0],f.y-i[1],f.z-i[2]*l]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(p),this._centerAltitude=f.toAltitude(),this._center=this.coordinateLocation(f),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(e=!1){if(!this._elevation)return;const n=this._elevation,i=kn(1,this._center.lat)*this.worldSize,a=this._computeCameraPosition(i),l=n.getAtPointOrZero(new nn(...a)),c=this.pixelsPerMeter/this.worldSize*l,h=this._minimumHeightOverTerrain(),f=a[2]-c;if(f<=h)if(f<0||e){const p=this.locationCoordinate(this._center,this._centerAltitude),g=[a[0],a[1],p.z-a[2]],_=Z.length(g);g[2]-=(h-f)/this._pixelsPerMercatorPixel;const y=Z.length(g);if(0===y)return;Z.scale(g,g,_/y*this._pixelsPerMercatorPixel),this._camera.position=[a[0],a[1],p.z*this._pixelsPerMercatorPixel-g[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||e){const y=this.center;return y.lat=et(y.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!e)&&(y.lng=et(y.lng,this.minLng,this.maxLng)),this.center=y,void(this._constraining=!1)}const n=this._unmodified,{x:i,y:a}=this.point;let l=0,c=i,h=a;const f=this.width/2,p=this.height/2,g=this.worldMinY*this.scale,_=this.worldMaxY*this.scale;if(a-p<g&&(h=g+p),a+p>_&&(h=_-p),_-g<this.height&&(l=Math.max(l,this.height/(_-g)),h=(_+g)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const y=this.worldMinX*this.scale,v=this.worldMaxX*this.scale,w=this.worldSize/2-(y+v)/2;c=(i+w+this.worldSize)%this.worldSize-w,c-f<y&&(c=y+f),c+f>v&&(c=v-f),v-y<this.width&&(l=Math.max(l,this.width/(v-y)),c=(v+y)/2)}c===i&&h===a||(this.center=this.unproject(new ie(c,h))),l&&(this.zoom+=this.scaleZoom(l)),this._constrainCamera(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,n="globe"===this.projection.name,i=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=kn(1,this.center.lat)/kn(1,45));const a=np(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,a),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const l="meters"===this.projection.zAxisUnit?i:1,c=this._camera.getWorldToCamera(this.worldSize,l);let h;const f=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(f[8]=2*-e.x/this.width,f[9]=2*e.y/this.height,this.isOrthographic){let j=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),U=j*this.aspect,G=-U,$=-j;U-=e.x,G-=e.x,j+=e.y,$+=e.y,h=this._camera.getCameraToClipOrthographic(G,U,$,j,this._nearZ,this._farZ),((W,H,J,te)=>{for(let oe=0;oe<16;oe++)W[oe]=rp(H[oe],J[oe],te)})(h,h,f,d0(this.pitch>=15?1:this.pitch/15))}else h=f;const p=se.mul([],f,c);let g=se.mul([],h,c);if(this.projection.isReprojectedInTileSpace){const j=this.locationCoordinate(this.center),U=se.identity([]);se.translate(U,U,[j.x*this.worldSize,j.y*this.worldSize,0]),se.multiply(U,U,dt(this)),se.translate(U,U,[-j.x*this.worldSize,-j.y*this.worldSize,0]),se.multiply(g,g,U),se.multiply(p,p,U),this.inverseAdjustmentMatrix=function(G){const $=dt(G,!0);return Rh.invert([],[$[0],$[1],$[4],$[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=se.scale([],g,[this.worldSize,this.worldSize,this.worldSize/l,1]),this.projMatrix=g,this.invProjMatrix=se.invert(new Float64Array(16),this.projMatrix);const _=se.invert([],h);this.frustumCorners=Rl.fromInvProjectionMatrix(_,this.horizonLineFromTop(),this.height),this.cameraFrustum=ua.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!n);const y=new Float32Array(16);se.identity(y),se.scale(y,y,[1,-1,1]),se.rotateX(y,y,this._pitch),se.rotateZ(y,y,this.angle);const v=se.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=se.clone(v);const w=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;v[8]=2*-e.x/this.width,v[9]=2*(e.y+w)/this.height,this.skyboxMatrix=se.multiply(y,v,y);const E=this.point,T=E.x,C=E.y,S=this.width%2/2,I=this.height%2/2,R=Math.cos(this.angle),A=Math.sin(this.angle),k=T-Math.round(T)+R*S+A*I,L=C-Math.round(C)+R*I+A*S,B=new Float64Array(g);if(se.translate(B,B,[k>.5?k-1:k,L>.5?L-1:L,0]),this.alignedProjMatrix=B,g=se.create(),se.scale(g,g,[this.width/2,-this.height/2,1]),se.translate(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=se.create(),se.scale(g,g,[1,-1,1]),se.translate(g,g,[-1,-1,0]),se.scale(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g,this.pixelMatrix=se.multiply(new Float64Array(16),this.labelPlaneMatrix,p),this._calcFogMatrices(),this._distanceTileDataCache={},g=se.invert(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=g,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=function(U){const{x:G,y:$}=U.point,{lng:W,lat:H}=U._center;return kw(G,$,U.worldSize,W,H)}(this);const j=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=Z.transformMat4(j,j,c),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=g;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const e=this.cameraWorldSizeForFog,n=this.cameraPixelsPerMeter,i=this._camera.position,a=1/this.height/this._pixelsPerMercatorPixel,l=[e,e,n];Z.scale(l,l,a),Z.scale(i,i,-1),Z.multiply(i,i,l);const c=se.create();se.translate(c,c,i),se.scale(c,c,l),this.mercatorFogMatrix=c,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(e,n,a)}_computeCameraPosition(e){const n=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,i=this._camera.forward(),a=this.point,l=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*n-e/this.worldSize*this._centerAltitude;return[a.x/this.worldSize-i[0]*l,a.y/this.worldSize-i[1]*l,e/this.worldSize*this._centerAltitude-i[2]*l]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(e){const n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),i=this._camera.position[2],a=e[2];let l=1;this.projection.wrap&&(this.center=this.center.wrap()),a>0&&(l=Math.min((n-i)/a,1)),this._camera.position=Z.scaleAndAdd([],this._camera.position,e,l),this._updateStateFromCamera()}_updateStateFromCamera(){const e=this._camera.position,n=this._camera.forward(),{pitch:i,bearing:a}=this._camera.getPitchBearing(),l=kn(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,c=this._mercatorZfromZoom(this._maxZoom)*Math.cos(At(this._maxPitch)),h=Math.max((e[2]-l)/Math.cos(i),c),f=this._zoomFromMercatorZ(h);Z.scaleAndAdd(e,e,n,h),this._pitch=et(i,At(this.minPitch),At(this.maxPitch)),this.angle=ts(a,-Math.PI,Math.PI),this._setZoom(et(f,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new nn(e[0],e[1],e[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}zoomFromMercatorZAdjusted(e){let n=0,i=6,a=0,l=1/0;for(;i-n>1e-6&&i>n;){const c=n+.5*(i-n),h=this.tileSize*Math.pow(2,c),f=this.getCameraToCenterDistance(this.projection,c,h),p=this.scaleZoom(f/(e*this.tileSize)),g=Math.abs(c-p);g<l&&(l=g,a=c),c<p?n=c:i=c}return a}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(ee("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(e,n){const i=Math.min(e.x,n.x),a=Math.max(e.x,n.x),l=Math.min(e.y,n.y),c=Math.max(e.y,n.y);if(l<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const h=[new ie(i,l),new ie(a,c),new ie(i,c),new ie(a,l)],f=this.renderWorldCopies?-3:0,p=this.renderWorldCopies?4:1;for(const g of h){const _=this.pointRayIntersection(g);if(_.t<0)return!0;const y=this.rayIntersectionCoordinate(_);if(y.x<f||y.y<0||y.x>p||y.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+kr(this.fovAboveCenter)>88||this.anyCornerOffEdge(new ie(0,0),new ie(this.width,this.height))}zoomDeltaToMovement(e,n){const i=Z.length(Z.sub([],this._camera.position,e)),a=this._zoomFromMercatorZ(i)+n;return i-this._mercatorZfromZoom(a)}getCameraPoint(){if("globe"===this.projection.name){const e=function([n,i,a],l){const c=[n,i,a,1];bn.transformMat4(c,c,l);const h=c[3]=Math.max(c[3],1e-6);return c[0]/=h,c[1]/=h,c[2]/=h,c}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new ie(e[0],e[1])}{const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new ie(0,e))}}getCameraToCenterDistance(e,n=this.zoom,i=this.worldSize){const a=np(e,n,this.width,this.height,1024),l=e.pixelSpaceConversion(this.center.lat,i,a);let c=.5/Math.tan(.5*this._fov)*this.height*l;return this.isOrthographic&&(c=rp(1,c,d0(this.pitch>=15?1:this.pitch/15))),c}getWorldToCameraMatrix(){const e=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&se.multiply(e,e,this.globeMatrix),e}getFrustum(e){return ua.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,e,"meters"===this.projection.zAxisUnit)}}function f0(t,e,n){se.identity(t),se.rotateZ(t,t,At(e[2])),se.rotateX(t,t,At(e[0])),se.rotateY(t,t,At(e[1])),se.scale(t,t,n),se.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Ng(t,e,n,i,a,l,c,h){const f=[n[0]-e[0],n[1]-e[1],0],p=[i[0]-e[0],i[1]-e[1],0];if(Z.length(f)<1e-12||Z.length(p)<1e-12)return Mi.identity(t);const g=Z.cross([],f,p);Z.normalize(g,g),Z.subtract(p,i,e),f[2]=(l-a)*h,p[2]=(c-a)*h;const _=f;return Z.cross(_,f,p),Z.normalize(_,_),Mi.rotationTo(t,g,_)}function ld(t,e,n=!1){const i=ni(e.zoom),a=function(l,c,h){const f=c.worldSize,p=[l[12],l[13],l[14]],g=Gr(p[1]/f),_=Ao(p[0]/f),y=se.identity([]),v=kn(1,g)*f,w=kn(1,0)*f*Ni(g,c.zoom),E=1/Ky(f);let T=w*E;if(h){const R=np(c.projection,c.zoom,c.width,c.height,1024);T=E*c.projection.pixelSpaceConversion(c.center.lat,f,R)}const C=Dr(g,_);Z.add(C,C,Z.scale([],Z.normalize([],C),v*T*p[2]));const S=function(R){const A=[R[0],R[1],R[2]];let k=[0,1,0];const L=Z.cross([],k,A);return Z.cross(k,A,L),0===Z.squaredLength(k)&&(k=[0,1,0],Z.cross(L,A,k)),Z.normalize(L,L),Z.normalize(k,k),Z.normalize(A,A),[L[0],L[1],L[2],0,k[0],k[1],k[2],0,A[0],A[1],A[2],0,R[0],R[1],R[2],1]}(C);se.scale(y,y,[T,T,T*v]),se.translate(y,y,[-p[0],-p[1],-p[2]]);const I=se.multiply([],c.globeMatrix,S);return se.multiply(I,I,y),se.multiply(I,I,l),I}(t,e,n);return i>0?function(c,h,f){const p=(w,E,T)=>{const C=Z.length(w),S=Z.length(E),I=Ol(w,E,T);return Z.scale(I,I,1/Z.length(I)*wt(C,S,T))},g=p([c[0],c[1],c[2]],[h[0],h[1],h[2]],f),_=p([c[4],c[5],c[6]],[h[4],h[5],h[6]],f),y=p([c[8],c[9],c[10]],[h[8],h[9],h[10]],f),v=Ol([c[12],c[13],c[14]],[h[12],h[13],h[14]],f);return[g[0],g[1],g[2],0,_[0],_[1],_[2],0,y[0],y[1],y[2],0,v[0],v[1],v[2],1]}(a,function(c,h){const f=h.worldSize,p=kn(1,0)*f*Ni(h.center.lat,h.zoom)/Ky(f),g=kn(1,h.center.lat)*f,_=se.identity([]);return se.rotateY(_,_,At(h.center.lng)),se.rotateX(_,_,At(h.center.lat)),se.translate(_,_,[0,0,Fi]),se.scale(_,_,[p,p,p*g]),se.translate(_,_,[h.point.x-.5*f,h.point.y-.5*f,0]),se.multiply(_,_,c),se.multiply(_,h.globeMatrix,_)}(t,e),i):a}const VM=[1,1,1];class bE{constructor(e,n,i,a){this.id=e,this.position=null!=n?new bt(n[0],n[1]):new bt(0,0),this.orientation=i??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new $n([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,n){if(se.multiply(e.matrix,n,e.matrix),e.meshes)for(const i of e.meshes){const a=$n.applyTransform(i.aabb,e.matrix);this.aabb.encapsulate(a)}if(e.children)for(const i of e.children)this._applyTransformations(i,e.matrix)}computeBoundsAndApplyParent(){const e=se.identity([]);for(const n of this.nodes)this._applyTransformations(n,e)}_positionModelOnTerrain(e,n){const i=e.elevation;if(!i)return 0;const a=$n.projectAabbCorners(this.aabb,this.matrix),l=kn(1,this.position.lat)*e.worldSize,c=function(C,S){const I=[0,0,1],R=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const A of R){const k=C[A.corners[0]],L=C[A.corners[1]],B=C[A.corners[2]],j=[L[0]-k[0],L[1]-k[1],S*(L[2]-k[2])],U=Z.cross(j,j,[B[0]-k[0],B[1]-k[1],S*(B[2]-k[2])]);Z.normalize(U,U),A.dotProductWithUp=Z.dot(U,I)}return R.sort((A,k)=>A.dotProductWithUp-k.dotProductWithUp),R[0].corners}(a,l),h=a[c[0]],f=a[c[1]],p=a[c[2]],g=a[c[3]],_=i.getAtPointOrZero(new nn(h[0]/e.worldSize,h[1]/e.worldSize),0),y=i.getAtPointOrZero(new nn(f[0]/e.worldSize,f[1]/e.worldSize),0),v=i.getAtPointOrZero(new nn(p[0]/e.worldSize,p[1]/e.worldSize),0),w=i.getAtPointOrZero(new nn(g[0]/e.worldSize,g[1]/e.worldSize),0),E=(_+w)/2,T=(y+v)/2;return E>T?y<v?Ng(n,f,g,h,y,w,_,l):Ng(n,p,h,g,v,_,w,l):_<w?Ng(n,h,f,p,_,y,v,l):Ng(n,g,p,f,w,v,y,l),Math.max(E,T)}computeModelMatrix(e,n,i,a,l,c,h=!1){const f=e.transform,p=f.zoom,g=f.project(this.position),_=Ni(this.position.lat,p),y=1/_;se.identity(this.matrix),se.translate(this.matrix,this.matrix,[g.x+a[0]*y,g.y+a[1]*y,a[2]]);let v=1,w=1;const E=f.worldSize;if(h){if("mercator"===f.projection.name){let I=0;f.elevation&&(I=f.elevation.getAtPointOrZero(new nn(g.x/E,g.y/E),0));const R=bn.transformMat4([],[g.x,g.y,I,1],f.projMatrix)[3]/f.cameraToCenterDistance;v=R,w=R*Ni(f.center.lat,p)}else if("globe"===f.projection.name){const I=ld(this.matrix,f),R=se.multiply([],f.projMatrix,I),A=[0,0,0,1];bn.transformMat4(A,A,R);const k=A[3]/f.cameraToCenterDistance,L=ni(p),B=f.projection.pixelsPerMeter(this.position.lat,E)*Ni(this.position.lat,p),j=f.projection.pixelsPerMeter(f.center.lat,E)*Ni(f.center.lat,p);v=k/wt(B,zw(f.center.lat),L),w=k*_/B,v*=j,w*=j}}else v=y;se.scale(this.matrix,this.matrix,[v,v,w]);const T=[...this.matrix],C=this.orientation,S=[];if(f0(S,[C[0]+n[0],C[1]+n[1],C[2]+n[2]],i),se.multiply(this.matrix,T,S),l&&f.elevation){let I=0;const R=[];if(c&&f.elevation){I=this._positionModelOnTerrain(f,R);const A=se.fromQuat([],R),k=se.multiply([],A,S);se.multiply(this.matrix,T,k)}else I=f.elevation.getAtPointOrZero(new nn(g.x/E,g.y/E),0);0!==I&&(this.matrix[14]+=I)}}upload(e){if(!this.uploaded){for(const n of this.nodes)zg(n,e);for(const n of this.nodes)op(n);this.uploaded=!0}}destroy(){for(const e of this.nodes)Bg(e)}}function ip(t,e,n=!1){t.uploaded||(t.gfxTexture=new Wr(e,t.image,n?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function EE(t,e,n){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,cE.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,zM.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,ku.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(12===t.colorArray.bytesPerElement?uE:hE).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,od.members,!0)),t.segments=Cn.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);const i=t.material;i.pbrMetallicRoughness.baseColorTexture&&ip(i.pbrMetallicRoughness.baseColorTexture,e),i.pbrMetallicRoughness.metallicRoughnessTexture&&ip(i.pbrMetallicRoughness.metallicRoughnessTexture,e),i.normalTexture&&ip(i.normalTexture,e),i.occlusionTexture&&ip(i.occlusionTexture,e,n),i.emissionTexture&&ip(i.emissionTexture,e)}function zg(t,e,n){if(t.meshes)for(const i of t.meshes)EE(i,e,n);if(t.children)for(const i of t.children)zg(i,e,n)}function op(t){if(t.meshes)for(const e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(const e of t.children)op(e)}function Bg(t){if(t.meshes)for(const n of t.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(const n of t.children)Bg(n)}class p0{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class CE{constructor(){this.instancedDataArray=new Em,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class TE{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,n,i,a){this.tileToMeter=Nh(i);const l=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:c,id:h,index:f,sourceLayerIndex:p}of e){const g=_o(c,l);if(!this.layers[0]._featureFilter.filter(new pr(this.zoom),g,i))continue;const _={id:h,sourceLayerIndex:p,index:f,geometry:l?g.geometry:Yt(c,i,a),properties:c.properties,type:c.type,patterns:{}},y=this.addFeature(_,_.geometry,g);y&&n.featureIndex.insert(c,_.geometry,f,p,this.index,this.instancesPerModel[y].instancedDataArray.length)}this.lookup=null}update(e,n,i,a){for(const l in this.instancesPerModel){const c=this.instancesPerModel[l];for(const h in e)c.idToFeaturesIndex.hasOwnProperty(h)&&this.evaluate(c.features[c.idToFeaturesIndex[h]],e[h],c,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const n in this.instancesPerModel){const i=this.instancesPerModel[n];for(const a of i.features){const l=this.layers[0],c=a.feature,h=this.canonical,f=l.paint.get("model-rotation").evaluate(c,{},h),p=l.paint.get("model-scale").evaluate(c,{},h),g=l.paint.get("model-translation").evaluate(c,{},h);Z.exactEquals(a.rotation,f)&&Z.exactEquals(a.scale,p)&&Z.exactEquals(a.translation,g)||(this.evaluate(a,a.featureStates,i,!0),e=!0)}}return e}isEmpty(){for(const e in this.instancesPerModel)if(0!==this.instancesPerModel[e].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const n in this.instancesPerModel){const i=this.instancesPerModel[n];i.instancedDataArray.length<0||0===i.instancedDataArray.length||(i.instancedDataBuffer?i.instancedDataBuffer.updateData(i.instancedDataArray):i.instancedDataBuffer=e.createVertexBuffer(i.instancedDataArray,BM.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const e in this.instancesPerModel){const n=this.instancesPerModel[e];0!==n.instancedDataArray.length&&n.instancedDataBuffer&&n.instancedDataBuffer.destroy()}}addFeature(e,n,i){const a=this.layers[0],l=a.layout.get("model-id").evaluate(i,{},this.canonical);if(!l)return ee(`modelId is not evaluated for layer ${a.id} and it is not going to get rendered.`),l;this.instancesPerModel[l]||(this.instancesPerModel[l]=new CE);const c=this.instancesPerModel[l],h=c.instancedDataArray,f=new p0(i,h.length);for(const p of n)for(const g of p){if(g.x<0||g.x>=he||g.y<0||g.y>=he)continue;const _=(this.lookupDim-1)/he,y=this.lookupDim*(g.y*_|0)+g.x*_|0;if(this.lookup){if(0!==this.lookup[y])continue;this.lookup[y]=1}this.instanceCount++;const v=h.length;h.resize(v+1),c.instancesEvaluatedElevation.push(0),h.float32[16*v]=g.x,h.float32[16*v+1]=g.y}return f.instancedDataCount=c.instancedDataArray.length-f.instancedDataOffset,f.instancedDataCount>0&&(e.id&&(c.idToFeaturesIndex[e.id]=c.features.length),c.features.push(f),this.evaluate(f,{},c,!1)),l}evaluate(e,n,i,a){const l=this.layers[0],c=e.feature,h=this.canonical,f=e.rotation=l.paint.get("model-rotation").evaluate(c,n,h),p=e.scale=l.paint.get("model-scale").evaluate(c,n,h),g=e.translation=l.paint.get("model-translation").evaluate(c,n,h),_=l.paint.get("model-color").evaluate(c,n,h);_.a=l.paint.get("model-color-mix-intensity").evaluate(c,n,h);const y=[];this.maxVerticalOffset<g[2]&&(this.maxVerticalOffset=g[2]),this.maxScale=Math.max(Math.max(this.maxScale,p[0]),Math.max(p[1],p[2])),f0(y,f,p);const v=Math.round(100*_.a)+_.b/1.05;for(let w=0;w<e.instancedDataCount;++w){const E=e.instancedDataOffset+w,T=16*E,C=i.instancedDataArray.float32;let S=0;a&&(S=C[T+6]-i.instancesEvaluatedElevation[E]);const I=0|C[T+1];C[T]=(0|C[T])+_.r/1.05,C[T+1]=I+_.g/1.05,C[T+2]=v,C[T+3]=1/(h.z>10?this.tileToMeter:Nh(h,I)),C[T+4]=g[0],C[T+5]=g[1],C[T+6]=g[2]+S,C[T+7]=y[0],C[T+8]=y[1],C[T+9]=y[2],C[T+10]=y[4],C[T+11]=y[5],C[T+12]=y[6],C[T+13]=y[8],C[T+14]=y[9],C[T+15]=y[10],i.instancesEvaluatedElevation[E]=g[2]}}}Qe(TE,"ModelBucket",{omit:["layers"]}),Qe(CE,"PerModelAttributes"),Qe(p0,"ModelFeature");const EI=new mr({visibility:new Re(le.layout_model.visibility),"model-id":new lt(le.layout_model["model-id"])});var CI={paint:new mr({"model-opacity":new Re(le.paint_model["model-opacity"]),"model-rotation":new lt(le.paint_model["model-rotation"]),"model-scale":new lt(le.paint_model["model-scale"]),"model-translation":new lt(le.paint_model["model-translation"]),"model-color":new lt(le.paint_model["model-color"]),"model-color-mix-intensity":new lt(le.paint_model["model-color-mix-intensity"]),"model-type":new Re(le.paint_model["model-type"]),"model-cast-shadows":new Re(le.paint_model["model-cast-shadows"]),"model-receive-shadows":new Re(le.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Re(le.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new lt(le.paint_model["model-emissive-strength"]),"model-roughness":new lt(le.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new lt(le.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Re(le.paint_model["model-cutoff-fade-range"])}),layout:EI};const DE=new Float32Array(262144),cd=new Uint8Array(262144);function m0(t){let e=0;if(t.meshes)for(const n of t.meshes)e=Math.max(e,n.aabb.max[2]);if(t.children)for(const n of t.children)e=Math.max(e,m0(n));return e}const sp=["","wall","door","roof","window","lamp","logo"];class ME{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:m0(e)}}}}class SE{constructor(e,n,i,a){this.nodes=e,this.id=n,this.modelTraits|=1,this.uploaded=!1,this.hasPattern=!1,i&&(this.modelTraits|=4),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=a,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const n=this.getNodesInfo();for(const i of n){const a=i.node;this.uploaded?this.updatePbrBuffer(a):zg(a,e,!0)}for(const i of n)op(i.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(const i of e.meshes)i.pbrBuffer&&(i.pbrBuffer.updateData(i.featureArray),n=!0);return n}needsReEvaluation(e,n,i){const a=e.transform.projectionOptions,l=e.style.getBrightness(),c=this.brightness!==l;return!!(!this.uploaded||this.dirty||a.name!==this.projection.name||ud(i.paint.get("model-color").value,c)||ud(i.paint.get("model-color-mix-intensity").value,c)||ud(i.paint.get("model-roughness").value,c)||ud(i.paint.get("model-emissive-strength").value,c)||ud(i.paint.get("model-height-based-emissive-strength-multiplier").value,c))&&(this.projection=a,this.brightness=l,!0)}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const i=this.getNodesInfo(),a=this.id.canonical;for(const l of i){const c=l.feature;l.evaluatedScale=n.paint.get("model-scale").evaluate(c,{},a)}}evaluate(e){const n=this.getNodesInfo();for(const i of n){if(!i.node.meshes)continue;const a=i.feature,l=i.node.meshes&&i.node.meshes[0].featureData,c=i.evaluatedColor[2],h=i.evaluatedRMEA[2],f=this.id.canonical;if(i.hasTranslucentParts=!1,l){for(let p=0;p<sp.length;p++){const g=sp[p];g.length&&(a.properties.part=g);const _=e.paint.get("model-color").evaluate(a,{},f),y=e.paint.get("model-color-mix-intensity").evaluate(a,{},f);i.evaluatedColor[p]=[_.r,_.g,_.b,y],i.evaluatedRMEA[p][0]=e.paint.get("model-roughness").evaluate(a,{},f),i.evaluatedRMEA[p][2]=e.paint.get("model-emissive-strength").evaluate(a,{},f),i.evaluatedRMEA[p][3]=_.a,i.emissionHeightBasedParams[p]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(a,{},f),!i.hasTranslucentParts&&_.a<1&&(i.hasTranslucentParts=!0)}delete a.properties.part,jM(i,c!==i.evaluatedColor[2]||h!==i.evaluatedRMEA[2])}i.evaluatedScale=e.paint.get("model-scale").evaluate(a,{},f),this.updatePbrBuffer(i.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,i,a){const l=e.findDEMTileFor(i);if(l&&(l.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(l.dem&&l.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=l.tileID.overscaledZ;const c=Pc.create(e,i,l);if(!c)return;4&this.modelTraits&&this.updateDEM(e,c,i,a);for(const h of this.getNodesInfo()){const f=h.node;if(!f.footprint||!f.footprint.vertices||!f.footprint.vertices.length)continue;const p=f.footprint.vertices;let g=c.getElevationAt(p[0].x,p[0].y,!0,!0);for(let _=1;_<p.length;_++)g=Math.min(g,c.getElevationAt(p[_].x,p[_].y,!0,!0));f.elevation=g}}this.terrainTile=l.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,i,a){let l=n._dem._modifiedForSources[a];if(void 0===l&&(n._dem._modifiedForSources[a]=[],l=n._dem._modifiedForSources[a]),l.includes(i.canonical))return;const c=n._dem.dim;l.push(i.canonical);let h=!1;for(const f of this.getNodesInfo()){const p=f.node;if(!p.footprint||!p.footprint.grid)continue;const g=p.footprint.grid,_=n.tileCoordToPixel(g.min.x,g.min.y),y=n.tileCoordToPixel(g.max.x,g.max.y),v=Math.min(Math.min(c-y.y,_.x),Math.min(_.y,c-y.x));if(v<0)continue;const w=et(v,2,5);let E=Math.max(0,_.x-w),T=Math.max(0,_.y-w),C=Math.min(y.x+w,c-1),S=Math.min(y.y+w,c-1);for(let k=T;k<=S;++k)for(let L=E;L<=C;++L)cd[k*c+L]=255;let I=0,R=0;for(let k=0;k<g.cellsY;++k)for(let L=0;L<g.cellsX;++L){if(!g.cells[k*g.cellsX+L])continue;const B=n.tileCoordToPixel(g.min.x+L/g.xScale,g.min.y+k/g.yScale),j=n.tileCoordToPixel(g.min.x+(L+1)/g.xScale,g.min.y+(k+1)/g.yScale);for(let U=B.y;U<=Math.min(j.y+1,c-1);++U)for(let G=B.x;G<=Math.min(j.x+1,c-1);++G)255===cd[U*c+G]&&(cd[U*c+G]=0,I+=n.getElevationAtPixel(G,U),R++)}const A=I/R;E=Math.max(1,_.x-w),T=Math.max(1,_.y-w),C=Math.min(y.x+w,c-2),S=Math.min(y.y+w,c-2),h=!0;for(let k=T;k<=S;++k)for(let L=E;L<=C;++L)0===cd[k*c+L]&&(DE[k*c+L]=n._dem.set(L,k,A));for(let k=1;k<w;++k){E=Math.max(1,_.x-k),T=Math.max(1,_.y-k),C=Math.min(y.x+k,c-2),S=Math.min(y.y+k,c-2);for(let L=T;L<=S;++L)for(let B=E;B<=C;++B){const j=L*c+B;if(255===cd[j]){let U=0,G=0,$=-1,W=-1;for(let H=-1;H<=1;++H)for(let J=-1;J<=1;++J){const te=(L+H)*c+B+J;if(cd[te]>=k)continue;const oe=DE[te],K=Math.abs(oe);K>G&&(U=oe,G=K,$=J,W=H)}if(G>.1){const H=1-(k+.5*Math.abs($*W))/w;let J=n._dem.get(B,L)+U*H;const te=n._dem.get(B+$,L+W),oe=n._dem.get(B-$,L-W,!0);(J-te)*(J-oe)>0&&(J=(te+oe)/2),DE[j]=n._dem.set(B,L,J),cd[j]=k}}}}}h&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=Ct.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(const e of this.nodes)this.nodesInfo.push(new ME(e));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(const e of this.nodes)Bg(e);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();const e=this.getNodesInfo();for(const n of e)op(n.node),Bg(n.node)}isEmpty(){return!this.nodes.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const i=n.getReplacementRegionsForTile(e.toUnwrapped()),a=this.getNodesInfo();for(let l=0;l<this.nodesInfo.length;l++){const c=a[l].node;a[l].hiddenByReplacement=!!c.footprint&&!i.find(h=>h.footprint===c.footprint)}}getHeightAtTileCoord(e,n){const i=this.getNodesInfo(),a=[];for(let l=0;l<this.nodesInfo.length;l++){const c=i[l],h=c.node.meshes[0];if(e<h.aabb.min[0]||n<h.aabb.min[1]||e>h.aabb.max[0]||n>h.aabb.max[1])continue;const f=(e-h.aabb.min[0])/(h.aabb.max[0]-h.aabb.min[0])*64|0,p=64*Math.min(63,(n-h.aabb.min[1])/(h.aabb.max[1]-h.aabb.min[1])*64|0)+Math.min(63,f);if(!(h.heightmap[p]<0&&c.node.footprint))return c.hiddenByReplacement?void 0:{height:h.heightmap[p],maxHeight:c.feature.properties.height,hidden:!1,verticalScale:c.evaluatedScale[2]};if(c.node.footprint.grid.query(new ie(e,n),new ie(e,n),a),a.length>0)return{height:void 0,maxHeight:c.feature.properties.height,hidden:c.hiddenByReplacement,verticalScale:c.evaluatedScale[2]}}}}function ud(t,e){return!t.isLightConstant&&e}function ap(t,e,n,i,a,l,c,h){let f=(61440&e|(61440&e)>>4)>>8,p=(3840&e|(3840&e)>>4)>>4,g=240&e|(240&e)>>4;n[3]>0&&(f=wt(f,255*n[0],n[3]),p=wt(p,255*n[1],n[3]),g=wt(g,255*n[2],n[3]));const _=f<<8|p,y=g<<8|Math.floor(255*i[3]),v=function(k){const L=et(k,0,2);return Math.min(Math.round(.5*L*255),255)}(i[2])<<8|15*i[0]<<4|15*i[1],w=et(a[0],0,1),E=et(a[1],0,1),T=et(a[2],0,1),C=et(a[3],0,1);let S,I,R,A;if(w!==E&&c!==l&&E!==w){const k=c-l;I=1/(k*(E-w)),R=-(l+k*w)/(k*(E-w));const L=et(a[4],-1,1);A=Math.pow(10,L),S=255*T<<8|255*C}else S=65535,I=0,R=1,A=1;if(t.emplaceBack(_,y,v,S,I,R,A),h){const k=h.length;h.clear();for(let L=0;L<k;L++)h.emplaceBack(_,y,v,S,I,R,A)}}function jM(t,e){const n=t.node;let i=0;for(const a of n.meshes){if(n.lights&&n.lightMeshIndex===i||!a.featureData)continue;a.featureArray=new yc,a.featureArray.reserve(a.featureData.length);let l=e;for(const c of a.featureData){let h;const f=65535&c,p=(15&f)<8?15&f:0,g=c>>16&65535,_=t.evaluatedRMEA[p],y=t.evaluatedColor[p],v=t.emissionHeightBasedParams[p];if(l&&2===p&&n.lights&&(h=new yc,h.resize(10*n.lights.length)),ap(a.featureArray,g,y,_,v,a.aabb.min[2],a.aabb.max[2],h),h&&l){l=!1;const w=n.meshes[n.lightMeshIndex];w.featureArray=h,w.featureArray._trim()}}a.featureArray._trim(),i++}}Qe(SE,"Tiled3dModelBucket",{omit:["layers"]}),Qe(ME,"Tiled3dModelFeature");class UM{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(e){const n=g0(new ie(0,0),new ie(he,he),e),i=[];for(const a of this._activeRegions){if(a.hiddenByOverlap||!IE(n,a))continue;const l=$M(a.min,a.max,e);i.push({min:l.min,max:l.max,sourceId:this._sourceIds[a.priority],footprint:a.footprint,footprintTileId:a.tileId})}return i}setSources(e){this._setSources(e.map(n=>({getSourceId:()=>n.cache.id,getFootprints:()=>{const i=[];for(const a of n.cache.getVisibleCoordinates()){const l=n.cache.getTile(a).buckets[n.layer];if(l)for(const c of l.getNodesInfo()){const h=c.node;h.footprint&&i.push({footprint:h.footprint,id:a.toUnwrapped()})}}return i}})))}_addSource(e){const n=e.getFootprints();if(0!==n.length){for(const i of n){if(!i.footprint)continue;const a=g0(i.footprint.min,i.footprint.max,i.id);this._activeRegions.push({min:a.min,max:a.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:i.id,footprint:i.footprint})}this._sourceIds.push(e.getSourceId())}}_computeReplacement(){this._activeRegions.sort((n,i)=>n.priority-i.priority||Vg(n.min,i.min)||Vg(n.max,i.max));let e=this._activeRegions.length!==this._prevRegions.length;if(!e){let n=0,i=0;for(;!e&&n!==this._activeRegions.length;){const a=this._activeRegions[n],l=this._prevRegions[i];e=a.priority!==l.priority||!AE(a,l),++n,++i}}if(e){++this._updateTime;const n=i=>{const a=this._activeRegions;if(i>=a.length)return i;const l=a[i].priority;for(;i<a.length&&a[i].priority===l;)++i;return i};if(this._sourceIds.length>1){let i=0,a=n(i);for(;i!==a;){let l=i;const c=i;for(;l!==a;){const h=this._activeRegions[l];h.hiddenByOverlap=!1;for(let f=0;f<c;f++){const p=this._activeRegions[f];if(!p.hiddenByOverlap&&IE(h,p)&&(h.hiddenByOverlap=hd(h.footprint,h.tileId,p.footprint,p.tileId),h.hiddenByOverlap))break}++l}i=a,a=n(i)}}}}_setSources(e){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let n=e.length-1;n>=0;n--)this._addSource(e[n]);this._computeReplacement()}}function Vg(t,e){return t.x-e.x||t.y-e.y}function AE(t,e){return 0===Vg(t.min,e.min)&&0===Vg(t.max,e.max)}function IE(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function g0(t,e,n){const i=1/he,a=1/(1<<n.canonical.z),l=(e.x*i+n.canonical.x)*a+n.wrap,c=(e.y*i+n.canonical.y)*a;return{min:new ie((t.x*i+n.canonical.x)*a+n.wrap,(t.y*i+n.canonical.y)*a),max:new ie(l,c)}}function $M(t,e,n){const i=1<<n.canonical.z,a=((e.x-n.wrap)*i-n.canonical.x)*he,l=(e.y*i-n.canonical.y)*he;return{min:new ie(((t.x-n.wrap)*i-n.canonical.x)*he,(t.y*i-n.canonical.y)*he),max:new ie(a,l)}}function PE(t,e,n,i,a,l,c){const h=t.indices,f=t.vertices,p=[];for(let g=i;g<i+a;g+=3){const _=e[n[g+0]+l],y=e[n[g+1]+l],v=e[n[g+2]+l],w=Math.min(_.x,y.x,v.x),E=Math.max(_.x,y.x,v.x),T=Math.min(_.y,y.y,v.y),C=Math.max(_.y,y.y,v.y);p.length=0,t.grid.query(new ie(w,T),new ie(E,C),p);for(let S=0;S<p.length;S++){const I=p[S];if(cv(f[h[3*I+0]],f[h[3*I+1]],f[h[3*I+2]],_,y,v,c))return!0}}return!1}function hd(t,e,n,i){if(!t||!n)return!1;let a=t.vertices;if(!e.canonical.equals(i.canonical)||e.wrap!==i.wrap){if(n.vertices.length<t.vertices.length)return hd(n,i,t,e);const l=e.canonical,c=i.canonical,h=Math.pow(2,c.z-l.z);a=t.vertices.map(f=>new ie(f.x*l.x*he*h-c.x*he,f.y*l.y*he*h-c.y*he))}return PE(n,a,t.indices,0,t.indices.length,0,0)}const HM=Vf.types,RE=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],GM=["fill-extrusion-flood-light-ground-radius"],kE=Math.pow(2,13),qM=Math.pow(2,15)-1,_0=new ie(0,1),il=2147483648;function Lu(t,e,n,i,a,l,c,h){t.emplaceBack((e<<1)+c,(n<<1)+l,(Math.floor(i*kE)<<1)+a,Math.round(h))}function jg(t,e,n,i,a,l){t.emplaceBack(e.x,e.y,(n.x<<1)+i,(n.y<<1)+a,l)}function dd(t,e,n){t.emplaceBack(e.x,e.y,e.z,16384*n[0],16384*n[1],16384*n[2])}class y0{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class OE{constructor(){this.centroidXY=new ie(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.min=new ie(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new ie(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new ie(this.max.x-this.min.x,this.max.y-this.min.y)}}class LE{constructor(){this.acc=new ie(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,i){this.accCount++,this.acc._add(n);let a=!!this.borders;n.x<e.min.x?(e.min.x=n.x,a=!0):n.x>e.max.x&&(e.max.x=n.x,a=!0),n.y<e.min.y?(e.min.y=n.y,a=!0):n.y>e.max.y&&(e.max.y=n.y,a=!0),((0===n.x||n.x===he)&&n.x===i.x)!=((0===n.y||n.y===he)&&n.y===i.y)&&this.processBorderOverlap(n,i),a&&this.checkBorderIntersection(n,i)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,wt(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>he!=e.x>he&&this.addBorderIntersection(1,wt(n.y,e.y,(he-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,wt(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>he!=e.y>he&&this.addBorderIntersection(3,wt(n.x,e.x,(he-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const i=this.borders[e];n<i[0]&&(i[0]=n),n>i[1]&&(i[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const i=0===e.x?0:1;this.addBorderIntersection(i,n.y),this.addBorderIntersection(i,e.y)}else{const i=0===e.y?2:3;this.addBorderIntersection(i,n.x),this.addBorderIntersection(i,e.x)}}centroid(){return 0===this.accCount?new ie(0,0):new ie(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function FE(t,e){const n=t.add(e)._unit(),i=et(t.x*n.x+t.y*n.y,-1,1);var a,l,c;return a=Math.acos(i),Math.min(4,Math.max(-4,Math.tan(a)))/4*qM*((l=t).x*(c=e).y-l.y*c.x<0?-1:1)}const v0=[t=>t.x<0,t=>t.x>he,t=>t.y<0,t=>t.y>he];function WM(t,e,n,i){const a=[4];if(0===i)return a;n._mult(i);const l=t.sub(n),c=e.sub(n),h=[t,e,l,c];for(let f=0;f<4;f++)for(const p of h)if(v0[f](p)){a.push(f);break}return a}class x0{constructor(e){this.vertexArray=new B1,this.indexArray=new Tr,this.programConfigurations=new xc(e.layers,e.zoom,n=>GM.includes(n)),this._segments=new Cn,this.hiddenByLandmarkVertexArray=new Th,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Cn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(e,n,i,a=!1){const l=e.length;if(l>2){let c=Math.max(0,this._segments.get().length-1);const h=this._segments._prepareSegment(4*l,this.vertexArray.length,2*this._segmentToGroundQuads[c].length);let f;c!==this._segments.get().length-1&&(c++,this._segmentToGroundQuads[c]=[],this._segmentToRegionTriCounts[c]=[0,0,0,0,0]);{const p=e[0],g=e[1];f=FE(p.sub(e[l-1])._perp()._unit(),g.sub(p)._perp()._unit())}for(let p=0;p<l;p++){const g=p===l-1?0:p+1,_=e[p],y=e[g],v=e[g===l-1?0:g+1],w=y.sub(_)._perp()._unit(),E=FE(w,v.sub(y)._perp()._unit()),T=f,C=E;if(w0(_,y,n)||a&&BE(_,n)&&BE(y,n)){f=E;continue}const S=h.vertexLength;jg(this.vertexArray,_,y,1,1,T),jg(this.vertexArray,_,y,1,0,T),jg(this.vertexArray,_,y,0,1,C),jg(this.vertexArray,_,y,0,0,C),h.vertexLength+=4;const I=WM(_,y,w,i);for(const R of I)this._segmentToGroundQuads[c].push({id:S,region:R}),this._segmentToRegionTriCounts[c][R]+=2,h.primitiveLength+=2;f=E}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),n=e.length;for(let i=0;i<n;i++)this._segmentToGroundQuads[i].sort((a,l)=>a.region-l.region);for(let i=0;i<n;i++){const a=this._segmentToGroundQuads[i],l=e[i],c=this._segmentToRegionTriCounts[i];c.reduce((f,p)=>f+p,0);let h=0;for(let f=0;f<=4;f++){const p=c[f];if(0!==p){let g=this.regionSegments[f];g||(g=this.regionSegments[f]=new Cn);const _={vertexOffset:l.vertexOffset,primitiveOffset:l.primitiveOffset+h,vertexLength:l.vertexLength,primitiveLength:p};g.get().push(_)}h+=p}for(let f=0;f<a.length;f++){const p=a[f].id;this.indexArray.emplaceBack(p,p+1,p+3),this.indexArray.emplaceBack(p,p+3,p+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,i,a,l,c){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,i,a,l,c)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,mI.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,i,a,l,c){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,i,a,l,c)}updateHiddenByLandmark(e){if(!this.hasData())return;const n=e.groundVertexCount+e.groundVertexArrayOffset;if(0===e.groundVertexCount)return;const i=e.flags&il?1:0;for(let a=e.groundVertexArrayOffset;a<n;++a)this.hiddenByLandmarkVertexArray.emplace(a,i);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,_I.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const n=this.regionSegments[e];n&&n.destroy()}}}}class lp{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Tr,this.footprintVertices=new jo,this.footprintSegments=[],this.layoutVertexArray=new $a,this.centroidVertexArray=new $1,this.indexArray=new Tr,this.programConfigurations=new xc(e.layers,e.zoom,n=>RE.includes(n)),this.segments=new Cn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new x0(e),this.maxHeight=0,this.partLookup={}}populate(e,n,i,a){this.features=[],this.hasPattern=Ev("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Nh(i),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:l,id:c,index:h,sourceLayerIndex:f}of e){const p=this.layers[0]._featureFilter.needGeometry,g=_o(l,p);if(!this.layers[0]._featureFilter.filter(new pr(this.zoom),g,i))continue;const _={id:c,sourceLayerIndex:f,index:h,geometry:p?g.geometry:Yt(l,i,a),properties:l.properties,type:l.type,patterns:{}},y=this.layoutVertexArray.length;this.hasPattern?this.features.push(Bf("fill-extrusion",this.layers,_,this.zoom,n)):this.addFeature(_,_.geometry,h,i,{},n.availableImages,a,n.brightness),n.featureIndex.insert(l,_.geometry,h,f,this.index,y)}this.sortBorders(),this.groundEffect.prepareBorderSegments()}addFeatures(e,n,i,a,l,c){for(const h of this.features){const{geometry:f}=h;this.addFeature(h,f,h.index,n,i,a,l,c)}this.sortBorders()}update(e,n,i,a,l){const c=0!==Object.keys(e).length;if(c&&!this.stateDependentLayers.length)return;const h=c?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,n,h,i,a,l),this.groundEffect.update(e,n,h,i,a,l)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,vI),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,yI.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,gI.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,i,a,l,c,h,f){const p=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,g=[new ie(0,0),new ie(he,he)],_=h.projection,y="globe"===_.name,v="Polygon"===HM[e.type],w=new LE;w.centroidDataIndex=this.centroidData.length;const E=new OE,T=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},a)<=0,C=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},a);E.height=C,E.vertexArrayOffset=this.layoutVertexArray.length,E.groundVertexArrayOffset=this.groundEffect.vertexArray.length,y&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new vm);const S=rg(n,500);for(let B=S.length-1;B>=0;B--){const j=S[B];(0===j.length||(I=j[0]).every(U=>U.x<=0)||I.every(U=>U.x>=he)||I.every(U=>U.y<=0)||I.every(U=>U.y>=he))&&S.splice(B,1)}var I;let R;if(y)R=E0(S,g,a);else{R=[];for(const B of S)R.push({polygon:B,bounds:g})}const A=v?this.edgeRadius:0,k=A>0&&this.zoom<17,L=(B,j)=>{if(0===B.length)return!1;const U=B[B.length-1];return j.x===U.x&&j.y===U.y};for(const{polygon:B,bounds:j}of R){let U=0,G=0;for(const H of B)v&&!H[0].equals(H[H.length-1])&&H.push(H[0]),G+=v?H.length-1:H.length;const $=this.segments.prepareSegment((v?5:4)*G,this.layoutVertexArray,this.indexArray);E.footprintSegIdx<0&&(E.footprintSegIdx=this.footprintSegments.length);const W=new y0;if(W.vertexOffset=this.footprintVertices.length,W.indexOffset=3*this.footprintIndices.length,W.ringIndices=[],v){const H=[],J=[];U=$.vertexLength;for(let oe=0;oe<B.length;oe++){const K=B[oe];K.length&&0!==oe&&J.push(H.length/2);const Q=[];let ae,ue;ae=K[1].sub(K[0])._perp()._unit(),W.ringIndices.push(K.length-1);for(let fe=1;fe<K.length;fe++){const ge=K[fe],ve=K[fe===K.length-1?1:fe+1],de=ge.clone();if(A){ue=ve.sub(ge)._perp()._unit();const me=ae.add(ue)._unit(),Oe=A*Math.min(4,1/(ae.x*me.x+ae.y*me.y));de.x+=Oe*me.x,de.y+=Oe*me.y,de.x=Math.round(de.x),de.y=Math.round(de.y),ae=ue}!T||0!==A&&!k||L(Q,de)||Q.push(de),Lu(this.layoutVertexArray,de.x,de.y,0,0,1,1,0),$.vertexLength++,this.footprintVertices.emplaceBack(ge.x,ge.y),H.push(ge.x,ge.y),y&&dd(this.layoutVertexExtArray,_.projectTilePoint(de.x,de.y,a),_.upVector(a,de.x,de.y))}T&&(0===A||k)&&(0!==Q.length&&L(Q,Q[0])&&Q.pop(),this.groundEffect.addData(Q,j,p))}const te=bv(H,J);for(let oe=0;oe<te.length;oe+=3)this.footprintIndices.emplaceBack(W.vertexOffset+te[oe+0],W.vertexOffset+te[oe+1],W.vertexOffset+te[oe+2]),this.indexArray.emplaceBack(U+te[oe],U+te[oe+2],U+te[oe+1]),$.primitiveLength++;W.indexCount+=te.length,W.vertexCount+=this.footprintVertices.length-W.vertexOffset}for(let H=0;H<B.length;H++){const J=B[H];w.startRing(E,J[0]);let te=J.length>4&&VE(J[J.length-2],J[0],J[1]),oe=A?ZM(J[J.length-2],J[0],J[1],A):0;const K=[];let Q,ae,ue;ae=J[1].sub(J[0])._perp()._unit();let fe=!0;for(let ge=1,ve=0;ge<J.length;ge++){let de=J[ge-1],me=J[ge];const Oe=J[ge===J.length-1?1:ge+1];if(w.appendEdge(E,me,de),w0(me,de,j)){A&&(ae=Oe.sub(me)._perp()._unit(),fe=!fe);continue}const qe=me.sub(de)._perp(),Ge=qe.x/(Math.abs(qe.x)+Math.abs(qe.y)),We=qe.y>0?1:0,it=de.dist(me);if(ve+it>32768&&(ve=0),A){ue=Oe.sub(me)._perp()._unit();let Ft=zE(de,me,Oe,NE(ae,ue),A);isNaN(Ft)&&(Ft=0);const Dt=me.sub(de)._unit();de=de.add(Dt.mult(oe))._round(),me=me.add(Dt.mult(-Ft))._round(),oe=Ft,ae=ue,T&&this.zoom>=17&&(L(K,de)||K.push(de),L(K,me)||K.push(me))}const gt=$.vertexLength,zt=J.length>4&&VE(de,me,Oe);let an=jE(ve,te,fe);if(Lu(this.layoutVertexArray,de.x,de.y,Ge,We,0,0,an),Lu(this.layoutVertexArray,de.x,de.y,Ge,We,0,1,an),ve+=it,an=jE(ve,zt,!fe),te=zt,Lu(this.layoutVertexArray,me.x,me.y,Ge,We,0,0,an),Lu(this.layoutVertexArray,me.x,me.y,Ge,We,0,1,an),$.vertexLength+=4,this.indexArray.emplaceBack(gt+0,gt+1,gt+2),this.indexArray.emplaceBack(gt+1,gt+3,gt+2),$.primitiveLength+=2,A){const Ft=U+(1===ge?J.length-2:ge-2),Dt=1===ge?U:Ft+1;if(this.indexArray.emplaceBack(gt+1,Ft,gt+3),this.indexArray.emplaceBack(Ft,Dt,gt+3),$.primitiveLength+=2,void 0===Q&&(Q=gt),!w0(Oe,J[ge],j)){const pt=ge===J.length-1?Q:$.vertexLength;this.indexArray.emplaceBack(gt+2,gt+3,pt),this.indexArray.emplaceBack(gt+3,pt+1,pt),this.indexArray.emplaceBack(gt+3,Dt,pt+1),$.primitiveLength+=3}fe=!fe}if(y){const Ft=this.layoutVertexExtArray,Dt=_.projectTilePoint(de.x,de.y,a),pt=_.projectTilePoint(me.x,me.y,a),ut=_.upVector(a,de.x,de.y),Kt=_.upVector(a,me.x,me.y);dd(Ft,Dt,ut),dd(Ft,Dt,ut),dd(Ft,pt,Kt),dd(Ft,pt,Kt)}}v&&(U+=J.length-1),T&&A&&this.zoom>=17&&(0!==K.length&&L(K,K[0])&&K.pop(),this.groundEffect.addData(K,j,p,A>0))}this.footprintSegments.push(W),++E.footprintSegLen}if(E.vertexCount=this.layoutVertexArray.length-E.vertexArrayOffset,E.groundVertexCount=this.groundEffect.vertexArray.length-E.groundVertexArrayOffset,0!==E.vertexCount){if(E.centroidXY=w.borders?_0:this.encodeCentroid(w,E),this.centroidData.push(E),w.borders){this.featuresOnBorder.push(w);const B=this.featuresOnBorder.length-1;for(let j=0;j<w.borders.length;j++)w.borders[j][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[j].push(B)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,l,c,a,f),this.groundEffect.addPaintPropertiesData(e,i,l,c,a,f),this.maxHeight=Math.max(this.maxHeight,C)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,i)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[i].borders[e][0])}encodeCentroid(e,n){const i=e.centroid(),a=n.span(),l=Math.min(7,Math.round(a.x*this.tileToMeter/10)),c=Math.min(7,Math.round(a.y*this.tileToMeter/10));return new ie(et(i.x,1,8191)<<3|l,et(i.y,1,8191)<<3|c)}showCentroid(e){const n=this.centroidData[e.centroidDataIndex];n.flags&=il,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const n=e.vertexArrayOffset,i=e.vertexCount+e.vertexArrayOffset,a=e.flags&il?_0:e.centroidXY,l=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==a.y||l!==a.x){for(let c=n;c<i;++c)this.centroidVertexArray.emplace(c,a.x,a.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const i=n.getReplacementRegionsForTile(e.toUnwrapped());if(function(l,c){if(l.length!==c.length)return!1;for(let h=0;h<l.length;h++)if(l[h].sourceId!==c[h].sourceId||!AE(l[h],c[h]))return!1;return!0}(this.activeReplacements,i))return;if(this.activeReplacements=i,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const l of this.centroidData)l.flags&=2147483647;const a=[];for(const l of this.activeReplacements){const c=Math.pow(2,l.footprintTileId.canonical.z-e.canonical.z);for(const h of this.centroidData)if(!(h.flags&il||l.min.x>h.max.x||h.min.x>l.max.x||l.min.y>h.max.y||h.min.y>l.max.y))for(let f=0;f<h.footprintSegLen;f++){const p=this.footprintSegments[h.footprintSegIdx+f];if(a.length=0,XM(this.footprintVertices,p.vertexOffset,p.vertexCount,l.footprintTileId.canonical,e.canonical,a),PE(l.footprint,a,this.footprintIndices.uint16,p.indexOffset,p.indexCount,-p.vertexOffset,-c)){h.flags|=il;break}}}for(const l of this.centroidData)this.writeCentroidToBuffer(l);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,i){let a=!1;for(let l=0;l<i.footprintSegLen;l++){const c=this.footprintSegments[i.footprintSegIdx+l];let h=0;for(const f of c.ringIndices){for(let p=h,g=f+h-1;p<f+h;g=p++){const _=this.footprintVertices.int16[2*(p+c.vertexOffset)+0],y=this.footprintVertices.int16[2*(p+c.vertexOffset)+1],v=this.footprintVertices.int16[2*(g+c.vertexOffset)+1];y>n!=v>n&&e<(this.footprintVertices.int16[2*(g+c.vertexOffset)+0]-_)*(n-y)/(v-y)+_&&(a=!a)}h=f}}return a}getHeightAtTileCoord(e,n){let i=Number.NEGATIVE_INFINITY,a=!0;const l=4*(e+he)*he+(n+he);if(this.partLookup.hasOwnProperty(l)){const c=this.partLookup[l];return c?{height:c.height,hidden:!!(c.flags&il)}:void 0}for(const c of this.centroidData)e>c.max.x||c.min.x>e||n>c.max.y||c.min.y>n||this.footprintContainsPoint(e,n,c)&&c&&c.height>i&&(i=c.height,this.partLookup[l]=c,a=!!(c.flags&il));if(i!==Number.NEGATIVE_INFINITY)return{height:i,hidden:a};this.partLookup[l]=void 0}}function NE(t,e){const n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function ZM(t,e,n,i){const a=e.sub(t)._perp()._unit(),l=n.sub(e)._perp()._unit();return zE(t,e,n,NE(a,l),i)}function zE(t,e,n,i,a){const l=Math.sqrt(1-i*i);return Math.min(t.dist(e)/3,e.dist(n)/3,a*l/i)}function w0(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function BE(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function VE(t,e,n){if(t.x<0||t.x>=he||e.x<0||e.x>=he||n.x<0||n.x>=he)return!1;const i=n.sub(e),a=i.perp(),l=t.sub(e);return(i.x*l.x+i.y*l.y)/Math.sqrt((i.x*i.x+i.y*i.y)*(l.x*l.x+l.y*l.y))>-.866&&a.x*l.x+a.y*l.y<0}function jE(t,e,n){const i=e?2|t:-3&t;return n?1|i:-2&i}function b0(){const t=Math.PI/32,e=Math.tan(t),n=da;return n*Math.sqrt(1+2*e*e)-n}function E0(t,e,n){const i=1<<n.z,a=Ao(n.x/i),l=Ao((n.x+1)/i),c=Gr(n.y/i),h=Gr((n.y+1)/i);return function(f,p,g,_,y=0,v){const w=[];if(!f.length||!g||!_)return w;const E=(k,L)=>{for(const B of k)w.push({polygon:B,bounds:L})},T=Math.ceil(Math.log2(g)),C=Math.ceil(Math.log2(_)),S=T-C,I=[];for(let k=0;k<Math.abs(S);k++)I.push(S>0?0:1);for(let k=0;k<Math.min(T,C);k++)I.push(0),I.push(1);let R=f;if(R=sg(R,p[0].y-y,p[1].y+y,1),R=sg(R,p[0].x-y,p[1].x+y,0),!R.length)return w;const A=[];for(I.length?A.push({polygons:R,bounds:p,depth:0}):E(R,p);A.length;){const k=A.pop(),L=k.depth,B=I[L],j=k.bounds[0],U=k.bounds[1],G=0===B?j.x:j.y,$=0===B?U.x:U.y,W=v?v(B,G,$):.5*(G+$),H=sg(k.polygons,G-y,W+y,B),J=sg(k.polygons,W-y,$+y,B);if(H.length){const te=[j,new ie(0===B?W:U.x,1===B?W:U.y)];I.length>L+1?A.push({polygons:H,bounds:te,depth:L+1}):E(H,te)}if(J.length){const te=[new ie(0===B?W:j.x,1===B?W:j.y),U];I.length>L+1?A.push({polygons:J,bounds:te,depth:L+1}):E(J,te)}}return w}(t,e,Math.ceil((l-a)/11.25),Math.ceil((c-h)/11.25),1,(f,p,g)=>{if(0===f)return.5*(p+g);{const _=Gr((n.y+p/he)/i);return(gi(.5*(Gr((n.y+g/he)/i)+_))*i-n.y)*he}})}function XM(t,e,n,i,a,l){const c=Math.pow(2,i.z-a.z);for(let h=0;h<n;h++){let f=t.int16[2*(h+e)+0],p=t.int16[2*(h+e)+1];f=(f+a.x*he)*c-i.x*he,p=(p+a.y*he)*c-i.y*he,l.push(new ie(f,p))}}Qe(lp,"FillExtrusionBucket",{omit:["layers","features"]}),Qe(OE,"PartData"),Qe(y0,"FootprintSegment"),Qe(LE,"BorderCentroidData"),Qe(x0,"GroundEffect");const YM=new mr({visibility:new Re(le["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Re(le["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var UE={paint:new mr({"fill-extrusion-opacity":new Re(le["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new lt(le["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Re(le["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Re(le["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new lt(le["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new lt(le["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new lt(le["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Re(le["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Re(le["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Re(le["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Re(le["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Re(le["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Re(le["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Re(le["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Re(le["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new lt(le["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new lt(le["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Re(le["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Re(le["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Re(le["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Re(le["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"])}),layout:YM};class fd extends ie{constructor(e,n,i){super(e,n),this.z=i}}function cp(t,e){return t.x*e.x+t.y*e.y}function $E(t,e){if(1===t.length){let n=0;const i=e[n++];let a;for(;!a||i.equals(a);)if(a=e[n++],!a)return 1/0;for(;n<e.length;n++){const l=e[n],c=t[0],h=a.sub(i),f=l.sub(i),p=c.sub(i),g=cp(h,h),_=cp(h,f),y=cp(f,f),v=cp(p,h),w=cp(p,f),E=g*y-_*_,T=(y*v-_*w)/E,C=(g*w-_*v)/E,S=i.z*(1-T-C)+a.z*T+l.z*C;if(isFinite(S))return S}return 1/0}{let n=1/0;for(const i of e)n=Math.min(n,i.z);return n}}function Ug(t,e,n,i,a,l,c,h){const f=c*a.getElevationAt(t,e,!0,!0),p=0!==l[0],g=p?0===l[1]?c*(l[0]/7-450):c*function(_,y,v){const w=Math.floor(y[0]/8),E=Math.floor(y[1]/8),T=10*(y[0]-8*w),C=10*(y[1]-8*E),S=_.getElevationAt(w,E,!0,!0),I=_.getMeterToDEM(v),R=Math.floor(.5*(T*I-1)),A=Math.floor(.5*(C*I-1)),k=_.tileCoordToPixel(w,E),L=2*R+1,B=2*A+1,j=(K=L,Q=B,[(J=_).getElevationAtPixel(te=k.x-R,oe=k.y-A,!0),J.getElevationAtPixel(te+Q,oe,!0),J.getElevationAtPixel(te,oe+Q,!0),J.getElevationAtPixel(te+K,oe+Q,!0)]),U=Math.abs(j[0]-j[1]),G=Math.abs(j[2]-j[3]),$=Math.abs(j[0]-j[2])+Math.abs(j[1]-j[3]),W=Math.min(.25,.5*I*(U+G)/L),H=Math.min(.25,.5*I*$/B);var J,te,oe,K,Q;return S+Math.max(W*T,H*C)}(a,l,h):f;return{base:f+(0===n)?-1:n,top:p?Math.max(g+i,f+n+2):f+i}}const C0=new mr({"line-cap":new lt(le.layout_line["line-cap"]),"line-join":new lt(le.layout_line["line-join"]),"line-miter-limit":new Re(le.layout_line["line-miter-limit"]),"line-round-limit":new Re(le.layout_line["line-round-limit"]),"line-sort-key":new lt(le.layout_line["line-sort-key"]),visibility:new Re(le.layout_line.visibility)});var T0={paint:new mr({"line-opacity":new lt(le.paint_line["line-opacity"]),"line-color":new lt(le.paint_line["line-color"]),"line-translate":new Re(le.paint_line["line-translate"]),"line-translate-anchor":new Re(le.paint_line["line-translate-anchor"]),"line-width":new lt(le.paint_line["line-width"]),"line-gap-width":new lt(le.paint_line["line-gap-width"]),"line-offset":new lt(le.paint_line["line-offset"]),"line-blur":new lt(le.paint_line["line-blur"]),"line-dasharray":new lt(le.paint_line["line-dasharray"]),"line-pattern":new lt(le.paint_line["line-pattern"]),"line-gradient":new gm(le.paint_line["line-gradient"]),"line-trim-offset":new Re(le.paint_line["line-trim-offset"]),"line-emissive-strength":new Re(le.paint_line["line-emissive-strength"]),"line-border-width":new lt(le.paint_line["line-border-width"]),"line-border-color":new lt(le.paint_line["line-border-color"])}),layout:C0};const D0=(t,e,n,i,a,l,c)=>{const h=t.transform,f=h.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:$g(t,e,n,i),u_pixels_to_tile_units:f,u_device_pixel_ratio:l,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:a,u_texsize:Fr(n)?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:HE(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:c,u_emissive_strength:n.paint.get("line-emissive-strength")}},KM=(t,e,n,i,a)=>{const l=t.transform;return{u_matrix:$g(t,e,n,i),u_texsize:e.imageAtlasTexture.size,u_pixels_to_tile_units:l.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:a,u_image:0,u_tile_units_to_pixels:HE(e,l),u_units_to_pixels:[1/l.pixelsToGLUnits[0],1/l.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function HE(t,e){return 1/rl(t,1,e.tileZoom)}function $g(t,e,n,i){return t.translatePosMatrix(i||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const GE=t=>{const e=[];Fr(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const n=t.paint.get("line-trim-offset");return 0===n[0]&&0===n[1]||e.push("RENDER_LINE_TRIM_OFFSET"),0!==t.paint.get("line-border-width").constantOr(1)&&e.push("RENDER_LINE_BORDER"),e};function Fr(t){const e=t.paint.get("line-dasharray").value;return e.value||"constant"!==e.kind}const Lc=new class extends lt{possiblyEvaluate(t,e){return e=new pr(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,i){return e=Ke({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,i)}}(T0.paint.properties["line-width"].specification);function M0(t,e){return e>0?e+2*t:t}Lc.useIntegerZoom=!0;const JM=new mr({visibility:new Re(le.layout_background.visibility)});var TI={paint:new mr({"background-color":new Re(le.paint_background["background-color"]),"background-pattern":new Re(le.paint_background["background-pattern"]),"background-opacity":new Re(le.paint_background["background-opacity"]),"background-emissive-strength":new Re(le.paint_background["background-emissive-strength"])}),layout:JM};const qE=new mr({visibility:new Re(le.layout_raster.visibility)});var S0={paint:new mr({"raster-opacity":new Re(le.paint_raster["raster-opacity"]),"raster-color":new gm(le.paint_raster["raster-color"]),"raster-color-mix":new Re(le.paint_raster["raster-color-mix"]),"raster-color-range":new Re(le.paint_raster["raster-color-range"]),"raster-hue-rotate":new Re(le.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Re(le.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Re(le.paint_raster["raster-brightness-max"]),"raster-saturation":new Re(le.paint_raster["raster-saturation"]),"raster-contrast":new Re(le.paint_raster["raster-contrast"]),"raster-resampling":new Re(le.paint_raster["raster-resampling"]),"raster-fade-duration":new Re(le.paint_raster["raster-fade-duration"])}),layout:qE};function WE(t,e,n,i,a,l,c,h){const f=[t,n,a,e,i,l,1,1,1],p=[c,h,1],g=Mo.adjoint([],f),[_,y,v]=Z.transformMat3(p,p,Mo.transpose(g,g));return Mo.multiply(f,[_,0,0,0,y,0,0,0,v],f)}class gs extends Mn{constructor(e,n,i,a){super(),this.id=e,this.dispatcher=i,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(a),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new Se("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=vt(this.map._requestManager.transformRequest(this.url,_e.Image),(i,a)=>{if(this._imageRequest=null,this._loaded=!0,i)this.fire(new xt(i));else if(a){const{HTMLImageElement:l}=ce;this.image=a instanceof l?Ct.getImageData(a):a,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading()}})}loaded(){return this._loaded}updateImage(e){return this.image&&e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Ag(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Se("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Ag||this.texture.destroy()}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],i=e[0][1];for(const l of e)l[1]>i&&(i=l[1]),l[1]<n&&(n=l[1]);const a=(i+n)/2;if(a>Mr?this.onNorthPole=!0:a<-Mr&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const l=e.map(nn.fromLngLat);this.tileID=function(c){let h=1/0,f=1/0,p=-1/0,g=-1/0;for(const w of c)h=Math.min(h,w.x),f=Math.min(f,w.y),p=Math.max(p,w.x),g=Math.max(g,w.y);const _=Math.max(p-h,g-f),y=Math.max(0,Math.floor(-Math.log(_)/Math.LN2)),v=Math.pow(2,y);return new Ls(y,Math.floor((h+p)/2*v),Math.floor((f+g)/2*v))}(l),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Se("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(e){for(const f in this.tiles){const p=this.tiles[f];"loaded"!==p.state&&(p.state="loaded",p.texture=this.texture)}if(this._boundsArray)return;const n=Po(this.tileID,this.map.transform.projection),[i,a,l,c]=this.coordinates.map(f=>{const p=n.projection.project(f[0],f[1]);return Fb(n,p)._round()});this.perspectiveTransform=function(f,p,g,_,y,v,w,E,T,C){const S=WE(0,0,f,0,0,p,f,p),I=WE(g,_,y,v,w,E,T,C);return Mo.multiply(I,Mo.adjoint(S,S),I),[I[6]/I[8]*f/he,I[7]/I[8]*p/he]}(this.width,this.height,i.x,i.y,a.x,a.y,c.x,c.y,l.x,l.y);const h=this._boundsArray=new $a;h.emplaceBack(i.x,i.y,0,0),h.emplaceBack(a.x,a.y,he,0),h.emplaceBack(c.x,c.y,0,he),h.emplaceBack(l.x,l.y,he,he),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=e.createVertexBuffer(h,Yv.members),this.boundsSegments=Cn.simpleSegment(0,0,4,2)}prepare(){const e=0!==Object.keys(this.tiles).length;if(this.tileID&&!e)return;const n=this.map.painter.context,i=n.gl;!this._dirty||this.texture instanceof Ag||(this.texture?this.texture.update(this.image):(this.texture=new Wr(n,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class QM extends ks{constructor(e){super(e,{}),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(e){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const ZE=new mr({visibility:new Re(le.layout_sky.visibility)});var A0={paint:new mr({"sky-type":new Re(le.paint_sky["sky-type"]),"sky-atmosphere-sun":new Re(le.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Re(le.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Re(le.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Re(le.paint_sky["sky-gradient-radius"]),"sky-gradient":new gm(le.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Re(le.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Re(le.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Re(le.paint_sky["sky-opacity"])}),layout:ZE};function Hg(t,e,n){const i=[0,0,1],a=Mi.identity([]);return Mi.rotateY(a,a,n?-At(t)+Math.PI:At(t)),Mi.rotateX(a,a,-At(e)),Z.transformQuat(i,i,a),Z.normalize(i,i)}var XE={paint:new mr({})};const YE={circle:class extends ks{constructor(t,e){super(t,lI,e)}createBucket(t){return new iv(t)}queryRadius(t){const e=t;return Of("circle-radius",this,e)+Of("circle-stroke-width",this,e)+uv(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,i,a,l,c,h){const f=Zw(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),p=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return hv(t,i,l,c,h,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),f,p)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){const n=Yw(this);return{config:new bu(this,e),defines:n,overrideFog:!1}}},heatmap:class extends ks{createBucket(t){return new Qw(t)}constructor(t,e){super(t,pv,e),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=mv({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Of("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,i,a,l,c,h){const f=this.paint.get("heatmap-radius").evaluate(e,n);return hv(t,i,l,c,h,!0,!0,new ie(0,0),f)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return"heatmap"===t?{config:new bu(this,e),overrideFog:!1}:{}}},hillshade:class extends ks{constructor(t,e){super(t,WD,e)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends ks{constructor(t,e){super(t,fI,e)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(t,e){return{config:new bu(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Cv(t)}queryRadius(){return uv(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,i,a,l){return!t.queryGeometry.isAboveHorizon&&Hw(HD(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),i)}isTileClipped(){return!0}},"fill-extrusion":class extends ks{constructor(t,e){super(t,UE,e)}createBucket(t){return new lp(t)}queryRadius(){return uv(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,n,i,a,l,c,h,f){const p=Zw(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),g=this.paint.get("fill-extrusion-height").evaluate(e,n),_=this.paint.get("fill-extrusion-base").evaluate(e,n),y=[0,0],v=h&&l.elevation,w=l.elevation?l.elevation.exaggeration():1,E=t.tile.getBucket(this);if(v&&E instanceof lp){const R=E.centroidVertexArray,A=f+1;A<R.length&&(y[0]=R.geta_centroid_pos0(A),y[1]=R.geta_centroid_pos1(A))}if(0===y[0]&&1===y[1])return!1;"globe"===l.projection.name&&(i=E0([i],[new ie(0,0),new ie(he,he)],t.tileID.canonical).map(R=>R.polygon).flat());const T=v?h:null,[C,S]=(A=i,k=_,L=g,B=p,j=c,U=T,G=y,$=w,W=l.center.lat,"globe"===(R=l).projection.name?function(J,te,oe,K,Q,ae,ue,fe,ge,ve,de){const me=[],Oe=[],qe=J.projection.upVectorScale(de,J.center.lat,J.worldSize).metersToTile,Ge=[0,0,0,1],We=[0,0,0,1],it=(zt,an,Ft,Dt)=>{zt[0]=an,zt[1]=Ft,zt[2]=Dt,zt[3]=1},gt=b0();oe>0&&(oe+=gt),K+=gt;for(const zt of te){const an=[],Ft=[];for(const Dt of zt){const pt=Dt.x+Q.x,ut=Dt.y+Q.y,Kt=J.projection.projectTilePoint(pt,ut,de),dn=J.projection.upVector(de,Dt.x,Dt.y);let Bt=oe,Rn=K;if(ue){const Jn=Ug(pt,ut,oe,K,ue,fe,ge,ve);Bt+=Jn.base,Rn+=Jn.top}0!==oe?it(Ge,Kt.x+dn[0]*qe*Bt,Kt.y+dn[1]*qe*Bt,Kt.z+dn[2]*qe*Bt):it(Ge,Kt.x,Kt.y,Kt.z),it(We,Kt.x+dn[0]*qe*Rn,Kt.y+dn[1]*qe*Rn,Kt.z+dn[2]*qe*Rn),Z.transformMat4(Ge,Ge,ae),Z.transformMat4(We,We,ae),an.push(new fd(Ge[0],Ge[1],Ge[2])),Ft.push(new fd(We[0],We[1],We[2]))}me.push(an),Oe.push(Ft)}return[me,Oe]}(R,A,k,L,B,j,U,G,$,W,t.tileID.canonical):U?function(J,te,oe,K,Q,ae,ue,fe,ge){const ve=[],de=[],me=[0,0,0,1];for(const Oe of J){const qe=[],Ge=[];for(const We of Oe){const it=We.x+K.x,gt=We.y+K.y,zt=Ug(it,gt,te,oe,ae,ue,fe,ge);me[0]=it,me[1]=gt,me[2]=zt.base,me[3]=1,bn.transformMat4(me,me,Q),me[3]=Math.max(me[3],1e-5);const an=new fd(me[0]/me[3],me[1]/me[3],me[2]/me[3]);me[0]=it,me[1]=gt,me[2]=zt.top,me[3]=1,bn.transformMat4(me,me,Q),me[3]=Math.max(me[3],1e-5);const Ft=new fd(me[0]/me[3],me[1]/me[3],me[2]/me[3]);qe.push(an),Ge.push(Ft)}ve.push(qe),de.push(Ge)}return[ve,de]}(A,k,L,B,j,U,G,$,W):function(J,te,oe,K,Q){const ae=[],ue=[],fe=Q[8]*te,ge=Q[9]*te,ve=Q[10]*te,de=Q[11]*te,me=Q[8]*oe,Oe=Q[9]*oe,qe=Q[10]*oe,Ge=Q[11]*oe;for(const We of J){const it=[],gt=[];for(const zt of We){const an=zt.x+K.x,Ft=zt.y+K.y,Dt=Q[0]*an+Q[4]*Ft+Q[12],pt=Q[1]*an+Q[5]*Ft+Q[13],ut=Q[2]*an+Q[6]*Ft+Q[14],Kt=Q[3]*an+Q[7]*Ft+Q[15],dn=Dt+fe,Bt=pt+ge,Rn=ut+ve,Jn=Math.max(Kt+de,1e-5),Xn=Dt+me,Hn=pt+Oe,Nr=ut+qe,Qn=Math.max(Kt+Ge,1e-5);it.push(new fd(dn/Jn,Bt/Jn,Rn/Jn)),gt.push(new fd(Xn/Qn,Hn/Qn,Nr/Qn))}ae.push(it),ue.push(gt)}return[ae,ue]}(A,k,L,B,j)),I=t.queryGeometry;var R,A,k,L,B,j,U,G,$,W;return function(R,A,k){let L=1/0;Hw(k,A)&&(L=$E(k,A[0]));for(let B=0;B<A.length;B++){const j=A[B],U=R[B];for(let G=0;G<j.length-1;G++){const $=j[G],W=[$,j[G+1],U[G+1],U[G],$];Uw(k,W)&&(L=Math.min(L,$E(k,W)))}}return L!==1/0&&L}(C,S,I.isPointQuery()?I.screenBounds:I.screenGeometry)}},line:class extends ks{constructor(t,e){super(t,T0,e),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof em,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=Lc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Hl(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){const n=GE(this);return{config:new bu(this,e),defines:n,overrideFog:!1}}queryRadius(t){const e=t,n=M0(Of("line-width",this,e),Of("line-gap-width",this,e)),i=Of("line-offset",this,e);return n/2+Math.abs(i)+uv(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,i,a,l){if(t.queryGeometry.isAboveHorizon)return!1;const c=HD(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),h=t.pixelToTileUnitsFactor/2*M0(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),f=this.paint.get("line-offset").evaluate(e,n);return f&&(i=function(p,g){const _=[],y=new ie(0,0);for(let v=0;v<p.length;v++){const w=p[v],E=[];for(let T=0;T<w.length;T++){const C=w[T],S=w[T+1],I=0===T?y:C.sub(w[T-1])._unit()._perp(),R=T===w.length-1?y:S.sub(C)._unit()._perp(),A=I._add(R)._unit();A._mult(1/(A.x*R.x+A.y*R.y)),E.push(A._mult(g)._add(C))}_.push(E)}return _}(i,f*t.pixelToTileUnitsFactor)),function(p,g,_){for(let y=0;y<g.length;y++){const v=g[y];if(p.length>=3)for(let w=0;w<v.length;w++)if(_i(p,v[w]))return!0;if(Gw(p,v,_))return!0}return!1}(c,i,h)}isTileClipped(){return!0}},symbol:Kf,background:class extends ks{constructor(t,e){super(t,TI,e)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:class extends ks{constructor(t,e){super(t,S0,e),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(t){return!(t&&t._source instanceof gs&&(t._source.onNorthPole||t._source.onSouthPole))}_handleSpecialPaintPropertyUpdate(t){"raster-color"!==t&&"raster-color-range"!==t||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-color"].value.expression,[e,n]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=mv({expression:t,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:e,end:n}],resolution:256}),this.colorRampTexture=null}},sky:class extends ks{constructor(t,e){super(t,A0,e),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=mv({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if("atmosphere"===this.paint.get("sky-type")){const i=this.paint.get("sky-atmosphere-sun"),a=!i,l=t.style.light,c=l.properties.get("position");return a&&"viewport"===l.properties.get("anchor")&&ee("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?Hg(c.azimuthal,90-c.polar,e):Hg(i[0],90-i[1],e)}const n=this.paint.get("sky-gradient-center");return Hg(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}},slot:class extends ks{constructor(t,e){super(t,XE)}},model:class extends ks{constructor(t,e){super(t,CI,e)}createBucket(t){return new TE(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||"model-color"!==t&&"model-color-mix-intensity"!==t&&"model-rotation"!==t&&"model-scale"!==t&&"model-translation"!==t&&"model-emissive-strength"!==t)}_isPropertyZoomDependent(t){const e=this._transitionablePaint._values[t];return null!=e&&null!=e.value&&null!=e.value.expression&&e.value.expression instanceof ei}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};function up(t,e){return"custom"===t.type?new QM(t):new YE[t.type](t,e)}function e2(t){const{userImage:e}=t;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}class t2 extends Mn{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(e){this.images[e]={},this.loaded[e]=!1,this.updatedImages[e]={},this.patterns[e]={},this.callbackDispatchedThisFrame[e]={},this.atlasImage[e]=new Sr({width:1,height:1})}isLoaded(){for(const e in this.loaded)if(!this.loaded[e])return!1;return!0}setLoaded(e,n){if(this.loaded[n]!==e&&(this.loaded[n]=e,e)){for(const{ids:i,callback:a}of this.requestors)this._notify(i,n,a);this.requestors=[]}}hasImage(e,n){return!!this.getImage(e,n)}getImage(e,n){return this.images[n][e]}addImage(e,n,i){this._validate(e,i)&&(this.images[n][e]=i)}_validate(e,n){let i=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new xt(new Error(`Image "${e}" has invalid "stretchX" value`))),i=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new xt(new Error(`Image "${e}" has invalid "stretchY" value`))),i=!1),this._validateContent(n.content,n)||(this.fire(new xt(new Error(`Image "${e}" has invalid "content" value`))),i=!1),i}_validateStretch(e,n){if(!e)return!0;let i=0;for(const a of e){if(a[0]<i||a[1]<a[0]||n<a[1])return!1;i=a[1]}return!0}_validateContent(e,n){return!(e&&(4!==e.length||e[0]<0||n.data.width<e[0]||e[1]<0||n.data.height<e[1]||e[2]<0||n.data.width<e[2]||e[3]<0||n.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,n,i){i.version=this.images[n][e].version+1,this.images[n][e]=i,this.updatedImages[n][e]=!0}removeImage(e,n){const i=this.images[n][e];delete this.images[n][e],delete this.patterns[n][e],i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(e){return Object.keys(this.images[e])}getImages(e,n,i){let a=!0;const l=!!this.loaded[n];if(!l)for(const c of e)this.images[n][c]||(a=!1);l||a?this._notify(e,n,i):this.requestors.push({ids:e,scope:n,callback:i})}getUpdatedImages(e){return this.updatedImages[e]}_notify(e,n,i){const a={};for(const l of e){this.images[n][l]||this.fire(new Se("styleimagemissing",{id:l}));const c=this.images[n][l];c?a[l]={data:c.data.clone(),pixelRatio:c.pixelRatio,sdf:c.sdf,version:c.version,stretchX:c.stretchX,stretchY:c.stretchY,content:c.content,hasRenderCallback:Boolean(c.userImage&&c.userImage.render)}:ee(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}i(null,a)}getPixelSize(e){const{width:n,height:i}=this.atlasImage[e];return{width:n,height:i}}getPattern(e,n){const i=this.patterns[n][e],a=this.getImage(e,n);if(!a)return null;if(i&&i.position.version===a.version)return i.position;if(i)i.position.version=a.version;else{const l={w:a.data.width+2,h:a.data.height+2,x:0,y:0},c=new Bv(l,a);this.patterns[n][e]={bin:l,position:c}}return this._updatePatternAtlas(n),this.patterns[n][e].position}bind(e,n){const i=e.gl;let a=this.atlasTexture[n];a?this.dirty&&(a.update(this.atlasImage[n]),this.dirty=!1):(a=new Wr(e,this.atlasImage[n],i.RGBA),this.atlasTexture[n]=a),a.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(e){const n=[];for(const c in this.patterns[e])n.push(this.patterns[e][c].bin);const{w:i,h:a}=gg(n),l=this.atlasImage[e];l.resize({width:i||1,height:a||1});for(const c in this.patterns[e]){const{bin:h}=this.patterns[e][c],f=h.x+1,p=h.y+1,g=this.images[e][c].data,_=g.width,y=g.height;Sr.copy(g,l,{x:0,y:0},{x:f,y:p},{width:_,height:y}),Sr.copy(g,l,{x:0,y:y-1},{x:f,y:p-1},{width:_,height:1}),Sr.copy(g,l,{x:0,y:0},{x:f,y:p+y},{width:_,height:1}),Sr.copy(g,l,{x:_-1,y:0},{x:f-1,y:p},{width:1,height:y}),Sr.copy(g,l,{x:0,y:0},{x:f+_,y:p},{width:1,height:y})}this.dirty=!0}beginFrame(){for(const e in this.images)this.callbackDispatchedThisFrame[e]={}}dispatchRenderCallbacks(e,n){for(const i of e){if(this.callbackDispatchedThisFrame[n][i])continue;this.callbackDispatchedThisFrame[n][i]=!0;const a=this.images[n][i];e2(a)&&this.updateImage(i,n,a)}}}const n2=new mr({anchor:new Re(le.light.anchor),position:new class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return Ae(t.expression.evaluate(e))}interpolate(t,e,n){return{x:wt(t.x,e.x,n),y:wt(t.y,e.y,n),z:wt(t.z,e.z,n),azimuthal:wt(t.azimuthal,e.azimuthal,n),polar:wt(t.polar,e.polar,n)}}}(le.light.position),color:new Re(le.light.color),intensity:new Re(le.light.intensity)});class KE extends Mn{constructor(e,n="flat"){super(),this._transitionable=new ds(n2),this.setLight(e,n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,n,i={}){this._validate(cm,e,i)||(this._transitionable.setTransitionOrValue(e),this.id=n)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,i){return(!i||!1!==i.validate)&&fm(this,e.call(mc,Ke({value:n,style:{glyphs:!0,sprite:!0},styleSpec:le})))}}const JE=new mr({source:new Re(le.terrain.source),exaggeration:new Re(le.terrain.exaggeration)});let DI=class extends Mn{constructor(t,e){super(),this._transitionable=new ds(JE),this.set(t),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=e}setScope(t){this.scope=t}get(){return this._transitionable.serialize()}set(t){this._transitionable.setTransitionOrValue(t)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}getExaggeration(t){return this._transitioning.possiblyEvaluate(new pr(t)).get("exaggeration")}isZoomDependent(){const t=this._transitionable._values.exaggeration;return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof ei}};const Fu=.05;function P0(t,e,n,i){const a=Cs(45,65,n),[l,c]=r2(t,i);let h=1-Math.min(1,Math.exp((e-l)/(c-l)*-6));return h*=h*h,h=Math.min(1,1.00747*h),h*a*t.alpha}function r2(t,e){const n=.5/Math.tan(.5*e);return[t.range[0]+n,t.range[1]+n]}function eC(t,e,n,i,a){const l=Z.transformMat4([],[e,n,i],a.mercatorFogMatrix);return P0(t,Z.length(l),a.pitch,a._fov)}function tC(t,e,n,i,a,l,c){const h=[[n,i,0],[a,i,0],[a,l,0],[n,l,0]];let f=Number.MAX_VALUE,p=-Number.MAX_VALUE;for(const g of h){const _=Z.transformMat4([],g,e),y=Z.length(_);f=Math.min(f,y),p=Math.max(p,y)}return[P0(t,f,c.pitch,c._fov),P0(t,p,c.pitch,c._fov)]}const i2=new mr({range:new Re(le.fog.range),color:new Re(le.fog.color),"high-color":new Re(le.fog["high-color"]),"space-color":new Re(le.fog["space-color"]),"horizon-blend":new Re(le.fog["horizon-blend"]),"star-intensity":new Re(le.fog["star-intensity"]),"vertical-range":new Re(le.fog["vertical-range"])});class o2 extends Mn{constructor(e,n){super(),this._transitionable=new ds(i2),this.set(e),this._transitioning=this._transitionable.untransitioned(),this._transform=n}get state(){const e=this._transform,n="globe"===e.projection.name,i=ni(e.zoom),a=this.properties.get("range"),l=[.5,3];return{range:n?[wt(l[0],a[0],i),wt(l[1],a[1],i)]:a,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(e,n={}){if(this._validate(C1,e,n))return;const i=Ke({},e);for(const a of Object.keys(le.fog))void 0===i[a]&&(i[a]=le.fog[a].default);this._transitionable.setTransitionOrValue(i)}getOpacity(e){if(!this._transform.projection.supportsFog)return 0;const n=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:Cs(45,65,e))*n.a}getOpacityAtLatLng(e,n){return this._transform.projection.supportsFog?function(i,a,l){const c=nn.fromLngLat(a),h=l.elevation?l.elevation.getAtPointOrZero(c):0;return eC(i,c.x,c.y,h,l)}(this.state,e,n):0}getOpacityForTile(e){if(!this._transform.projection.supportsFog)return[1,1];const n=this._transform.calculateFogTileMatrix(e.toUnwrapped());return tC(this.state,n,0,0,he,he,this._transform)}getOpacityForBounds(e,n,i,a,l){return this._transform.projection.supportsFog?tC(this.state,e,n,i,a,l,this._transform):[1,1]}getFovAdjustedRange(e){return this._transform.projection.supportsFog?r2(this.state,e):[0,1]}isVisibleOnFrustum(e){if(!this._transform.projection.supportsFog)return!1;const n=[4,5,6,7];for(const i of n){const a=e.points[i];let l;if(a[2]>=0)l=a;else{const c=e.points[i-4];l=Fa(c,a,c[2]/(c[2]-a[2]))}if(eC(this.state,l[0],l[1],0,this._transform)>=Fu)return!0}return!1}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,i){return(!i||!1!==i.validate)&&fm(this,e.call(mc,Ke({value:n,style:{glyphs:!0,sprite:!0},styleSpec:le})))}}class s2{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class a2{constructor(){this.tasks={},this.taskQueue=[],Xr(["process"],this),this.invoker=new s2(this.process),this.nextId=0}add(e,n){const i=this.nextId++,a=function({type:l,isSymbolTile:c,zoom:h}){return h=h||0,"message"===l?0:"maybePrepare"!==l||c?"parseTile"!==l||c?"parseTile"===l&&c?300-h:"maybePrepare"===l&&c?400-h:500:200-h:100-h}(n);if(0===a){De();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[i]={fn:e,metadata:n,priority:a,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}}}process(){De();try{if(this.taskQueue=this.taskQueue.filter(i=>!!this.tasks[i]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let a=0;a<this.taskQueue.length;a++){const l=this.tasks[this.taskQueue[a]];l.priority<n&&(n=l.priority,e=a)}if(null===e)return null;const i=this.taskQueue[e];return this.taskQueue.splice(e,1),i}remove(){this.invoker.remove()}}class nC{constructor(e,n,i){this.target=e,this.parent=n,this.mapId=i,this.callbacks={},this.cancelCallbacks={},Xr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new a2}send(e,n,i,a,l=!1,c){const h=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=c,this.callbacks[h]=i);const f=new Set;return this.target.postMessage({id:h,type:e,hasCallback:!!i,targetMapId:a,mustQueue:l,sourceMapId:this.mapId,data:Ua(n,f)},f),{cancel:()=>{i&&delete this.callbacks[h],this.target.postMessage({id:h,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(e){const n=e.data,i=n.id;if(i&&(!n.targetMapId||this.mapId===n.targetMapId))if("<cancel>"===n.type){const a=this.cancelCallbacks[i];delete this.cancelCallbacks[i],a&&a.cancel()}else if(n.mustQueue||De()){const a=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,n),a&&a.metadata||{type:"message"})}else this.processTask(i,n)}processTask(e,n){if("<response>"===n.type){const i=this.callbacks[e];delete this.callbacks[e],i&&(n.error?i(oa(n.error)):i(null,oa(n.data)))}else{const i=new Set,a=n.hasCallback?(c,h)=>{delete this.cancelCallbacks[e],this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:c?Ua(c):null,data:Ua(h,i)},i)}:c=>{},l=oa(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,l,a);else if(this.parent.getWorkerSource){const c=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,c[0],l.source,l.scope)[c[1]](l,a)}else a(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let Gg=(()=>{class t{constructor(n,i){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=vr();const a=this.workerPool.acquire(this.id);for(let l=0;l<a.length;l++){const c=new t.Actor(a[l],i,this.id);c.name=`Worker ${l}`,this.actors.push(c)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,i,a){gl(this.actors,(l,c)=>{l.send(n,i,c)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}return t.Actor=nC,t})();class rC extends Mn{constructor(e,n,i,a){super(),this.scope=i,this._options=e,this.properties=new yf(n),this._transitionable=new ds(n,new Map(a)),this._transitionable.setTransitionOrValue(e.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(e){this._transitionable.setTransitionOrValue(this._options.properties,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(e,n){this._options=e,this._transitionable.setTransitionOrValue(e.properties,n)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}const l2=new mr({color:new Re(le.properties_light_ambient.color),intensity:new Re(le.properties_light_ambient.intensity)}),c2=new mr({direction:new class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([n,i]){const a=Ae([1,n,i]);return{x:a.x,y:a.y,z:a.z}}(t.expression.evaluate(e))}interpolate(t,e,n){return{x:wt(t.x,e.x,n),y:wt(t.y,e.y,n),z:wt(t.z,e.z,n)}}}(le.properties_light_directional.direction),color:new Re(le.properties_light_directional.color),intensity:new Re(le.properties_light_directional.intensity),"cast-shadows":new Re(le.properties_light_directional["cast-shadows"]),"shadow-intensity":new Re(le.properties_light_directional["shadow-intensity"])});class R0{constructor(e,n,i,a){this.screenBounds=e,this.cameraPoint=n,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=i,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,a)}static createFromScreenPoints(e,n){let i,a;if(e instanceof ie||"number"==typeof e[0]){const l=ie.convert(e);i=[l],a=n.isPointAboveHorizon(l)}else{const l=ie.convert(e[0]),c=ie.convert(e[1]);i=[l,c],a=ml(l,c).every(h=>n.isPointAboveHorizon(h))}return new R0(i,n.getCameraPoint(),a,n)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(e){return ml(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],e)}bufferedCameraGeometry(e){const n=this.screenBounds[0],i=1===this.screenBounds.length?this.screenBounds[0].add(new ie(1,1)):this.screenBounds[1],a=ml(n,i,0,!1);return this.cameraPoint.y>i.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<i.x?a.splice(3,0,this.cameraPoint):this.cameraPoint.x>=i.x?a[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(a[3]=this.cameraPoint)),function(l,c){const h=[];for(let f=0;f<l.length;f++){const p=ts(f-1,-1,l.length-1),g=ts(f+1,-1,l.length-1),_=l[f],y=l[g],v=l[p].sub(_).unit(),w=y.sub(_).unit(),E=w.angleWithSep(v.x,v.y),T=v.add(w).unit().mult(-1*c/Math.sin(E/2));h.push(_.add(T))}return h}(a,e)}bufferedCameraGeometryGlobe(e){const n=this.screenBounds[0],i=1===this.screenBounds.length?this.screenBounds[0].add(new ie(1,1)):this.screenBounds[1],a=ml(n,i,e),l=this.cameraPoint.clone();switch(3*((l.y>n.y)+(l.y>i.y))+((l.x>n.x)+(l.x>i.x))){case 0:a[0]=l,a[4]=l.clone();break;case 1:a.splice(1,0,l);break;case 2:a[1]=l;break;case 3:a.splice(4,0,l);break;case 5:a.splice(2,0,l);break;case 6:a[3]=l;break;case 7:a.splice(3,0,l);break;case 8:a[2]=l}return a}containsTile(e,n,i,a=0){const l=e.queryPadding/n._pixelsPerMercatorPixel+1,c=i?this._bufferedCameraMercator(l,n):this._bufferedScreenMercator(l,n);let h=e.tileID.wrap+(c.unwrapped?a:0);const f=c.polygon.map(T=>Fb(e.tileTransform,T,h));if(!Ww(f,0,0,he,he))return;h=e.tileID.wrap+(this.screenGeometryMercator.unwrapped?a:0);const p=this.screenGeometryMercator.polygon.map(T=>yo(e.tileTransform,T,h)),g=p.map(T=>new ie(T[0],T[1])),_=n.getFreeCameraOptions().position||new nn(0,0,0),y=yo(e.tileTransform,_,h),v=p.map(T=>{const C=Z.sub(T,T,y);return Z.normalize(C,C),new Mf(y,C)}),w=rl(e,1,n.zoom)*n._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:g,tilespaceRays:v,bufferedTilespaceGeometry:f,bufferedTilespaceBounds:(E=qs(f),E.min.x=et(E.min.x,0,he),E.min.y=et(E.min.y,0,he),E.max.x=et(E.max.x,0,he),E.max.y=et(E.max.y,0,he),E),tile:e,tileID:e.tileID,pixelToTileUnitsFactor:w};var E}_bufferedScreenMercator(e,n){const i=k0(e);if(this._screenRaycastCache[i])return this._screenRaycastCache[i];{let a;return a="globe"===n.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),n):{polygon:this.bufferedScreenGeometry(e).map(l=>n.pointCoordinate3D(l)),unwrapped:!0},this._screenRaycastCache[i]=a,a}}_bufferedCameraMercator(e,n){const i=k0(e);if(this._cameraRaycastCache[i])return this._cameraRaycastCache[i];{let a;return a="globe"===n.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),n):{polygon:this.bufferedCameraGeometry(e).map(l=>n.pointCoordinate3D(l)),unwrapped:!0},this._cameraRaycastCache[i]=a,a}}_projectAndResample(e,n){const i=function(l,c){const h=se.multiply([],c.pixelMatrix,c.globeMatrix),f=[0,-Fi,0,1],p=[0,Fi,0,1],g=[0,0,0,1];bn.transformMat4(f,f,h),bn.transformMat4(p,p,h),bn.transformMat4(g,g,h);const _=new ie(f[0]/f[3],f[1]/f[3]),y=new ie(p[0]/p[3],p[1]/p[3]),v=_i(l,_)&&f[3]<g[3],w=_i(l,y)&&p[3]<g[3];if(!v&&!w)return null;const E=function(L,B,j){for(let U=1;U<L.length;U++){const G=pd(B.pointCoordinate3D(L[U-1]).x),$=pd(B.pointCoordinate3D(L[U]).x);if(j<0){if(G<$)return{idx:U,t:-G/($-1-G)}}else if($<G)return{idx:U,t:(1-G)/($+1-G)}}return null}(l,c,v?-1:1);if(!E)return null;const{idx:T,t:C}=E;let S=T>1?Nu(l.slice(0,T),c):[],I=T<l.length?Nu(l.slice(T),c):[];S=S.map(L=>new ie(pd(L.x),L.y)),I=I.map(L=>new ie(pd(L.x),L.y));const R=[...S];0===R.length&&R.push(I[I.length-1]);const A=wt(R[R.length-1].y,(0===I.length?S[0]:I[0]).y,C);let k;return k=v?[new ie(0,A),new ie(0,0),new ie(1,0),new ie(1,A)]:[new ie(1,A),new ie(1,1),new ie(0,1),new ie(0,A)],R.push(...k),0===I.length?R.push(S[0]):R.push(...I),{polygon:R.map(L=>new nn(L.x,L.y)),unwrapped:!1}}(e,n);if(i)return i;const a=function(l,c){let h=!1,f=-1/0,p=0;for(let _=0;_<l.length-1;_++)l[_].x>f&&(f=l[_].x,p=_);for(let _=0;_<l.length-1;_++){const y=(p+_)%(l.length-1),v=l[y],w=l[y+1];Math.abs(v.x-w.x)>.5&&(v.x<w.x?(v.x+=1,0===y&&(l[l.length-1].x+=1)):(w.x+=1,y+1===l.length-1&&(l[0].x+=1)),h=!0)}const g=Si(c.center.lng);return h&&g<Math.abs(g-1)&&l.forEach(_=>{_.x-=1}),{polygon:l,unwrapped:h}}(Nu(e,n).map(l=>new ie(pd(l.x),l.y)),n);return{polygon:a.polygon.map(l=>new nn(l.x,l.y)),unwrapped:a.unwrapped}}}function Nu(t,e){return Bw(t,n=>{const i=e.pointCoordinate3D(n);n.x=i.x,n.y=i.y},1/256)}function pd(t){return t<0?1+t%1:t%1}function k0(t){return 100*t|0}function qg(t,e,n,i,a){const l=function(c,h){if(c)return a(c);if(h){t.url&&h.tiles&&t.tiles&&delete t.tiles;const f=fi(Ke(h,t),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);h.vector_layers&&(f.vectorLayers=h.vector_layers,f.vectorLayerIds=f.vectorLayers.map(p=>p.id)),f.tiles=e.canonicalizeTileset(f,t.url),a(null,f)}};return t.url?Me(e.transformRequest(e.normalizeSourceURL(t.url,null,n,i),_e.Source),l):Ct.frame(()=>l(null,t))}class hp{constructor(e,n,i){this.bounds=Ji.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=i||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const n=Math.pow(2,e.z),i=Math.floor(Si(this.bounds.getWest())*n),a=Math.floor(gi(this.bounds.getNorth())*n),l=Math.ceil(Si(this.bounds.getEast())*n),c=Math.ceil(gi(this.bounds.getSouth())*n);return e.x>=i&&e.x<l&&e.y>=a&&e.y<c}}class O0{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Ja({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const i=this.getKey(e,n);return this.positions[i]}trim(){const e=this.width,n=this.height=rn(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,i){const a=[];let l=e.length%2==1?-e[e.length-1]*i:0,c=e[0]*i,h=!0;a.push({left:l,right:c,isDash:h,zeroLength:0===e[0]});let f=e[0];for(let p=1;p<e.length;p++){h=!h;const g=e[p];l=f*i,f+=g,c=f*i,a.push({left:l,right:c,isDash:h,zeroLength:0===g})}return a}addRoundDash(e,n,i){const a=n/2;for(let l=-i;l<=i;l++){const c=this.width*(this.nextRow+i+l);let h=0,f=e[h];for(let p=0;p<this.width;p++){p/f.right>1&&(f=e[++h]);const g=Math.abs(p-f.left),_=Math.abs(p-f.right),y=Math.min(g,_);let v;const w=l/i*(a+1);if(f.isDash){const E=a-Math.abs(w);v=Math.sqrt(y*y+E*E)}else v=a-Math.sqrt(y*y+w*w);this.image.data[c+p]=Math.max(0,Math.min(255,v+128))}}}addRegularDash(e,n){for(let f=e.length-1;f>=0;--f){const p=e[f],g=e[f+1];p.zeroLength?e.splice(f,1):g&&g.isDash===p.isDash&&(g.left=p.left,e.splice(f,1))}const i=e[0],a=e[e.length-1];i.isDash===a.isDash&&(i.left=a.left-this.width,a.right=i.right+this.width);const l=this.width*this.nextRow;let c=0,h=e[c];for(let f=0;f<this.width;f++){f/h.right>1&&(h=e[++c]);const p=Math.abs(f-h.left),g=Math.abs(f-h.right),_=Math.min(p,g);this.image.data[l+f]=Math.max(0,Math.min(255,(h.isDash?_:-_)+n+128))}}addDash(e,n){const i=this.getKey(e,n);if(this.positions[i])return this.positions[i];const a="round"===n,l=a?7:0,c=2*l+1;if(this.nextRow+c>this.height)return ee("LineAtlas out of space"),null;0===e.length&&e.push(1);let h=0;for(let g=0;g<e.length;g++)e[g]<0&&(ee("Negative value is found in line dasharray, replacing values with 0"),e[g]=0),h+=e[g];if(0!==h){const g=this.width/h,_=this.getDashRanges(e,this.width,g);a?this.addRoundDash(_,g,l):this.addRegularDash(_,"square"===n?.5*g:0)}const f=this.nextRow+l;this.nextRow+=c;const p={tl:[f,l],br:[h,0]};return this.positions[i]=p,p}}Qe(O0,"LineAtlas");class oC{constructor(e){const n={},i=[];for(const h in e){const f=e[h],p=n[h]={};for(const g in f.glyphs){const _=f.glyphs[+g];if(!_||0===_.bitmap.width||0===_.bitmap.height)continue;const y=_.metrics.localGlyph?2:1,v={x:0,y:0,w:_.bitmap.width+2*y,h:_.bitmap.height+2*y};i.push(v),p[g]=v}}const{w:a,h:l}=gg(i),c=new Ja({width:a||1,height:l||1});for(const h in e){const f=e[h];for(const p in f.glyphs){const g=f.glyphs[+p];if(!g||0===g.bitmap.width||0===g.bitmap.height)continue;const _=n[h][p],y=g.metrics.localGlyph?2:1;Ja.copy(g.bitmap,c,{x:0,y:0},{x:_.x+y,y:_.y+y},g.bitmap)}}this.image=c,this.positions=n}}Qe(oC,"GlyphAtlas");class MI{constructor(e){this.tileID=new _n(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.scope=e.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.promoteId=e.promoteId,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Po(e.tileID.canonical,e.projection),this.projection=e.projection,this.brightness=e.brightness,this.extraShadowCaster=!!e.extraShadowCaster}parse(e,n,i,a,l){this.status="parsing",this.data=e,this.collisionBoxArray=new cy;const c=new db(Object.keys(e.layers).sort()),h=new Lv(this.tileID,this.promoteId);h.bucketLayerIDs=[];const f={},p=new O0(256,256),g={featureIndex:h,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:p,availableImages:i,brightness:this.brightness},_=n.familiesBySource[this.source];for(const S in _){const I=e.layers[S];if(!I)continue;let R=!1,A=!1,k=!1;for(const j of _[S])"symbol"===j[0].type?R=!0:A=!0,j[0].is3D()&&"model"!==j[0].type&&(k=!0);if(this.extraShadowCaster&&!k||!0===this.isSymbolTile&&!R||!1===this.isSymbolTile&&!A)continue;1===I.version&&ee(`Vector tile source "${this.source}" layer "${S}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const L=c.encode(S),B=[];for(let j=0;j<I.length;j++){const U=I.feature(j),G=h.getId(U,S);B.push({feature:U,id:G,index:j,sourceLayerIndex:L})}for(const j of _[S]){const U=j[0];(!this.extraShadowCaster||U.is3D()&&"model"!==U.type)&&(void 0!==this.isSymbolTile&&"symbol"===U.type!==this.isSymbolTile||U.minzoom&&this.zoom<Math.floor(U.minzoom)||U.maxzoom&&this.zoom>=U.maxzoom||"none"!==U.visibility&&(L0(j,this.zoom,g.brightness,i),(f[U.id]=U.createBucket({index:h.bucketLayerIDs.length,layers:j,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:L,sourceID:this.source,projection:this.projection.spec})).populate(B,g,this.tileID.canonical,this.tileTransform),h.bucketLayerIDs.push(j.map(G=>G.id))))}}let y,v,w,E;p.trim();const T={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},C=()=>{if(y)return l(y);if(this.extraShadowCaster)this.status="done",l(null,{buckets:xe(f).filter(S=>!S.isEmpty()),featureIndex:h,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:g.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(v&&w&&E){const S=new oC(v),I=new qh(w,E);for(const R in f){const A=f[R];A instanceof nd?(L0(A.layers,this.zoom,g.brightness,i),Rb(A,v,S.positions,w,I.iconPositions,this.showCollisionBoxes,i,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):A.hasPattern&&(A instanceof Hl||A instanceof Cv||A instanceof lp)&&(L0(A.layers,this.zoom,g.brightness,i),A.addFeatures(g,this.tileID.canonical,I.patternPositions,i,this.tileTransform,this.brightness))}this.status="done",l(null,{buckets:xe(f).filter(R=>!R.isEmpty()),featureIndex:h,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:S.image,lineAtlas:p,imageAtlas:I,brightness:g.brightness})}};if(!this.extraShadowCaster){const S=Ws(g.glyphDependencies,A=>Object.keys(A).map(Number));Object.keys(S).length?a.send("getGlyphs",{uid:this.uid,stacks:S,scope:this.scope},(A,k)=>{y||(y=A,v=k,C())},void 0,!1,T):v={};const I=Object.keys(g.iconDependencies);I.length?a.send("getImages",{icons:I,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(A,k)=>{y||(y=A,w=k,C())},void 0,!1,T):w={};const R=Object.keys(g.patternDependencies);R.length?a.send("getImages",{icons:R,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(A,k)=>{y||(y=A,E=k,C())},void 0,!1,T):E={}}C()}}function L0(t,e,n,i){const a=new pr(e,{brightness:n});for(const l of t)l.recalculate(a,i)}class sC{constructor(e){this.entries={},this.scheduler=e}request(e,n,i,a){const l=this.entries[e]=this.entries[e]||{callbacks:[]};if(l.result){const[c,h]=l.result;return this.scheduler?this.scheduler.add(()=>{a(c,h)},n):a(c,h),()=>{}}return l.callbacks.push(a),l.cancel||(l.cancel=i((c,h)=>{l.result=[c,h];for(const f of l.callbacks)this.scheduler?this.scheduler.add(()=>{f(c,h)},n):f(c,h);setTimeout(()=>delete this.entries[e],3e3)})),()=>{l.result||(l.callbacks=l.callbacks.filter(c=>c!==a),l.callbacks.length||(l.cancel(),delete this.entries[e]))}}}function aC(t,e,n){const i=JSON.stringify(t.request);return t.data&&(this.deduped.entries[i]={result:[null,t.data]}),this.deduped.request(i,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},a=>{const l=je(t.request,(c,h,f,p)=>{c?a(c):h&&a(null,{vectorTile:n?void 0:new Mv(new ug(h)),rawData:h,cacheControl:f,expires:p})});return()=>{l.cancel(),a()}},e)}class lC extends Mn{constructor(e,n,i,a){if(super(),this.id=e,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Ke(this,fi(n,["url","scheme","tileSize","promoteId"])),this._options=Ke({type:"vector"},n),this._collectResourceTiming=!!n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(a),this._tileWorkers={},this._deduped=new sC}load(e){this._loaded=!1,this.fire(new Se("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,i=this.map._worldview;this._tileJSONRequest=qg(this._options,this.map._requestManager,n,i,(a,l)=>{this._tileJSONRequest=null,this._loaded=!0,a?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),i&&2!==i.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${i}`),this.fire(new xt(a))):l&&(Ke(this,l),l.bounds&&(this.tileBounds=new hp(l.bounds,this.minzoom,this.maxzoom)),ka(l.tiles,this.map._requestManager._customAccessToken),this.fire(new Se("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Se("data",{dataType:"source",sourceDataType:"content"}))),e&&e(a)})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const e=gr(this.id,this.scope);this.load(()=>this.map.style.clearSource(e))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return Ke({},this._options)}loadTile(e,n){const i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),a={request:this.map._requestManager.transformRequest(i,_e.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:Ct.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:e.isExtraShadowCaster};if(a.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state)"loading"===e.state?e.reloadCallback=n:e.request=e.actor.send("reloadTile",a,l.bind(this));else if(e.actor=this._tileWorkers[i]=this._tileWorkers[i]||this.dispatcher.getActor(),this.dispatcher.ready)e.request=e.actor.send("loadTile",a,l.bind(this),void 0,!0);else{const c=aC.call({deduped:this._deduped},a,(h,f)=>{h||!f?l.call(this,h):(a.data={cacheControl:f.cacheControl,expires:f.expires,rawData:f.rawData.slice(0)},e.actor&&e.actor.send("loadTile",a,l.bind(this),void 0,!0))},!0);e.request={cancel:c}}function l(c,h){return delete e.request,e.aborted?n(null):c&&404!==c.status?n(c):(h&&h.resourceTiming&&(e.resourceTiming=h.resourceTiming),this.map._refreshExpiredTiles&&h&&e.setExpiryData(h),e.loadVectorData(h,this.map.painter),Zs(this.dispatcher),n(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class dp extends Mn{constructor(e,n,i,a){super(),this.id=e,this.dispatcher=i,this.setEventedParent(a),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Ke({type:"raster"},n),Ke(this,fi(n,["url","scheme","tileSize"]))}load(e){this._loaded=!1,this.fire(new Se("dataloading",{dataType:"source"})),this._tileJSONRequest=qg(this._options,this.map._requestManager,null,null,(n,i)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new xt(n)):i&&(Ke(this,i),i.bounds&&(this.tileBounds=new hp(i.bounds,this.minzoom,this.maxzoom)),ka(i.tiles),this.fire(new Se("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Se("data",{dataType:"source",sourceDataType:"content"}))),e&&e(n)})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const e=gr(this.id,this.scope);this.load(()=>this.map.style.clearSource(e))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return Ke({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,n){const i=Ct.devicePixelRatio>=2,a=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),i,this.tileSize);e.request=vt(this.map._requestManager.transformRequest(a,_e.Tile),(l,c,h,f)=>(delete e.request,e.aborted?(e.state="unloaded",n(null)):l?(e.state="errored",n(l)):c?(this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:h,expires:f}),e.setTexture(c,this.map.painter),e.state="loaded",Zs(this.dispatcher),void n(null)):n(null)))}static loadTileData(e,n,i){e.setTexture(n,i)}static unloadTileData(e,n){e.texture&&n.saveTileTexture(e.texture)}abortTile(e,n){e.request&&(e.request.cancel(),delete e.request),n()}unloadTile(e,n){e.texture&&this.map.painter.saveTileTexture(e.texture),n()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let zu;function u2(){return null!=E_.workerClass?new E_.workerClass:new ce.Worker(E_.workerUrl)}const fp="mapboxgl_preloaded_worker_pool";class Er{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Er.workerCount;)this.workers.push(new u2);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&0===this.numActive()&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[fp]}numActive(){return Object.keys(this.active).length}}let pp;function Bu(){return pp||(pp=new Er),pp}Er.workerCount=2;let Vs,F0,ba,N0=null;function mp(){return De()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:F0||Rt.DRACO_URL}const B0={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},cC={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Wg={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Zg(t,e,n){const i=n.json.bufferViews.length,a=n.buffers.length;e.bufferView=i,n.json.bufferViews[i]={buffer:a,byteLength:t.byteLength},n.buffers[a]=t}const Xg="KHR_draco_mesh_compression";function h2(t,e){const n=t.extensions&&t.extensions[Xg];if(!n)return;const i=new ba.Decoder,a=j0(e,n.bufferView),l=new ba.Mesh;if(!i.DecodeArrayToMesh(a,a.byteLength,l))throw new Error("Failed to decode Draco mesh");const c=e.json.accessors[t.indices],h=B0[c.componentType],f=c.count*h.BYTES_PER_ELEMENT,p=ba._malloc(f);h===Uint16Array?i.GetTrianglesUInt16Array(l,f,p):i.GetTrianglesUInt32Array(l,f,p),Zg(ba.memory.buffer.slice(p,p+f),c,e),ba._free(p);for(const g of Object.keys(n.attributes)){const _=i.GetAttributeByUniqueId(l,n.attributes[g]),y=e.json.accessors[t.attributes[g]],v=cC[y.componentType],w=y.count*Wg[y.type]*B0[y.componentType].BYTES_PER_ELEMENT,E=ba._malloc(w);i.GetAttributeDataArrayForAllPoints(l,_,ba[v],w,E),Zg(ba.memory.buffer.slice(E,E+w),y,e),ba._free(E)}i.destroy(),l.destroy(),delete t.extensions[Xg]}const uC=1179937895,d2=new TextDecoder("utf8");function Yg(t,e){return new URL(t,e).href}function V0(t,e,n,i){return fetch(Yg(t.uri,i)).then(a=>a.arrayBuffer()).then(a=>{e.buffers[n]=a})}function j0(t,e){const n=t.json.bufferViews[e];return new Uint8Array(t.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function U0(t,e,n,i){if(t.uri){const a=Yg(t.uri,i);return fetch(a).then(l=>l.blob()).then(l=>ce.createImageBitmap(l)).then(l=>{e.images[n]=l})}if(void 0!==t.bufferView){const a=j0(e,t.bufferView),l=new ce.Blob([a],{type:t.mimeType});return ce.createImageBitmap(l).then(c=>{e.images[n]=c})}}function Kg(t,e=0,n){const i={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===uC){const p=new Uint32Array(t,e);let g=2;const _=(p[g++]>>2)-3,y=p[g++]>>2;if(g++,i.json=JSON.parse(d2.decode(p.subarray(g,g+y))),g+=y,g<_){const v=p[g++];g++;const w=e+(g<<2);i.buffers[0]=t.slice(w,w+v)}}else i.json=JSON.parse(d2.decode(new Uint8Array(t,e)));const{buffers:a,images:l,meshes:c,extensionsUsed:h}=i.json;let f=Promise.resolve();if(a){const p=[];for(let g=0;g<a.length;g++){const _=a[g];_.uri?p.push(V0(_,i,g,n)):i.buffers[g]||(i.buffers[g]=null)}f=Promise.all(p)}return f.then(()=>{const p=[],g=h&&h.includes(Xg);if(g&&p.push(function(){if(!ba)return Vs||(Vs=function(_){let y,v=null;function w(){y=new Uint8Array(v.buffer)}function E(){throw new Error("Unexpected Draco error.")}const T={a:{a:E,d:function(C,S,I){return y.copyWithin(C,S,S+I)},c:function(C){const S=y.length,I=Math.max(C>>>0,Math.ceil(1.2*S)),R=Math.ceil((I-S)/65536);try{return v.grow(R),w(),!0}catch{return!1}},b:E}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(_,T):_.then(C=>C.arrayBuffer()).then(C=>WebAssembly.instantiate(C,T))).then(C=>{const{Rb:S,Qb:I,P:R,T:A,X:k,Ja:L,La:B,Qa:j,Va:U,Wa:G,eb:$,jb:W,f:H,e:J,yb:te,zb:oe,Ab:K,Bb:Q,Db:ae,Gb:ue}=C.instance.exports;v=J;const fe=(()=>{let ge=0,ve=0,de=0,me=0;return Oe=>{de&&(S(me),S(ge),ve+=de,de=ge=0),ge||(ve+=128,ge=I(ve));const qe=Oe.length+7&-8;let Ge=ge;qe>=ve&&(de=qe,Ge=me=I(qe));for(let We=0;We<Oe.length;We++)y[Ge+We]=Oe[We];return Ge}})();return w(),H(),{memory:J,_free:S,_malloc:I,Mesh:class{constructor(){this.ptr=R()}destroy(){A(this.ptr)}},Decoder:class{constructor(){this.ptr=L()}destroy(){W(this.ptr)}DecodeArrayToMesh(ge,ve,de){const me=fe(ge),Oe=B(this.ptr,me,ve,de.ptr);return!!k(Oe)}GetAttributeByUniqueId(ge,ve){return{ptr:j(this.ptr,ge.ptr,ve)}}GetTrianglesUInt16Array(ge,ve,de){U(this.ptr,ge.ptr,ve,de)}GetTrianglesUInt32Array(ge,ve,de){G(this.ptr,ge.ptr,ve,de)}GetAttributeDataArrayForAllPoints(ge,ve,de,me,Oe){$(this.ptr,ge.ptr,ve.ptr,de,me,Oe)}},DT_INT8:te(),DT_UINT8:oe(),DT_INT16:K(),DT_UINT16:Q(),DT_UINT32:ae(),DT_FLOAT32:ue()}})}(fetch(mp())),Vs.then(_=>{ba=_,Vs=void 0}))}()),l)for(let _=0;_<l.length;_++)p.push(U0(l[_],i,_,n));return(p.length?Promise.all(p):Promise.resolve()).then(()=>{if(g&&c)for(const{primitives:_}of c)for(const y of _)h2(y,i);return i})})}function hC(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>Kg(e,0,t))}class dC{constructor(e,n,i){if(this.triangleCount=n.length/3,this.min=new ie(0,0),this.max=new ie(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===e.length||0===i)return;const a=e.map(g=>g.x),l=e.map(g=>g.y);this.min=new ie(Math.min(...a),Math.min(...l)),this.max=new ie(Math.max(...a),Math.max(...l));const c=this.max.sub(this.min);c.x=Math.max(c.x,1),c.y=Math.max(c.y,1);const h=Math.max(c.x,c.y)/i;this.cellsX=Math.max(1,Math.ceil(c.x/h)),this.cellsY=Math.max(1,Math.ceil(c.y/h)),this.xScale=1/h,this.yScale=1/h;const f=[];for(let g=0;g<this.triangleCount;g++){const _=e[n[3*g+0]].sub(this.min),y=e[n[3*g+1]].sub(this.min),v=e[n[3*g+2]].sub(this.min),w=Fc(Math.floor(Math.min(_.x,y.x,v.x)),this.xScale,this.cellsX),E=Fc(Math.floor(Math.max(_.x,y.x,v.x)),this.xScale,this.cellsX),T=Fc(Math.floor(Math.min(_.y,y.y,v.y)),this.yScale,this.cellsY),C=Fc(Math.floor(Math.max(_.y,y.y,v.y)),this.yScale,this.cellsY),S=new ie(0,0),I=new ie(0,0),R=new ie(0,0),A=new ie(0,0);for(let k=T;k<=C;++k){S.y=I.y=k*h,R.y=A.y=(k+1)*h;for(let L=w;L<=E;++L)S.x=R.x=L*h,I.x=A.x=(L+1)*h,(cv(_,y,v,S,I,A)||cv(_,y,v,S,A,R))&&f.push({cellIdx:k*this.cellsX+L,triIdx:g})}}if(0===f.length)return;f.sort((g,_)=>g.cellIdx-_.cellIdx||g.triIdx-_.triIdx);let p=0;for(;p<f.length;){const g=f[p].cellIdx,_={start:this.payload.length,len:0};for(;p<f.length&&f[p].cellIdx===g;)++_.len,this.payload.push(f[p++].triIdx);this.cells[g]=_}}query(e,n,i){if(0===this.triangleCount||0===this.cells.length||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let f=0;f<this.lookup.length;f++)this.lookup[f]=0;const a=Fc(e.x-this.min.x,this.xScale,this.cellsX),l=Fc(n.x-this.min.x,this.xScale,this.cellsX),c=Fc(e.y-this.min.y,this.yScale,this.cellsY),h=Fc(n.y-this.min.y,this.yScale,this.cellsY);for(let f=c;f<=h;f++)for(let p=a;p<=l;p++){const g=this.cells[f*this.cellsX+p];if(g)for(let _=0;_<g.len;_++){const y=this.payload[g.start+_],v=Math.floor(y/8),w=1<<y%8;if(!(this.lookup[v]&w)&&(this.lookup[v]|=w,i.push(y),i.length===this.triangleCount))return}}}}function Fc(t,e,n){return Math.max(0,Math.min(n-1,Math.floor(t*e)))}function Vu(t,e){const n=t.json.bufferViews[e.bufferView];return new B0[e.componentType](t.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*Wg[e.type])}function fC(t,e,n){const i=t.indices,a=t.attributes,l={};l.indexArray=new Tr;const c=e.json.accessors[i],h=c.count/3;l.indexArray.reserve(h);const f=Vu(e,c);for(let y=0;y<h;y++)l.indexArray.emplaceBack(f[3*y],f[3*y+1],f[3*y+2]);l.indexArray._trim(),l.vertexArray=new Ga;const p=e.json.accessors[a.POSITION];l.vertexArray.reserve(p.count);const g=Vu(e,p);for(let y=0;y<p.count;y++)l.vertexArray.emplaceBack(g[3*y],g[3*y+1],g[3*y+2]);if(l.vertexArray._trim(),l.aabb=new $n(p.min,p.max),l.centroid=function(y,v){const w=[0,0,0],E=y.length;if(E>0){for(let T=0;T<E;T++){const C=3*y[T];w[0]+=v[C],w[1]+=v[C+1],w[2]+=v[C+2]}w[0]/=E,w[1]/=E,w[2]/=E}return w}(f,g),void 0!==a.COLOR_0){const y=e.json.accessors[a.COLOR_0],v=Wg[y.type];if(5126===y.componentType){l.colorArray=3===v?new Ga:new Ha,l.colorArray.reserve(y.count);const w=Vu(e,y);if(3===v)for(let E=0;E<y.count;E++)l.colorArray.emplaceBack(w[3*E],w[3*E+1],w[3*E+2]);else for(let E=0;E<y.count;E++)l.colorArray.emplaceBack(w[4*E],w[4*E+1],w[4*E+2],w[4*E+3]);l.colorArray._trim()}else if(5123===y.componentType&&4===v){l.colorArray=new Ha,l.colorArray.resize(y.count);const w=Vu(e,y),E=1/65535,T=l.colorArray.float32;for(let C=0;C<4*w.length;++C)T[C]=w[C]*E}else ee(`glTF color buffer parsing for accessor ${JSON.stringify(y)} is not supported`)}if(void 0!==a.NORMAL){l.normalArray=new Ga;const y=e.json.accessors[a.NORMAL];l.normalArray.reserve(y.count);const v=Vu(e,y);for(let w=0;w<y.count;w++)l.normalArray.emplaceBack(v[3*w],v[3*w+1],v[3*w+2]);l.normalArray._trim()}if(void 0!==a.TEXCOORD_0&&n.length>0){l.texcoordArray=new wf;const y=e.json.accessors[a.TEXCOORD_0];l.texcoordArray.reserve(y.count);const v=Vu(e,y);for(let w=0;w<y.count;w++)l.texcoordArray.emplaceBack(v[2*w],v[2*w+1]);l.texcoordArray._trim()}const _=t.material;return l.material=function(y,v){const{emissiveFactor:w=[0,0,0],alphaMode:E="OPAQUE",alphaCutoff:T=.5,normalTexture:C,occlusionTexture:S,emissiveTexture:I,doubleSided:R}=y,{baseColorFactor:A=[1,1,1,1],metallicFactor:k=1,roughnessFactor:L=1,baseColorTexture:B,metallicRoughnessTexture:j}=y.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new yt(...A),metallicFactor:k,roughnessFactor:L,baseColorTexture:B?v[B.index]:void 0,metallicRoughnessTexture:j?v[j.index]:void 0},doubleSided:R,emissiveFactor:w,alphaMode:E,alphaCutoff:T,normalTexture:C?v[C.index]:void 0,occlusionTexture:S?v[S.index]:void 0,emissionTexture:I?v[I.index]:void 0,defined:void 0===y.defined}}(void 0!==_?e.json.materials[_]:{defined:!1},n),void 0!==a._FEATURE_RGBA4444&&(l.featureData=new Uint32Array(Vu(e,e.json.accessors[a._FEATURE_RGBA4444]).buffer)),l}function Jg(t,e,n){const{matrix:i,rotation:a,translation:l,scale:c,mesh:h,extras:f,children:p}=t,g={};if(g.matrix=i||se.fromRotationTranslationScale([],a||[0,0,0,1],l||[0,0,0],c||[1,1,1]),void 0!==h){g.meshes=n[h];const _=g.anchor=[0,0];for(const y of g.meshes){const{min:v,max:w}=y.aabb;_[0]+=v[0]+w[0],_[1]+=v[1]+w[1]}_[0]=Math.floor(_[0]/g.meshes.length/2),_[1]=Math.floor(_[1]/g.meshes.length/2)}if(f&&(f.id&&(g.id=f.id),f.lights&&(g.lights=function(_){if(!_.length)return[];const y=function(C){const S=atob(C),I=new Uint8Array(S.length);for(let R=0;R<S.length;R++)I[R]=S.codePointAt(R);return I}(_),v=[],w=y.length/24,E=new Uint16Array(y.buffer),T=new Float32Array(y.buffer);for(let C=0;C<w;C++){const S=E[2*C*6]/30,I=E[2*C*6+1]/30,R=E[2*C*6+10]/100,A=T[6*C+1],k=T[6*C+2],L=T[6*C+3],B=T[6*C+4],j=L-A,U=B-k,G=Math.hypot(j,U);v.push({pos:[A+.5*j,k+.5*U,I],normal:[U/G,-j/G,0],width:G,height:S,depth:R,points:[A,k,L,B]})}return v}(f.lights))),p){const _=[];for(const y of p)_.push(Jg(e.json.nodes[y],e,n));g.children=_}return g}function $0(t){if(0===t.vertices.length||0===t.indices.length)return null;const[e,n]=[t.vertices[0].clone(),t.vertices[0].clone()];for(let c=1;c<t.vertices.length;++c){const h=t.vertices[c];e.x=Math.min(e.x,h.x),e.y=Math.min(e.y,h.y),n.x=Math.max(n.x,h.x),n.y=Math.max(n.y,h.y)}const i=Math.ceil(Math.max(n.x-e.x,n.y-e.y)/256),a=Math.max(8,i),l=new dC(t.vertices,t.indices,a);return{vertices:t.vertices,indices:t.indices,grid:l,min:e,max:n}}function f2(t){if(!t.extras||!t.extras.ground)return null;const e=t.extras.ground;if(!e||!Array.isArray(e)||0===e.length)return null;const n=e[0];if(!n||!Array.isArray(n)||0===n.length)return null;const i=[];for(const c of n){if(!Array.isArray(c)||2!==c.length)continue;const h=c[0],f=c[1];"number"==typeof h&&"number"==typeof f&&i.push(new ie(h,f))}if(i.length<3)return null;i.length>1&&i[i.length-1].equals(i[0])&&i.pop();let a=0;for(let c=0;c<i.length;c++){const h=i[c],f=i[(c+1)%i.length],p=i[(c+2)%i.length];a+=(h.x-f.x)*(p.y-f.y)-(p.x-f.x)*(h.y-f.y)}a>0&&i.reverse();const l=bv(i.flatMap(c=>[c.x,c.y]),[]);return 0===l.length?null:{vertices:i,indices:l}}function H0(t){const e=[],n=[];let i=0;for(const a of t){i=e.length;const l=a.vertexArray.float32,c=a.indexArray.uint16;for(let h=0;h<a.vertexArray.length;h++)e.push(new ie(l[3*h+0],l[3*h+1]));for(let h=0;h<3*a.indexArray.length;h++)n.push(c[h]+i)}if(n.length%3!=0)return null;for(let a=0;a<n.length;a+=3){const l=e[n[a+0]],c=e[n[a+1]],h=e[n[a+2]];(l.x-c.x)*(h.y-c.y)-(h.x-c.x)*(l.y-c.y)>0&&([n[a+1],n[a+2]]=[n[a+2],n[a+1]])}return{vertices:e,indices:n}}function gp(t){const n=function(f,p){const g=[];for(const _ of f.json.meshes){const y=[];for(const v of _.primitives)y.push(fC(v,f,p));g.push(y)}return g}(t,function(f,p){const g=[],_=ce.WebGL2RenderingContext;if(f.json.textures)for(const y of f.json.textures){const v={magFilter:_.LINEAR,minFilter:_.NEAREST,wrapS:_.REPEAT,wrapT:_.REPEAT};void 0!==y.sampler&&Object.assign(v,f.json.samplers[y.sampler]),g.push({image:p[y.source],sampler:v,uploaded:!1})}return g}(t,t.images)),{scenes:i,scene:a,nodes:l}=t.json,c=i?i[a||0].nodes:l,h=[];for(const f of c)h.push(Jg(l[f],t,n));return function(f,p,g){const _={},y=new Set;for(let v=0;v<f.length;v++){const w=g[p[v]];if(!w.extras)continue;const E=w.extras["mapbox:footprint:version"],T=w.extras["mapbox:footprint:id"];(E||T)&&y.add(v),"1.0.0"===E&&T&&(_[T]=v)}for(let v=0;v<f.length;v++){if(y.has(v))continue;const w=f[v],E=g[p[v]];if(!E.extras)continue;let T=null;w.id in _&&(T=H0(f[_[w.id]].meshes)),T||(T=f2(E)),T&&(w.footprint=$0(T))}if(y.size>0){const v=Array.from(y.values()).sort((w,E)=>w-E);for(let w=v.length-1;w>=0;w--)f.splice(v[w],1)}}(h,c,t.json.nodes),h}function p2(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);const e=t.vertexArray.float32,n=t.aabb.min[0]-1,i=t.aabb.min[1]-1,a=64/(t.aabb.max[0]-n+2),l=64/(t.aabb.max[1]-i+2);for(let c=0;c<e.length;c+=3){const h=e[c+2],f=(e[c+0]-n)*a|0,p=(e[c+1]-i)*l|0;h>t.heightmap[64*p+f]&&(t.heightmap[64*p+f]=h)}}function pC(t,e){const n={};n.indexArray=new Tr,n.indexArray.reserve(4*t.length),n.vertexArray=new Ga,n.vertexArray.reserve(10*t.length),n.colorArray=new Ha,n.vertexArray.reserve(10*t.length);let i=0;for(const c of t){const h=Math.min(10,Math.max(4,1.3*c.height))*e,f=[-c.normal[1],c.normal[0],0],p=Math.min(.29,.1*c.width/c.depth),g=c.width-2*c.depth*e*(p+.01),_=Z.scaleAndAdd([],c.pos,f,g/2),y=Z.scaleAndAdd([],c.pos,f,-g/2),v=[_[0],_[1],_[2]+c.height],w=[y[0],y[1],y[2]+c.height],E=Z.scaleAndAdd([],c.normal,f,p);Z.scale(E,E,h);const T=Z.scaleAndAdd([],c.normal,f,-p);Z.scale(T,T,h),Z.add(E,_,E),Z.add(T,y,T),_[2]+=.1,y[2]+=.1,n.vertexArray.emplaceBack(E[0],E[1],E[2]),n.vertexArray.emplaceBack(T[0],T[1],T[2]),n.vertexArray.emplaceBack(_[0],_[1],_[2]),n.vertexArray.emplaceBack(y[0],y[1],y[2]),n.vertexArray.emplaceBack(v[0],v[1],v[2]),n.vertexArray.emplaceBack(w[0],w[1],w[2]),n.vertexArray.emplaceBack(_[0],_[1],_[2]),n.vertexArray.emplaceBack(y[0],y[1],y[2]),n.vertexArray.emplaceBack(E[0],E[1],E[2]),n.vertexArray.emplaceBack(T[0],T[1],T[2]);const C=g/h/2;n.colorArray.emplaceBack(-C-p,-1,C,.8),n.colorArray.emplaceBack(C+p,-1,C,.8),n.colorArray.emplaceBack(-C,0,C,1.3),n.colorArray.emplaceBack(C,0,C,1.3),n.colorArray.emplaceBack(C+p,-.8,C,.7),n.colorArray.emplaceBack(C+p,-.8,C,.7),n.colorArray.emplaceBack(0,0,C,1.3),n.colorArray.emplaceBack(0,0,C,1.3),n.colorArray.emplaceBack(C+p,-1.2,C,.8),n.colorArray.emplaceBack(C+p,-1.2,C,.8),n.indexArray.emplaceBack(6+i,4+i,8+i),n.indexArray.emplaceBack(7+i,9+i,5+i),n.indexArray.emplaceBack(0+i,1+i,2+i),n.indexArray.emplaceBack(1+i,3+i,2+i),i+=10}const a={defined:!0,emissiveFactor:[0,0,0]},l={};return l.baseColorFactor=yt.white,a.pbrMetallicRoughness=l,n.material=a,n.aabb=new $n([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}Qe(dC,"TriangleGridIndex");const Qg={vector:lC,raster:dp,"raster-dem":class extends dp{constructor(t,e,n,i){super(t,e,n,i),this.type="raster-dem",this.maxzoom=22,this._options=Ke({type:"raster-dem"},e),this.encoding=e.encoding||"mapbox"}loadTile(t,e){const n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);t.request=vt(this.map._requestManager.transformRequest(n,_e.Tile),function(l,c,h,f){if(delete t.request,t.aborted)t.state="unloaded",e(null);else if(l)t.state="errored",e(l);else if(c){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:h,expires:f});const g=ce.ImageBitmap&&c instanceof ce.ImageBitmap&&(null==zu&&(zu=ce.OffscreenCanvas&&new ce.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof ce.createImageBitmap),zu),_=1-(c.width-((p=c.width)<=1?1:Math.pow(2,Math.floor(Math.log(p)/Math.LN2))))/2;_<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));const y=g?c:Ct.getImageData(c,_),v={uid:t.uid,coord:t.tileID,source:this.id,scope:this.scope,rawImageData:y,encoding:this.encoding,padding:_,convertToFloat:i};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",v,a.bind(this),void 0,!0))}var p}.bind(this));const i=this.map?.painter?.terrainUseFloatDEM();function a(l,c){l&&(t.state="errored",e(l)),c&&(t.dem=c,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",e(null))}}_getNeighboringTiles(t){const e=t.canonical,n=Math.pow(2,e.z),i=(e.x-1+n)%n,a=0===e.x?t.wrap-1:t.wrap,l=(e.x+1+n)%n,c=e.x+1===n?t.wrap+1:t.wrap,h={};return h[new _n(t.overscaledZ,a,e.z,i,e.y).key]={backfilled:!1},h[new _n(t.overscaledZ,c,e.z,l,e.y).key]={backfilled:!1},e.y>0&&(h[new _n(t.overscaledZ,a,e.z,i,e.y-1).key]={backfilled:!1},h[new _n(t.overscaledZ,t.wrap,e.z,e.x,e.y-1).key]={backfilled:!1},h[new _n(t.overscaledZ,c,e.z,l,e.y-1).key]={backfilled:!1}),e.y+1<n&&(h[new _n(t.overscaledZ,a,e.z,i,e.y+1).key]={backfilled:!1},h[new _n(t.overscaledZ,t.wrap,e.z,e.x,e.y+1).key]={backfilled:!1},h[new _n(t.overscaledZ,c,e.z,l,e.y+1).key]={backfilled:!1}),h}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.hillshadeFBO&&(t.hillshadeFBO.destroy(),delete t.hillshadeFBO),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded"}},geojson:class extends Mn{constructor(t,e,n,i){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(i),this._data=e.data,this._options=Ke({},e),this._collectResourceTiming=e.collectResourceTiming,void 0!==e.maxzoom&&(this.maxzoom=e.maxzoom),e.type&&(this.type=e.type),e.attribution&&(this.attribution=e.attribution),this.promoteId=e.promoteId;const a=he/this.tileSize;this.workerOptions=Ke({source:this.id,scope:this.scope,cluster:e.cluster||!1,geojsonVtOptions:{buffer:(void 0!==e.buffer?e.buffer:128)*a,tolerance:(void 0!==e.tolerance?e.tolerance:.375)*a,extent:he,maxZoom:this.maxzoom,lineMetrics:e.lineMetrics||!1,generateId:e.generateId||!1},superclusterOptions:{maxZoom:void 0!==e.clusterMaxZoom?e.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,e.clusterMinPoints||2),extent:he,radius:(void 0!==e.clusterRadius?e.clusterRadius:50)*a,log:!1,generateId:e.generateId||!1},clusterProperties:e.clusterProperties,filter:e.filter},e.workerOptions)}onAdd(t){this.map=t,this.setData(this._data)}setData(t){return this._data=t,this._updateWorkerData(),this}getClusterExpansionZoom(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id,scope:this.scope},e),this}getClusterChildren(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id,scope:this.scope},e),this}getClusterLeaves(t,e,n,i){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:t,limit:e,offset:n},i),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new Se("dataloading",{dataType:"source"})),this._loaded=!1;const t=Ke({},this.workerOptions);t.scope=this.scope;const e=this._data;"string"==typeof e?(t.request=this.map._requestManager.transformRequest(Ct.resolveURL(e),_e.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(e),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(n,i)=>{if(this._loaded=!0,this._pendingLoad=null,n)this.fire(new xt(n));else{const a={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&i&&i.resourceTiming&&i.resourceTiming[this.id]&&(a.resourceTiming=i.resourceTiming[this.id]),this.fire(new Se("data",a)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(t,e){const n=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const i={type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:Ct.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};t.request=this.actor.send(n,i,(a,l)=>(delete t.request,t.unloadVectorData(),t.aborted?e(null):a?e(a):(t.loadVectorData(l,this.map.painter,"reloadTile"===n),e(null))),void 0,"loadTile"===n)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Ke({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends gs{constructor(t,e,n,i){super(t,e,n,i),this.roundZoom=!0,this.type="video",this.options=e}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const e of t.urls)this.urls.push(this.map._requestManager.transformRequest(e,_e.Source).url);!function(e,n){const i=ce.document.createElement("video");i.muted=!0,i.onloadstart=function(){n(null,i)};for(let a=0;a<e.length;a++){const l=ce.document.createElement("source");He(e[a])||(i.crossOrigin="Anonymous"),l.src=e[a],i.appendChild(l)}}(this.urls,(e,n)=>{this._loaded=!0,e?this.fire(new xt(e)):n&&(this.video=n,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const e=this.video.seekable;t<e.start(0)||t>e.end(0)?this.fire(new xt(new Ye(`sources.${this.id}`,null,`Playback for this video can be set only between the ${e.start(0)} and ${e.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,e=t.gl;this.texture?this.video.paused||(this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE),e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,this.video)):(this.texture=new Wr(t,this.video,e.RGBA),this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(t)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:gs,model:class extends Mn{constructor(t,e,n,i){super(),this.id=t,this.type="model",this.models=[],this._loaded=!1,this._options=e}load(){const t=[];for(const e in this._options.models){const n=this._options.models[e],i=hC(this.map._requestManager.transformRequest(n.uri,_e.Model).url).then(a=>{if(!a)return;const l=gp(a),c=new bE(e,n.position,n.orientation,l);c.computeBoundsAndApplyParent(),this.models.push(c)}).catch(a=>{this.fire(new xt(new Error(`Could not load model ${e} from ${n.uri}: ${a.message}`)))});t.push(i)}return Promise.allSettled(t).then(()=>{this._loaded=!0,this.fire(new Se("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(e=>{this.fire(new xt(new Error(`Could not load models: ${e.message}`)))})}onAdd(t){this.map=t,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(t,e){}serialize(){return{type:"model"}}},"batched-model":class extends Mn{constructor(t,e,n,i){super(),this.type="batched-model",this.id=t,this.tileSize=512,this._options=e,this.tiles=this._options.tiles,this.maxzoom=e.maxzoom||19,this.minzoom=e.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=n,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(i)}onAdd(t){this.map=t,this.load()}load(t){this._loaded=!1,this.fire(new Se("dataloading",{dataType:"source"}));const e=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map._worldview;this._tileJSONRequest=qg(this._options,this.map._requestManager,e,n,(i,a)=>{this._tileJSONRequest=null,this._loaded=!0,i?(e&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${e}`),n&&2!==n.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new xt(i))):a&&(Ke(this,a),a.bounds&&(this.tileBounds=new hp(a.bounds,this.minzoom,this.maxzoom)),ka(a.tiles,this.map._requestManager._customAccessToken),this.fire(new Se("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Se("data",{dataType:"source",sourceDataType:"content"}))),t&&t(i)})}hasTransition(){return!1}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loaded(){return this._loaded}loadTile(t,e){const n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),i={request:this.map._requestManager.transformRequest(n,_e.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(t.actor&&"expired"!==t.state)if("loading"===t.state)t.reloadCallback=e;else{if(t.buckets){const l=Object.values(t.buckets);for(const c of l)c.dirty=!0;return void(t.state="loaded")}t.request=t.actor.send("reloadTile",i,a.bind(this))}else t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",i,a.bind(this),void 0,!0);function a(l,c){return t.aborted?e(null):l&&404!==l.status?e(l):(c&&(c.resourceTiming&&(t.resourceTiming=c.resourceTiming),this.map._refreshExpiredTiles&&t.setExpiryData(c),t.buckets={...t.buckets,...c.buckets}),t.state="loaded",void e(null))}}serialize(){return Ke({},this._options)}},canvas:class extends gs{constructor(t,e,n,i){super(t,e,n,i),e.coordinates?Array.isArray(e.coordinates)&&4===e.coordinates.length&&!e.coordinates.some(a=>!Array.isArray(a)||2!==a.length||a.some(l=>"number"!=typeof l))||this.fire(new xt(new Ye(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new xt(new Ye(`sources.${t}`,null,'missing required property "coordinates"'))),e.animate&&"boolean"!=typeof e.animate&&this.fire(new xt(new Ye(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),e.canvas?"string"==typeof e.canvas||e.canvas instanceof ce.HTMLCanvasElement||this.fire(new xt(new Ye(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new xt(new Ye(`sources.${t}`,null,'missing required property "canvas"'))),this.options=e,this.animate=void 0===e.animate||e.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof ce.HTMLCanvasElement?this.options.canvas:ce.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new xt(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const e=this.map.painter.context;this.texture?!t&&!this._playing||this.texture instanceof Ag||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Wr(e,this.canvas,e.gl.RGBA,{premultiply:!0}),this._prepareData(e)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}},custom:class extends Mn{constructor(t,e,n,i){super(),this.id=t,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=e,this.setEventedParent(i),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new xt(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new xt(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new hp(this._implementation.bounds,this.minzoom,this.maxzoom)),e.update=this._update.bind(this),e.clearTiles=this._clearTiles.bind(this),e.coveringTiles=this._coveringTiles.bind(this),Ke(this,fi(e,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return fi(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new Se("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Se("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(t){this._map=t,this._loaded=!1,this.fire(new Se("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(t),this.load()}onRemove(t){this._implementation.onRemove&&this._implementation.onRemove(t)}hasTile(t){if(this._implementation.hasTile){const{x:e,y:n,z:i}=t.canonical;return this._implementation.hasTile({x:e,y:n,z:i})}return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,e){const{x:n,y:i,z:a}=t.tileID.canonical,l=new ce.AbortController;t.request=Promise.resolve(this._implementation.loadTile({x:n,y:i,z:a},{signal:l.signal})).then(function(c){return delete t.request,t.aborted?(t.state="unloaded",e(null)):void 0===c?(t.state="errored",e(null)):null===c?(this.loadTileData(t,{width:this.tileSize,height:this.tileSize,data:null}),t.state="loaded",e(null)):(h=c)instanceof ce.ImageData||h instanceof ce.HTMLCanvasElement||h instanceof ce.ImageBitmap||h instanceof ce.HTMLImageElement?(this.loadTileData(t,c),t.state="loaded",void e(null)):(t.state="errored",e(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var h}.bind(this)).catch(c=>{20!==c.code&&(t.state="errored",e(c))}),t.request.cancel=()=>l.abort()}loadTileData(t,e){dp.loadTileData(t,e,this._map.painter)}unloadTileData(t){dp.unloadTileData(t,this._map.painter)}unloadTile(t,e){if(this.unloadTileData(t),this._implementation.unloadTile){const{x:n,y:i,z:a}=t.tileID.canonical;this._implementation.unloadTile({x:n,y:i,z:a})}e()}abortTile(t,e){t.request&&t.request.cancel&&(t.request.cancel(),delete t.request),e()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(t=>({x:t.canonical.x,y:t.canonical.y,z:t.canonical.z}))}_clearTiles(){const t=gr(this.id,this.scope);this._map.style.clearSource(t)}_update(){this.fire(new Se("data",{dataType:"source",sourceDataType:"content"}))}}},G0=function(t,e,n,i){const a=new Qg[e.type](t,e,n,i);if(a.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${a.id}`);return Xr(["load","abort","unload","serialize","prepare"],a),a};function mC(t,e){const n=se.identity([]);return se.scale(n,n,[.5*t.width,.5*-t.height,1]),se.translate(n,n,[1,-1,0]),se.multiply(n,n,t.calculateProjMatrix(e.toUnwrapped())),Float32Array.from(n)}function m2(t,e,n,i,a,l,c,h=!1){const f=t.tilesIn(i,c,h);f.sort(ju);const p=[];for(const _ of f)p.push({wrappedTileID:_.tile.tileID.wrapped().key,queryResults:_.tile.queryRenderedFeatures(e,n,t._state,_,a,l,mC(t.transform,_.tile.tileID),h)});const g=function(_){const y={},v={};for(const w of _){const E=w.queryResults,T=w.wrappedTileID,C=v[T]=v[T]||{};for(const S in E){const I=E[S],R=C[S]=C[S]||{},A=y[S]=y[S]||[];for(const k of I)R[k.featureIndex]||(R[k.featureIndex]=!0,A.push(k))}}return y}(p);for(const _ in g)g[_].forEach(y=>{const v=y.feature,w=v.layer;w&&"background"!==w.type&&"sky"!==w.type&&"slot"!==w.type&&(v.source=w.source,w["source-layer"]&&(v.sourceLayer=w["source-layer"]),v.state=void 0!==v.id?t.getFeatureState(w["source-layer"],v.id):{})});return g}function Oo(t,e){const n=t.getRenderableIds().map(l=>t.getTileByID(l)),i=[],a={};for(let l=0;l<n.length;l++){const c=n[l],h=c.tileID.canonical.key;a[h]||(a[h]=!0,c.querySourceFeatures(i,e))}return i}function ju(t,e){const n=t.tileID,i=e.tileID;return n.overscaledZ-i.overscaledZ||n.canonical.y-i.canonical.y||n.wrap-i.wrap||n.canonical.x-i.canonical.x}class g2{constructor(e){this.style=e}processLayersChanged(){this.layers=[];for(const e in this.style._mergedLayers){const n=this.style._mergedLayers[e];if("fill-extrusion"===n.type)this.layers.push(n);else if("model"===n.type){const i=this.style.getLayerSource(n);i&&"batched-model"===i.type&&this.layers.push(n)}}}updateZOffset(e,n){this.currentBuildingBuckets=[];for(let a=0;a<this.layers.length;++a){const l=this.layers[a],c=this.style.getLayerSourceCache(l);let h=1;"fill-extrusion"===l.type&&(h=l.paint.get("fill-extrusion-opacity")>0?l.paint.get("fill-extrusion-vertical-scale"):0);let f=c?c.getTile(n):null;if(!f&&c&&n.canonical.z>c.getSource().minzoom){let p=n.scaledTo(Math.min(c.getSource().maxzoom,n.overscaledZ-1));for(;p.overscaledZ>=c.getSource().minzoom&&(f=c.getTile(p),!f&&0!==p.overscaledZ);)p=p.scaledTo(p.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:f?f.getBucket(l):null,tileID:f?f.tileID:n,verticalScale:h})}e.hasAnyZOffset=!1;let i=!1;for(let a=0;a<e.symbolInstances.length;a++){const l=e.symbolInstances.get(a),c=l.zOffset,h=this._getHeightAtTileOffset(n,l.tileAnchorX,l.tileAnchorY);l.zOffset=-1!==h?h:c,i||c===l.zOffset||(i=!0),e.hasAnyZOffset||0===l.zOffset||(e.hasAnyZOffset=!0)}i&&(e.zOffsetBuffersNeedUpload=!0,e.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(e,n,i,a){let l=n,c=i;if(e.canonical.z!==a.canonical.z){const h=a.canonical,f=1/(1<<e.canonical.z-h.z);l=(n+e.canonical.x*he)*f-h.x*he|0,c=(i+e.canonical.y*he)*f-h.y*he|0}return{tileX:l,tileY:c}}_getHeightAtTileOffset(e,n,i){let a;for(let l=0;l<this.layers.length;++l){if("fill-extrusion"!==this.layers[l].type)continue;const{bucket:c,tileID:h,verticalScale:f}=this.currentBuildingBuckets[l];if(!c)continue;const{tileX:p,tileY:g}=this._mapCoordToOverlappingTile(e,n,i,h),_=c.getHeightAtTileCoord(p,g);if(_&&void 0!==_.height){if(!_.hidden)return _.height*f;a=_.height}}for(let l=0;l<this.layers.length;++l){if("model"!==this.layers[l].type)continue;const{bucket:c,tileID:h}=this.currentBuildingBuckets[l];if(!c)continue;const{tileX:f,tileY:p}=this._mapCoordToOverlappingTile(e,n,i,h),g=c.getHeightAtTileCoord(f,p);if(g&&!g.hidden)return void 0===g.height&&void 0!==a?Math.min(g.maxHeight,a)*g.verticalScale:(g.height||0)*g.verticalScale}return-1}}var gC=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function SI(t,e){const n={};for(const i in t)"ref"!==i&&(n[i]=t[i]);return gC.forEach(i=>{i in e&&(n[i]=e[i])}),n}function _2(t){t=t.slice();const e=Object.create(null);for(let n=0;n<t.length;n++)e[t[n].id]=t[n];for(let n=0;n<t.length;n++)"ref"in t[n]&&(t[n]=SI(t[n],e[t[n].ref]));return t}const yn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function q0(t,e,n){n.push({command:yn.addSource,args:[t,e[t]]})}function md(t,e,n){e.push({command:yn.removeSource,args:[t]}),n[t]=!0}function y2(t,e,n,i){md(t,n,i),q0(t,e,n)}function W0(t,e,n){let i;for(i in t[n])if(t[n].hasOwnProperty(i)&&"data"!==i&&!ln(t[n][i],e[n][i]))return!1;for(i in e[n])if(e[n].hasOwnProperty(i)&&"data"!==i&&!ln(t[n][i],e[n][i]))return!1;return!0}function e_(t,e,n,i,a,l){let c;for(c in e=e||{},t=t||{})t.hasOwnProperty(c)&&(ln(t[c],e[c])||n.push({command:l,args:[i,c,e[c],a]}));for(c in e)e.hasOwnProperty(c)&&!t.hasOwnProperty(c)&&(ln(t[c],e[c])||n.push({command:l,args:[i,c,e[c],a]}))}function _p(t){return t.id}function t_(t,e){return t[e.id]=e,t}class v2{constructor(e,n){this.reset(e,n)}reset(e,n){this.points=e||[],this._distances=[0];for(let i=1;i<this.points.length;i++)this._distances[i]=this._distances[i-1]+this.points[i].dist(this.points[i-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=et(e,0,1);let n=1,i=this._distances[n];const a=e*this.paddedLength+this.padding;for(;i<a&&n<this._distances.length;)i=this._distances[++n];const l=n-1,c=this._distances[l],h=i-c,f=h>0?(a-c)/h:0;return this.points[l].mult(1-f).add(this.points[n].mult(f))}}class _C{constructor(e,n,i){const a=this.boxCells=[],l=this.circleCells=[];this.xCellCount=Math.ceil(e/i),this.yCellCount=Math.ceil(n/i);for(let c=0;c<this.xCellCount*this.yCellCount;c++)a.push([]),l.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=n,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,n,i,a,l){this._forEachCell(n,i,a,l,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(l)}insertCircle(e,n,i,a){this._forEachCell(n-a,i-a,n+a,i+a,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(n),this.circles.push(i),this.circles.push(a)}_insertBoxCell(e,n,i,a,l,c){this.boxCells[l].push(c)}_insertCircleCell(e,n,i,a,l,c){this.circleCells[l].push(c)}_query(e,n,i,a,l,c){if(i<0||e>this.width||a<0||n>this.height)return!l&&[];const h=[];if(e<=0&&n<=0&&this.width<=i&&this.height<=a){if(l)return!0;for(let f=0;f<this.boxKeys.length;f++)h.push({key:this.boxKeys[f],x1:this.bboxes[4*f],y1:this.bboxes[4*f+1],x2:this.bboxes[4*f+2],y2:this.bboxes[4*f+3]});for(let f=0;f<this.circleKeys.length;f++){const p=this.circles[3*f],g=this.circles[3*f+1],_=this.circles[3*f+2];h.push({key:this.circleKeys[f],x1:p-_,y1:g-_,x2:p+_,y2:g+_})}return c?h.filter(c):h}return this._forEachCell(e,n,i,a,this._queryCell,h,{hitTest:l,seenUids:{box:{},circle:{}}},c),l?h.length>0:h}_queryCircle(e,n,i,a,l){const c=e-i,h=e+i,f=n-i,p=n+i;if(h<0||c>this.width||p<0||f>this.height)return!a&&[];const g=[];return this._forEachCell(c,f,h,p,this._queryCellCircle,g,{hitTest:a,circle:{x:e,y:n,radius:i},seenUids:{box:{},circle:{}}},l),a?g.length>0:g}query(e,n,i,a,l){return this._query(e,n,i,a,!1,l)}hitTest(e,n,i,a,l){return this._query(e,n,i,a,!0,l)}hitTestCircle(e,n,i,a){return this._queryCircle(e,n,i,!0,a)}_queryCell(e,n,i,a,l,c,h,f){const p=h.seenUids,g=this.boxCells[l];if(null!==g){const y=this.bboxes;for(const v of g)if(!p.box[v]){p.box[v]=!0;const w=4*v;if(e<=y[w+2]&&n<=y[w+3]&&i>=y[w+0]&&a>=y[w+1]&&(!f||f(this.boxKeys[v]))){if(h.hitTest)return c.push(!0),!0;c.push({key:this.boxKeys[v],x1:y[w],y1:y[w+1],x2:y[w+2],y2:y[w+3]})}}}const _=this.circleCells[l];if(null!==_){const y=this.circles;for(const v of _)if(!p.circle[v]){p.circle[v]=!0;const w=3*v;if(this._circleAndRectCollide(y[w],y[w+1],y[w+2],e,n,i,a)&&(!f||f(this.circleKeys[v]))){if(h.hitTest)return c.push(!0),!0;{const E=y[w],T=y[w+1],C=y[w+2];c.push({key:this.circleKeys[v],x1:E-C,y1:T-C,x2:E+C,y2:T+C})}}}}}_queryCellCircle(e,n,i,a,l,c,h,f){const p=h.circle,g=h.seenUids,_=this.boxCells[l];if(null!==_){const v=this.bboxes;for(const w of _)if(!g.box[w]){g.box[w]=!0;const E=4*w;if(this._circleAndRectCollide(p.x,p.y,p.radius,v[E+0],v[E+1],v[E+2],v[E+3])&&(!f||f(this.boxKeys[w])))return c.push(!0),!0}}const y=this.circleCells[l];if(null!==y){const v=this.circles;for(const w of y)if(!g.circle[w]){g.circle[w]=!0;const E=3*w;if(this._circlesCollide(v[E],v[E+1],v[E+2],p.x,p.y,p.radius)&&(!f||f(this.circleKeys[w])))return c.push(!0),!0}}}_forEachCell(e,n,i,a,l,c,h,f){const p=this._convertToXCellCoord(e),g=this._convertToYCellCoord(n),_=this._convertToXCellCoord(i),y=this._convertToYCellCoord(a);for(let v=p;v<=_;v++)for(let w=g;w<=y;w++)if(l.call(this,e,n,i,a,this.xCellCount*w+v,c,h,f))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,n,i,a,l,c){const h=a-e,f=l-n,p=i+c;return p*p>h*h+f*f}_circleAndRectCollide(e,n,i,a,l,c,h){const f=(c-a)/2,p=Math.abs(e-(a+f));if(p>f+i)return!1;const g=(h-l)/2,_=Math.abs(n-(l+g));if(_>g+i)return!1;if(p<=f||_<=g)return!0;const y=p-f,v=_-g;return y*y+v*v<=i*i}}const js=100;class yC{constructor(e,n,i=new _C(e.width+200,e.height+200,25),a=new _C(e.width+200,e.height+200,25)){this.transform=e,this.grid=i,this.ignoredGrid=a,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+js,this.screenBottomBoundary=e.height+js,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=n}placeCollisionBox(e,n,i,a,l,c,h,f){let p=i.projectedAnchorX,g=i.projectedAnchorY,_=i.projectedAnchorZ;const y=i.elevation,v=i.tileID,w=e.getProjection();if(y&&v){const[k,L,B]=w.upVector(v.canonical,i.tileAnchorX,i.tileAnchorY),j=w.upVectorScale(v.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;p+=k*y*j,g+=L*y*j,_+=B*y*j}const E=this.projectAndGetPerspectiveRatio(h,p,g,_,i.tileID,"globe"===w.name||!!y||this.transform.pitch>0,w),T=c*E.perspectiveRatio,C=(i.x1*n+a.x-i.padding)*T+E.point.x,S=(i.y1*n+a.y-i.padding)*T+E.point.y,I=(i.x2*n+a.x+i.padding)*T+E.point.x,R=(i.y2*n+a.y+i.padding)*T+E.point.y,A=E.perspectiveRatio<=.55||E.occluded;return!this.isInsideGrid(C,S,I,R)||!l&&this.grid.hitTest(C,S,I,R,f)||A?{box:[],offscreen:!1,occluded:E.occluded}:{box:[C,S,I,R],offscreen:this.isOffscreen(C,S,I,R),occluded:!1}}placeCollisionCircles(e,n,i,a,l,c,h,f,p,g,_,y,v,w,E){const T=[],C=this.transform.elevation,S=e.getProjection(),I=C?C.getAtTileOffsetFunc(E,this.transform.center.lat,this.transform.worldSize,S):null,R=new ie(i.tileAnchorX,i.tileAnchorY);let{x:A,y:k,z:L}=S.projectTilePoint(R.x,R.y,E.canonical);if(I){const[oe,K,Q]=I(R);A+=oe,k+=K,L+=Q}const B="globe"===S.name,j=this.projectAndGetPerspectiveRatio(h,A,k,L,E,B||!!C||this.transform.pitch>0,S),{perspectiveRatio:U}=j,G=(_?c/U:c*U)/24,$=xa(A,k,L,f),W=j.signedDistanceFromCamera>0?h0(G,l,i.lineOffsetX*G,i.lineOffsetY*G,!1,$,R,i,a,f,{},C&&!_?I:null,_&&!!C,S,E,_):null;let H=!1,J=!1,te=!0;if(W&&!j.occluded){const oe=.5*v*U+w,K=new ie(-100,-100),Q=new ie(this.screenRightBoundary,this.screenBottomBoundary),ae=new v2,{first:ue,last:fe}=W,ge=ue.path.length;let ve=[];for(let Oe=ge-1;Oe>=1;Oe--)ve.push(ue.path[Oe]);for(let Oe=1;Oe<fe.path.length;Oe++)ve.push(fe.path[Oe]);const de=2.5*oe;p&&(ve=ve.map(([Oe,qe,Ge],We)=>(I&&!B&&(Ge=I(We<ge-1?ue.tilePath[ge-1-We]:fe.tilePath[We-ge+2])[2]),xa(Oe,qe,Ge,p))),ve.some(Oe=>Oe[3]<=0)&&(ve=[]));let me=[];if(ve.length>0){let Oe=1/0,qe=-1/0,Ge=1/0,We=-1/0;for(const it of ve)Oe=Math.min(Oe,it[0]),Ge=Math.min(Ge,it[1]),qe=Math.max(qe,it[0]),We=Math.max(We,it[1]);qe>=K.x&&Oe<=Q.x&&We>=K.y&&Ge<=Q.y&&(me=[ve.map(it=>new ie(it[0],it[1]))],(Oe<K.x||qe>Q.x||Ge<K.y||We>Q.y)&&(me=Ib(me,K.x,K.y,Q.x,Q.y)))}for(const Oe of me){ae.reset(Oe,.25*oe);let qe=0;qe=ae.length<=.5*oe?1:Math.ceil(ae.paddedLength/de)+1;for(let Ge=0;Ge<qe;Ge++){const We=Ge/Math.max(qe-1,1),it=ae.lerp(We),gt=it.x+js,zt=it.y+js;T.push(gt,zt,oe,0);const an=gt-oe,Ft=zt-oe,Dt=gt+oe,pt=zt+oe;if(te=te&&this.isOffscreen(an,Ft,Dt,pt),J=J||this.isInsideGrid(an,Ft,Dt,pt),!n&&this.grid.hitTestCircle(gt,zt,oe,y)&&(H=!0,!g))return{circles:[],offscreen:!1,collisionDetected:H,occluded:!1}}}}return{circles:!g&&H||!J?[]:T,offscreen:te,collisionDetected:H,occluded:j.occluded}}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const n=[];let i=1/0,a=1/0,l=-1/0,c=-1/0;for(const g of e){const _=new ie(g.x+js,g.y+js);i=Math.min(i,_.x),a=Math.min(a,_.y),l=Math.max(l,_.x),c=Math.max(c,_.y),n.push(_)}const h=this.grid.query(i,a,l,c).concat(this.ignoredGrid.query(i,a,l,c)),f={},p={};for(const g of h){const _=g.key;void 0===f[_.bucketInstanceId]&&(f[_.bucketInstanceId]={}),f[_.bucketInstanceId][_.featureIndex]||Uw(n,[new ie(g.x1,g.y1),new ie(g.x2,g.y1),new ie(g.x2,g.y2),new ie(g.x1,g.y2)])&&(f[_.bucketInstanceId][_.featureIndex]=!0,void 0===p[_.bucketInstanceId]&&(p[_.bucketInstanceId]=[]),p[_.bucketInstanceId].push(_.featureIndex))}return p}insertCollisionBox(e,n,i,a,l){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:a,collisionGroupID:l},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,n,i,a,l){const c=n?this.ignoredGrid:this.grid,h={bucketInstanceId:i,featureIndex:a,collisionGroupID:l};for(let f=0;f<e.length;f+=4)c.insertCircle(h,e[f],e[f+1],e[f+2])}projectAndGetPerspectiveRatio(e,n,i,a,l,c,h){const f=[n,i,a,1];let p=!1;a||this.transform.pitch>0?(bn.transformMat4(f,f,e),this.fogState&&l&&"globe"!==h.name&&(p=function(y,v,w,E,T,C){const S=C.calculateFogTileMatrix(T),I=[v,w,E];return Z.transformMat4(I,I,S),P0(y,Z.length(I),C.pitch,C._fov)}(this.fogState,n,i,a,l.toUnwrapped(),this.transform)>.9)):wE(f,f,e);const g=f[3];return{point:new ie((f[0]/g+1)/2*this.transform.width+js,(-f[1]/g+1)/2*this.transform.height+js),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(h)/g*.5,1.5),signedDistanceFromCamera:g,occluded:c&&f[2]>g||p}}isOffscreen(e,n,i,a){return i<js||e>=this.screenRightBoundary||a<js||n>this.screenBottomBoundary}isInsideGrid(e,n,i,a){return i>=0&&e<this.gridRightBoundary&&a>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const e=se.identity([]);return se.translate(e,e,[-100,-100,0]),e}}function n_(t,e,n){const i=e.createTileMatrix(t,t.worldSize,n.toUnwrapped());return se.multiply(new Float32Array(16),t.projMatrix,i)}function r_(t,e,n){if(e.projection.name===n.projection.name)return t.projMatrix;const i=n.clone();return i.setProjection(e.projection),n_(i,e.getProjection(),t)}function yp(t,e,n){return e.name===n.projection.name?t.projMatrix:n_(n,e,t)}class x2{constructor(e,n,i,a){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?n:-n))):a&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class gd{constructor(e,n,i,a,l,c=!1){this.text=new x2(e?e.text:null,n,i,l),this.icon=new x2(e?e.icon:null,n,a,l),this.clipped=c}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Z0{constructor(e,n,i,a=!1){this.text=e,this.icon=n,this.skipFade=i,this.clipped=a}}class vC{constructor(){this.invProjMatrix=se.create(),this.viewportMatrix=se.create(),this.circles=[]}}class _d{constructor(e,n,i,a,l){this.bucketInstanceId=e,this.featureIndex=n,this.sourceLayerIndex=i,this.bucketIndex=a,this.tileID=l}}class w2{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const n=++this.maxGroupID;this.collisionGroups[e]={ID:n,predicate:i=>i.collisionGroupID===n}}return this.collisionGroups[e]}}function X0(t,e,n,i,a){const{horizontalAlign:l,verticalAlign:c}=vg(t),h=-(l-.5)*e,f=-(c-.5)*n,p=bg(t,i);return new ie(h+p[0]*a,f+p[1]*a)}function vp(t,e,n,i,a){const l=new ie(t,e);return n&&l._rotate(i?a:-a),l}class AI{constructor(e,n,i,a,l,c){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new yC(this.transform,l),this.buildingIndex=c,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new w2(i),this.collisionCircleArrays={},this.prevPlacement=a,a&&(a.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,n,i,a){const l=i.getBucket(n),c=i.latestFeatureIndex;if(!l||!c||n.fqid!==l.layerIds[0])return;const h=l.layers[0].layout,f=i.collisionBoxArray,p=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),g=i.tileSize/he,_=i.tileID.toUnwrapped();this.transform.setProjection(l.projection);const y=(v=i.tileID,w=l.getProjection(),E=this.transform,w.name===this.projection?E.calculateProjMatrix(v.toUnwrapped()):n_(E,w,v));var v,w,E;const T="map"===h.get("text-pitch-alignment"),C="map"===h.get("text-rotation-alignment");n.compileFilter();const S=n.dynamicFilter(),I=n.dynamicFilterNeedsFeature(),R=this.transform.calculatePixelsToTileUnitsMatrix(i),A=l0(y,i.tileID.canonical,T,C,this.transform,l.getProjection(),R);let k=null;if(T){const j=c0(y,i.tileID.canonical,T,C,this.transform,l.getProjection(),R);k=se.multiply([],this.transform.labelPlaneMatrix,j)}let L=null;S&&i.latestFeatureIndex&&(L={unwrappedTileID:_,dynamicFilter:S,dynamicFilterNeedsFeature:I,featureIndex:i.latestFeatureIndex}),this.retainedQueryData[l.bucketInstanceId]=new _d(l.bucketInstanceId,c,l.sourceLayerIndex,l.index,i.tileID);const B={bucket:l,layout:h,posMatrix:y,textLabelPlaneMatrix:A,labelToScreenMatrix:k,clippingData:L,scale:p,textPixelRatio:g,holdingForFade:i.holdingForFade(),collisionBoxArray:f,partiallyEvaluatedTextSize:pa(l.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:pa(l.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(l.sourceID)};if(a)for(const j of l.sortKeyRanges){const{sortKey:U,symbolInstanceStart:G,symbolInstanceEnd:$}=j;e.push({sortKey:U,symbolInstanceStart:G,symbolInstanceEnd:$,parameters:B})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:l.symbolInstances.length,parameters:B})}attemptAnchorPlacement(e,n,i,a,l,c,h,f,p,g,_,y,v,w,E,T,C,S){const{textOffset0:I,textOffset1:R,crossTileID:A}=y,k=[I,R],L=X0(e,i,a,k,l),B=this.collisionIndex.placeCollisionBox(w,l,n,vp(L.x,L.y,c,h,this.transform.angle),_,f,p,g.predicate);if(T){const j=w.getSymbolInstanceIconSize(S,this.transform.zoom,y.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(w,j,T,vp(L.x,L.y,c,h,this.transform.angle),_,f,p,g.predicate).box.length)return}if(B.box.length>0){let j;return this.prevPlacement&&this.prevPlacement.variableOffsets[A]&&this.prevPlacement.placements[A]&&this.prevPlacement.placements[A].text&&(j=this.prevPlacement.variableOffsets[A].anchor),this.variableOffsets[A]={textOffset:k,width:i,height:a,anchor:e,textScale:l,prevAnchor:j},this.markUsedJustification(w,e,y,E),w.allowVerticalPlacement&&(this.markUsedOrientation(w,E,y),this.placedOrientations[A]=E),{shift:L,placedGlyphBoxes:B}}}placeLayerBucketPart(e,n,i,a){const{bucket:l,layout:c,posMatrix:h,textLabelPlaneMatrix:f,labelToScreenMatrix:p,clippingData:g,textPixelRatio:_,holdingForFade:y,collisionBoxArray:v,partiallyEvaluatedTextSize:w,partiallyEvaluatedIconSize:E,collisionGroup:T}=e.parameters,C=c.get("text-optional"),S=c.get("icon-optional"),I=c.get("text-allow-overlap"),R=c.get("icon-allow-overlap"),A="map"===c.get("text-rotation-alignment"),k="map"===c.get("text-pitch-alignment"),L="viewport-y"===c.get("symbol-z-order"),B=c.get("symbol-z-elevate");this.transform.setProjection(l.projection);let j=I&&(R||!l.hasIconData()||S),U=R&&(I||!l.hasTextData()||C);!l.collisionArrays&&v&&l.deserializeCollisionBoxes(v),i&&a&&l.updateCollisionDebugBuffers(this.transform.zoom,v);const G=($,W,H)=>{const{crossTileID:J,numVerticalGlyphVertices:te}=$;if(g){const Dt={zoom:this.transform.zoom,pitch:this.transform.pitch};let pt=null;if(g.dynamicFilterNeedsFeature){const ut=this.retainedQueryData[l.bucketInstanceId];pt=g.featureIndex.loadFeature({featureIndex:$.featureIndex,bucketIndex:ut.bucketIndex,sourceLayerIndex:ut.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,g.dynamicFilter)(Dt,pt,this.retainedQueryData[l.bucketInstanceId].tileID.canonical,new ie($.tileAnchorX,$.tileAnchorY),this.transform.calculateDistanceTileData(g.unwrappedTileID)))return this.placements[J]=new Z0(!1,!1,!1,!0),void n.add(J)}if(n.has(J))return;if(y)return void(this.placements[J]=new Z0(!1,!1,!1));let oe=!1,K=!1,Q=!0,ae=!1,ue=!1,fe=null,ge={box:null,offscreen:null,occluded:null},ve={box:null,offscreen:null,occluded:null},de=null,me=null,Oe=null,qe=0,Ge=0,We=0;H.textFeatureIndex?qe=H.textFeatureIndex:$.useRuntimeCollisionCircles&&(qe=$.featureIndex),H.verticalTextFeatureIndex&&(Ge=H.verticalTextFeatureIndex);const it=Dt=>{Dt.tileID=this.retainedQueryData[l.bucketInstanceId].tileID;const pt=this.transform.elevation;Dt.elevation=$.zOffset+(pt?pt.getAtTileOffset(Dt.tileID,Dt.tileAnchorX,Dt.tileAnchorY):0)},gt=H.textBox;if(gt){it(gt);const Dt=ut=>{let Kt=or.horizontal;if(l.allowVerticalPlacement&&!ut&&this.prevPlacement){const dn=this.prevPlacement.placedOrientations[J];dn&&(this.placedOrientations[J]=dn,Kt=dn,this.markUsedOrientation(l,Kt,$))}return Kt},pt=(ut,Kt)=>{if(l.allowVerticalPlacement&&te>0&&H.verticalTextBox){for(const dn of l.writingModes)if(dn===or.vertical?(ge=Kt(),ve=ge):ge=ut(),ge&&ge.box&&ge.box.length)break}else ge=ut()};if(c.get("text-variable-anchor")){let ut=c.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[J]){const Bt=this.prevPlacement.variableOffsets[J];ut.indexOf(Bt.anchor)>0&&(ut=ut.filter(Rn=>Rn!==Bt.anchor),ut.unshift(Bt.anchor))}const Kt=(Bt,Rn,Jn)=>{const Xn=l.getSymbolInstanceTextSize(w,$,this.transform.zoom,W),Hn=(Bt.x2-Bt.x1)*Xn+2*Bt.padding,Nr=(Bt.y2-Bt.y1)*Xn+2*Bt.padding,Qn=$.hasIconTextFit&&!R?Rn:null;Qn&&it(Qn);let sr={box:[],offscreen:!1,occluded:!1};const In=I?2*ut.length:ut.length;for(let xo=0;xo<In;++xo){const ul=this.attemptAnchorPlacement(ut[xo%ut.length],Bt,Hn,Nr,Xn,A,k,_,h,T,xo>=ut.length,$,W,l,Jn,Qn,w,E);if(ul&&(sr=ul.placedGlyphBoxes,sr&&sr.box&&sr.box.length)){oe=!0,fe=ul.shift;break}}return sr};pt(()=>Kt(gt,H.iconBox,or.horizontal),()=>{const Bt=H.verticalTextBox;return Bt&&it(Bt),l.allowVerticalPlacement&&!(ge&&ge.box&&ge.box.length)&&te>0&&Bt?Kt(Bt,H.verticalIconBox,or.vertical):{box:null,offscreen:null,occluded:null}}),ge&&(oe=ge.box,Q=ge.offscreen,ae=ge.occluded);const dn=Dt(!(!ge||!ge.box));if(!oe&&this.prevPlacement){const Bt=this.prevPlacement.variableOffsets[J];Bt&&(this.variableOffsets[J]=Bt,this.markUsedJustification(l,Bt.anchor,$,dn))}}else{const ut=(Kt,dn)=>{const Bt=l.getSymbolInstanceTextSize(w,$,this.transform.zoom,W),Rn=this.collisionIndex.placeCollisionBox(l,Bt,Kt,new ie(0,0),I,_,h,T.predicate);return Rn&&Rn.box&&Rn.box.length&&(this.markUsedOrientation(l,dn,$),this.placedOrientations[J]=dn),Rn};pt(()=>ut(gt,or.horizontal),()=>{const Kt=H.verticalTextBox;return l.allowVerticalPlacement&&te>0&&Kt?(it(Kt),ut(Kt,or.vertical)):{box:null,offscreen:null,occluded:null}}),Dt(!!(ge&&ge.box&&ge.box.length))}}if(de=ge,oe=de&&de.box&&de.box.length>0,Q=de&&de.offscreen,ae=de&&de.occluded,$.useRuntimeCollisionCircles){const Dt=l.text.placedSymbolArray.get($.centerJustifiedTextSymbolIndex>=0?$.centerJustifiedTextSymbolIndex:$.verticalPlacedTextSymbolIndex),pt=fg(l.textSizeData,w,Dt),ut=c.get("text-padding");me=this.collisionIndex.placeCollisionCircles(l,I,Dt,l.lineVertexArray,l.glyphOffsetArray,pt,h,f,p,i,k,T.predicate,$.collisionCircleDiameter*pt/24,ut,this.retainedQueryData[l.bucketInstanceId].tileID),oe=I||me.circles.length>0&&!me.collisionDetected,Q=Q&&me.offscreen,ae=me.occluded}if(H.iconFeatureIndex&&(We=H.iconFeatureIndex),H.iconBox){const Dt=pt=>{it(pt);const ut=$.hasIconTextFit&&fe?vp(fe.x,fe.y,A,k,this.transform.angle):new ie(0,0),Kt=l.getSymbolInstanceIconSize(E,this.transform.zoom,$.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(l,Kt,pt,ut,R,_,h,T.predicate)};ve&&ve.box&&ve.box.length&&H.verticalIconBox?(Oe=Dt(H.verticalIconBox),K=Oe.box.length>0):(Oe=Dt(H.iconBox),K=Oe.box.length>0),Q=Q&&Oe.offscreen,ue=Oe.occluded}const zt=C||0===$.numHorizontalGlyphVertices&&0===te,an=S||0===$.numIconVertices;if(zt||an?an?zt||(K=K&&oe):oe=K&&oe:K=oe=K&&oe,oe&&de&&de.box&&this.collisionIndex.insertCollisionBox(de.box,c.get("text-ignore-placement"),l.bucketInstanceId,ve&&ve.box&&Ge?Ge:qe,T.ID),K&&Oe&&this.collisionIndex.insertCollisionBox(Oe.box,c.get("icon-ignore-placement"),l.bucketInstanceId,We,T.ID),me&&(oe&&this.collisionIndex.insertCollisionCircles(me.circles,c.get("text-ignore-placement"),l.bucketInstanceId,qe,T.ID),i)){const Dt=l.bucketInstanceId;let pt=this.collisionCircleArrays[Dt];void 0===pt&&(pt=this.collisionCircleArrays[Dt]=new vC);for(let ut=0;ut<me.circles.length;ut+=4)pt.circles.push(me.circles[ut+0]),pt.circles.push(me.circles[ut+1]),pt.circles.push(me.circles[ut+2]),pt.circles.push(me.collisionDetected?1:0)}const Ft="globe"!==l.projection.name;j=j&&(Ft||!ae),U=U&&(Ft||!ue),this.placements[J]=new Z0(oe||j,K||U,Q||l.justReloaded),n.add(J)};if(B&&this.buildingIndex&&(this.buildingIndex.updateZOffset(l,this.retainedQueryData[l.bucketInstanceId].tileID),l.updateZOffset()),L){const $=l.getSortedSymbolIndexes(this.transform.angle);for(let W=$.length-1;W>=0;--W){const H=$[W];G(l.symbolInstances.get(H),H,l.collisionArrays[H])}l.hasAnyZOffset&&ee(`${l.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(l.hasAnyZOffset){const $=l.getSortedIndexesByZOffset();for(let W=0;W<$.length;++W){const H=$[W];G(l.symbolInstances.get(H),H,l.collisionArrays[H])}}else for(let $=e.symbolInstanceStart;$<e.symbolInstanceEnd;$++)G(l.symbolInstances.get($),$,l.collisionArrays[$]);if(i&&l.bucketInstanceId in this.collisionCircleArrays){const $=this.collisionCircleArrays[l.bucketInstanceId];se.invert($.invProjMatrix,h),$.viewportMatrix=this.collisionIndex.getViewportMatrix()}l.justReloaded=!1}markUsedJustification(e,n,i,a){const{leftJustifiedTextSymbolIndex:l,centerJustifiedTextSymbolIndex:c,rightJustifiedTextSymbolIndex:h,verticalPlacedTextSymbolIndex:f,crossTileID:p}=i,g=Eg(n),_=a===or.vertical?f:"left"===g?l:"center"===g?c:"right"===g?h:-1;l>=0&&(e.text.placedSymbolArray.get(l).crossTileID=_>=0&&l!==_?0:p),c>=0&&(e.text.placedSymbolArray.get(c).crossTileID=_>=0&&c!==_?0:p),h>=0&&(e.text.placedSymbolArray.get(h).crossTileID=_>=0&&h!==_?0:p),f>=0&&(e.text.placedSymbolArray.get(f).crossTileID=_>=0&&f!==_?0:p)}markUsedOrientation(e,n,i){const a=n===or.horizontal||n===or.horizontalOnly?n:0,l=n===or.vertical?n:0,{leftJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:h,rightJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:p}=i,g=e.text.placedSymbolArray;c>=0&&(g.get(c).placedOrientation=a),h>=0&&(g.get(h).placedOrientation=a),f>=0&&(g.get(f).placedOrientation=a),p>=0&&(g.get(p).placedOrientation=l)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let i=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const a=n?n.symbolFadeChange(e):1,l=n?n.opacities:{},c=n?n.variableOffsets:{},h=n?n.placedOrientations:{};for(const f in this.placements){const p=this.placements[f],g=l[f];g?(this.opacities[f]=new gd(g,a,p.text,p.icon,null,p.clipped),i=i||p.text!==g.text.placed||p.icon!==g.icon.placed):(this.opacities[f]=new gd(null,a,p.text,p.icon,p.skipFade,p.clipped),i=i||p.text||p.icon)}for(const f in l){const p=l[f];if(!this.opacities[f]){const g=new gd(p,a,!1,!1);g.isHidden()||(this.opacities[f]=g,i=i||p.text.placed||p.icon.placed)}}for(const f in c)this.variableOffsets[f]||!this.opacities[f]||this.opacities[f].isHidden()||(this.variableOffsets[f]=c[f]);for(const f in h)this.placedOrientations[f]||!this.opacities[f]||this.opacities[f].isHidden()||(this.placedOrientations[f]=h[f]);i?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:e)}updateLayerOpacities(e,n){const i=new Set;for(const a of n){const l=a.getBucket(e);l&&a.latestFeatureIndex&&e.fqid===l.layerIds[0]&&(this.updateBucketOpacities(l,i,a.collisionBoxArray),l.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(l,a.tileID),l.updateZOffset()))}}updateBucketOpacities(e,n,i){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const a=e.layers[0].layout,l=!!e.layers[0].dynamicFilter(),c=new gd(null,0,!1,!1,!0),h=a.get("text-allow-overlap"),f=a.get("icon-allow-overlap"),p=a.get("text-variable-anchor"),g="map"===a.get("text-rotation-alignment"),_="map"===a.get("text-pitch-alignment"),y=new gd(null,0,h&&(f||!e.hasIconData()||a.get("icon-optional")),f&&(h||!e.hasTextData()||a.get("text-optional")),!0);!e.collisionArrays&&i&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(i);const v=(E,T,C)=>{for(let S=0;S<T/4;S++)E.opacityVertexArray.emplaceBack(C)};let w=0;for(let E=0;E<e.symbolInstances.length;E++){const T=e.symbolInstances.get(E),{numHorizontalGlyphVertices:C,numVerticalGlyphVertices:S,crossTileID:I,numIconVertices:R}=T,A=n.has(I);let k=this.opacities[I];A?k=c:k||(k=y,this.opacities[I]=k),n.add(I);const L=C>0||S>0,B=R>0,j=this.placedOrientations[I],U=j===or.vertical,G=j===or.horizontal||j===or.horizontalOnly;if(!L&&!B||k.isHidden()||w++,L){const $=Y0(k.text);v(e.text,C,U?xp:$),v(e.text,S,G?xp:$);const W=k.text.isHidden(),{leftJustifiedTextSymbolIndex:H,centerJustifiedTextSymbolIndex:J,rightJustifiedTextSymbolIndex:te,verticalPlacedTextSymbolIndex:oe}=T,K=e.text.placedSymbolArray,Q=W||U?1:0;H>=0&&(K.get(H).hidden=Q),J>=0&&(K.get(J).hidden=Q),te>=0&&(K.get(te).hidden=Q),oe>=0&&(K.get(oe).hidden=W||G?1:0);const ae=this.variableOffsets[I];ae&&this.markUsedJustification(e,ae.anchor,T,j);const ue=this.placedOrientations[I];ue&&(this.markUsedJustification(e,"left",T,ue),this.markUsedOrientation(e,ue,T))}if(B){const $=Y0(k.icon),{placedIconSymbolIndex:W,verticalPlacedIconSymbolIndex:H}=T,J=e.icon.placedSymbolArray,te=k.icon.isHidden()?1:0;W>=0&&(v(e.icon,R,U?xp:$),J.get(W).hidden=te),H>=0&&(v(e.icon,T.numVerticalIconVertices,G?xp:$),J.get(H).hidden=te)}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const $=e.collisionArrays[E];if($){let W=new ie(0,0),H=!0;if($.textBox||$.verticalTextBox){if(p){const te=this.variableOffsets[I];te?(W=X0(te.anchor,te.width,te.height,te.textOffset,te.textScale),g&&W._rotate(_?this.transform.angle:-this.transform.angle)):H=!1}l&&(H=!k.clipped),$.textBox&&i_(e.textCollisionBox.collisionVertexArray,k.text.placed,!H||U,W.x,W.y),$.verticalTextBox&&i_(e.textCollisionBox.collisionVertexArray,k.text.placed,!H||G,W.x,W.y)}const J=H&&Boolean(!G&&$.verticalIconBox);$.iconBox&&i_(e.iconCollisionBox.collisionVertexArray,k.icon.placed,J,T.hasIconTextFit?W.x:0,T.hasIconTextFit?W.y:0),$.verticalIconBox&&i_(e.iconCollisionBox.collisionVertexArray,k.icon.placed,!J,T.hasIconTextFit?W.x:0,T.hasIconTextFit?W.y:0)}}}if(e.fullyClipped=0===w,e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){const E=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=E.invProjMatrix,e.placementViewportMatrix=E.viewportMatrix,e.collisionCircleArray=E.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,n){const i=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*i>e}setStale(){this.stale=!0}}function i_(t,e,n,i,a){t.emplaceBack(e?1:0,n?1:0,i||0,a||0),t.emplaceBack(e?1:0,n?1:0,i||0,a||0),t.emplaceBack(e?1:0,n?1:0,i||0,a||0),t.emplaceBack(e?1:0,n?1:0,i||0,a||0)}const II=Math.pow(2,25),b2=Math.pow(2,24),E2=Math.pow(2,17),C2=Math.pow(2,16),xC=Math.pow(2,9),wC=Math.pow(2,8),T2=Math.pow(2,1);function Y0(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;const e=t.placed?1:0,n=Math.floor(127*t.opacity);return n*II+e*b2+n*E2+e*C2+n*xC+e*wC+n*T2+e}const xp=0;class D2{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(e,n,i,a,l){const c=this._bucketParts;for(;this._currentTileIndex<e.length;)if(n.getBucketParts(c,a,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,l())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,c.sort((h,f)=>h.sortKey-f.sortKey));this._currentPartIndex<c.length;){const h=c[this._currentPartIndex];if(n.placeLayerBucketPart(h,this._seenCrossTileIDs,i,0===h.symbolInstanceStart),this._currentPartIndex++,l())return!0}return!1}}class M2{constructor(e,n,i,a,l,c,h,f,p){this.placement=new AI(e,l,c,h,f,p),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=a,this._done=!1}isDone(){return this._done}continuePlacement(e,n,i,a){const l=Ct.now(),c=()=>{const h=Ct.now()-l;return!this._forceFullPlacement&&h>2};for(;this._currentPlacementIndex>=0;){const h=n[e[this._currentPlacementIndex]],f=this.placement.collisionIndex.transform.zoom;if("symbol"===h.type&&(!h.minzoom||h.minzoom<=f)&&(!h.maxzoom||h.maxzoom>f)){const p=h,g=p.layout.get("symbol-z-elevate"),_=this._inProgressLayer=this._inProgressLayer||new D2(p),y=gr(h.source,h.scope);if(_.continuePlacement(g?a[y]:i[y],this.placement,this._showCollisionBoxes,h,c))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const K0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class o_{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,i]=new Uint8Array(e,0,2);if(219!==n)throw new Error("Data does not appear to be in a KDBush format.");const a=i>>4;if(1!==a)throw new Error(`Got v${a} data when expected v1.`);const l=K0[15&i];if(!l)throw new Error("Unrecognized array type.");const[c]=new Uint16Array(e,2,1),[h]=new Uint32Array(e,4,1);return new o_(h,c,l,e)}constructor(e,n=64,i=Float64Array,a){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=i,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const l=K0.indexOf(this.ArrayType),c=2*e*this.ArrayType.BYTES_PER_ELEMENT,h=e*this.IndexArrayType.BYTES_PER_ELEMENT,f=(8-h%8)%8;if(l<0)throw new Error(`Unexpected typed array class: ${i}.`);a&&a instanceof ArrayBuffer?(this.data=a,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+h+f,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+c+h+f),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+h+f,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+l]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=e,this.coords[this._pos++]=n,i}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return s_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,i,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:c,nodeSize:h}=this,f=[0,l.length-1,0],p=[];for(;f.length;){const g=f.pop()||0,_=f.pop()||0,y=f.pop()||0;if(_-y<=h){for(let T=y;T<=_;T++){const C=c[2*T],S=c[2*T+1];C>=e&&C<=i&&S>=n&&S<=a&&p.push(l[T])}continue}const v=y+_>>1,w=c[2*v],E=c[2*v+1];w>=e&&w<=i&&E>=n&&E<=a&&p.push(l[v]),(0===g?e<=w:n<=E)&&(f.push(y),f.push(v-1),f.push(1-g)),(0===g?i>=w:a>=E)&&(f.push(v+1),f.push(_),f.push(1-g))}return p}within(e,n,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:a,coords:l,nodeSize:c}=this,h=[0,a.length-1,0],f=[],p=i*i;for(;h.length;){const g=h.pop()||0,_=h.pop()||0,y=h.pop()||0;if(_-y<=c){for(let T=y;T<=_;T++)bC(l[2*T],l[2*T+1],e,n)<=p&&f.push(a[T]);continue}const v=y+_>>1,w=l[2*v],E=l[2*v+1];bC(w,E,e,n)<=p&&f.push(a[v]),(0===g?e-i<=w:n-i<=E)&&(h.push(y),h.push(v-1),h.push(1-g)),(0===g?e+i>=w:n+i>=E)&&(h.push(v+1),h.push(_),h.push(1-g))}return f}}function s_(t,e,n,i,a,l){if(a-i<=n)return;const c=i+a>>1;J0(t,e,c,i,a,l),s_(t,e,n,i,c-1,1-l),s_(t,e,n,c+1,a,1-l)}function J0(t,e,n,i,a,l){for(;a>i;){if(a-i>600){const p=a-i+1,g=n-i+1,_=Math.log(p),y=.5*Math.exp(2*_/3),v=.5*Math.sqrt(_*y*(p-y)/p)*(g-p/2<0?-1:1);J0(t,e,n,Math.max(i,Math.floor(n-g*y/p+v)),Math.min(a,Math.floor(n+(p-g)*y/p+v)),l)}const c=e[2*n+l];let h=i,f=a;for(yd(t,e,i,n),e[2*a+l]>c&&yd(t,e,i,a);h<f;){for(yd(t,e,h,f),h++,f--;e[2*h+l]<c;)h++;for(;e[2*f+l]>c;)f--}e[2*i+l]===c?yd(t,e,i,f):(f++,yd(t,e,f,a)),f<=n&&(i=f+1),n<=f&&(a=f-1)}}function yd(t,e,n,i){a_(t,n,i),a_(e,2*n,2*i),a_(e,2*n+1,2*i+1)}function a_(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function bC(t,e,n,i){const a=t-n,l=e-i;return a*a+l*l}const Q0=.03125;class PI{constructor(e,n,i){this.tileID=e,this.bucketInstanceId=i,this.index=new o_(n.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const a=e.canonical.x*he,l=e.canonical.y*he;for(let c=0;c<n.length;c++){const{key:h,crossTileID:f,tileAnchorX:p,tileAnchorY:g}=n.get(c),_=Math.floor((a+p)*Q0),y=Math.floor((l+g)*Q0);this.index.add(_,y),this.keys.push(h),this.crossTileIDs.push(f)}this.index.finish()}findMatches(e,n,i){const a=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z),l=Q0/Math.pow(2,n.canonical.z-this.tileID.canonical.z),c=n.canonical.x*he,h=n.canonical.y*he;for(let f=0;f<e.length;f++){const p=e.get(f);if(p.crossTileID)continue;const{key:g,tileAnchorX:_,tileAnchorY:y}=p,v=Math.floor((c+_)*l),w=Math.floor((h+y)*l),E=this.index.range(v-a,w-a,v+a,w+a);for(const T of E){const C=this.crossTileIDs[T];if(this.keys[T]===g&&!i.has(C)){i.add(C),p.crossTileID=C;break}}}}}class EC{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class RI{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const n=Math.round((e-this.lng)/360);if(0!==n)for(const i in this.indexes){const a=this.indexes[i],l={};for(const c in a){const h=a[c];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+n),l[h.tileID.key]=h}this.indexes[i]=l}this.lng=e}addBucket(e,n,i){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let l=0;l<n.symbolInstances.length;l++)n.symbolInstances.get(l).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]=new Set);const a=this.usedCrossTileIDs[e.overscaledZ];for(const l in this.indexes){const c=this.indexes[l];if(Number(l)>e.overscaledZ)for(const h in c){const f=c[h];f.tileID.isChildOf(e)&&f.findMatches(n.symbolInstances,e,a)}else{const h=c[e.scaledTo(Number(l)).key];h&&h.findMatches(n.symbolInstances,e,a)}}for(let l=0;l<n.symbolInstances.length;l++){const c=n.symbolInstances.get(l);c.crossTileID||(c.crossTileID=i.generate(),a.add(c.crossTileID))}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new PI(e,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(e,n){for(const i of n.crossTileIDs)this.usedCrossTileIDs[e].delete(i)}removeStaleBuckets(e){let n=!1;for(const i in this.indexes){const a=this.indexes[i];for(const l in a)e[a[l].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,a[l]),delete a[l],n=!0)}return n}}class kI{constructor(){this.layerIndexes={},this.crossTileIDs=new EC,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,n,i,a){let l=this.layerIndexes[e.fqid];void 0===l&&(l=this.layerIndexes[e.fqid]=new RI);let c=!1;const h={};"globe"!==a.name&&l.handleWrapJump(i);for(const f of n){const p=f.getBucket(e);p&&e.fqid===p.layerIds[0]&&(p.bucketInstanceId||(p.bucketInstanceId=++this.maxBucketInstanceId),l.addBucket(f.tileID,p,this.crossTileIDs)&&(c=!0),h[p.bucketInstanceId]=!0)}return l.removeStaleBuckets(h)&&(c=!0),c}pruneUnusedLayers(e){const n={};e.forEach(i=>{n[i]=!0});for(const i in this.layerIndexes)n[i]||delete this.layerIndexes[i]}}var S2="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nvec3 linearTosRGB(vec3 color)\n{return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn)\n{return pow(srgbIn,vec3(2.2));}vec3 linearProduct(vec3 srgbIn,vec3 k)\n{return srgbIn*pow(k,vec3(1./2.2));}\n#if __VERSION__ >=300\n#define _HANDLE_WIREFRAME_DEPTH gl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define _HANDLE_WIREFRAME_DEPTH\n#endif\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\ngl_FragColor=vec4(0.7,0.0,0.0,0.7); \\\n_HANDLE_WIREFRAME_DEPTH;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w-0.0001;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",A2="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",I2="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",P2="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",R2="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",k2="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",wp="#ifdef RENDER_SHADOWS\n#if defined(NATIVE) && __VERSION__ >=300\n#define TEXTURE_GATHER\n#endif\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture2D(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture2D(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture2D(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture2D(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef TEXTURE_GATHER\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const O2=[];xd(S2,O2);const Uu={"_prelude_fog.vertex.glsl":P2,"_prelude_terrain.vertex.glsl":I2,"_prelude_shadow.vertex.glsl":k2,"_prelude_fog.fragment.glsl":R2,"_prelude_shadow.fragment.glsl":wp,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE"},$u={};Tn("",I2),Tn(R2,P2),Tn(wp,k2);const vd=Tn("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;varying float v_cutoff_opacity;\n#endif","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;varying float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),ex=S2;var L2={background:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nattribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;varying vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:Tn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Tn('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:Tn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Tn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nattribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:Tn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Tn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nattribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nattribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nvarying vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nattribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvarying highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nvarying float v_flood_radius;varying float v_has_floodlight;\n#endif\nvarying float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef RENDER_CUTOFF\ncolor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\n#if __VERSION__ >=300\n#ifdef RENDER_CUTOFF\ninvariant gl_Position;\n#endif\n#endif\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nvarying float v_flood_radius;varying float v_has_floodlight;\n#endif\nvarying float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),fillExtrusionDepth:Tn("varying highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\ngl_FragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\nvarying highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying vec3 v_normal;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:Tn('#include "_prelude_shadow.fragment.glsl"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec3 u_ground_shadow_factor;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\ngl_FragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;attribute vec2 a_pos;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:Tn("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nvarying highp vec2 v_pos;varying highp vec4 v_line_segment;varying highp float v_flood_light_radius_tile;varying highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nvarying highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture2D(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\ngl_FragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\ngl_FragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\ngl_FragColor=color;HANDLE_WIREFRAME_DEBUG;\n#endif\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nattribute highp vec4 a_pos_end;attribute highp float a_angular_offset_factor;attribute highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nvarying highp vec2 v_pos;varying highp vec4 v_line_segment;varying highp float v_flood_light_radius_tile;varying highp vec2 v_ao;\n#ifdef FOG\nvarying highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;\n#ifdef FORCE_ABS_FL_GROUND_RADIUS\nfl_ground_radius=abs(flood_light_ground_radius);\n#endif\nfloat flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:Tn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture(u_image,coord).r/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting_with_emission_ground(gl_FragColor,u_emissive_strength);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    \nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec2 u_colorization_scale;uniform highp vec4 u_colorization_mix;highp vec4 colormap (highp float value) {highp float scaled_value=value*u_colorization_scale.y+u_colorization_scale.x;highp vec2 coords=vec2(scaled_value,0.5);return texture2D(u_color_ramp,coords);}\n#endif\nvoid main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);vec4 color;\n#ifdef RASTER_COLOR\nhighp vec4 fadedColor=mix(color0,color1,u_fade_t);color=colormap(dot(vec4(fadedColor.rgb,1),u_colorization_mix));color.a*=fadedColor.a;if (color.a > 0.0) {color.rgb/=color.a;}\n#else\nif (color0.a > 0.0) {color0.rgb/=color0.a;}if (color1.a > 0.0) {color1.rgb/=color1.a;}color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_ground(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;attribute vec2 a_texture_pos;\n#endif\nvarying vec2 v_pos0;varying vec2 v_pos1;void main() {vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*u_globe_matrix*vec4(a_globe_pos,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\nuv=a_texture_pos/8192.0;\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),symbolIcon:Tn('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nvarying float v_fade_opacity;varying vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nvarying vec2 v_tex_b;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture2D(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture2D(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;\n#else\nout_color=texture2D(u_texture,v_tex_a)*alpha;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nattribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef Z_OFFSET\nattribute float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nattribute vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nvarying vec2 v_tex_b;\n#endif\nvarying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;}'),symbolSDF:Tn('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo;\n#if __VERSION__ >=300\ndraw_halo=v_draw_halo > 0.0;\n#else\ndraw_halo=u_is_halo;\n#endif\nif (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nattribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef Z_OFFSET\nattribute float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;\n#if __VERSION__ >=300\nv_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;\n#endif\nv_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:Tn('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo;\n#if __VERSION__ >=300\ndraw_halo=v_draw_halo > 0.0;\n#else\ndraw_halo=u_is_halo;\n#endif\nif (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nattribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef Z_OFFSET\nattribute float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;\n#if __VERSION__ >=300\nv_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture2D(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}'),terrainDepth:Tn("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:Tn('#include "_prelude_fog.fragment.glsl"\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}',A2),skyboxGradient:Tn('#include "_prelude_fog.fragment.glsl"\nvarying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}',A2),skyboxCapture:Tn("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture2D(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:Tn('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\ngl_FragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\ngl_FragColor=vec4(1,1,1,1);\n#else\ngl_FragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);gl_FragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\ngl_FragColor=vec4(c*t,t);\n#endif\n}',"attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;varying highp vec4 v_position_height;varying lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth_shadows;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nvarying lowp vec4 v_roughness_metallic_emissive_alpha;varying mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nvarying highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture2D(u_depthTexture,coord));return v_depth > depth+0.0005;}\n#endif\nconst float M_PI=3.141592653589793;\n#define saturate(_x) clamp(_x,0.,1.)\nfloat calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture2D(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\ntexColor.rgb=sRGBToLinear(texColor.rgb);if(u_baseTextureIsAlpha) {if (texColor.w < 0.5) {discard;}albedo*=mix(vec4(texColor.rgb,texColor.a),vec4(texColor.a),float(u_baseTextureIsAlpha));} else {albedo*=texColor;}\n#endif\nreturn vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture2D( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture2D(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(M_PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/M_PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/M_PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 diffuse=getDiffuseShadedColor(getBaseColor().rgb,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture2D(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(diffuse,1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nfloat ao=(texture2D(u_occlusionTexture,uv_2f).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture2D(u_emissionTexture,uv_2f).rgb);\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\ncolor=mix(color,mat.baseColor.rgb,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\ngl_FragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nattribute vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nattribute vec4 a_normal_matrix0;attribute vec4 a_normal_matrix1;attribute vec4 a_normal_matrix2;attribute vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth_shadows;\n#endif\nvarying vec4 v_position_height;varying lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nvarying highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nvarying lowp vec4 v_roughness_metallic_emissive_alpha;varying mediump vec4 v_height_based_emission_params;\n#endif\nvoid main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=local_pos;\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:Tn("varying highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\ngl_FragColor=pack_depth(v_depth);\n#endif\n}","attribute vec3 a_pos_3f;uniform mat4 u_matrix;varying highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nattribute vec4 a_normal_matrix0;attribute vec4 a_normal_matrix1;attribute vec4 a_normal_matrix2;attribute vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:Tn("varying highp vec2 v_uv;varying mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;gl_FragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nattribute vec3 a_pos_3f;attribute vec2 a_uv;attribute float a_size_scale;attribute float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;varying highp vec2 v_uv;varying mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}")};function xd(t,e){const n=t.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let i of n)if(i=i.trim(),"#"===i[0]&&i.includes("if")&&!i.includes("endif")){i=i.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const a=i.split(" ");for(const l of a)e.includes(l)||e.push(l)}}function Tn(t,e){const n=/#include\s+"([^"]+)"/g,i=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let a=e.match(/attribute(\S*) (highp |mediump |lowp )?([\w]+) ([\w]+)/g);a&&(a=a.filter((p,g)=>a.indexOf(p)===g));const l={},c=[],h=[];t=t.replace(n,(p,g)=>(h.push(g),"")),e=e.replace(n,(p,g)=>(c.push(g),""));let f=[...O2];xd(t,f),xd(e,f);for(const p of[...c,...h])Uu[p]||console.error(`Undefined include: ${p}`),$u[p]||($u[p]=[],xd(Uu[p],$u[p])),f=[...f,...$u[p]];return{fragmentSource:t=t.replace(i,(p,g,_,y,v)=>(l[v]=!0,"define"===g?`\n#ifndef HAS_UNIFORM_u_${v}\nvarying ${_} ${y} ${v};\n#else\nuniform ${_} ${y} u_${v};\n#endif\n`:"initialize"===g?`\n#ifdef HAS_UNIFORM_u_${v}\n    ${_} ${y} ${v} = u_${v};\n#endif\n`:"define-attribute"===g?`\n#ifdef HAS_ATTRIBUTE_a_${v}\n    varying ${_} ${y} ${v};\n#endif\n`:"initialize-attribute"===g?"":void 0)),vertexSource:e=e.replace(i,(p,g,_,y,v)=>{const w="float"===y?"vec2":y,E=v.match(/color/)?"color":w;return"define-attribute-vertex-shader-only"===g?`\n#ifdef HAS_ATTRIBUTE_a_${v}\nattribute ${_} ${y} a_${v};\n#endif\n`:l[v]?"define"===g?`\n#ifndef HAS_UNIFORM_u_${v}\nuniform lowp float u_${v}_t;\nattribute ${_} ${w} a_${v};\nvarying ${_} ${y} ${v};\n#else\nuniform ${_} ${y} u_${v};\n#endif\n`:"initialize"===g?"vec4"===E?`\n#ifndef HAS_UNIFORM_u_${v}\n    ${v} = a_${v};\n#else\n    ${_} ${y} ${v} = u_${v};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${v}\n    ${v} = unpack_mix_${E}(a_${v}, u_${v}_t);\n#else\n    ${_} ${y} ${v} = u_${v};\n#endif\n`:"define-attribute"===g?`\n#ifdef HAS_ATTRIBUTE_a_${v}\n    attribute ${_} ${y} a_${v};\n    varying ${_} ${y} ${v};\n#endif\n`:"initialize-attribute"===g?`\n#ifdef HAS_ATTRIBUTE_a_${v}\n    ${v} = a_${v};\n#endif\n`:void 0:"define"===g?`\n#ifndef HAS_UNIFORM_u_${v}\nuniform lowp float u_${v}_t;\nattribute ${_} ${w} a_${v};\n#else\nuniform ${_} ${y} u_${v};\n#endif\n`:"define-instanced"===g?"mat4"===E?`\n#ifdef INSTANCED_ARRAYS\nattribute vec4 a_${v}0;\nattribute vec4 a_${v}1;\nattribute vec4 a_${v}2;\nattribute vec4 a_${v}3;\n#else\nuniform ${_} ${y} u_${v};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nattribute ${_} ${w} a_${v};\n#else\nuniform ${_} ${y} u_${v};\n#endif\n`:"initialize-attribute-custom"===g?`\n#ifdef HAS_ATTRIBUTE_a_${v}\n    ${_} ${y} ${v} = a_${v};\n#endif\n`:"vec4"===E?`\n#ifndef HAS_UNIFORM_u_${v}\n    ${_} ${y} ${v} = a_${v};\n#else\n    ${_} ${y} ${v} = u_${v};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${v}\n    ${_} ${y} ${v} = unpack_mix_${E}(a_${v}, u_${v}_t);\n#else\n    ${_} ${y} ${v} = u_${v};\n#endif\n`}),staticAttributes:a,usedDefines:f,vertexIncludes:c,fragmentIncludes:h}}class tx{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(e,n,i,a,l,c,h,f){this.context=e;let p=this.boundPaintVertexBuffers.length!==a.length;for(let _=0;!p&&_<a.length;_++)this.boundPaintVertexBuffers[_]!==a[_]&&(p=!0);let g=this.boundDynamicVertexBuffers.length!==h.length;for(let _=0;!g&&_<h.length;_++)this.boundDynamicVertexBuffers[_]!==h[_]&&(g=!0);if(!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==i||p||g||this.boundIndexBuffer!==l||this.boundVertexOffset!==c)this.freshBind(n,i,a,l,c,h,f);else{e.bindVertexArrayOES.set(this.vao);for(const _ of h)_&&(_.bind(),f&&_.instanceCount&&_.setVertexAttribDivisor(e.gl,n,f));l&&l.dynamicDraw&&l.bind()}}freshBind(e,n,i,a,l,c,h){const f=e.numAttributes,p=this.context,g=p.gl;this.vao&&this.destroy(),this.vao=p.gl.createVertexArray(),p.bindVertexArrayOES.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=a,this.boundVertexOffset=l,this.boundDynamicVertexBuffers=c,n.enableAttributes(g,e),n.bind(),n.setVertexAttribPointers(g,e,l);for(const _ of i)_.enableAttributes(g,e),_.bind(),_.setVertexAttribPointers(g,e,l);for(const _ of c)_&&(_.enableAttributes(g,e),_.bind(),_.setVertexAttribPointers(g,e,l),h&&_.instanceCount&&_.setVertexAttribDivisor(g,e,h));a&&a.bind(),p.currentNumAttributes=f}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function CC(t,e){const n=Math.pow(2,e.canonical.z),i=e.canonical.y;return[new nn(0,i/n).toLngLat().lat,new nn(0,(i+1)/n).toLngLat().lat]}function OI(t,e,n,i,a,l,c){const h=t.context,f=h.gl,p=n.hillshadeFBO;if(!p)return;t.prepareDrawTile();const g=t.isTileAffectedByFog(e),_=t.getOrCreateProgram("hillshade",{overrideFog:g});h.activeTexture.set(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,p.colorAttachment.get());const y=((T,C,S,I)=>{const R=S.paint.get("hillshade-shadow-color"),A=S.paint.get("hillshade-highlight-color"),k=S.paint.get("hillshade-accent-color"),L=S.paint.get("hillshade-emissive-strength");let B=At(S.paint.get("hillshade-illumination-direction"));if("viewport"===S.paint.get("hillshade-illumination-anchor"))B-=T.transform.angle;else if(T.style&&T.style.enable3dLights()&&T.style.directionalLight){const U=T.style.directionalLight.properties.get("direction");B=At(tt(U.x,U.y,U.z)[1])}const j=!T.options.moving;return{u_matrix:I||T.transform.calculateProjMatrix(C.tileID.toUnwrapped(),j),u_image:0,u_latrange:CC(0,C.tileID),u_light:[S.paint.get("hillshade-exaggeration"),B],u_shadow:R,u_highlight:A,u_emissive_strength:L,u_accent:k}})(t,n,i,t.terrain?e.projMatrix:null);t.uploadCommonUniforms(h,_,e.toUnwrapped());const{tileBoundsBuffer:v,tileBoundsIndexBuffer:w,tileBoundsSegments:E}=t.getTileBoundsBuffers(n);_.draw(t,f.TRIANGLES,a,l,c,Wt.disabled,y,i.id,v,w,E)}function F2(t,e,n){if(!e.needsDEMTextureUpload)return;const i=t.context,a=i.gl;i.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||t.getTileTexture(n.stride);const l=n.getPixels();e.demTexture?e.demTexture.update(l,{premultiply:!1}):e.demTexture=new Wr(i,l,t.terrainUseFloatDEM()?a.R32F:a.RGBA,{premultiply:!1}),e.needsDEMTextureUpload=!1}function N2(t,e,n){const i=t.context,a=i.gl;if(!e.dem)return;const l=e.dem;if(i.activeTexture.set(a.TEXTURE1),F2(t,e,l),!e.demTexture)return;e.demTexture.bind(a.NEAREST,a.CLAMP_TO_EDGE);const c=l.dim;i.activeTexture.set(a.TEXTURE0);let h=e.hillshadeFBO;if(!h){const y=new Wr(i,{width:c,height:c,data:null},a.RGBA);y.bind(a.LINEAR,a.CLAMP_TO_EDGE),h=e.hillshadeFBO=i.createFramebuffer(c,c,!0,"renderbuffer"),h.colorAttachment.set(y.texture)}i.bindFramebuffer.set(h.framebuffer),i.viewport.set([0,0,c,c]);const{tileBoundsBuffer:f,tileBoundsIndexBuffer:p,tileBoundsSegments:g}=t.getMercatorTileBoundsBuffers(),_=[];t.terrainUseFloatDEM()&&_.push("TERRAIN_DEM_FLOAT_FORMAT"),t.getOrCreateProgram("hillshadePrepare",{defines:_}).draw(t,a.TRIANGLES,Et.disabled,qt.disabled,fn.unblended,Wt.disabled,((y,v)=>{const w=v.stride,E=se.create();return se.ortho(E,0,he,-he,0,0,1),se.translate(E,E,[0,-he,0]),{u_matrix:E,u_image:1,u_dimension:[w,w],u_zoom:y.overscaledZ,u_unpack:v.unpackVector}})(e.tileID,l),n.id,f,p,g),e.needsHillshadePrepare=!1}const TC=t=>({u_matrix:new It(t),u_image0:new Xt(t),u_skirt_height:new Pe(t),u_ground_shadow_factor:new kt(t)}),ol=(t,e,n)=>({u_matrix:t,u_image0:0,u_skirt_height:e,u_ground_shadow_factor:n}),DC=(t,e,n,i,a,l,c,h,f,p,g,_,y,v,w)=>({u_proj_matrix:Float32Array.from(t),u_globe_matrix:e,u_normalize_matrix:Float32Array.from(i),u_merc_matrix:n,u_zoom_transition:a,u_merc_center:l,u_image0:0,u_frustum_tl:c,u_frustum_tr:h,u_frustum_br:f,u_frustum_bl:p,u_globe_pos:g,u_globe_radius:_,u_viewport:y,u_grid_matrix:w?Float32Array.from(w):new Float32Array(9),u_skirt_height:v}),bp=(t,e)=>{if(e>0&&t.terrain&&ee("Cutoff is currently disabled on terrain"),e<=0||t.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,0]}};const n=t.transform,i=Math.max(Math.abs(n._zoom-(t.minCutoffZoom-1)),1),a=n.isLODDisabled(!1)?Cs(60,45,n.pitch):Cs(30,15,n.pitch),l=n._farZ-n._nearZ,c=e*n.height,h=((1-(f=a))*(.75*n.cameraToCenterDistance)+f*(n._farZ+c))*i;var f;return{shouldRenderCutoff:a<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(h-n._nearZ)/l,(h-c-n._nearZ)/l]}}};function z2(t,e){return null!=t&&null!=e&&!(!t.hasData()||!e.hasData())&&null!=t.demTexture&&null!=e.demTexture&&t.tileID.key!==e.tileID.key}const Ep=new class{constructor(){this.operations={}}newMorphing(t,e,n,i,a){if(t in this.operations){const l=this.operations[t];l.to.tileID.key!==n.tileID.key&&(l.queued=n)}else this.operations[t]={startTime:i,phase:0,duration:a,from:e,to:n,queued:null}}getMorphValuesForProxy(t){if(!(t in this.operations))return null;const e=this.operations[t];return{from:e.from,to:e.to,phase:e.phase}}update(t){for(const e in this.operations){const n=this.operations[e];for(n.phase=(t-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,t)){delete this.operations[e];break}}}_nextOp(t,e){return!!t.queued&&(t.from=t.to,t.to=t.queued,t.queued=null,t.phase=0,t.startTime=e,!0)}_validOp(t){return t.from.hasData()&&t.to.hasData()}},MC={0:null,1:"TERRAIN_VERTEX_MORPHING"};function l_(t,e,n){if(0===e)return 0;const i=e<1&&514===n?.25/e:1;return 6*Math.pow(1.5,22-t)*Math.max(e,1)*i}function B2(t,e){const n=1<<t.z;return!e&&(0===t.x||t.x===n-1)||0===t.y||t.y===n-1}const SC=t=>({u_matrix:t});function AC(t,e,n,i,a){if(a>0){const l=Ct.now(),c=(l-t.timeAdded)/a,h=e?(l-e.timeAdded)/a:-1,f=n.getSource(),p=i.coveringZoomLevel({tileSize:f.tileSize,roundZoom:f.roundZoom}),g=!e||Math.abs(e.tileID.overscaledZ-p)>Math.abs(t.tileID.overscaledZ-p),_=g&&t.refreshedUponExpiration?1:et(g?c:1-h,0,1);return t.refreshedUponExpiration&&c>=1&&(t.refreshedUponExpiration=!1),e?{opacity:1,mix:1-_}:{opacity:_,mix:0}}return{opacity:1,mix:0}}class IC extends Bs{constructor(e){const n={type:"raster-dem",maxzoom:e.transform.maxZoom},i=new Gg(Bu(),null),a=G0("mock-dem",n,i,e.style);super("mock-dem",a,!1),a.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,n){e.state="loaded",n(null)}}class PC extends Bs{constructor(e){const n=G0("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new Gg(Bu(),null),e.style);super("proxy",n,!1),n.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,n,i){if(e.freezeTileCoverage)return;this.transform=e;const a=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((l,c)=>{if(l[c.key]="",!this._tiles[c.key]){const h=new qo(c,this._source.tileSize*c.overscaleFactor(),e.tileZoom);h.state="loaded",this._tiles[c.key]=h}return l},{});for(const l in this._tiles)l in a||(this.freeFBO(l),this._tiles[l].unloadVectorData(),delete this._tiles[l])}freeFBO(e){const n=this.proxyCachedFBO[e];if(void 0!==n){const i=Object.values(n);this.renderCachePool.push(...i),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach(e=>e.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class V2 extends _n{constructor(e,n,i){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=n,this.projMatrix=i}}class Ea extends class el{isDataAvailableAtPoint(e){const n=this._source();if(this.isUsingMockSource()||!n||e.y<0||e.y>1)return!1;const i=n.getSource().maxzoom,a=1<<i,l=Math.floor(e.x),c=Math.floor((e.x-l)*a),h=Math.floor(e.y*a),f=this.findDEMTileFor(new _n(i,l,i,c,h));return!(!f||!f.dem)}getAtPointOrZero(e,n=0){return this.getAtPoint(e,n)||0}getAtPoint(e,n,i=!0){if(this.isUsingMockSource())return null;null==n&&(n=null);const a=this._source();if(!a||e.y<0||e.y>1)return n;const l=a.getSource().maxzoom,c=1<<l,h=Math.floor(e.x),f=e.x-h,p=new _n(l,h,l,Math.floor(f*c),Math.floor(e.y*c)),g=this.findDEMTileFor(p);if(!g||!g.dem)return n;const _=g.dem,y=1<<g.tileID.canonical.z,v=(f*y-g.tileID.canonical.x)*_.dim,w=(e.y*y-g.tileID.canonical.y)*_.dim,E=Math.floor(v),T=Math.floor(w);return(i?this.exaggeration():1)*wt(wt(_.get(E,T),_.get(E,T+1),w-T),wt(_.get(E+1,T),_.get(E+1,T+1),w-T),v-E)}getAtTileOffset(e,n,i){const a=1<<e.canonical.z;return this.getAtPointOrZero(new nn(e.wrap+(e.canonical.x+n/he)/a,(e.canonical.y+i/he)/a))}getAtTileOffsetFunc(e,n,i,a){return l=>{const c=this.getAtTileOffset(e,l.x,l.y),h=a.upVector(e.canonical,l.x,l.y),f=a.upVectorScale(e.canonical,n,i).metersToTile;return Z.scale(h,h,c*f),h}}getForTilePoints(e,n,i,a){if(this.isUsingMockSource())return!1;const l=Pc.create(this,e,a);return!!l&&(n.forEach(c=>{c[2]=this.exaggeration()*l.getElevationAt(c[0],c[1],i)}),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;const n=this.findDEMTileFor(e);if(!n||!n.dem)return null;const i=n.dem.tree,a=n.tileID,l=1<<e.canonical.z-a.canonical.z;let c=e.canonical.x/l-a.canonical.x,h=e.canonical.y/l-a.canonical.y,f=0;for(let p=0;p<e.canonical.z-a.canonical.z&&!i.leaves[f];p++){c*=2,h*=2;const g=2*Math.floor(h)+Math.floor(c);f=i.childOffsets[f]+g,c%=1,h%=1}return{min:this.exaggeration()*i.minimums[f],max:this.exaggeration()*i.maximums[f]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,n,i){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}}{constructor(e,n){super(),this.painter=e,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[i,a,l]=function(f){const p=new jo,g=new Tr,_=131;p.reserve(17161),g.reserve(33800);const y=64,v=8224;for(let T=-y;T<8288;T+=y)for(let C=-y;C<8288;C+=y){const S=C<0||C>v||T<0||T>v?24575:0,I=et(Math.round(C),0,he),R=et(Math.round(T),0,he);p.emplaceBack(I+S,R)}const E=(T,C)=>{const S=C*_+T;g.emplaceBack(S+1,S,S+_),g.emplaceBack(S+_,S+_+1,S+1)};for(let T=1;T<129;T++)for(let C=1;C<129;C++)E(C,T);return[0,129].forEach(T=>{for(let C=0;C<130;C++)E(C,T),E(T,C)}),[p,g,32768]}(),c=e.context;this.gridBuffer=c.createVertexBuffer(i,Ec.members),this.gridIndexBuffer=c.createIndexBuffer(a),this.gridSegments=Cn.simpleSegment(0,0,i.length,a.length),this.gridNoSkirtSegments=Cn.simpleSegment(0,0,i.length,l),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new PC(n.map),this.orthoMatrix=se.create(),se.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,he,0,he,0,1);const h=c.gl;this._overlapStencilMode=new qt({func:h.GEQUAL,mask:255},0,255,h.KEEP,h.KEEP,h.REPLACE),this._previousZoom=e.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new IC(n.map),this._pendingGroundEffectLayers=[]}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),this._style=e,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(e,n,i){if(e&&e.terrain){this._style!==e&&(this.style=e,this._evaluationZoom=void 0);const a=e.terrain.properties,l=0===e.terrain.drapeRenderMode,c=e.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=Ct.now();const h=e.terrain&&e.terrain.scope,f=a.get("source"),p=l?this._mockSourceCache:e.getSourceCache(f,h);if(!p)return void ee(`Couldn't find terrain source "${f}".`);if(this.sourceCache=p,this._exaggeration=c?this.calculateExaggeration(n):a.get("exaggeration"),!n.projection.requiresDraping&&c&&0===this._exaggeration)return void this._disable();this.enabled=!0;const g=()=>{this.sourceCache.used&&ee(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const _=this.getScaledDemTileSize();this.sourceCache.update(n,_,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,g(),this._initializing=!0),g(),n.updateElevation(!0,i),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0,this._previousZoom=n.zoom}else this._disable()}calculateExaggeration(e){const n=this._previousCameraAltitude,i=e.getFreeCameraOptions().position.z/e.pixelsPerMeter*e.worldSize;this._previousCameraAltitude=i;const a=null!=n?i-n:Number.MAX_VALUE;if(Math.abs(a)<2)return this._exaggeration;const l=e.zoom,c=this._style.terrain;if(!this._previousUpdateTimestamp)return c.getExaggeration(l);let h=l-this._previousZoom;const f=this._previousUpdateTimestamp;let p=l;null!=this._evaluationZoom&&(p=this._evaluationZoom,Math.abs(l-p)>.5&&(h=.5*(l-p+h)),h*a<0&&(p+=h)),this._evaluationZoom=p;const g=c.getExaggeration(p),_=g===c.getExaggeration(Math.max(0,p-.1));if(_&&Math.abs(g-this._exaggeration)<.01)return g;let y=Math.min(.1,.00375*(this._updateTimestamp-f));return(_||g<.1||Math.abs(h)<1e-4)&&(y=Math.min(.2,4*y)),wt(this._exaggeration,g,y)}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._mergedSourceCaches)this._style._mergedSourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(e=>e.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(e){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const n=this.proxySourceCache,i=this.painter.transform;this._initializing&&(this._initializing=0===i._centerAltitude&&-1===this.getAtPointOrZero(nn.fromLngLat(i.center),-1),this._emptyDEMTextureDirty=!this._initializing);const a=this.proxyCoords=n.getIds().map(f=>{const p=n.getTileByID(f).tileID;return p.projMatrix=i.calculateProjMatrix(p.toUnwrapped()),p});!function(f,p){const g=p.transform.pointCoordinate(p.transform.getCameraPoint()),_=new ie(g.x,g.y);f.sort((y,v)=>{if(v.overscaledZ-y.overscaledZ)return v.overscaledZ-y.overscaledZ;const w=new ie(y.canonical.x+(1<<y.canonical.z)*y.wrap,y.canonical.y),E=new ie(v.canonical.x+(1<<v.canonical.z)*v.wrap,v.canonical.y),T=_.mult(1<<y.canonical.z);return T.x-=.5,T.y-=.5,T.distSqr(w)-T.distSqr(E)})}(a,this.painter);const l=this.proxyToSource||{};this.proxyToSource={},a.forEach(f=>{this.proxyToSource[f.key]={}}),this.terrainTileForTile={};const c=this._style._mergedSourceCaches;for(const f in c){const p=c[f];if(!p.used||(p!==this.sourceCache&&this.resetTileLookupCache(p.id),this._setupProxiedCoordsForOrtho(p,e[f],l),p.usedForTerrain))continue;const g=e[f];p.getSource().reparseOverscaled&&this._assignTerrainTiles(g)}this.proxiedCoords[n.id]=a.map(f=>new V2(f,f.key,this.orthoMatrix)),this._assignTerrainTiles(a),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(l),this.renderingToTexture=!1;const h={};this._visibleDemTiles=[];for(const f of this.proxyCoords){const p=this.terrainTileForTile[f.key];if(!p)continue;const g=p.tileID.key;g in h||(this._visibleDemTiles.push(p),h[g]=g)}}_assignTerrainTiles(e){this._initializing||e.forEach(n=>{if(this.terrainTileForTile[n.key])return;const i=this._findTileCoveringTileID(n,this.sourceCache);i&&(this.terrainTileForTile[n.key]=i)})}_prepareDEMTextures(){const e=this.painter.context,n=e.gl;for(const i in this.terrainTileForTile){const a=this.terrainTileForTile[i],l=a.dem;!l||a.demTexture&&!a.needsDEMTextureUpload||(e.activeTexture.set(n.TEXTURE1),F2(this.painter,a,l))}}_prepareDemTileUniforms(e,n,i,a){if(!n||null==n.demTexture)return!1;const l=e.tileID.canonical,c=Math.pow(2,n.tileID.canonical.z-l.z),h=a||"";return i[`u_dem_tl${h}`]=[l.x*c%1,l.y*c%1],i[`u_dem_scale${h}`]=c,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const e=this.painter.context,n=e.gl;if(!this._emptyDepthBufferTexture){const i=new Sr({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new Wr(e,i,n.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let e=0;const n=this._visibleDemTiles.reduce((i,a)=>{if(!a.dem)return i;const l=a.dem.tree.minimums[0];return l>0&&e++,i+l},0);return e?n/e:0}_updateEmptyDEMTexture(){const e=this.painter.context,n=e.gl;e.activeTexture.set(n.TEXTURE2);const i=this._getLoadedAreaMinimum(),[a,l]=(()=>{if(this.painter.terrainUseFloatDEM()){const h=new fv({width:1,height:1},new Float32Array([i]));return[n.R32F,h]}{const h=new Sr({width:1,height:1},new Uint8Array(Su.pack(i,this.sourceCache.getSource().encoding)));return[n.RGBA,h]}})();this._emptyDEMTextureDirty=!1;let c=this._emptyDEMTexture;return c?c.update(l,{premultiply:!1}):c=this._emptyDEMTexture=new Wr(e,l,a,{premultiply:!1}),c}setupElevationDraw(e,n,i){const a=this.painter.context,l=a.gl,c=(h=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:Su.getUnpackVector(h),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var h;c.u_exaggeration=this.exaggeration();let f=null,p=null,g=1;if(i&&i.morphing&&this._useVertexMorphing){const v=i.morphing.srcDemTile,w=i.morphing.dstDemTile;g=i.morphing.phase,v&&w&&(this._prepareDemTileUniforms(e,v,c,"_prev")&&(p=v),this._prepareDemTileUniforms(e,w,c)&&(f=w))}const _=v=>v&&v.demTexture&&this.painter.terrainUseFloatDEM()?l.LINEAR:l.NEAREST,y=v=>{c.u_dem_size=1===v.size[0]?1:v.size[0]-2};if(p&&f)a.activeTexture.set(l.TEXTURE2),f.demTexture.bind(_(f),l.CLAMP_TO_EDGE),a.activeTexture.set(l.TEXTURE4),p.demTexture.bind(_(p),l.CLAMP_TO_EDGE),f.demTexture&&y(f.demTexture),c.u_dem_lerp=g;else{f=this.terrainTileForTile[e.tileID.key],a.activeTexture.set(l.TEXTURE2);const v=this._prepareDemTileUniforms(e,f,c)?f.demTexture:this.emptyDEMTexture;v.bind(_(f),l.CLAMP_TO_EDGE),y(v)}if(a.activeTexture.set(l.TEXTURE3),i&&i.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE),this._depthFBO&&(c.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE),c.u_depth_size_inv=[1,1]),i&&i.useMeterToDem&&f){const v=(1<<f.tileID.canonical.z)*kn(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;c.u_meter_to_dem=v}if(i&&i.labelPlaneMatrixInv&&(c.u_label_plane_matrix_inv=i.labelPlaneMatrixInv),n.setTerrainUniformValues(a,c),"globe"===this.painter.transform.projection.name){const v=this.globeUniformValues(this.painter.transform,e.tileID.canonical,i&&i.useDenormalizedUpVectorScale);n.setGlobeUniformValues(a,v)}}globeUniformValues(e,n,i){const a=e.projection;return{u_tile_tl_up:a.upVector(n,0,0),u_tile_tr_up:a.upVector(n,he,0),u_tile_br_up:a.upVector(n,he,he),u_tile_bl_up:a.upVector(n,0,he),u_tile_up_scale:i?Xm(1):a.upVectorScale(n,e.center.lat,e.worldSize).metersToTile}}renderToBackBuffer(e){const n=this.painter,i=this.painter.context;0!==e.length&&(i.bindFramebuffer.set(null),i.viewport.set([0,0,n.width,n.height]),n.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(a,l,c,h,f){if("globe"===a.transform.projection.name)!function(p,g,_,y,v){const w=p.context,E=w.gl;let T,C;const S=p.transform,I=Ow(p,w,S),R=(W,H)=>{if(C===H)return;const J=[MC[H],"PROJECTION_GLOBE_VIEW"];I&&J.push("CUSTOM_ANTIALIASING");const te=p.isTileAffectedByFog(W);T=p.getOrCreateProgram("globeRaster",{defines:J,overrideFog:te}),C=H},A=p.colorModeForRenderPass(),k=new Et(E.LEQUAL,Et.ReadWrite,p.depthRangeFor3D);Ep.update(v);const L=function(W){const H=W.pixelsPerMeter,J=H/kn(1,W.center.lat),te=se.identity(new Float64Array(16));return se.translate(te,te,[W.point.x,W.point.y,0]),se.scale(te,te,[J,J,H]),Float32Array.from(te)}(S),B=[Si(S.center.lng),gi(S.center.lat)],j=p.globeSharedBuffers,U=[S.width*Ct.devicePixelRatio,S.height*Ct.devicePixelRatio],G=Float32Array.from(S.globeMatrix),$={useDenormalizedUpVectorScale:!0};{const W=p.transform,H=l_(W.zoom,g.exaggeration(),g.sourceCache._source.tileSize);C=-1;const J=E.TRIANGLES;for(const te of y){const oe=_.getTile(te),K=qt.disabled,Q=g.prevTerrainTileForTile[te.key],ae=g.terrainTileForTile[te.key];z2(Q,ae)&&Ep.newMorphing(te.key,Q,ae,v,250),w.activeTexture.set(E.TEXTURE0),oe.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE);const ue=Ep.getMorphValuesForProxy(te.key),fe=ue?1:0;ue&&xi($,{morphing:{srcDemTile:ue.from,dstDemTile:ue.to,phase:Aa(ue.phase)}});const ge=Cc(te.canonical),ve=Fh(ge.getCenter().lat),de=Jy(te.canonical,ge,ve,W.worldSize/W._pixelsPerMercatorPixel),me=So(ps(te.canonical)),Oe=DC(W.projMatrix,G,L,me,ni(W.zoom),B,W.frustumCorners.TL,W.frustumCorners.TR,W.frustumCorners.BR,W.frustumCorners.BL,W.globeCenterInViewSpace,W.globeRadius,U,H,de);if(R(te,fe),T&&(g.setupElevationDraw(oe,T,$),p.uploadCommonUniforms(w,T,te.toUnwrapped()),j)){const[qe,Ge,We]=j.getGridBuffers(ve,0!==H);T.draw(p,J,k,K,A,Wt.backCCW,Oe,"globe_raster",qe,Ge,We)}}}if(j&&(p.renderDefaultNorthPole||p.renderDefaultSouthPole)){const W=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];I&&W.push("CUSTOM_ANTIALIASING"),T=p.getOrCreateProgram("globeRaster",{defines:W});for(const H of y){const{x:J,y:te,z:oe}=H.canonical,K=0===te,Q=te===(1<<oe)-1,[ae,ue,fe,ge]=j.getPoleBuffers(oe,!1);if(ge&&(K||Q)){const ve=_.getTile(H);w.activeTexture.set(E.TEXTURE0),ve.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE);let de=Ym(oe,J,S);const me=So(ps(H.canonical)),Oe=(qe,Ge)=>qe.draw(p,E.TRIANGLES,k,qt.disabled,A,Wt.disabled,DC(S.projMatrix,de,de,me,0,B,S.frustumCorners.TL,S.frustumCorners.TR,S.frustumCorners.BR,S.frustumCorners.BL,S.globeCenterInViewSpace,S.globeRadius,U,0),"globe_pole_raster",Ge,fe,ge);g.setupElevationDraw(ve,T,$),p.uploadCommonUniforms(w,T,H.toUnwrapped()),K&&p.renderDefaultNorthPole&&Oe(T,ae),Q&&p.renderDefaultSouthPole&&(de=se.scale(se.create(),de,[1,-1,1]),Oe(T,ue))}}}}(a,l,c,h,f);else{const p=a.context,g=p.gl;let _,y;const v=a.shadowRenderer,w=bp(a,a.longestCutoffRange),E=A=>{if(y===A)return;const k=[];k.push(MC[A]),w.shouldRenderCutoff&&k.push("RENDER_CUTOFF"),_=a.getOrCreateProgram("terrainRaster",{defines:k}),y=A},T=a.colorModeForRenderPass(),C=new Et(g.LEQUAL,Et.ReadWrite,a.depthRangeFor3D);Ep.update(f);const S=a.transform,I=l_(S.zoom,l.exaggeration(),l.sourceCache._source.tileSize);let R=[0,0,0];if(v){const A=a.style.directionalLight,k=a.style.ambientLight;A&&k&&(R=bd(A,k))}{y=-1;const A=g.TRIANGLES,[k,L]=[l.gridIndexBuffer,l.gridSegments];for(const B of h){const j=c.getTile(B),U=qt.disabled,G=l.prevTerrainTileForTile[B.key],$=l.terrainTileForTile[B.key];z2(G,$)&&Ep.newMorphing(B.key,G,$,f,250),p.activeTexture.set(g.TEXTURE0),j.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST);const W=Ep.getMorphValuesForProxy(B.key),H=W?1:0;let J;W&&(J={morphing:{srcDemTile:W.from,dstDemTile:W.to,phase:Aa(W.phase)}});const te=ol(B.projMatrix,B2(B.canonical,S.renderWorldCopies)?I/10:I,R);if(E(H),!_)continue;l.setupElevationDraw(j,_,J);const oe=B.toUnwrapped();v&&v.setupShadows(oe,_),a.uploadCommonUniforms(p,_,oe,null,w),_.draw(a,A,C,U,T,Wt.backCCW,te,"terrain_raster",l.gridBuffer,k,L)}}}}(n,this,this.proxySourceCache,e,this._updateTimestamp),this.renderingToTexture=!0,n.gpuTimingDeferredRenderEnd(),e.splice(0,e.length))}renderBatch(e){if(0===this._drapedRenderBatches.length)return e+1;this.renderingToTexture=!0;const n=this.painter,i=this.painter.context,a=this.proxySourceCache,l=this.proxiedCoords[a.id],c=this._drapedRenderBatches.shift(),h=n.style.order,f=[];let p=0;for(const g of l){const _=a.getTileByID(g.proxyTileKey),y=a.proxyCachedFBO[g.key]?a.proxyCachedFBO[g.key][e]:void 0,v=void 0!==y?a.renderCache[y]:this.pool[p++],w=void 0!==y;if(_.texture=v.tex,w&&!v.dirty){f.push(_.tileID);continue}let E;i.bindFramebuffer.set(v.fb.framebuffer),this.renderedToTile=!1,v.dirty&&(i.clear({color:yt.transparent,stencil:0}),v.dirty=!1);for(let T=c.start;T<=c.end;++T){const C=n.style._mergedLayers[h[T]];if(C.isHidden(n.transform.zoom))continue;const S=n.style.getLayerSourceCache(C),I=S?this.proxyToSource[g.key][S.id]:[g];if(!I)continue;const R=I;i.viewport.set([0,0,v.fb.width,v.fb.height]),E!==(S?S.id:null)&&(this._setupStencil(v,I,C,S),E=S?S.id:null),n.renderLayer(n,S,C,R)}if(0===this._drapedRenderBatches.length)for(const T of this._pendingGroundEffectLayers){const C=n.style._mergedLayers[h[T]];if(C.isHidden(n.transform.zoom))continue;const S=n.style.getLayerSourceCache(C),I=S?this.proxyToSource[g.key][S.id]:[g];if(!I)continue;const R=I;i.viewport.set([0,0,v.fb.width,v.fb.height]),E!==(S?S.id:null)&&(this._setupStencil(v,I,C,S),E=S?S.id:null),n.renderLayer(n,S,C,R)}this.renderedToTile?(v.dirty=!0,f.push(_.tileID)):w||--p,5===p&&(p=0,this.renderToBackBuffer(f))}return this.renderToBackBuffer(f),this.renderingToTexture=!1,i.bindFramebuffer.set(null),i.viewport.set([0,0,n.width,n.height]),c.end+1}postRender(){}isLayerOrderingCorrect(e){const n=e.order.length;let i=-1,a=n;for(let l=0;l<n;++l)this._style.isLayerDraped(e._mergedLayers[e.order[l]])?i=Math.max(i,l):a=Math.min(a,l);return a>i}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter(n=>n.dem).forEach(n=>{e=Math.min(e,n.dem.tree.minimums[0])}),0===e?e:(e-30)*this._exaggeration}raycast(e,n,i){if(!this._visibleDemTiles)return null;const a=this._visibleDemTiles.filter(l=>l.dem).map(l=>{const c=l.tileID,h=1<<c.overscaledZ,{x:f,y:p}=c.canonical,g=f/h,_=(f+1)/h,y=p/h,v=(p+1)/h;return{minx:g,miny:y,maxx:_,maxy:v,t:l.dem.tree.raycastRoot(g,y,_,v,e,n,i),tile:l}});a.sort((l,c)=>(null!==l.t?l.t:Number.MAX_VALUE)-(null!==c.t?c.t:Number.MAX_VALUE));for(const l of a){if(null==l.t)return null;const c=l.tile.dem.tree.raycast(l.minx,l.miny,l.maxx,l.maxy,e,n,i);if(null!=c)return c}return null}_createFBO(){const e=this.painter.context,n=e.gl,i=this.drapeBufferSize;e.activeTexture.set(n.TEXTURE0);const a=new Wr(e,{width:i[0],height:i[1],data:null},n.RGBA);a.bind(n.LINEAR,n.CLAMP_TO_EDGE);const l=e.createFramebuffer(i[0],i[1],!0,null);return l.colorAttachment.set(a.texture),l.depthAttachment=new FM(e,l.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=e.createRenderbuffer(e.gl.DEPTH_STENCIL,i[0],i[1]),this._stencilRef=0,l.depthAttachment.set(this._sharedDepthStencil),e.clear({stencil:0})):l.depthAttachment.set(this._sharedDepthStencil),e.extTextureFilterAnisotropic&&!e.extTextureFilterAnisotropicForceOff&&n.texParameterf(n.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax),{fb:l,tex:a,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.hasLightTransitions())return!0;for(const e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e].hasTransition())return!0;return this._style.order.some(e=>{const n=this._style._mergedLayers[e],i=n.isHidden(this.painter.transform.zoom);return"custom"===n.type?!i&&n.shouldRedrape():!i&&n.hasTransition()})}_clearLineLayersFromRenderCache(){let e=!1;for(const i of this._style.getSources())if(i instanceof lC){e=!0;break}if(!e)return;const n={};for(let i=0;i<this._style.order.length;++i){const a=this._style._mergedLayers[this._style.order[i]],l=this._style.getLayerSourceCache(a);if(l&&!n[l.id]&&!a.isHidden(this.painter.transform.zoom)&&"line"===a.type&&a.widthExpression()instanceof ei){n[l.id]=!0;for(const c of this.proxyCoords){const h=this.proxyToSource[c.key][l.id];if(h)for(const f of h)this._clearRenderCacheForTile(l.id,f)}}}}_clearRasterLayersFromRenderCache(){let e=!1;for(const i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i]._source instanceof dp){e=!0;break}if(!e)return;const n={};for(let i=0;i<this._style.order.length;++i){const a=this._style._mergedLayers[this._style.order[i]],l=this._style.getLayerSourceCache(a);if(!l||n[l.id]||a.isHidden(this.painter.transform.zoom)||"raster"!==a.type)continue;const c=a.paint.get("raster-fade-duration");for(const h of this.proxyCoords){const f=this.proxyToSource[h.key][l.id];if(f)for(const p of f){const g=AC(l.getTile(p),l.findLoadedParent(p,0),l,this.painter.transform,c);(1!==g.opacity||0!==g.mix)&&this._clearRenderCacheForTile(l.id,p)}}}}_setupDrapedRenderBatches(){const e=this._style.order,n=e.length;if(0===n)return;const i=[];this._pendingGroundEffectLayers=[];let a,l=0,c=this._style._mergedLayers[e[l]];for(;!this._style.isLayerDraped(c)&&c.isHidden(this.painter.transform.zoom)&&++l<n;)c=this._style._mergedLayers[e[l]];for(;l<n;++l){const h=this._style._mergedLayers[e[l]];h.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(h)?void 0===a&&(a=l):("fill-extrusion"===h.type&&this._pendingGroundEffectLayers.push(l),void 0!==a&&(i.push({start:a,end:l-1}),a=void 0)))}if(void 0!==a&&i.push({start:a,end:l-1}),0!==i.length){const h=i[i.length-1];this._pendingGroundEffectLayers.every(p=>p>h.end)||ee("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=i}_setupRenderCache(e){const n=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,n.renderCache.length>n.renderCachePool.length){const c=Object.values(n.proxyCachedFBO);n.proxyCachedFBO={};for(let h=0;h<c.length;++h){const f=Object.values(c[h]);n.renderCachePool.push(...f)}}return}this._clearRasterLayersFromRenderCache();const i=this.proxyCoords,a=this._tilesDirty;for(let c=i.length-1;c>=0;c--){const h=i[c];if(n.getTileByID(h.key),void 0!==n.proxyCachedFBO[h.key]){const f=e[h.key],p=this.proxyToSource[h.key];let g=0;for(const _ in p){const y=p[_],v=f[_];if(!v||v.length!==y.length||y.some((w,E)=>w!==v[E]||a[_]&&a[_].hasOwnProperty(w.key))){g=-1;break}++g}for(const _ in n.proxyCachedFBO[h.key])n.renderCache[n.proxyCachedFBO[h.key][_]].dirty=g<0||g!==Object.values(f).length}}const l=[...this._drapedRenderBatches];l.sort((c,h)=>h.end-h.start-(c.end-c.start));for(const c of l)for(const h of i){if(n.proxyCachedFBO[h.key])continue;let f=n.renderCachePool.pop();void 0===f&&n.renderCache.length<50&&(f=n.renderCache.length,n.renderCache.push(this._createFBO())),void 0!==f&&(n.proxyCachedFBO[h.key]={},n.proxyCachedFBO[h.key][c.start]=f,n.renderCache[f].dirty=!0)}this._tilesDirty={}}_setupStencil(e,n,i,a){if(!a||!this._sourceTilesOverlap[a.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const l=this.painter.context,c=l.gl;if(n.length<=1)return void(this._overlapStencilType=!1);let h;if(i.isTileClipped())h=n.length,this._overlapStencilMode.test={func:c.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(n[0].overscaledZ>n[n.length-1].overscaledZ))return void(this._overlapStencilType=!1);h=1,this._overlapStencilMode.test={func:c.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+h>255&&(l.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=h,this._overlapStencilMode.ref=this._stencilRef,i.isTileClipped()&&this._renderTileClippingMasks(n,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):qt.disabled}_renderTileClippingMasks(e,n){const i=this.painter,a=this.painter.context,l=a.gl;i._tileClippingMaskIDs={},a.setColorMode(fn.disabled),a.setDepthMode(Et.disabled);const c=i.getOrCreateProgram("clippingMask");for(const h of e){const f=i._tileClippingMaskIDs[h.key]=--n;c.draw(i,l.TRIANGLES,Et.disabled,new qt({func:l.ALWAYS,mask:0},f,255,l.KEEP,l.KEEP,l.REPLACE),fn.disabled,Wt.disabled,SC(h.projMatrix),"$clipping",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}pointCoordinate(e){const n=this.painter.transform;if(e.x<0||e.x>n.width||e.y<0||e.y>n.height)return null;const i=[e.x,e.y,1,1];bn.transformMat4(i,i,n.pixelMatrixInverse),bn.scale(i,i,1/i[3]),i[0]/=n.worldSize,i[1]/=n.worldSize;const a=n._camera.position,l=kn(1,n.center.lat),c=[a[0],a[1],a[2]/l,0],h=Z.subtract([],i.slice(0,3),c);Z.normalize(h,h);const f=this.raycast(c,h,this._exaggeration);return null!==f&&f?(Z.scaleAndAdd(c,c,h,f),c[3]=c[2],c[2]*=l,c):null}drawDepth(){const e=this.painter,n=e.context,i=this.proxySourceCache,a=Math.ceil(e.width),l=Math.ceil(e.height);if(!this._depthFBO||this._depthFBO.width===a&&this._depthFBO.height===l||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const c=n.gl,h=n.createFramebuffer(a,l,!0,"renderbuffer");n.activeTexture.set(c.TEXTURE0);const f=new Wr(n,{width:a,height:l,data:null},c.RGBA);f.bind(c.NEAREST,c.CLAMP_TO_EDGE),h.colorAttachment.set(f.texture);const p=n.createRenderbuffer(n.gl.DEPTH_COMPONENT16,a,l);h.depthAttachment.set(p),this._depthFBO=h,this._depthTexture=f}n.bindFramebuffer.set(this._depthFBO.framebuffer),n.viewport.set([0,0,a,l]),function(c,h,f,p){if("globe"===c.transform.projection.name)return;const g=c.context,_=g.gl;g.clear({depth:1});const y=c.getOrCreateProgram("terrainDepth"),v=new Et(_.LESS,Et.ReadWrite,c.depthRangeFor3D);for(const w of p){const E=f.getTile(w),T=ol(w.projMatrix,0,[0,0,0]);h.setupElevationDraw(E,y),y.draw(c,_.TRIANGLES,v,qt.disabled,fn.unblended,Wt.backCCW,T,"terrain_depth",h.gridBuffer,h.gridIndexBuffer,h.gridNoSkirtSegments)}}(e,this,i,this.proxyCoords)}_setupProxiedCoordsForOrtho(e,n,i){if(e.getSource()instanceof gs)return this._setupProxiedCoordsForImageSource(e,n,i);this._findCoveringTileCache[e.id]=this._findCoveringTileCache[e.id]||{};const a=this.proxiedCoords[e.id]=[],l=this.proxyCoords;for(let h=0;h<l.length;h++){const f=l[h],p=this._findTileCoveringTileID(f,e);if(p){const g=this._createProxiedId(f,p,i[f.key]&&i[f.key][e.id]);a.push(g),this.proxyToSource[f.key][e.id]=[g]}}let c=!1;for(let h=0;h<n.length;h++){const f=e.getTile(n[h]);if(!f||!f.hasData())continue;const p=this._findTileCoveringTileID(f.tileID,this.proxySourceCache);if(p&&p.tileID.canonical.z!==f.tileID.canonical.z){const g=this.proxyToSource[p.tileID.key][e.id],_=this._createProxiedId(p.tileID,f,i[p.tileID.key]&&i[p.tileID.key][e.id]);g?g.splice(g.length-1,0,_):this.proxyToSource[p.tileID.key][e.id]=[_],a.push(_),c=!0}}this._sourceTilesOverlap[e.id]=c}_setupProxiedCoordsForImageSource(e,n,i){if(!e.getSource().loaded())return;const a=this.proxiedCoords[e.id]=[],l=this.proxyCoords,c=e.getSource(),h=c.tileID;if(!h)return;const f=new ie(h.x,h.y)._div(1<<h.z),p=c.coordinates.map(nn.fromLngLat).reduce((_,y)=>(_.min.x=Math.min(_.min.x,y.x-f.x),_.min.y=Math.min(_.min.y,y.y-f.y),_.max.x=Math.max(_.max.x,y.x-f.x),_.max.y=Math.max(_.max.y,y.y-f.y),_),{min:new ie(Number.MAX_VALUE,Number.MAX_VALUE),max:new ie(-Number.MAX_VALUE,-Number.MAX_VALUE)}),g=(_,y)=>{const v=_.wrap+_.canonical.x/(1<<_.canonical.z),w=_.canonical.y/(1<<_.canonical.z),E=he/(1<<_.canonical.z),T=y.wrap+y.canonical.x/(1<<y.canonical.z),C=y.canonical.y/(1<<y.canonical.z);return v+E<T+p.min.x||v>T+p.max.x||w+E<C+p.min.y||w>C+p.max.y};for(let _=0;_<l.length;_++){const y=l[_];for(let v=0;v<n.length;v++){const w=e.getTile(n[v]);if(!w||!w.hasData()||g(y,w.tileID))continue;const E=this._createProxiedId(y,w,i[y.key]&&i[y.key][e.id]),T=this.proxyToSource[y.key][e.id];T?T.push(E):this.proxyToSource[y.key][e.id]=[E],a.push(E)}}}_createProxiedId(e,n,i){let a=this.orthoMatrix;if(i){const l=i.find(c=>c.key===n.tileID.key);if(l)return l}if(n.tileID.key!==e.key){const l=e.canonical.z-n.tileID.canonical.z;let c,h,f;a=se.create();const p=n.tileID.wrap-e.wrap<<e.overscaledZ;l>0?(c=he>>l,h=c*((n.tileID.canonical.x<<l)-e.canonical.x+p),f=c*((n.tileID.canonical.y<<l)-e.canonical.y)):(c=he<<-l,h=he*(n.tileID.canonical.x-(e.canonical.x+p<<-l)),f=he*(n.tileID.canonical.y-(e.canonical.y<<-l))),se.ortho(a,0,c,0,c,0,1),se.translate(a,a,[h,f,0])}return new V2(n.tileID,e.key,a)}_findTileCoveringTileID(e,n){let i=n.getTile(e);if(i&&i.hasData())return i;const a=this._findCoveringTileCache[n.id],l=a[e.key];if(i=l?n.getTileByID(l):null,i&&i.hasData()||null===l)return i;let c=i?i.tileID:e,h=c.overscaledZ;const f=n.getSource().minzoom,p=[];if(!l){const _=n.getSource().maxzoom;if(e.canonical.z>=_){const y=e.canonical.z-_;n.getSource().reparseOverscaled?(h=Math.max(e.canonical.z+2,n.transform.tileZoom),c=new _n(h,e.wrap,_,e.canonical.x>>y,e.canonical.y>>y)):0!==y&&(h=_,c=new _n(h,e.wrap,_,e.canonical.x>>y,e.canonical.y>>y))}c.key!==e.key&&(p.push(c.key),i=n.getTile(c))}const g=_=>{p.forEach(y=>{a[y]=_}),p.length=0};for(h-=1;h>=f&&(!i||!i.hasData());h--){i&&g(i.tileID.key);const _=c.calculateScaledKey(h);if(i=n.getTileByID(_),i&&i.hasData())break;const y=a[_];if(null===y)break;void 0===y?p.push(_):i=n.getTileByID(y)}return g(i?i.tileID.key:null),i&&i.hasData()?i:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,n){let i=this._tilesDirty[e];i||(i=this._tilesDirty[e]={}),i[n.key]=!0}}function j2(t,e,n){const i=function(h,f,p){const g=Z.dot(f,h),_=Z.dot(p,[.2126,.7152,.0722]),y=(w,E,T)=>(1-T)*w+T*E,v=y(1-.3*Math.min(_,1),1,Math.min(g+1,1));return y(.92,1,Math.asin(et(f[2],-1,1))/Math.PI+.5)*v}(t,[0,0,1],e),a=[0,0,0];Z.scale(a,n.slice(0,3),i);const l=[0,0,0];Z.scale(l,e.slice(0,3),t[2]);const c=[0,0,0];return Z.add(c,a,l),En(c)}const nx=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],U2=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class yi{static cacheKey(e,n,i,a){let l=`${n}${a?a.cacheKey:""}`;for(const c of i)e.usedDefines.includes(c)&&(l+=`/${c}`);return l}constructor(e,n,i,a,l,c){const h=e.gl;this.program=h.createProgram(),this.configuration=a,this.name=n,this.fixedDefines=[...c];const f=function(C){const S=[];for(let I=0;I<C.length;I++){if(null===C[I])continue;const R=C[I].split(" ");S.push(R.pop())}return S}(i.staticAttributes),p=a?a.getBinderAttributes():[],g=f.concat(p);let _=a?a.defines():[];_=_.concat(c.map(C=>`#define ${C}`));const y="#version 300 es\n";let v=y+_.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",ex,vd.fragmentSource).join("\n");for(const C of i.fragmentIncludes)v+=`\n${Uu[C]}`;v+=`\n${i.fragmentSource}`;let w=y+_.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",ex,vd.vertexSource).join("\n");for(const C of i.vertexIncludes)w+=`\n${Uu[C]}`;w+=`\n${i.vertexSource}`;const E=h.createShader(h.FRAGMENT_SHADER);if(h.isContextLost())return void(this.failedToCreate=!0);h.shaderSource(E,v),h.compileShader(E),h.attachShader(this.program,E);const T=h.createShader(h.VERTEX_SHADER);if(h.isContextLost())this.failedToCreate=!0;else{h.shaderSource(T,w),h.compileShader(T),h.attachShader(this.program,T),this.attributes={},this.numAttributes=g.length;for(let C=0;C<this.numAttributes;C++)if(g[C]){const S=g[C].startsWith("a_")?g[C]:`a_${g[C]}`;h.bindAttribLocation(this.program,C,S),this.attributes[S]=C}h.linkProgram(this.program),h.deleteShader(T),h.deleteShader(E),this.fixedUniforms=l(e),this.binderUniforms=a?a.getUniforms(e):[],c.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new Xt(C=e),u_dem_prev:new Xt(C),u_dem_unpack:new go(C),u_dem_tl:new Jt(C),u_dem_scale:new Pe(C),u_dem_tl_prev:new Jt(C),u_dem_scale_prev:new Pe(C),u_dem_size:new Pe(C),u_dem_lerp:new Pe(C),u_exaggeration:new Pe(C),u_depth:new Xt(C),u_depth_size_inv:new Jt(C),u_meter_to_dem:new Pe(C),u_label_plane_matrix_inv:new It(C)}),c.includes("GLOBE")&&(this.globeUniforms=(C=>({u_tile_tl_up:new kt(C),u_tile_tr_up:new kt(C),u_tile_br_up:new kt(C),u_tile_bl_up:new kt(C),u_tile_up_scale:new Pe(C)}))(e)),c.includes("FOG")&&(this.fogUniforms=(C=>({u_fog_matrix:new It(C),u_fog_range:new Jt(C),u_fog_color:new go(C),u_fog_horizon_blend:new Pe(C),u_fog_vertical_limit:new Jt(C),u_fog_temporal_offset:new Pe(C),u_frustum_tl:new kt(C),u_frustum_tr:new kt(C),u_frustum_br:new kt(C),u_frustum_bl:new kt(C),u_globe_pos:new kt(C),u_globe_radius:new Pe(C),u_globe_transition:new Pe(C),u_is_globe:new Xt(C),u_viewport:new Jt(C)}))(e)),c.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(C=>({u_cutoff_params:new go(C)}))(e)),c.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(C=>({u_lighting_ambient_color:new kt(C),u_lighting_directional_dir:new kt(C),u_lighting_directional_color:new kt(C),u_ground_radiance:new kt(C)}))(e)),c.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(C=>({u_light_matrix_0:new It(C),u_light_matrix_1:new It(C),u_fade_range:new Jt(C),u_shadow_normal_offset:new kt(C),u_shadow_intensity:new Pe(C),u_shadow_texel_size:new Pe(C),u_shadow_map_resolution:new Pe(C),u_shadow_direction:new kt(C),u_shadow_bias:new kt(C),u_shadowmap_0:new Xt(C),u_shadowmap_1:new Xt(C)}))(e))}var C}setTerrainUniformValues(e,n){if(!this.terrainUniforms)return;const i=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const a in n)i[a]&&i[a].set(this.program,a,n[a])}}setGlobeUniformValues(e,n){if(!this.globeUniforms)return;const i=this.globeUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const a in n)i[a]&&i[a].set(this.program,a,n[a])}}setFogUniformValues(e,n){if(!this.fogUniforms)return;const i=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const a in n)i[a].set(this.program,a,n[a])}}setCutoffUniformValues(e,n){if(!this.cutoffUniforms)return;const i=this.cutoffUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const a in n)i[a].set(this.program,a,n[a])}}setLightsUniformValues(e,n){if(!this.lightsUniforms)return;const i=this.lightsUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const a in n)i[a].set(this.program,a,n[a])}}setShadowUniformValues(e,n){if(this.failedToCreate||!this.shadowUniforms)return;const i=this.shadowUniforms;e.program.set(this.program);for(const a in n)i[a].set(this.program,a,n[a])}_drawDebugWireframe(e,n,i,a,l,c,h,f,p,g){const _=e.options.wireframe;if(!1===_.terrain&&!1===_.layers2D&&!1===_.layers3D)return;const y=e.context;if(!(()=>!(!_.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!_.layers2D||e._terrain&&e._terrain.renderingToTexture||!nx.includes(this.name))||!(!_.layers3D||!U2.includes(this.name)))())return;const v=y.gl,w=e.wireframeDebugCache.getLinesFromTrianglesBuffer(e.frameCounter,l,y);if(!w)return;const E=[...this.fixedDefines];E.push("DEBUG_WIREFRAME");const T=e.getOrCreateProgram(this.name,{config:this.configuration,defines:E});y.program.set(T.program);const C=(R,A,k)=>{if(A[R]&&k[R])for(const L in A[R])k[R][L]&&k[R][L].set(k.program,L,A[R][L].current)};p&&p.setUniforms(T.program,y,T.binderUniforms,h,{zoom:f}),C("fixedUniforms",this,T),C("terrainUniforms",this,T),C("globeUniforms",this,T),C("fogUniforms",this,T),C("lightsUniforms",this,T),C("shadowUniforms",this,T),w.bind(),y.setColorMode(new fn([v.ONE,v.ONE_MINUS_SRC_ALPHA,v.ZERO,v.ONE],yt.transparent,[!0,!0,!0,!1])),y.setDepthMode(new Et(n.func===v.LESS?v.LEQUAL:n.func,Et.ReadOnly,n.range)),y.setStencilMode(qt.disabled);const S=3*c.primitiveLength*2,I=3*c.primitiveOffset*2*2;g&&g>1?v.drawElementsInstanced(v.LINES,S,v.UNSIGNED_SHORT,I,g):v.drawElements(v.LINES,S,v.UNSIGNED_SHORT,I),l.bind(),y.program.set(this.program),y.setDepthMode(n),y.setStencilMode(i),y.setColorMode(a)}draw(e,n,i,a,l,c,h,f,p,g,_,y,v,w,E,T){const C=e.context,S=C.gl;if(this.failedToCreate)return;C.program.set(this.program),C.setDepthMode(i),C.setStencilMode(a),C.setColorMode(l),C.setCullFace(c);for(const A of Object.keys(this.fixedUniforms))this.fixedUniforms[A].set(this.program,A,h[A]);w&&w.setUniforms(this.program,C,this.binderUniforms,y,{zoom:v});const I={[S.LINES]:2,[S.TRIANGLES]:3,[S.LINE_STRIP]:1}[n],R=T&&T>0?1:void 0;for(const A of _.get()){const k=A.vaos||(A.vaos={});(k[f]||(k[f]=new tx)).bind(C,this,p,w?w.getPaintVertexBuffers():[],g,A.vertexOffset,E||[],R),T&&T>1?S.drawElementsInstanced(n,A.primitiveLength*I,S.UNSIGNED_SHORT,A.primitiveOffset*I*2,T):S.drawElements(n,A.primitiveLength*I,S.UNSIGNED_SHORT,A.primitiveOffset*I*2),n===S.TRIANGLES&&this._drawDebugWireframe(e,i,a,l,g,A,y,v,w,T)}}}function RC(t,e){const n=Math.pow(2,e.tileID.overscaledZ),i=e.tileSize*Math.pow(2,t.transform.tileZoom)/n,a=i*(e.tileID.canonical.x+e.tileID.wrap*n),l=i*e.tileID.canonical.y;return{u_image:0,u_texsize:e.imageAtlasTexture.size,u_tile_units_to_pixels:1/rl(e,1,t.transform.tileZoom),u_pixel_coord_upper:[a>>16,l>>16],u_pixel_coord_lower:[65535&a,65535&l]}}const rx=se.create(),kC=(t,e,n,i,a,l,c,h,f,p,g,_,y,v,w)=>{const E=e.style.light,T=E.properties.get("position"),C=[T.x,T.y,T.z],S=Mo.create();"viewport"===E.properties.get("anchor")&&(Mo.fromRotation(S,-e.transform.angle),Z.transformMat3(C,C,S));const I=E.properties.get("color"),R=e.transform,A={u_matrix:t,u_lightpos:C,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[I.r,I.g,I.b],u_vertical_gradient:+n,u_opacity:i,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:rx,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:a,u_edge_radius:l,u_flood_light_color:_,u_vertical_scale:y,u_flood_light_intensity:v,u_ground_shadow_factor:w};return"globe"===R.projection.name&&(A.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],A.u_zoom_transition=f,A.u_inv_rot_matrix=g,A.u_merc_center=p,A.u_up_dir=R.projection.upVector(new Ls(0,0,0),p[0]*he,p[1]*he),A.u_height_lift=h),A},$2=(t,e,n)=>({u_matrix:t,u_edge_radius:e,u_vertical_scale:n}),ix=(t,e,n,i,a,l,c,h,f,p,g,_,y,v)=>{const w=kC(t,e,n,i,a,l,c,f,p,g,_,y,v,1,[0,0,0]),E={u_height_factor:-Math.pow(2,c.overscaledZ)/h.tileSize/8};return Ke(w,RC(e,h),E)},ox=(t,e)=>({u_matrix:t,u_emissive_strength:e}),sx=(t,e,n,i)=>Ke(ox(t,e),RC(n,i)),H2=(t,e,n)=>({u_matrix:t,u_world:n,u_emissive_strength:e}),OC=(t,e,n,i,a)=>Ke(sx(t,e,n,i),{u_world:a}),c_=(t,e,n,i)=>{const a=he/n.tileSize;return{u_matrix:t,u_camera_to_center_distance:e.getCameraToCenterDistance(i),u_extrude_scale:[e.pixelsToGLUnits[0]/a,e.pixelsToGLUnits[1]/a]}},u_=(t,e,n=1)=>({u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:n}),ax=se.create(),G2=(t,e,n,i,a,l,c)=>{const h=t.transform,f="globe"===h.projection.name,p=f?Lh(h.zoom,e.canonical)*h._pixelsPerMercatorPixel:rl(n,1,l),g={u_matrix:e.projMatrix,u_extrude_scale:p,u_intensity:c,u_inv_rot_matrix:ax,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(f){g.u_inv_rot_matrix=i,g.u_merc_center=a,g.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],g.u_zoom_transition=ni(h.zoom);const _=a[0]*he,y=a[1]*he;g.u_up_dir=h.projection.upVector(new Ls(0,0,0),_,y)}return g},h_=(t,e,n,i,a,l,c,h,f,p,g)=>{return{u_matrix:t,u_normalize_matrix:e,u_globe_matrix:n,u_tl_parent:i,u_scale_parent:a,u_fade_t:l.mix,u_opacity:l.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(y=c.paint.get("raster-saturation"),y>0?1-1/(1.001-y):-y),u_contrast_factor:(_=c.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:Nc(c.paint.get("raster-hue-rotate")),u_perspective_transform:h,u_colorization_mix:p,u_colorization_scale:LC(g),u_color_ramp:f};var _,y};function Nc(t){t*=Math.PI/180;const e=Math.sin(t),n=Math.cos(t);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}function LC([t,e]){if(t===e)return[t,e];const n=(e+t)/2,i=(e-t)/2*256/255;return[-(t=n-i)/((e=n+i)-t),1/(e-t)]}const d_=se.create(),sl=(t,e,n,i,a,l,c,h,f,p,g,_,y,v,w,E,T)=>{const C=a.transform,S={u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:C.getCameraToCenterDistance(E),u_rotate_symbol:+n,u_aspect_ratio:C.width/C.height,u_fade_change:a.options.fadeDuration?a.symbolFadeChange:1,u_matrix:l,u_label_plane_matrix:c,u_coord_matrix:h,u_is_text:+f,u_pitch_with_map:+i,u_texsize:p,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:d_,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:d_,u_up_vector:[0,-1,0],u_icon_transition:T||0};return"globe"===E.name&&(S.u_tile_id=[g.canonical.x,g.canonical.y,1<<g.canonical.z],S.u_zoom_transition=_,S.u_inv_rot_matrix=v,S.u_merc_center=y,S.u_camera_forward=C._camera.forward(),S.u_ecef_origin=function(I,R){const A=[0,0,0],k=So(ps(R.canonical));return Z.transformMat4(A,A,k),Z.transformMat4(A,A,I),A}(C.globeMatrix,g.toUnwrapped()),S.u_tile_matrix=Float32Array.from(C.globeMatrix),S.u_up_vector=w),S},FC=(t,e,n,i,a,l,c,h,f,p,g,_,y,v,w,E,T)=>Ke(sl(t,e,n,i,a,l,c,h,f,p,_,y,v,w,E,T),{u_gamma_scale:i?a.transform.getCameraToCenterDistance(T)*Math.cos(a.terrain?0:a.transform._pitch):1,u_device_pixel_ratio:Ct.devicePixelRatio,u_is_halo:+g,undefined:void 0}),LI=(t,e,n,i,a,l,c,h,f,p,g,_,y,v,w,E)=>Ke(FC(t,e,n,i,a,l,c,h,!0,f,!0,g,_,y,v,w,E),{u_texsize_icon:p,u_texture_icon:1}),q2=(t,e,n,i)=>({u_matrix:t,u_emissive_strength:e,u_opacity:n,u_color:i}),NC=(t,e,n,i,a,l,c)=>Ke(function(h,f,p,g){const _=p.imageManager.getPattern(h.toString(),f),{width:y,height:v}=p.imageManager.getPixelSize(f),w=Math.pow(2,g.tileID.overscaledZ),E=g.tileSize*Math.pow(2,p.transform.tileZoom)/w,T=E*(g.tileID.canonical.x+g.tileID.wrap*w),C=E*g.tileID.canonical.y;return{u_image:0,u_pattern_tl:_.tl,u_pattern_br:_.br,u_texsize:[y,v],u_pattern_size:_.displaySize,u_tile_units_to_pixels:1/rl(g,1,p.transform.tileZoom),u_pixel_coord_upper:[T>>16,C>>16],u_pixel_coord_lower:[65535&T,65535&C]}}(a,l,i,c),{u_matrix:t,u_emissive_strength:e,u_opacity:n}),Wo_BaseColor=5,Wo_MetallicRoughness=6,Wo_Normal=7,Wo_Occlusion=8,Wo_Emission=9,Wo_ShadowMap0=10,lx=(t,e,n,i,a,l,c,h,f,p,g,_=[0,0,0])=>{const y=i.style.light,v=y.properties.get("position"),w=[-v.x,-v.y,v.z],E=Mo.create();"viewport"===y.properties.get("anchor")&&(Mo.fromRotation(E,-i.transform.angle),Z.transformMat3(w,w,E));const T="MASK"===p.alphaMode,C=y.properties.get("color"),S=g.paint.get("model-ambient-occlusion-intensity"),I=g.paint.get("model-color").constantOr(yt.white),R=g.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:t,u_lighting_matrix:e,u_normal_matrix:n,u_lightpos:w,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[C.r,C.g,C.b],u_camera_pos:_,u_opacity:a,u_baseTextureIsAlpha:0,u_alphaMask:+T,u_alphaCutoff:p.alphaCutoff,u_baseColorFactor:[l.r,l.g,l.b,l.a],u_emissiveFactor:[c[0],c[1],c[2],1],u_metallicFactor:h,u_roughnessFactor:f,u_baseColorTexture:Wo_BaseColor,u_metallicRoughnessTexture:Wo_MetallicRoughness,u_normalTexture:Wo_Normal,u_occlusionTexture:Wo_Occlusion,u_emissionTexture:Wo_Emission,u_color_mix:[I.r,I.g,I.b,R],u_aoIntensity:S}},cx=new Float32Array(16),W2=(t,e=cx,n=cx)=>({u_matrix:t,u_instance:e,u_node_matrix:n}),zC={fillExtrusion:t=>({u_matrix:new It(t),u_lightpos:new kt(t),u_lightintensity:new Pe(t),u_lightcolor:new kt(t),u_vertical_gradient:new Pe(t),u_opacity:new Pe(t),u_edge_radius:new Pe(t),u_ao:new Jt(t),u_tile_id:new kt(t),u_zoom_transition:new Pe(t),u_inv_rot_matrix:new It(t),u_merc_center:new Jt(t),u_up_dir:new kt(t),u_height_lift:new Pe(t),u_flood_light_color:new kt(t),u_vertical_scale:new Pe(t),u_flood_light_intensity:new Pe(t),u_ground_shadow_factor:new kt(t)}),fillExtrusionDepth:t=>({u_matrix:new It(t),u_edge_radius:new Pe(t),u_vertical_scale:new Pe(t)}),fillExtrusionPattern:t=>({u_matrix:new It(t),u_lightpos:new kt(t),u_lightintensity:new Pe(t),u_lightcolor:new kt(t),u_vertical_gradient:new Pe(t),u_height_factor:new Pe(t),u_edge_radius:new Pe(t),u_ao:new Jt(t),u_tile_id:new kt(t),u_zoom_transition:new Pe(t),u_inv_rot_matrix:new It(t),u_merc_center:new Jt(t),u_up_dir:new kt(t),u_height_lift:new Pe(t),u_image:new Xt(t),u_texsize:new Jt(t),u_pixel_coord_upper:new Jt(t),u_pixel_coord_lower:new Jt(t),u_tile_units_to_pixels:new Pe(t),u_opacity:new Pe(t)}),fillExtrusionGroundEffect:t=>({u_matrix:new It(t),u_opacity:new Pe(t),u_ao_pass:new Pe(t),u_meter_to_tile:new Pe(t),u_ao:new Jt(t),u_flood_light_intensity:new Pe(t),u_flood_light_color:new kt(t),u_attenuation:new Pe(t),u_edge_radius:new Pe(t),u_fb:new Xt(t),u_fb_size:new Pe(t)}),fill:t=>({u_matrix:new It(t),u_emissive_strength:new Pe(t)}),fillPattern:t=>({u_matrix:new It(t),u_emissive_strength:new Pe(t),u_image:new Xt(t),u_texsize:new Jt(t),u_pixel_coord_upper:new Jt(t),u_pixel_coord_lower:new Jt(t),u_tile_units_to_pixels:new Pe(t)}),fillOutline:t=>({u_matrix:new It(t),u_emissive_strength:new Pe(t),u_world:new Jt(t)}),fillOutlinePattern:t=>({u_matrix:new It(t),u_emissive_strength:new Pe(t),u_world:new Jt(t),u_image:new Xt(t),u_texsize:new Jt(t),u_pixel_coord_upper:new Jt(t),u_pixel_coord_lower:new Jt(t),u_tile_units_to_pixels:new Pe(t)}),circle:t=>({u_camera_to_center_distance:new Pe(t),u_extrude_scale:new gy(t),u_device_pixel_ratio:new Pe(t),u_matrix:new It(t),u_inv_rot_matrix:new It(t),u_merc_center:new Jt(t),u_tile_id:new kt(t),u_zoom_transition:new Pe(t),u_up_dir:new kt(t),u_emissive_strength:new Pe(t)}),collisionBox:t=>({u_matrix:new It(t),u_camera_to_center_distance:new Pe(t),u_extrude_scale:new Jt(t)}),collisionCircle:t=>({u_matrix:new It(t),u_inv_matrix:new It(t),u_camera_to_center_distance:new Pe(t),u_viewport_size:new Jt(t)}),debug:t=>({u_color:new xu(t),u_matrix:new It(t),u_overlay:new Xt(t),u_overlay_scale:new Pe(t)}),clippingMask:t=>({u_matrix:new It(t)}),heatmap:t=>({u_extrude_scale:new Pe(t),u_intensity:new Pe(t),u_matrix:new It(t),u_inv_rot_matrix:new It(t),u_merc_center:new Jt(t),u_tile_id:new kt(t),u_zoom_transition:new Pe(t),u_up_dir:new kt(t)}),heatmapTexture:t=>({u_image:new Xt(t),u_color_ramp:new Xt(t),u_opacity:new Pe(t)}),hillshade:t=>({u_matrix:new It(t),u_image:new Xt(t),u_latrange:new Jt(t),u_light:new Jt(t),u_shadow:new xu(t),u_highlight:new xu(t),u_emissive_strength:new Pe(t),u_accent:new xu(t)}),hillshadePrepare:t=>({u_matrix:new It(t),u_image:new Xt(t),u_dimension:new Jt(t),u_zoom:new Pe(t),u_unpack:new go(t)}),line:t=>({u_matrix:new It(t),u_pixels_to_tile_units:new gy(t),u_device_pixel_ratio:new Pe(t),u_units_to_pixels:new Jt(t),u_dash_image:new Xt(t),u_gradient_image:new Xt(t),u_image_height:new Pe(t),u_texsize:new Jt(t),u_tile_units_to_pixels:new Pe(t),u_alpha_discard_threshold:new Pe(t),u_trim_offset:new Jt(t),u_emissive_strength:new Pe(t)}),linePattern:t=>({u_matrix:new It(t),u_texsize:new Jt(t),u_pixels_to_tile_units:new gy(t),u_device_pixel_ratio:new Pe(t),u_image:new Xt(t),u_units_to_pixels:new Jt(t),u_tile_units_to_pixels:new Pe(t),u_alpha_discard_threshold:new Pe(t)}),raster:t=>({u_matrix:new It(t),u_normalize_matrix:new It(t),u_globe_matrix:new It(t),u_tl_parent:new Jt(t),u_scale_parent:new Pe(t),u_fade_t:new Pe(t),u_opacity:new Pe(t),u_image0:new Xt(t),u_image1:new Xt(t),u_brightness_low:new Pe(t),u_brightness_high:new Pe(t),u_saturation_factor:new Pe(t),u_contrast_factor:new Pe(t),u_spin_weights:new kt(t),u_perspective_transform:new Jt(t),u_colorization_mix:new go(t),u_colorization_scale:new Jt(t),u_color_ramp:new Xt(t)}),symbolIcon:t=>({u_is_size_zoom_constant:new Xt(t),u_is_size_feature_constant:new Xt(t),u_size_t:new Pe(t),u_size:new Pe(t),u_camera_to_center_distance:new Pe(t),u_rotate_symbol:new Xt(t),u_aspect_ratio:new Pe(t),u_fade_change:new Pe(t),u_matrix:new It(t),u_label_plane_matrix:new It(t),u_coord_matrix:new It(t),u_is_text:new Xt(t),u_pitch_with_map:new Xt(t),u_texsize:new Jt(t),u_tile_id:new kt(t),u_zoom_transition:new Pe(t),u_inv_rot_matrix:new It(t),u_merc_center:new Jt(t),u_camera_forward:new kt(t),u_tile_matrix:new It(t),u_up_vector:new kt(t),u_ecef_origin:new kt(t),u_texture:new Xt(t),u_icon_transition:new Pe(t)}),symbolSDF:t=>({u_is_size_zoom_constant:new Xt(t),u_is_size_feature_constant:new Xt(t),u_size_t:new Pe(t),u_size:new Pe(t),u_camera_to_center_distance:new Pe(t),u_rotate_symbol:new Xt(t),u_aspect_ratio:new Pe(t),u_fade_change:new Pe(t),u_matrix:new It(t),u_label_plane_matrix:new It(t),u_coord_matrix:new It(t),u_is_text:new Xt(t),u_pitch_with_map:new Xt(t),u_texsize:new Jt(t),u_texture:new Xt(t),u_gamma_scale:new Pe(t),u_device_pixel_ratio:new Pe(t),u_tile_id:new kt(t),u_zoom_transition:new Pe(t),u_inv_rot_matrix:new It(t),u_merc_center:new Jt(t),u_camera_forward:new kt(t),u_tile_matrix:new It(t),u_up_vector:new kt(t),u_ecef_origin:new kt(t),u_is_halo:new Xt(t)}),symbolTextAndIcon:t=>({u_is_size_zoom_constant:new Xt(t),u_is_size_feature_constant:new Xt(t),u_size_t:new Pe(t),u_size:new Pe(t),u_camera_to_center_distance:new Pe(t),u_rotate_symbol:new Xt(t),u_aspect_ratio:new Pe(t),u_fade_change:new Pe(t),u_matrix:new It(t),u_label_plane_matrix:new It(t),u_coord_matrix:new It(t),u_is_text:new Xt(t),u_pitch_with_map:new Xt(t),u_texsize:new Jt(t),u_texsize_icon:new Jt(t),u_texture:new Xt(t),u_texture_icon:new Xt(t),u_gamma_scale:new Pe(t),u_device_pixel_ratio:new Pe(t),u_is_halo:new Xt(t)}),background:t=>({u_matrix:new It(t),u_emissive_strength:new Pe(t),u_opacity:new Pe(t),u_color:new xu(t)}),backgroundPattern:t=>({u_matrix:new It(t),u_emissive_strength:new Pe(t),u_opacity:new Pe(t),u_image:new Xt(t),u_pattern_tl:new Jt(t),u_pattern_br:new Jt(t),u_texsize:new Jt(t),u_pattern_size:new Jt(t),u_pixel_coord_upper:new Jt(t),u_pixel_coord_lower:new Jt(t),u_tile_units_to_pixels:new Pe(t)}),terrainRaster:TC,terrainDepth:TC,skybox:t=>({u_matrix:new It(t),u_sun_direction:new kt(t),u_cubemap:new Xt(t),u_opacity:new Pe(t),u_temporal_offset:new Pe(t)}),skyboxGradient:t=>({u_matrix:new It(t),u_color_ramp:new Xt(t),u_center_direction:new kt(t),u_radius:new Pe(t),u_opacity:new Pe(t),u_temporal_offset:new Pe(t)}),skyboxCapture:t=>({u_matrix_3f:new Y1(t),u_sun_direction:new kt(t),u_sun_intensity:new Pe(t),u_color_tint_r:new go(t),u_color_tint_m:new go(t),u_luminance:new Pe(t)}),globeRaster:t=>({u_proj_matrix:new It(t),u_globe_matrix:new It(t),u_normalize_matrix:new It(t),u_merc_matrix:new It(t),u_zoom_transition:new Pe(t),u_merc_center:new Jt(t),u_image0:new Xt(t),u_grid_matrix:new Y1(t),u_skirt_height:new Pe(t),u_frustum_tl:new kt(t),u_frustum_tr:new kt(t),u_frustum_br:new kt(t),u_frustum_bl:new kt(t),u_globe_pos:new kt(t),u_globe_radius:new Pe(t),u_viewport:new Jt(t)}),globeAtmosphere:t=>({u_frustum_tl:new kt(t),u_frustum_tr:new kt(t),u_frustum_br:new kt(t),u_frustum_bl:new kt(t),u_horizon:new Pe(t),u_transition:new Pe(t),u_fadeout_range:new Pe(t),u_color:new go(t),u_high_color:new go(t),u_space_color:new go(t),u_temporal_offset:new Pe(t),u_horizon_angle:new Pe(t)}),model:t=>({u_matrix:new It(t),u_lighting_matrix:new It(t),u_normal_matrix:new It(t),u_lightpos:new kt(t),u_lightintensity:new Pe(t),u_lightcolor:new kt(t),u_camera_pos:new kt(t),u_opacity:new Pe(t),u_baseColorFactor:new go(t),u_emissiveFactor:new go(t),u_metallicFactor:new Pe(t),u_roughnessFactor:new Pe(t),u_baseTextureIsAlpha:new Xt(t),u_alphaMask:new Xt(t),u_alphaCutoff:new Pe(t),u_baseColorTexture:new Xt(t),u_metallicRoughnessTexture:new Xt(t),u_normalTexture:new Xt(t),u_occlusionTexture:new Xt(t),u_emissionTexture:new Xt(t),u_color_mix:new go(t),u_aoIntensity:new Pe(t)}),modelDepth:t=>({u_matrix:new It(t),u_instance:new It(t),u_node_matrix:new It(t)}),groundShadow:t=>({u_matrix:new It(t),u_ground_shadow_factor:new kt(t)}),stars:t=>({u_matrix:new It(t),u_up:new kt(t),u_right:new kt(t),u_intensity_multiplier:new Pe(t)})};let f_;function ux(t,e,n,i,a,l,c){const h=t.context,f=h.gl,p=t.transform,g=t.getOrCreateProgram("collisionBox"),_=[];let y=0,v=0;for(let R=0;R<i.length;R++){const A=i[R],k=e.getTile(A),L=k.getBucket(n);if(!L)continue;const B=r_(A,L,p);let j=B;0===a[0]&&0===a[1]||(j=t.translatePosMatrix(B,k,a,l));const U=c?L.textCollisionBox:L.iconCollisionBox,G=L.collisionCircleArray;if(G.length>0){const $=se.create(),W=j;se.mul($,L.placementInvProjMatrix,p.glCoordMatrix),se.mul($,$,L.placementViewportMatrix),_.push({circleArray:G,circleOffset:v,transform:W,invTransform:$,projection:L.getProjection()}),y+=G.length/4,v=y}U&&(t.terrain&&t.terrain.setupElevationDraw(k,g),g.draw(t,f.LINES,Et.disabled,qt.disabled,t.colorModeForRenderPass(),Wt.disabled,c_(j,p,k,L.getProjection()),n.id,U.layoutVertexBuffer,U.indexBuffer,U.segments,null,p.zoom,null,[U.collisionVertexBuffer,U.collisionVertexBufferExt]))}if(!c||!_.length)return;const w=t.getOrCreateProgram("collisionCircle"),E=new wm;E.resize(4*y),E._trim();let T=0;for(const R of _)for(let A=0;A<R.circleArray.length/4;A++){const k=4*A,L=R.circleArray[k+0],B=R.circleArray[k+1],j=R.circleArray[k+2],U=R.circleArray[k+3];E.emplace(T++,L,B,j,U,0),E.emplace(T++,L,B,j,U,1),E.emplace(T++,L,B,j,U,2),E.emplace(T++,L,B,j,U,3)}(!f_||f_.length<2*y)&&(f_=function(R){const A=2*R,k=new Tr;k.resize(A),k._trim();for(let L=0;L<A;L++){const B=6*L;k.uint16[B+0]=4*L+0,k.uint16[B+1]=4*L+1,k.uint16[B+2]=4*L+2,k.uint16[B+3]=4*L+2,k.uint16[B+4]=4*L+3,k.uint16[B+5]=4*L+0}return k}(y));const C=h.createIndexBuffer(f_,!0),S=h.createVertexBuffer(E,Nv.members,!0);for(const R of _){const A={u_matrix:R.transform,u_inv_matrix:R.invTransform,u_camera_to_center_distance:(I=p).getCameraToCenterDistance(R.projection),u_viewport_size:[I.width,I.height]};w.draw(t,f.TRIANGLES,Et.disabled,qt.disabled,t.colorModeForRenderPass(),Wt.disabled,A,n.id,S,C,Cn.simpleSegment(0,2*R.circleOffset,R.circleArray.length,R.circleArray.length/2),null,p.zoom)}var I;S.destroy(),C.destroy()}const Z2=se.create();function hx({width:t,height:e,anchor:n,textOffset:i,textScale:a},l){const{horizontalAlign:c,verticalAlign:h}=vg(n),f=-(c-.5)*t,p=-(h-.5)*e,g=bg(n,i);return new ie((f/a+g[0])*l,(p/a+g[1])*l)}function BC(t,e,n,i,a,l,c,h,f,p,g){const _=t.text.placedSymbolArray,y=t.text.dynamicLayoutVertexArray,v=t.icon.dynamicLayoutVertexArray,w={},E=t.getProjection(),T=yp(h,E,l),C=l.elevation,S=E.upVectorScale(h.canonical,l.center.lat,l.worldSize).metersToTile;y.clear();for(let I=0;I<_.length;I++){const R=_.get(I),{tileAnchorX:A,tileAnchorY:k,numGlyphs:L}=R,B=R.hidden||!R.crossTileID||t.allowVerticalPlacement&&!R.placedOrientation?null:i[R.crossTileID];if(B){let j=0,U=0,G=0;if(C){const ae=C?C.getAtTileOffset(h,A,k):0,[ue,fe,ge]=E.upVector(h.canonical,A,k);j=ae*ue*S,U=ae*fe*S,G=ae*ge*S}let[$,W,H,J]=xa(R.projectedAnchorX+j,R.projectedAnchorY+U,R.projectedAnchorZ+G,n?T:c);const te=u0(l.getCameraToCenterDistance(E),J);let oe=a.evaluateSizeForFeature(t.textSizeData,p,R)*te/24;n&&(oe*=t.tilePixelRatio/f);const K=hx(B,oe);n?(({x:$,y:W,z:H}=E.projectTilePoint(A+K.x,k+K.y,h.canonical)),[$,W,H]=xa($+j,W+U,H+G,c)):(e&&K._rotate(-l.angle),$+=K.x,W+=K.y,H=0);const Q=t.allowVerticalPlacement&&R.placedOrientation===or.vertical?Math.PI/2:0;for(let ae=0;ae<L;ae++)td(y,$,W,H,Q);g&&R.associatedIconIndex>=0&&(w[R.associatedIconIndex]={x:$,y:W,z:H,angle:Q})}else ad(L,y)}if(g){v.clear();const I=t.icon.placedSymbolArray;for(let R=0;R<I.length;R++){const A=I.get(R),{numGlyphs:k}=A,L=w[R];if(A.hidden||!L)ad(k,v);else{const{x:B,y:j,z:U,angle:G}=L;for(let $=0;$<k;$++)td(v,B,j,U,G)}}t.icon.dynamicLayoutVertexBuffer.updateData(v)}t.text.dynamicLayoutVertexBuffer.updateData(y)}function VC(t,e,n){return n.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function dx(t,e,n,i,a,l,c,h,f,p,g,_){const y=t.context,v=y.gl,w=t.transform,E="map"===h,T="map"===f,C=E&&"point"!==n.layout.get("symbol-placement"),S=E&&!T&&!C,I=void 0!==n.layout.get("symbol-sort-key").constantOr(1);let R=!1;const A=t.depthModeForSublayer(0,Et.ReadOnly),k=[Si(w.center.lng),gi(w.center.lat)],L=n.layout.get("text-variable-anchor"),B="globe"===w.projection.name,j=[],U=[0,-1,0];let G=U;!B&&!w.mercatorFromTransition||E||(G=function($){const W=$._camera.getWorldToCamera($.worldSize,1),H=se.multiply([],W,$.globeMatrix);se.invert(H,H);const J=[0,0,0],te=[0,1,0,0];return bn.transformMat4(te,te,H),J[0]=te[0],J[1]=te[1],J[2]=te[2],Z.normalize(J,J),J}(w));for(const $ of i){const W=e.getTile($),H=W.getBucket(n);if(!H||"mercator"===H.projection.name&&B)continue;const J=a?H.text:H.icon;if(!J||H.fullyClipped||!J.segments.get().length)continue;const te=J.programConfigurations.get(n.id),oe=a||H.sdfIcons,K=a?H.textSizeData:H.iconSizeData,Q=T||0!==w.pitch,ae=pa(K,w.zoom);let ue,fe,ge,ve,de=[0,0],me=null;if(a)fe=W.glyphAtlasTexture,ge=v.LINEAR,ue=W.glyphAtlasTexture.size,H.iconsInText&&(de=W.imageAtlasTexture.size,me=W.imageAtlasTexture,ve=Q||t.options.rotating||t.options.zooming||"composite"===K.kind||"camera"===K.kind?v.LINEAR:v.NEAREST);else{const Qn=1!==n.layout.get("icon-size").constantOr(0)||H.iconsNeedLinear;fe=W.imageAtlasTexture,ge=oe||t.options.rotating||t.options.zooming||Qn||Q?v.LINEAR:v.NEAREST,ue=W.imageAtlasTexture.size}const Oe="globe"===H.projection.name,qe=Oe?G:U,Ge=Oe?ni(w.zoom):0,We=yp($,H.getProjection(),w),it=w.calculatePixelsToTileUnitsMatrix(W),gt=a0(We,W.tileID.canonical,T,E,w,H.getProjection(),it),zt=t.terrain&&T&&C?se.invert(se.create(),gt):Z2,an=c0(We,W.tileID.canonical,T,E,w,H.getProjection(),it),Ft=L&&H.hasTextData(),Dt=H.hasIconTextFit()&&Ft&&H.hasIconData();if(C){const Qn=w.elevation,sr=Qn?Qn.getAtTileOffsetFunc($,w.center.lat,w.worldSize,H.getProjection()):null,In=l0(We,W.tileID.canonical,T,E,w,H.getProjection(),it);_E(H,We,t,a,In,an,T,p,sr,$)}const pt=C||a&&L||Dt,ut=t.translatePosMatrix(We,W,l,c),Kt=pt?Z2:gt,dn=t.translatePosMatrix(an,W,l,c,!0),Bt=H.getProjection().createInversionMatrix(w,$.canonical),Rn=n.paint.get("icon-image-cross-fade").constantOr(0),Jn=[];t.terrainRenderModeElevated()&&T&&Jn.push("PITCH_WITH_MAP_TERRAIN"),Oe&&(Jn.push("PROJECTION_GLOBE_VIEW"),pt&&Jn.push("PROJECTED_POS_ON_VIEWPORT")),Rn>0&&Jn.push("ICON_TRANSITION"),J.zOffsetVertexBuffer&&Jn.push("Z_OFFSET");const Xn=oe&&0!==n.paint.get(a?"text-halo-width":"icon-halo-width").constantOr(1);let Hn;Hn=oe?H.iconsInText?LI(K.kind,ae,S,T,t,ut,Kt,dn,ue,de,$,Ge,k,Bt,qe,H.getProjection()):FC(K.kind,ae,S,T,t,ut,Kt,dn,a,ue,!0,$,Ge,k,Bt,qe,H.getProjection()):sl(K.kind,ae,S,T,t,ut,Kt,dn,a,ue,$,Ge,k,Bt,qe,H.getProjection(),Rn);const Nr={program:t.getOrCreateProgram(VC(oe,a,H),{config:te,defines:Jn}),buffers:J,uniformValues:Hn,atlasTexture:fe,atlasTextureIcon:me,atlasInterpolation:ge,atlasInterpolationIcon:ve,isSDF:oe,hasHalo:Xn,tile:W,labelPlaneMatrixInv:zt};if(I&&H.canOverlap){R=!0;const Qn=J.segments.get();for(const sr of Qn)j.push({segments:new Cn([sr]),sortKey:sr.sortKey,state:Nr})}else j.push({segments:J.segments,sortKey:0,state:Nr})}R&&j.sort(($,W)=>$.sortKey-W.sortKey);for(const $ of j){const W=$.state;if(t.terrain&&t.terrain.setupElevationDraw(W.tile,W.program,{useDepthForOcclusion:w.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:W.labelPlaneMatrixInv}),y.activeTexture.set(v.TEXTURE0),W.atlasTexture.bind(W.atlasInterpolation,v.CLAMP_TO_EDGE),W.atlasTextureIcon&&(y.activeTexture.set(v.TEXTURE1),W.atlasTextureIcon&&W.atlasTextureIcon.bind(W.atlasInterpolationIcon,v.CLAMP_TO_EDGE)),t.uploadCommonLightUniforms(t.context,W.program),W.hasHalo){const H=W.uniformValues;H.u_is_halo=1,p_(W.buffers,$.segments,n,t,W.program,A,g,_,H,2),H.u_is_halo=0}else{if(W.isSDF){const H=W.uniformValues;W.hasHalo&&(H.u_is_halo=1,p_(W.buffers,$.segments,n,t,W.program,A,g,_,H,1)),H.u_is_halo=0}p_(W.buffers,$.segments,n,t,W.program,A,g,_,W.uniformValues,1)}}}function p_(t,e,n,i,a,l,c,h,f,p){const g=[t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer,t.iconTransitioningVertexBuffer,t.globeExtVertexBuffer,t.zOffsetVertexBuffer];a.draw(i,i.context.gl.TRIANGLES,l,c,h,Wt.disabled,f,n.id,t.layoutVertexBuffer,t.indexBuffer,e,n.paint,i.transform.zoom,t.programConfigurations.get(n.id),g,p)}function fx(t,e,n,i,a,l,c){const h=t.context.gl,f=n.paint.get("fill-pattern"),p=f&&f.constantOr(1);let g,_,y,v,w;c?(_=p&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",g=h.LINES):(_=p?"fillPattern":"fill",g=h.TRIANGLES);for(const E of i){const T=e.getTile(E);if(p&&!T.patternsLoaded())continue;const C=T.getBucket(n);if(!C)continue;t.prepareDrawTile();const S=C.programConfigurations.get(n.id),I=t.isTileAffectedByFog(E),R=t.getOrCreateProgram(_,{config:S,overrideFog:I});p&&(t.context.activeTexture.set(h.TEXTURE0),T.imageAtlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE),S.updatePaintBuffers());const A=f.constantOr(null);if(A&&T.imageAtlas){const B=T.imageAtlas.patternPositions[A.toString()];B&&S.setConstantPatternPositions(B)}const k=t.translatePosMatrix(E.projMatrix,T,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor")),L=n.paint.get("fill-emissive-strength");if(c){v=C.indexBuffer2,w=C.segments2;const B=t.terrain&&t.terrain.renderingToTexture?t.terrain.drapeBufferSize:[h.drawingBufferWidth,h.drawingBufferHeight];y="fillOutlinePattern"===_&&p?OC(k,L,t,T,B):H2(k,L,B)}else v=C.indexBuffer,w=C.segments,y=p?sx(k,L,t,T):ox(k,L);t.uploadCommonUniforms(t.context,R,E.toUnwrapped()),R.draw(t,g,a,t.stencilModeForClipping(E),l,Wt.disabled,y,n.id,C.layoutVertexBuffer,v,w,n.paint,t.transform.zoom,S,void 0)}}function Hu(t,e,n,i,a,l,c,h){const f=t.context,p=f.gl,g=t.transform,_=n.paint.get("fill-extrusion-pattern"),y=_.constantOr(1),v=n.paint.get("fill-extrusion-opacity"),w=t.style.enable3dLights(),E=n.paint.get(w&&!y?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),T=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),E],C=n.layout.get("fill-extrusion-edge-radius"),S=C>0&&!n.paint.get("fill-extrusion-rounded-roof"),I=S?0:C,R="globe"===g.projection.name?b0():0,A="globe"===g.projection.name,k=A?ni(g.zoom):0,L=[Si(g.center.lng),gi(g.center.lat)],B=n.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),j=n.paint.get("fill-extrusion-flood-light-intensity"),U=n.paint.get("fill-extrusion-vertical-scale"),G=bp(t,n.paint.get("fill-extrusion-cutoff-fade-range")),$=[];let W;A&&$.push("PROJECTION_GLOBE_VIEW"),T[0]>0&&$.push("FAUX_AO"),S&&$.push("ZERO_ROOF_RADIUS"),h&&$.push("HAS_CENTROID"),j>0&&$.push("FLOOD_LIGHT"),G.shouldRenderCutoff&&$.push("RENDER_CUTOFF");const H="shadow"===t.renderPass,J=t.shadowRenderer,te=H&&!!J;t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!0);let oe=[0,0,0];if(J){const Q=t.style.directionalLight,ae=t.style.ambientLight;Q&&ae&&(oe=bd(Q,ae)),W=$.concat(["SHADOWS_SINGLE_CASCADE"])}const K=te?"fillExtrusionDepth":y?"fillExtrusionPattern":"fillExtrusion";for(const Q of i){const ae=e.getTile(Q),ue=ae.getBucket(n);if(!ue||ue.projection.name!==g.projection.name)continue;let fe=!1;J&&(fe=0===J.getMaxCascadeForTile(Q.toUnwrapped()));const ge=t.isTileAffectedByFog(Q),ve=ue.programConfigurations.get(n.id),de=t.getOrCreateProgram(K,{config:ve,defines:fe?W:$,overrideFog:ge});if(t.terrain){const We=t.terrain;t.style.terrainSetForDrapingOnly(),We.setupElevationDraw(ae,de,{useMeterToDem:!0})}if(!ue.centroidVertexBuffer){const We=de.attributes.a_centroid_pos;void 0!==We&&p.vertexAttrib2f(We,0,0)}!H&&J&&J.setupShadows(ae.tileID.toUnwrapped(),de,"vector-tile",ae.tileID.overscaledZ),y&&(t.context.activeTexture.set(p.TEXTURE0),ae.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),ve.updatePaintBuffers());const me=_.constantOr(null);if(me&&ae.imageAtlas){const We=ae.imageAtlas.patternPositions[me.toString()];We&&ve.setConstantPatternPositions(We)}const Oe=n.paint.get("fill-extrusion-vertical-gradient");let qe;if(H&&J){if(FI(ae.tileID,ue,t))continue;const We=J.calculateShadowPassMatrixFromTile(ae.tileID.toUnwrapped());qe=$2(We,I,U)}else{const We=t.translatePosMatrix(Q.projMatrix,ae,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),it=g.projection.createInversionMatrix(g,Q.canonical);qe=y?ix(We,t,Oe,v,T,I,Q,ae,R,k,L,it,B,U):kC(We,t,Oe,v,T,I,Q,R,k,L,it,B,U,j,oe)}t.uploadCommonUniforms(f,de,Q.toUnwrapped(),null,G);const Ge=[];(t.terrain||h)&&Ge.push(ue.centroidVertexBuffer),A&&Ge.push(ue.layoutVertexExtBuffer),de.draw(t,f.gl.TRIANGLES,a,l,c,Wt.backCCW,qe,n.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,n.paint,t.transform.zoom,ve,Ge)}t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!1)}function Xl(t,e,n,i,a,l,c,h,f,p,g,_,y,v,w,E,T,C,S){const I=t.context,R=I.gl,A=t.transform,k=t.transform.zoom,L=[],B=bp(t,n.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===p?(L.push("CLEAR_SUBPASS"),S&&(L.push("CLEAR_FROM_TEXTURE"),I.activeTexture.set(R.TEXTURE0),S.bind(R.LINEAR,R.CLAMP_TO_EDGE))):"sdf"===p&&L.push("SDF_SUBPASS"),T&&L.push("HAS_CENTROID"),B.shouldRenderCutoff&&L.push("RENDER_CUTOFF");const j=n.layout.get("fill-extrusion-edge-radius"),U=(G,$,W,H,J)=>{const te=$.programConfigurations.get(n.id),oe=t.isTileAffectedByFog(G),K=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:te,defines:L,overrideFog:oe}),Q={u_matrix:H,u_opacity:g,u_ao_pass:f?1:0,u_meter_to_tile:J,u_ao:[_,y*J],u_flood_light_intensity:v,u_flood_light_color:w,u_attenuation:E,u_edge_radius:k>=17?0:j*J,u_fb:0,u_fb_size:S?S.size[0]:0},ae=[];T&&ae.push($.hiddenByLandmarkVertexBuffer),t.uploadCommonUniforms(I,K,G.toUnwrapped(),null,B),K.draw(t,I.gl.TRIANGLES,a,l,c,h,Q,n.id,$.vertexBuffer,$.indexBuffer,W,n.paint,k,te,ae)};for(const G of i){const $=e.getTile(G),W=$.getBucket(n);if(!W||W.projection.name!==A.projection.name||!W.groundEffect||W.groundEffect&&!W.groundEffect.hasData())continue;const H=W.groundEffect,J=1/W.tileToMeter;{const te=t.translatePosMatrix(G.projMatrix,$,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),oe=H.getDefaultSegment();U(G,H,oe,te,J)}if(C)for(let te=0;te<4;te++){const oe=Uy[te](G),K=e.getTile(oe);if(!K)continue;const Q=K.getBucket(n);if(!Q||Q.projection.name!==A.projection.name||!Q.groundEffect||Q.groundEffect&&!Q.groundEffect.hasData())continue;const ae=Q.groundEffect;let ue,fe;0===te?(ue=[-he,0,0],fe=1):1===te?(ue=[he,0,0],fe=0):2===te?(ue=[0,-he,0],fe=3):(ue=[0,he,0],fe=2);const ge=ae.regionSegments[fe];if(!ge)continue;const ve=new Float32Array(16);se.translate(ve,G.projMatrix,ue),U(G,ae,ge,t.translatePosMatrix(ve,$,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),J)}}}function jC(t,e,n,i,a,l,c){0===i.centroidVertexArray.length&&i.createCentroidsBuffer();const h=l?l.findDEMTileFor(n):null;if(!(h&&h.dem||c))return;const f=C=>{const S=e.getSource().minzoom,I=A=>{const k=e.getTileByID(A);if(k&&k.hasData())return k.getBucket(a)},R=[0,-1,1];for(const A of R){if(C.overscaledZ+A<S)continue;const k=I(C.calculateScaledKey(C.overscaledZ+A));if(k)return k}},p=[0,0,0],g=(C,S)=>(p[0]=Math.min(C.min.y,S.min.y),p[1]=Math.max(C.max.y,S.max.y),p[2]=he-S.min.x>C.max.x?S.min.x-he:C.max.x,p),_=(C,S)=>(p[0]=Math.min(C.min.x,S.min.x),p[1]=Math.max(C.max.x,S.max.x),p[2]=he-S.min.y>C.max.y?S.min.y-he:C.max.y,p),y=[(C,S)=>g(C,S),(C,S)=>g(S,C),(C,S)=>_(C,S),(C,S)=>_(S,C)],v=(C,S,I,R,A,k,L)=>{if(!l)return 0;const B=[[k?I:C,k?C:I,0],[k?I:S,k?S:I,0]],j=L<0?he+L:L,U=[k?j:(C+S)/2,k?(C+S)/2:j,0];return 0===I&&L<0||0!==I&&L>0?l.getForTilePoints(A,[U],!0,R):B.push(U),l.getForTilePoints(n,B,!0,h),Math.max(B[0][2],B[1][2],U[2])/l.exaggeration()};for(let C=0;C<4;C++){const S=i.borderFeatureIndices[C];if(0===S.length)continue;const I=Uy[C](n),R=f(I);if(!(R&&R instanceof lp)||i.borderDoneWithNeighborZ[C]===R.canonical.z)continue;0===R.centroidVertexArray.length&&R.createCentroidsBuffer();const A=l?l.findDEMTileFor(I):null;if(!(A&&A.dem||c))continue;const k=(C<2?1:5)-C,L=R.borderDoneWithNeighborZ[k]!==i.canonical.z,B=R.borderFeatureIndices[k];let j=0;if(i.canonical.z!==R.canonical.z){for(const U of S)i.showCentroid(i.featuresOnBorder[U]);if(L)for(const U of B)R.showCentroid(R.featuresOnBorder[U]);i.borderDoneWithNeighborZ[C]=R.canonical.z,R.borderDoneWithNeighborZ[k]=i.canonical.z}for(const U of S){const G=i.featuresOnBorder[U],$=i.centroidData[G.centroidDataIndex],W=G.borders[C];let H;for(;j<B.length;){H=R.featuresOnBorder[B[j]];const J=H.borders[k];if(J[1]>W[0]+3||J[0]>W[0]-3)break;R.showCentroid(H),j++}if(H&&j<B.length){const J=j;let te=0;for(;!(H.borders[k][0]>W[1]-3)&&(te++,++j!==B.length);)H=R.featuresOnBorder[B[j]];if(H=R.featuresOnBorder[B[J]],te>1){const Q=H.borders[k];Math.abs(W[0]-Q[0])<3&&Math.abs(W[1]-Q[1])<3&&(te=1,j=J+1)}else if(0===te){i.showCentroid(G);continue}const oe=R.centroidData[H.centroidDataIndex];c&&1===te&&(((E=$).flags|(T=oe).flags)&il?(E.flags|=il,T.flags|=il):(E.flags&=2147483647,T.flags&=2147483647));let K=new ie(0,0);if(te>1)j=J;else if(A&&A.dem&&!(G.intersectsCount()>1||H.intersectsCount()>1)){const Q=y[C]($,oe),ae=C%2?8191:0;w=v(Q[0],Math.min(8191,Q[1]),ae,A,I,C<2,Q[2]),K=new ie(Math.ceil(7*(w+450)),0)}$.centroidXY=oe.centroidXY=K,i.writeCentroidToBuffer($),R.writeCentroidToBuffer(oe)}else i.showCentroid(G)}i.borderDoneWithNeighborZ[C]=R.canonical.z,R.borderDoneWithNeighborZ[k]=i.canonical.z}var w,E,T;(i.needsCentroidUpdate||!i.centroidVertexBuffer&&0!==i.centroidVertexArray.length)&&i.uploadCentroid(t)}const X2=[1,0,0],UC=[0,1,0],$C=[0,0,1];function FI(t,e,n){const i=n.transform,a=n.shadowRenderer;if(!a)return!0;const l=t.toUnwrapped(),c=i.tileSize*a._cascades[n.currentShadowCascade].scale;let h=e.maxHeight;if(i.elevation){const E=i.elevation.getMinMaxForTile(t);E&&(h+=E.max)}const f=[...a.shadowDirection];f[2]=-f[2];const p=a.computeSimplifiedTileShadowVolume(l,h,c,f);if(!p)return!1;const g=[X2,UC,$C,f,[f[0],0,f[2]],[0,f[1],f[2]]],_="globe"===i.projection.name,y=i.scaleZoom(c),v=ua.fromInvProjectionMatrix(i.invProjMatrix,i.worldSize,y,!_),w=a.getCurrentCascadeFrustum();return 0===v.intersectsPrecise(p.vertices,p.planes,g)||0===w.intersectsPrecise(p.vertices,p.planes,g)}const Y2=new yt(1,0,0,1),NI=new yt(0,1,0,1),zI=new yt(0,0,1,1),HC=new yt(1,0,1,1),m_=new yt(0,1,1,1);function K2(t,e,n){const i=t.context,a=t.transform,l=i.gl,c="globe"===a.projection.name,h=c?["PROJECTION_GLOBE_VIEW"]:[];let f=n.projMatrix;if(c&&ni(a.zoom)>0){const U=Yy(Gy(n.canonical,a));f=se.multiply(new Float32Array(16),a.globeMatrix,U),se.multiply(f,a.projMatrix,f)}const p=t.getOrCreateProgram("debug",{defines:h}),g=e.getTileByID(n.key);t.terrain&&t.terrain.setupElevationDraw(g,p);const _=Et.disabled,y=qt.disabled,v=t.colorModeForRenderPass(),w="$debug";i.activeTexture.set(l.TEXTURE0),t.emptyTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),c?g._makeGlobeTileDebugBuffers(t.context,a):g._makeDebugTileBoundsBuffers(t.context,a.projection);const E=g._tileDebugBuffer||t.debugBuffer,T=g._tileDebugIndexBuffer||t.debugIndexBuffer,C=g._tileDebugSegments||t.debugSegments;p.draw(t,l.LINE_STRIP,_,y,v,Wt.disabled,u_(f,yt.red),w,E,T,C,null,null,null,[g._globeTileDebugBorderBuffer]);const S=g.latestRawTileData,I=Math.floor((S&&S.byteLength||0)/1024),R=e.getTile(n).tileSize,A=512/Math.min(R,512)*(n.overscaledZ/a.zoom)*.5;let k=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(k+=` => ${n.overscaledZ}`),k+=` ${I}kb`,function(U,G){U.initDebugOverlayCanvas();const $=U.debugOverlayCanvas,W=U.context.gl,H=U.debugOverlayCanvas.getContext("2d");H.clearRect(0,0,$.width,$.height),H.shadowColor="white",H.shadowBlur=2,H.lineWidth=1.5,H.strokeStyle="white",H.textBaseline="top",H.font="bold 36px Open Sans, sans-serif",H.fillText(G,5,5),H.strokeText(G,5,5),U.debugOverlayTexture.update($),U.debugOverlayTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE)}(t,k);const L=g._tileDebugTextBuffer||t.debugBuffer,B=g._tileDebugTextIndexBuffer||t.quadTriangleIndexBuffer,j=g._tileDebugTextSegments||t.debugSegments;p.draw(t,l.TRIANGLES,_,y,fn.alphaBlended,Wt.disabled,u_(f,yt.transparent,A),w,L,B,j,null,null,null,[g._globeTileDebugTextBuffer])}function GC(t,e,n,i){px(t,0,e+n/2,t.transform.width,n,i)}function J2(t,e,n,i){px(t,e-n/2,0,n,t.transform.height,i)}function px(t,e,n,i,a,l){const c=t.context,h=c.gl;h.enable(h.SCISSOR_TEST),h.scissor(e*Ct.devicePixelRatio,n*Ct.devicePixelRatio,i*Ct.devicePixelRatio,a*Ct.devicePixelRatio),c.clear({color:l}),h.disable(h.SCISSOR_TEST)}const BI=wn([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:VI}=BI;function Gu(t,e,n,i){t.emplaceBack(e,n,i)}class qC{constructor(e){this.vertexArray=new Ga,this.indices=new Tr,Gu(this.vertexArray,-1,-1,1),Gu(this.vertexArray,1,-1,1),Gu(this.vertexArray,-1,1,1),Gu(this.vertexArray,1,1,1),Gu(this.vertexArray,-1,-1,-1),Gu(this.vertexArray,1,-1,-1),Gu(this.vertexArray,-1,1,-1),Gu(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=e.createVertexBuffer(this.vertexArray,VI),this.indexBuffer=e.createIndexBuffer(this.indices),this.segment=Cn.simpleSegment(0,0,36,12)}}function Yl(t,e,n,i,a,l){const c=t.context.gl,h=e.paint.get("sky-atmosphere-color"),f=e.paint.get("sky-atmosphere-halo-color"),p=e.paint.get("sky-atmosphere-sun-intensity"),g={u_matrix_3f:Mo.fromMat4(Mo.create(),i),u_sun_direction:a,u_sun_intensity:p,u_color_tint_r:[(w=h).r,w.g,w.b,w.a],u_color_tint_m:[(E=f).r,E.g,E.b,E.a],u_luminance:5e-5};var w,E;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_CUBE_MAP_POSITIVE_X+l,e.skyboxTexture,0),n.draw(t,c.TRIANGLES,Et.disabled,qt.disabled,fn.unblended,Wt.frontCW,g,"skyboxCapture",e.skyboxGeometry.vertexBuffer,e.skyboxGeometry.indexBuffer,e.skyboxGeometry.segment)}const Q2=wn([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class eS{constructor(e){const n=new Dl;n.emplaceBack(-1,1,1,0,0),n.emplaceBack(1,1,1,1,0),n.emplaceBack(1,-1,1,1,1),n.emplaceBack(-1,-1,1,0,1);const i=new Tr;i.emplaceBack(0,1,2),i.emplaceBack(2,3,0),this.vertexBuffer=e.createVertexBuffer(n,Q2.members),this.indexBuffer=e.createIndexBuffer(i),this.segments=Cn.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const WC=wn([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class qu{constructor(){this.colorModeAlphaBlendedWriteRGB=new fn([1,771,1,771],yt.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new fn([1,0,1,0],yt.transparent,[!1,!1,!1,!0])}update(e){const n=e.context;if(!this.atmosphereBuffer){this.atmosphereBuffer=new eS(n);const i=100,a=200,l=function(g){const _=sf(30),y=[];for(let v=0;v<16e3;++v){const w=2*Math.PI*_(),E=Math.acos(1-2*_())-.5*Math.PI;y.push(Z.fromValues(Math.cos(E)*Math.cos(w),Math.cos(E)*Math.sin(w),Math.sin(E)))}return y}(),c=sf(300),h=new yu,f=new Tr;let p=0;for(let g=0;g<l.length;++g){const _=Z.scale([],l[g],200),y=Math.max(0,1+.01*i*(1*c()-.5)),v=Math.max(0,1+.01*a*(1*c()-.5));h.emplaceBack(_[0],_[1],_[2],-1,-1,y,v),h.emplaceBack(_[0],_[1],_[2],1,-1,y,v),h.emplaceBack(_[0],_[1],_[2],1,1,y,v),h.emplaceBack(_[0],_[1],_[2],-1,1,y,v),f.emplaceBack(p+0,p+1,p+2),f.emplaceBack(p+0,p+2,p+3),p+=4}this.starsVx=n.createVertexBuffer(h,WC.members),this.starsIdx=n.createIndexBuffer(f),this.starsSegments=Cn.simpleSegment(0,0,h.length,f.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(e,n){const i=e.context,a=i.gl,l=e.transform,c=new Et(a.LEQUAL,Et.ReadOnly,[0,1]),h=ni(l.zoom),f=n.properties.get("color").toArray01(),p=n.properties.get("high-color").toArray01(),g=n.properties.get("space-color").toArray01PremultipliedAlpha(),_=5e-4,y=et((n.properties.get("horizon-blend")-0)/1*.2495+_,5e-4,.25),v=Ow(e,i,l)&&y===_?l.worldSize/(2*Math.PI*1.025)-1:l.globeRadius,w=e.frameCounter/1e3%1,E=Z.length(l.globeCenterInViewSpace),T=Math.sqrt(Math.pow(E,2)-Math.pow(v,2)),C=Math.acos(T/E),S=I=>{const R="globe"===l.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];I&&R.push("ALPHA_PASS");const A=e.getOrCreateProgram("globeAtmosphere",{defines:R}),k={u_frustum_tl:l.frustumCorners.TL,u_frustum_tr:l.frustumCorners.TR,u_frustum_br:l.frustumCorners.BR,u_frustum_bl:l.frustumCorners.BL,u_horizon:l.frustumCorners.horizon,u_transition:h,u_fadeout_range:y,u_color:f,u_high_color:p,u_space_color:g,u_temporal_offset:w,u_horizon_angle:C};e.uploadCommonUniforms(i,A);const L=this.atmosphereBuffer;L&&A.draw(e,a.TRIANGLES,c,qt.disabled,I?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Wt.backCW,k,I?"atmosphere_glow_alpha":"atmosphere_glow",L.vertexBuffer,L.indexBuffer,L.segments)};S(!1),S(!0)}drawStars(e,n){const i=et(n.properties.get("star-intensity"),0,1);if(0===i)return;const a=e.context,l=a.gl,c=e.transform,h=e.getOrCreateProgram("stars"),f=Mi.identity([]);Mi.rotateX(f,f,-c._pitch),Mi.rotateZ(f,f,-c.angle),Mi.rotateX(f,f,At(c._center.lat)),Mi.rotateY(f,f,-At(c._center.lng));const p=se.fromQuat(new Float32Array(16),f),g=se.multiply([],c.starsProjMatrix,p),_=Mo.fromMat4([],p),y=Mo.invert([],_),v=[0,1,0];Z.transformMat3(v,v,y),Z.scale(v,v,.15);const w=[1,0,0];Z.transformMat3(w,w,y),Z.scale(w,w,.15);const E=(C=v,S=w,I=i,{u_matrix:Float32Array.from(g),u_up:C,u_right:S,u_intensity_multiplier:I});var C,S,I;e.uploadCommonUniforms(a,h),this.starsVx&&this.starsIdx&&h.draw(e,l.TRIANGLES,Et.disabled,qt.disabled,this.colorModeAlphaBlendedWriteRGB,Wt.disabled,E,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function mx(t,e){const n=[...t],i=e.cameraWorldSizeForFog/e.worldSize,a=se.identity([]);return se.scale(a,a,[i,i,1]),se.multiply(n,a,n),se.multiply(n,e.worldToFogMatrix,n),n}function Cp(t,e,n,i){const a=n.material,l=i.context,{baseColorTexture:c,metallicRoughnessTexture:h}=a.pbrMetallicRoughness,{normalTexture:f,occlusionTexture:p,emissionTexture:g}=a;function _(y,v,w){if(y&&(t.push(v),l.activeTexture.set(l.gl.TEXTURE0+w),y.gfxTexture)){const{minFilter:E,magFilter:T,wrapS:C,wrapT:S}=y.sampler;y.gfxTexture.bindExtraParam(E,T,C,S)}}_(c,"HAS_TEXTURE_u_baseColorTexture",Wo_BaseColor),_(h,"HAS_TEXTURE_u_metallicRoughnessTexture",Wo_MetallicRoughness),_(f,"HAS_TEXTURE_u_normalTexture",Wo_Normal),_(p,"HAS_TEXTURE_u_occlusionTexture",Wo_Occlusion),_(g,"HAS_TEXTURE_u_emissionTexture",Wo_Emission),n.texcoordBuffer&&(t.push("HAS_ATTRIBUTE_a_uv_2f"),e.push(n.texcoordBuffer)),n.colorBuffer&&(t.push(12===n.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),e.push(n.colorBuffer)),n.normalBuffer&&(t.push("HAS_ATTRIBUTE_a_normal_3f"),e.push(n.normalBuffer)),n.pbrBuffer&&(t.push("HAS_ATTRIBUTE_a_pbr"),t.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),e.push(n.pbrBuffer)),"OPAQUE"!==a.alphaMode&&"MASK"!==a.alphaMode||t.push("UNPREMULT_TEXTURE_IN_SHADER"),a.defined||t.push("DIFFUSE_SHADED"),t.push("USE_STANDARD_DERIVATIVES")}function wd(t,e,n,i,a,l){const c=n.paint.get("model-opacity"),h=e.context,f=new Et(e.context.gl.LEQUAL,Et.ReadWrite,e.depthRangeFor3D),p=e.transform,g=t.mesh,_=g.material,y=_.pbrMetallicRoughness,v=e.style.fog;let w;w="pixels"===e.transform.projection.zAxisUnit?[...t.nodeModelMatrix]:se.multiply([],i.zScaleMatrix,t.nodeModelMatrix),se.multiply(w,i.negCameraPosMatrix,w);const E=se.invert([],w);se.transpose(E,E);const T=lx(new Float32Array(t.worldViewProjection),new Float32Array(w),new Float32Array(E),e,c,y.baseColorFactor,_.emissiveFactor,y.metallicFactor,y.roughnessFactor,_,n),C={defines:[]},S=[];Cp(C.defines,S,g,e);const I=e.shadowRenderer;I&&(I.useNormalOffset=!1);let R=null;if(v){const L=mx(t.nodeModelMatrix,e.transform);if(R=new Float32Array(L),"globe"!==p.projection.name){const B=g.aabb.min,j=g.aabb.max,[U,G]=v.getOpacityForBounds(L,B[0],B[1],j[0],j[1]);C.overrideFog=U>=Fu||G>=Fu}}const A=bp(e,n.paint.get("model-cutoff-fade-range"));A.shouldRenderCutoff&&C.defines.push("RENDER_CUTOFF");const k=e.getOrCreateProgram("model",C);e.uploadCommonUniforms(h,k,null,R,A),"shadow"!==e.renderPass&&I&&I.setupShadowsFromMatrix(t.nodeModelMatrix,k),k.draw(e,h.gl.TRIANGLES,f,a,l,g.material.doubleSided?Wt.disabled:Wt.backCCW,T,n.id,g.vertexBuffer,g.indexBuffer,g.segments,n.paint,e.transform.zoom,void 0,S)}function ZC(t,e,n,i,a,l,c){let h;h="globe"===t.projection.name?ld(n,t):[...n],se.multiply(h,h,e.matrix);const f=se.multiply([],i,h);if(e.meshes)for(const p of e.meshes){if("BLEND"!==p.material.alphaMode){c.push({mesh:p,depth:0,modelIndex:a,worldViewProjection:f,nodeModelMatrix:h});continue}const g=Z.transformMat4([],p.centroid,f);g[2]>0&&l.push({mesh:p,depth:g[2],modelIndex:a,worldViewProjection:f,nodeModelMatrix:h})}if(e.children)for(const p of e.children)ZC(t,p,n,i,a,l,c)}function Tp(t,e,n,i){const a=n.shadowRenderer;if(!a)return;const l=a.getShadowPassDepthMode(),c=a.getShadowPassColorMode(),h=a.calculateShadowPassMatrixFromMatrix(e),f=W2(h);n.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(n,n.context.gl.TRIANGLES,l,qt.disabled,c,Wt.backCCW,f,i.id,t.vertexBuffer,t.indexBuffer,t.segments,i.paint,n.transform.zoom,void 0,void 0)}function gx(t,e,n){const i=e.updateZoomBasedPaintProperties(),a=function(l,c,h){let f,p,g,_=l.terrain?l.terrain.exaggeration():0;if(l.terrain&&_>0){const y=l.terrain,v=y.findDEMTileFor(h);v&&v.dem?f=Pc.create(y,h,v):_=0}if(0===_&&(c.terrainElevationMin=0,c.terrainElevationMax=0),_===c.validForExaggeration&&(0===_||f&&f._demTile&&f._demTile.tileID===c.validForDEMTile.id&&f._dem._timestamp===c.validForDEMTile.timestamp))return!1;for(const y in c.instancesPerModel){const v=c.instancesPerModel[y];for(let w=0;w<v.instancedDataArray.length;++w){const E=(f?_*f.getElevationAt(0|v.instancedDataArray.float32[16*w],0|v.instancedDataArray.float32[16*w+1],!0,!0):0)+v.instancesEvaluatedElevation[w];v.instancedDataArray.float32[16*w+6]=E,p=p?Math.min(c.terrainElevationMin,E):E,g=g?Math.max(c.terrainElevationMax,E):E}}return c.terrainElevationMin=p||0,c.terrainElevationMax=g||0,c.validForExaggeration=_,c.validForDEMTile=f&&f._demTile?{id:f._demTile.tileID,timestamp:f._dem._timestamp}:{id:void 0,timestamp:0},!0}(t,e,n);(i||a)&&(e.uploaded=!1,e.upload(t.context))}const ys={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new $n([0,0,0],[he,he,0])};function jI(t,e){const n=1<<t.canonical.z,i=e.getFreeCameraOptions().position,a=e.elevation,l=t.canonical.x/n,c=(t.canonical.x+1)/n,h=t.canonical.y/n,f=(t.canonical.y+1)/n;let p=e._centerAltitude;if(a){const v=a.getMinMaxForTile(t);v&&v.max>p&&(p=v.max)}const g=et(i.x,l,c)-i.x,_=et(i.y,h,f)-i.y,y=kn(p,e.center.lat)-i.z;return e._zoomFromMercatorZ(Math.sqrt(g*g+_*_+y*y))}function tS(t,e,n,i,a,l,c){const h=t.context,f="shadow"===t.renderPass,p=t.shadowRenderer,g=f&&p?p.getShadowPassDepthMode():new Et(h.gl.LEQUAL,Et.ReadWrite,t.depthRangeFor3D),_=t.isTileAffectedByFog(l);if(n.meshes)for(const y of n.meshes){const v=["MODEL_POSITION_ON_GPU"],w=[];let E,T,C;i.instancedDataArray.length>20&&v.push("INSTANCED_ARRAYS");const S=bp(t,e.paint.get("model-cutoff-fade-range"));if(S.shouldRenderCutoff&&v.push("RENDER_CUTOFF"),f&&p)E=t.getOrCreateProgram("modelDepth",{defines:v}),T=W2(c.shadowTileMatrix,c.shadowTileMatrix,Float32Array.from(n.matrix)),C=p.getShadowPassColorMode();else{Cp(v,w,y,t),E=t.getOrCreateProgram("model",{defines:v,overrideFog:_});const R=y.material,A=R.pbrMetallicRoughness,k=e.paint.get("model-opacity");T=lx(l.projMatrix,Float32Array.from(n.matrix),new Float32Array(16),t,k,A.baseColorFactor,R.emissiveFactor,A.metallicFactor,A.roughnessFactor,R,e,a),p&&(c.shadowUniformsInitialized?E.setShadowUniformValues(h,p.getShadowUniformValues()):(p.setupShadows(l.toUnwrapped(),E,"model-tile",l.overscaledZ),c.shadowUniformsInitialized=!0)),C=S.shouldRenderCutoff||k<1||"OPAQUE"!==R.alphaMode?fn.alphaBlended:fn.unblended}t.uploadCommonUniforms(h,E,l.toUnwrapped(),null,S);const I=y.material.doubleSided?Wt.disabled:Wt.backCCW;if(i.instancedDataArray.length>20)w.push(i.instancedDataBuffer),E.draw(t,h.gl.TRIANGLES,g,qt.disabled,C,I,T,e.id,y.vertexBuffer,y.indexBuffer,y.segments,e.paint,t.transform.zoom,void 0,w,i.instancedDataArray.length);else{const R=f?"u_instance":"u_normal_matrix";for(let A=0;A<i.instancedDataArray.length;++A)T[R]=new Float32Array(i.instancedDataArray.arrayBuffer,64*A,16),E.draw(t,h.gl.TRIANGLES,g,qt.disabled,C,I,T,e.id,y.vertexBuffer,y.indexBuffer,y.segments,e.paint,t.transform.zoom,void 0,w)}}if(n.children)for(const y of n.children)tS(t,e,y,i,a,l,c)}const UI=[1,-1,1];function $I(t,e,n,i){if(!n.modelManager)return!0;const a=n.modelManager;if(!n.shadowRenderer)return!0;const l=n.shadowRenderer,c=e.aabb;let h=!0,f=t.maxHeight;if(0===f){let g=0;for(const _ in t.instancesPerModel){const y=a.getModel(_,i);y?g=Math.max(g,Math.max(Math.max(y.aabb.max[0],y.aabb.max[1]),y.aabb.max[2])):h=!1}f=t.maxScale*g*1.41+t.maxVerticalOffset,h&&(t.maxHeight=f)}c.max[2]=f,c.min[2]+=t.terrainElevationMin,c.max[2]+=t.terrainElevationMax,Z.transformMat4(c.min,c.min,e.tileMatrix),Z.transformMat4(c.max,c.max,e.tileMatrix);const p=c.intersects(l.getCurrentCascadeFrustum());return 0===n.currentShadowCascade&&(t.isInsideFirstShadowMapFrustum=2===p),0===p}class XC{}class nS{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(e,n,i){{const _=this._storage.get(n.id);if(_)return _.lastUsedFrameIdx=e,_.buf}const a=i.gl,l=a.getBufferParameter(a.ELEMENT_ARRAY_BUFFER,a.BUFFER_SIZE),c=new ArrayBuffer(l),h=new Int16Array(c);a.getBufferSubData(a.ELEMENT_ARRAY_BUFFER,0,new Int16Array(c));const f=new fs;for(let _=0;_<l/2;_+=3){const y=h[_],v=h[_+1],w=h[_+2];f.emplaceBack(y,v),f.emplaceBack(v,w),f.emplaceBack(w,y)}const p=i.bindVertexArrayOES.current,g=new XC;return g.buf=new zs(i,f),g.lastUsedFrameIdx=e,this._storage.set(n.id,g),i.bindVertexArrayOES.set(p),g.buf}update(e){for(const[n,i]of this._storage)e-i.lastUsedFrameIdx>30&&(i.buf.destroy(),this._storage.delete(n))}destroy(){for(const[e,n]of this._storage)n.buf.destroy(),this._storage.delete(e)}}const YC={symbol:function(t,e,n,i,a){if("translucent"!==t.renderPass)return;const l=qt.disabled,c=t.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(h,f,p,g,_,y,v){const w=f.transform,E="map"===_,T="map"===y;for(const C of h){const S=g.getTile(C),I=S.getBucket(p);if(!I||!I.text||!I.text.segments.get().length)continue;const R=pa(I.textSizeData,w.zoom),A=yp(C,I.getProjection(),w),k=w.calculatePixelsToTileUnitsMatrix(S),L=a0(A,S.tileID.canonical,T,E,w,I.getProjection(),k),B=I.hasIconTextFit()&&I.hasIconData();if(R){const j=Math.pow(2,w.zoom-S.tileID.overscaledZ);BC(I,E,T,v,Tb,w,L,C,j,R,B)}}}(i,t,n,e,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),a),0!==n.paint.get("icon-opacity").constantOr(1)&&dx(t,e,n,i,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),l,c),0!==n.paint.get("text-opacity").constantOr(1)&&dx(t,e,n,i,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),l,c),e.map.showCollisionBoxes&&(ux(t,e,n,i,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),ux(t,e,n,i,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(t,e,n,i){if("translucent"!==t.renderPass)return;const a=n.paint.get("circle-opacity"),l=n.paint.get("circle-stroke-width"),c=n.paint.get("circle-stroke-opacity"),h=void 0!==n.layout.get("circle-sort-key").constantOr(1),f=n.paint.get("circle-emissive-strength");if(0===a.constantOr(1)&&(0===l.constantOr(1)||0===c.constantOr(1)))return;const p=t.context,g=p.gl,_=t.transform,y=t.depthModeForSublayer(0,Et.ReadOnly),v=qt.disabled,w=t.colorModeForDrapableLayerRenderPass(f),E="globe"===_.projection.name,T=[Si(_.center.lng),gi(_.center.lat)],C=[];for(let I=0;I<i.length;I++){const R=i[I],A=e.getTile(R),k=A.getBucket(n);if(!k||k.projection.name!==_.projection.name)continue;const L=k.programConfigurations.get(n.id),B=Yw(n),j=t.isTileAffectedByFog(R);E&&B.push("PROJECTION_GLOBE_VIEW");const U=t.getOrCreateProgram("circle",{config:L,defines:B,overrideFog:j}),G=k.layoutVertexBuffer,$=k.globeExtVertexBuffer,W=k.indexBuffer,H=_.projection.createInversionMatrix(_,R.canonical),J={programConfiguration:L,program:U,layoutVertexBuffer:G,globeExtVertexBuffer:$,indexBuffer:W,uniformValues:zh(t,R,A,H,T,n),tile:A};if(h){const te=k.segments.get();for(const oe of te)C.push({segments:new Cn([oe]),sortKey:oe.sortKey,state:J})}else C.push({segments:k.segments,sortKey:0,state:J})}h&&C.sort((I,R)=>I.sortKey-R.sortKey);const S={useDepthForOcclusion:_.depthOcclusionForSymbolsAndCircles};for(const I of C){const{programConfiguration:R,program:A,layoutVertexBuffer:k,globeExtVertexBuffer:L,indexBuffer:B,uniformValues:j,tile:U}=I.state,G=I.segments;t.terrain&&t.terrain.setupElevationDraw(U,A,S),t.uploadCommonUniforms(p,A,U.tileID.toUnwrapped()),A.draw(t,g.TRIANGLES,y,v,w,Wt.disabled,j,n.id,k,B,G,n.paint,_.zoom,R,[L])}},heatmap:function(t,e,n,i){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){const a=t.context,l=a.gl,c=qt.disabled,h=new fn([l.ONE,l.ONE,l.ONE,l.ONE],yt.transparent,[!0,!0,!0,!0]);(function(v,w,E,T){const C=v.gl,S=w.width*T,I=w.height*T;v.activeTexture.set(C.TEXTURE1),v.viewport.set([0,0,S,I]);let R=E.heatmapFbo;if(!R||R&&(R.width!==S||R.height!==I)){R&&R.destroy();const A=C.createTexture();C.bindTexture(C.TEXTURE_2D,A),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_S,C.CLAMP_TO_EDGE),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_T,C.CLAMP_TO_EDGE),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MIN_FILTER,C.LINEAR),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MAG_FILTER,C.LINEAR),R=E.heatmapFbo=v.createFramebuffer(S,I,!0,null),function(k,L,B,j,U,G){const $=k.gl;$.texImage2D($.TEXTURE_2D,0,k.extRenderToTextureHalfFloat?$.RGBA16F:$.RGBA,U,G,0,$.RGBA,k.extRenderToTextureHalfFloat?$.HALF_FLOAT:$.UNSIGNED_BYTE,null),j.colorAttachment.set(B)}(v,0,A,R,S,I)}else C.bindTexture(C.TEXTURE_2D,R.colorAttachment.get()),v.bindFramebuffer.set(R.framebuffer)})(a,t,n,"globe"===t.transform.projection.name?.5:.25),a.clear({color:yt.transparent});const f=t.transform,p="globe"===f.projection.name,g=p?["PROJECTION_GLOBE_VIEW"]:[],_=p?Wt.frontCCW:Wt.disabled,y=[Si(f.center.lng),gi(f.center.lat)];for(let v=0;v<i.length;v++){const w=i[v];if(e.hasRenderableParent(w))continue;const E=e.getTile(w),T=E.getBucket(n);if(!T||T.projection.name!==f.projection.name)continue;const C=t.isTileAffectedByFog(w),S=T.programConfigurations.get(n.id),I=t.getOrCreateProgram("heatmap",{config:S,defines:g,overrideFog:C}),{zoom:R}=t.transform;t.terrain&&t.terrain.setupElevationDraw(E,I),t.uploadCommonUniforms(a,I,w.toUnwrapped());const A=f.projection.createInversionMatrix(f,w.canonical);I.draw(t,l.TRIANGLES,Et.disabled,c,h,_,G2(t,w,E,A,y,R,n.paint.get("heatmap-intensity")),n.id,T.layoutVertexBuffer,T.indexBuffer,T.segments,n.paint,t.transform.zoom,S,p?[T.globeExtVertexBuffer]:null)}a.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(a,l){const c=a.context,h=c.gl,f=l.heatmapFbo;if(!f)return;c.activeTexture.set(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,f.colorAttachment.get()),c.activeTexture.set(h.TEXTURE1);let p=l.colorRampTexture;p||(p=l.colorRampTexture=new Wr(c,l.colorRamp,h.RGBA)),p.bind(h.LINEAR,h.CLAMP_TO_EDGE),a.getOrCreateProgram("heatmapTexture").draw(a,h.TRIANGLES,Et.disabled,qt.disabled,a.colorModeForRenderPass(),Wt.disabled,{u_image:0,u_color_ramp:1,u_opacity:l.paint.get("heatmap-opacity")},l.id,a.viewportBuffer,a.quadTriangleIndexBuffer,a.viewportSegments,l.paint,a.transform.zoom)}(t,n))},line:function(t,e,n,i){if("translucent"!==t.renderPass)return;const a=n.paint.get("line-opacity"),l=n.paint.get("line-width");if(0===a.constantOr(1)||0===l.constantOr(1))return;const c=n.paint.get("line-emissive-strength"),h=t.depthModeForSublayer(0,Et.ReadOnly),f=t.colorModeForDrapableLayerRenderPass(c),p=t.terrain&&t.terrain.renderingToTexture?1:Ct.devicePixelRatio,g=n.paint.get("line-dasharray"),_=g.constantOr(1),y=n.layout.get("line-cap"),v=n.paint.get("line-pattern"),w=v.constantOr(1),E=n.paint.get("line-pattern").constantOr(1),T=1!==n.paint.get("line-opacity").constantOr(1);let C=!E&&T;const S=n.paint.get("line-gradient"),I=w?"linePattern":"line",R=t.context,A=R.gl,k=GE(n);t.terrain&&t.terrain.clipOrMaskOverlapStencilType()&&(C=!1);for(const L of i){const B=e.getTile(L);if(w&&!B.patternsLoaded())continue;const j=B.getBucket(n);if(!j)continue;t.prepareDrawTile();const U=j.programConfigurations.get(n.id),G=t.isTileAffectedByFog(L),$=t.getOrCreateProgram(I,{config:U,defines:k,overrideFog:G}),W=v.constantOr(null);if(W&&B.imageAtlas){const ue=B.imageAtlas.patternPositions[W.toString()];ue&&U.setConstantPatternPositions(ue)}const H=g.constantOr(null),J=y.constantOr(null);if(!w&&H&&J&&B.lineAtlas){const ue=B.lineAtlas.getDash(H,J);ue&&U.setConstantPatternPositions(ue)}let[te,oe]=n.paint.get("line-trim-offset");("round"===J||"square"===J)&&te!==oe&&(0===te&&(te-=1),1===oe&&(oe+=1));const K=t.terrain?L.projMatrix:null,Q=w?KM(t,B,n,K,p):D0(t,B,n,K,j.lineClipsArray.length,p,[te,oe]);if(S){const ue=j.gradients[n.id];let fe=ue.texture;if(n.gradientVersion!==ue.version){let ge=256;if(n.stepInterpolant){const ve=e.getSource().maxzoom,de=L.canonical.z===ve?Math.ceil(1<<t.transform.maxZoom-L.canonical.z):1;ge=et(rn(j.maxLineLength/he*1024*de),256,R.maxTextureSize)}ue.gradient=mv({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:ge,image:ue.gradient||void 0,clips:j.lineClipsArray}),ue.texture?ue.texture.update(ue.gradient):ue.texture=new Wr(R,ue.gradient,A.RGBA),ue.version=n.gradientVersion,fe=ue.texture}R.activeTexture.set(A.TEXTURE1),fe.bind(n.stepInterpolant?A.NEAREST:A.LINEAR,A.CLAMP_TO_EDGE)}_&&(R.activeTexture.set(A.TEXTURE0),B.lineAtlasTexture.bind(A.LINEAR,A.REPEAT),U.updatePaintBuffers()),w&&(R.activeTexture.set(A.TEXTURE0),B.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),U.updatePaintBuffers()),t.uploadCommonUniforms(R,$,L.toUnwrapped());const ae=ue=>{$.draw(t,A.TRIANGLES,h,ue,f,Wt.disabled,Q,n.id,j.layoutVertexBuffer,j.indexBuffer,j.segments,n.paint,t.transform.zoom,U,[j.layoutVertexBuffer2])};if(C){const ue=t.stencilModeForClipping(L).ref;0===ue&&t.terrain&&R.clear({stencil:0});const fe={func:A.EQUAL,mask:255};Q.u_alpha_discard_threshold=.8,ae(new qt(fe,ue,255,A.KEEP,A.KEEP,A.INVERT)),Q.u_alpha_discard_threshold=0,ae(new qt(fe,ue,255,A.KEEP,A.KEEP,A.KEEP))}else ae(t.stencilModeForClipping(L))}C&&(t.resetStencilClippingMasks(),t.terrain&&R.clear({stencil:0}))},fill:function(t,e,n,i){const a=n.paint.get("fill-color"),l=n.paint.get("fill-opacity");if(0===l.constantOr(1))return;const c=n.paint.get("fill-emissive-strength"),h=t.colorModeForDrapableLayerRenderPass(c),f=n.paint.get("fill-pattern"),p=t.opaquePassEnabledForLayer()&&!f.constantOr(1)&&1===a.constantOr(yt.transparent).a&&1===l.constantOr(0)?"opaque":"translucent";if(t.renderPass===p){const g=t.depthModeForSublayer(1,"opaque"===t.renderPass?Et.ReadWrite:Et.ReadOnly);fx(t,e,n,i,g,h,!1)}if("translucent"===t.renderPass&&n.paint.get("fill-antialias")){const g=t.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,Et.ReadOnly);fx(t,e,n,i,g,h,!0)}},"fill-extrusion":function(t,e,n,i){const a=n.paint.get("fill-extrusion-opacity"),l=t.context,c=l.gl,h=t.terrain,f=h&&h.renderingToTexture,p=n.paint.get("fill-extrusion-cutoff-fade-range");if(0===a)return;const g=t.conflationActive&&t.layerUsedInConflation(n,e.getSource());if(g&&function(_,y,v,w){for(const E of w){const T=y.getTile(E).getBucket(v);T&&(T.updateReplacement(E,_.replacementSource),T.uploadCentroid(_.context))}}(t,e,n,i),h||g)for(const _ of i){const y=e.getTile(_).getBucket(n);y&&jC(t.context,e,_,y,n,h,g)}if("shadow"===t.renderPass&&t.shadowRenderer){const _=t.shadowRenderer;if(h&&a<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof ei)return;const y=_.getShadowPassDepthMode(),v=_.getShadowPassColorMode();Hu(t,e,n,i,y,qt.disabled,v,g)}else if("translucent"===t.renderPass){const _=!n.paint.get("fill-extrusion-pattern").constantOr(1);if(!f){const y=new Et(t.context.gl.LEQUAL,Et.ReadWrite,t.depthRangeFor3D);0===p&&1===a&&_?Hu(t,e,n,i,y,qt.disabled,fn.unblended,g):(Hu(t,e,n,i,y,qt.disabled,fn.disabled,g),Hu(t,e,n,i,y,t.stencilModeFor3D(),t.colorModeForRenderPass(),g),t.resetStencilClippingMasks())}if(t.style.enable3dLights()&&_&&(!h&&"globe"!==t.transform.projection.name||f)){const y=n.paint.get("fill-extrusion-opacity"),v=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),w=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),E=n.paint.get("fill-extrusion-flood-light-intensity"),T=n.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),C=v>0&&w>0,S=E>0,I=(A,k,L)=>(1-L)*A+L*k,R=A=>{const k=t.depthModeForSublayer(1,Et.ReadOnly,c.LEQUAL,!0),L=n.paint.get(A?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),B=I(.1,3,L),j=t._showOverdrawInspector;if(!j){const U=new qt({func:c.ALWAYS,mask:255},255,255,c.KEEP,c.KEEP,c.REPLACE),G=new fn([c.ONE,c.ONE,c.ONE,c.ONE],yt.transparent,[!1,!1,!1,!0],c.MIN);Xl(t,e,n,i,k,U,G,Wt.disabled,A,"sdf",y,v,w,E,T,B,g,!1)}{const U=j?qt.disabled:new qt({func:c.EQUAL,mask:255},255,255,c.KEEP,c.DECR,c.DECR),G=j?t.colorModeForRenderPass():new fn([c.ONE_MINUS_DST_ALPHA,c.DST_ALPHA,c.ONE,c.ONE],yt.transparent,[!0,!0,!0,!0]);Xl(t,e,n,i,k,U,G,Wt.disabled,A,"color",y,v,w,E,T,B,g,!1)}};if(f){const A=(k,L,B)=>{const j=t.depthModeForSublayer(1,Et.ReadOnly,c.LEQUAL,!1),U=n.paint.get(k?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),G=I(.1,3,U);{const $=new fn([c.ONE,c.ONE,c.ONE,c.ONE],yt.transparent,[!1,!1,!1,!0]);Xl(t,e,n,i,j,qt.disabled,$,Wt.disabled,k,"clear",y,v,w,E,T,G,g,L)}{const $=new qt({func:c.ALWAYS,mask:255},255,255,c.KEEP,c.KEEP,c.REPLACE),W=new fn([c.ONE,c.ONE,c.ONE,c.ONE],yt.transparent,[!1,!1,!1,!0],c.MIN);Xl(t,e,n,i,j,$,W,Wt.disabled,k,"sdf",y,v,w,E,T,G,g,L)}{const $=k?c.ZERO:c.ONE_MINUS_DST_ALPHA,W=new qt({func:c.EQUAL,mask:255},255,255,c.KEEP,c.DECR,c.DECR),H=new fn([$,c.DST_ALPHA,c.ONE_MINUS_DST_ALPHA,c.ZERO],yt.transparent,[!0,!0,!0,!0]);Xl(t,e,n,i,j,W,H,Wt.disabled,k,"color",y,v,w,E,T,G,g,L)}{const $=new fn([c.ONE,c.ONE,c.ONE,k?c.ZERO:c.ONE],yt.transparent,[!1,!1,!1,!0],k?c.FUNC_ADD:c.MAX);Xl(t,e,n,i,j,qt.disabled,$,Wt.disabled,k,"clear",y,v,w,E,T,G,g,L,B)}};if(C||S){let k;if(t.prepareDrawTile(),h){const L=h.drapeBufferSize[0],B=h.drapeBufferSize[1];k=h.framebufferCopyTexture,k&&(!k||k.size[0]===L&&k.size[1]===B)||(k&&k.destroy(),k=h.framebufferCopyTexture=new Wr(l,new Sr({width:L,height:B}),c.RGBA)),k.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,0,0,L,B,0)}C&&A(!0,!1,k),S&&A(!1,!0,k)}}else C&&R(!0),S&&R(!1)}}},hillshade:function(t,e,n,i){if("offscreen"!==t.renderPass&&"translucent"!==t.renderPass)return;const a=t.context,l=t.terrain&&t.terrain.renderingToTexture,[c,h]="translucent"!==t.renderPass||l?[{},i]:t.stencilConfigForOverlap(i);for(const f of h){const p=e.getTile(f);if(p.needsHillshadePrepare&&"offscreen"===t.renderPass)N2(t,p,n);else if("translucent"===t.renderPass){const g=t.depthModeForSublayer(0,Et.ReadOnly),_=n.paint.get("hillshade-emissive-strength"),y=t.colorModeForDrapableLayerRenderPass(_),v=l&&t.terrain?t.terrain.stencilModeForRTTOverlap(f):c[f.overscaledZ];OI(t,f,p,n,g,v,y)}}a.viewport.set([0,0,t.width,t.height]),t.resetStencilClippingMasks()},raster:function(t,e,n,i,a,l){if("translucent"!==t.renderPass||0===n.paint.get("raster-opacity"))return;const c=t.context,h=c.gl,f=e.getSource(),p=function(I,R,A){const k=[];let L,B;if(I.paint.get("raster-color")){k.push("RASTER_COLOR"),L=I.paint.get("raster-color-mix"),B=I.paint.get("raster-color-range"),R.activeTexture.set(A.TEXTURE2);let j=I.colorRampTexture;j||(j=I.colorRampTexture=new Wr(R,I.colorRamp,A.RGBA)),j.bind(A.LINEAR,A.CLAMP_TO_EDGE)}return{mix:L,range:B,defines:k}}(n,c,h),g=p.defines;let _=!1;if(f instanceof gs&&!i.length){if("globe"!==t.transform.projection.name)return;if(f.onNorthPole)_=!0,g.push("PROJECTION_GLOBE_VIEW");else{if(!f.onSouthPole)return;_=!0,g.push("PROJECTION_GLOBE_VIEW")}}const y=t.colorModeForDrapableLayerRenderPass(),v=t.terrain&&t.terrain.renderingToTexture,w=!t.options.moving,E="nearest"===n.paint.get("raster-resampling")?h.NEAREST:h.LINEAR;if(_){const I=e.getSource();if(!(I instanceof gs))return;const R=I.texture;if(!R)return;const A=t.globeSharedBuffers;if(!A)return;const k=new Et(h.LEQUAL,Et.ReadWrite,t.depthRangeFor3D),L=Float32Array.from(t.transform.projMatrix);let B=Ym(0,0,t.transform);const j=Float32Array.from(So(ps(new Ls(0,0,0)))),U={opacity:1,mix:0};t.terrain&&t.terrain.prepareDrawTile(),c.activeTexture.set(h.TEXTURE0),R.bind(E,h.CLAMP_TO_EDGE),c.activeTexture.set(h.TEXTURE1),R.bind(E,h.CLAMP_TO_EDGE),R.useMipmap&&c.extTextureFilterAnisotropic&&t.transform.pitch>20&&h.texParameterf(h.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax);const[G,$,W,H]=A.getPoleBuffers(0,!0);let J;I.onNorthPole?(J=G,t.renderDefaultNorthPole=!1):(B=se.scale(se.create(),B,[1,-1,1]),J=$,t.renderDefaultSouthPole=!1);const te=h_(L,j,B,[0,0],1,U,n,I.perspectiveTransform||[0,0],2,p.mix||[0,0,0,0],p.range||[0,0]),oe=t.getOrCreateProgram("raster",{defines:p.defines});return t.uploadCommonUniforms(c,oe,null),void oe.draw(t,h.TRIANGLES,k,qt.disabled,y,Wt.disabled,te,n.id,J,W,H)}if(!i.length)return;const[T,C]=f instanceof gs||v?[{},i]:t.stencilConfigForOverlap(i),S=C[C.length-1].overscaledZ;for(const I of C){const R=v?Et.disabled:t.depthModeForSublayer(I.overscaledZ-S,1===n.paint.get("raster-opacity")?Et.ReadWrite:Et.ReadOnly,h.LESS),A=I.toUnwrapped(),k=e.getTile(I);if(v&&(!k||!k.hasData())||!k.texture)continue;const L=v?I.projMatrix:t.transform.calculateProjMatrix(A,w),B=t.terrain&&v?t.terrain.stencilModeForRTTOverlap(I):T[I.overscaledZ],j=l?0:n.paint.get("raster-fade-duration");k.registerFadeDuration(j);const U=e.findLoadedParent(I,0),G=AC(k,U,e,t.transform,j);let $,W;t.terrain&&t.terrain.prepareDrawTile(),c.activeTexture.set(h.TEXTURE0),k.texture.bind(E,h.CLAMP_TO_EDGE),c.activeTexture.set(h.TEXTURE1),U?(U.texture.bind(E,h.CLAMP_TO_EDGE),$=Math.pow(2,U.tileID.overscaledZ-k.tileID.overscaledZ),W=[k.tileID.canonical.x*$%1,k.tileID.canonical.y*$%1]):k.texture.bind(E,h.CLAMP_TO_EDGE),k.texture.useMipmap&&c.extTextureFilterAnisotropic&&t.transform.pitch>20&&h.texParameterf(h.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax);const H=f instanceof gs?f.perspectiveTransform:[0,0],J=new Float32Array(16),te=h_(L,J,J,W||[0,0],$||1,G,n,H,2,p.mix||[0,0,0,0],p.range||[0,0]),oe=t.isTileAffectedByFog(I),K=t.getOrCreateProgram("raster",{defines:p.defines,overrideFog:oe});if(t.uploadCommonUniforms(c,K,A),f instanceof gs)f.boundsBuffer&&f.boundsSegments&&K.draw(t,h.TRIANGLES,R,qt.disabled,y,Wt.disabled,te,n.id,f.boundsBuffer,t.quadTriangleIndexBuffer,f.boundsSegments);else{const{tileBoundsBuffer:Q,tileBoundsIndexBuffer:ae,tileBoundsSegments:ue}=t.getTileBoundsBuffers(k);K.draw(t,h.TRIANGLES,R,B,y,Wt.disabled,te,n.id,Q,ae,ue)}}t.resetStencilClippingMasks()},background:function(t,e,n,i){const a=n.paint.get("background-color"),l=n.paint.get("background-opacity"),c=n.paint.get("background-emissive-strength");if(0===l)return;const h=t.context,f=h.gl,p=t.transform,g=p.tileSize,_=n.paint.get("background-pattern");if(t.isPatternMissing(_,n.scope))return;const y=!_&&1===a.a&&1===l&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==y)return;const v=qt.disabled,w=t.depthModeForSublayer(0,"opaque"===y?Et.ReadWrite:Et.ReadOnly),E=t.colorModeForDrapableLayerRenderPass(c),T=_?"backgroundPattern":"background";let C,S=i;S||(C=t.getBackgroundTiles(),S=Object.values(C).map(I=>I.tileID)),_&&(h.activeTexture.set(f.TEXTURE0),t.imageManager.bind(t.context,n.scope));for(const I of S){const R=t.isTileAffectedByFog(I),A=t.getOrCreateProgram(T,{overrideFog:R}),k=I.toUnwrapped(),L=i?I.projMatrix:t.transform.calculateProjMatrix(k);t.prepareDrawTile();const B=e?e.getTile(I):C?C[I.key]:new qo(I,g,p.zoom,t),j=_?NC(L,c,l,t,_,n.scope,{tileID:I,tileSize:g}):q2(L,c,l,a);t.uploadCommonUniforms(h,A,k);const{tileBoundsBuffer:U,tileBoundsIndexBuffer:G,tileBoundsSegments:$}=t.getTileBoundsBuffers(B);A.draw(t,f.TRIANGLES,w,v,E,Wt.disabled,j,n.id,U,G,$)}},sky:function(t,e,n){const i=t._atmosphere?ni(t.transform.zoom):1,a=n.paint.get("sky-opacity")*i;if(0===a)return;const l=t.context,c=n.paint.get("sky-type"),h=new Et(l.gl.LEQUAL,Et.ReadOnly,[0,1]),f=t.frameCounter/1e3%1;"atmosphere"===c?"offscreen"===t.renderPass?n.needsSkyboxCapture(t)&&(function(p,g,_,y){const v=p.context,w=v.gl;let E=g.skyboxFbo;if(!E){E=g.skyboxFbo=v.createFramebuffer(32,32,!0,null),g.skyboxGeometry=new qC(v),g.skyboxTexture=v.gl.createTexture(),w.bindTexture(w.TEXTURE_CUBE_MAP,g.skyboxTexture),w.texParameteri(w.TEXTURE_CUBE_MAP,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_CUBE_MAP,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_CUBE_MAP,w.TEXTURE_MIN_FILTER,w.LINEAR),w.texParameteri(w.TEXTURE_CUBE_MAP,w.TEXTURE_MAG_FILTER,w.LINEAR);for(let I=0;I<6;++I)w.texImage2D(w.TEXTURE_CUBE_MAP_POSITIVE_X+I,0,w.RGBA,32,32,0,w.RGBA,w.UNSIGNED_BYTE,null)}v.bindFramebuffer.set(E.framebuffer),v.viewport.set([0,0,32,32]);const T=g.getCenter(p,!0),C=p.getOrCreateProgram("skyboxCapture"),S=new Float64Array(16);se.identity(S),se.rotateY(S,S,.5*-Math.PI),Yl(p,g,C,S,T,0),se.identity(S),se.rotateY(S,S,.5*Math.PI),Yl(p,g,C,S,T,1),se.identity(S),se.rotateX(S,S,.5*-Math.PI),Yl(p,g,C,S,T,2),se.identity(S),se.rotateX(S,S,.5*Math.PI),Yl(p,g,C,S,T,3),se.identity(S),Yl(p,g,C,S,T,4),se.identity(S),se.rotateY(S,S,Math.PI),Yl(p,g,C,S,T,5),v.viewport.set([0,0,p.width,p.height])}(t,n),n.markSkyboxValid(t)):"sky"===t.renderPass&&function(p,g,_,y,v){const w=p.context,E=w.gl,T=p.transform,C=p.getOrCreateProgram("skybox");w.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_CUBE_MAP,g.skyboxTexture);const S={u_matrix:T.skyboxMatrix,u_sun_direction:g.getCenter(p,!1),u_cubemap:0,u_opacity:y,u_temporal_offset:v};p.uploadCommonUniforms(w,C),C.draw(p,E.TRIANGLES,_,qt.disabled,p.colorModeForRenderPass(),Wt.backCW,S,"skybox",g.skyboxGeometry.vertexBuffer,g.skyboxGeometry.indexBuffer,g.skyboxGeometry.segment)}(t,n,h,a,f):"gradient"===c&&"sky"===t.renderPass&&function(p,g,_,y,v){const w=p.context,E=w.gl,T=p.transform,C=p.getOrCreateProgram("skyboxGradient");g.skyboxGeometry||(g.skyboxGeometry=new qC(w)),w.activeTexture.set(E.TEXTURE0);let S=g.colorRampTexture;S||(S=g.colorRampTexture=new Wr(w,g.colorRamp,E.RGBA)),S.bind(E.LINEAR,E.CLAMP_TO_EDGE);const I=(L=y,B=v,{u_matrix:T.skyboxMatrix,u_color_ramp:0,u_center_direction:g.getCenter(p,!1),u_radius:At(g.paint.get("sky-gradient-radius")),u_opacity:L,u_temporal_offset:B});var L,B;p.uploadCommonUniforms(w,C),C.draw(p,E.TRIANGLES,_,qt.disabled,p.colorModeForRenderPass(),Wt.backCW,I,"skyboxGradient",g.skyboxGeometry.vertexBuffer,g.skyboxGeometry.indexBuffer,g.skyboxGeometry.segment)}(t,n,h,a,f)},debug:function(t,e,n){for(let i=0;i<n.length;i++)K2(t,e,n[i])},custom:function(t,e,n,i){const a=t.context,l=n.implementation;if(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes("custom")||t.terrain&&(t.terrain.renderingToTexture||"offscreen"===t.renderPass)&&n.isLayerDraped(e)){if("offscreen"===t.renderPass){const c=l.prerender;if(c){if(t.setCustomLayerDefaults(),a.setColorMode(t.colorModeForRenderPass()),"globe"===t.transform.projection.name){const h=t.transform.pointMerc;c.call(l,a.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),ni(t.transform.zoom),[h.x,h.y],t.transform.pixelsPerMeterRatio)}else c.call(l,a.gl,t.transform.customLayerMatrix());a.setDirty(),t.setBaseState()}}else if("translucent"===t.renderPass){if(t.terrain&&t.terrain.renderingToTexture){const h=l.renderToTile;if(h){const f=i[0].canonical,p=new nn(f.x+i[0].wrap*(1<<f.z),f.y,f.z);a.setDepthMode(Et.disabled),a.setStencilMode(qt.disabled),a.setColorMode(t.colorModeForRenderPass()),t.setCustomLayerDefaults(),h.call(l,a.gl,p),a.setDirty(),t.setBaseState()}return}t.setCustomLayerDefaults(),a.setColorMode(t.colorModeForRenderPass()),a.setStencilMode(qt.disabled);const c="3d"===l.renderingMode?new Et(t.context.gl.LEQUAL,Et.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Et.ReadOnly);if(a.setDepthMode(c),"globe"===t.transform.projection.name){const h=t.transform.pointMerc;l.render(a.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),ni(t.transform.zoom),[h.x,h.y],t.transform.pixelsPerMeterRatio)}else l.render(a.gl,t.transform.customLayerMatrix());a.setDirty(),t.setBaseState(),a.bindFramebuffer.set(null)}}else ee("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(t,e,n,i){if("opaque"===t.renderPass)return;const a=n.paint.get("model-opacity");if(0===a)return;const l=n.paint.get("model-cast-shadows");if("shadow"===t.renderPass&&(!l||t.terrain&&a<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof ei))return;const c=t.shadowRenderer,h=n.paint.get("model-receive-shadows");c&&(c.useNormalOffset=!0,h||(c.enabled=!1));const f=()=>{c&&(c.useNormalOffset=!0,h||(c.enabled=!0))},p=e.getSource();if("light-beam"===t.renderPass&&"batched-model"!==p.type)return;if("vector"===p.type||"geojson"===p.type)return function(C,S,I,R){const A=C.transform;if("mercator"!==A.projection.name)return void ee(`Drawing 3D models for ${A.projection.name} projection is not yet implemented`);const k=A.getFreeCameraOptions().position;if(!C.modelManager)return;const L=C.modelManager,B=C.shadowRenderer;if(!I._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const j=I._unevaluatedLayout._values["model-id"],U={...I.layout.get("model-id").parameters};for(const G of R){const $=S.getTile(G).getBucket(I);if(!$||$.projection.name!==A.projection.name)continue;const W=jI(G,A);U.zoom=W;const H=j.possiblyEvaluate(U);if(gx(C,$,G),ys.shadowUniformsInitialized=!1,ys.useSingleShadowCascade=!!B&&0===B.getMaxCascadeForTile(G.toUnwrapped()),"shadow"===C.renderPass&&B){if(1===C.currentShadowCascade&&$.isInsideFirstShadowMapFrustum)continue;const oe=A.calculatePosMatrix(G.toUnwrapped(),A.worldSize);if(ys.tileMatrix.set(oe),ys.shadowTileMatrix=Float32Array.from(B.calculateShadowPassMatrixFromMatrix(oe)),ys.aabb.min.fill(0),ys.aabb.max[0]=ys.aabb.max[1]=he,ys.aabb.max[2]=0,$I($,ys,C,I.scope))continue}const J=1<<G.canonical.z,te=[((k.x-G.wrap)*J-G.canonical.x)*he,(k.y*J-G.canonical.y)*he,k.z*J*he];for(let oe in $.instancesPerModel){const K=$.instancesPerModel[oe];K.features.length>0&&(oe=H.evaluate(K.features[0].feature,{}));const Q=L.getModel(oe,I.scope);if(Q&&Q.uploaded)for(const ae of Q.nodes)tS(C,I,ae,K,te,G,ys)}}}(t,e,n,i),void f();if(!p.loaded())return;if("batched-model"===p.type)return function(C,S,I,R){const A=C.context,k=C.transform,L=C.style.fog,B=C.shadowRenderer;if("mercator"!==k.projection.name)return void ee(`Drawing 3D landmark models for ${k.projection.name} projection is not yet implemented`);const j=C.transform.getFreeCameraOptions().position,U=Z.scale([],[j.x,j.y,j.z],C.transform.worldSize);Z.negate(U,U);const G=se.identity([]),$=Ni(k.center.lat,k.zoom),W=se.fromScaling([],[1,1,1/$]);se.translate(G,G,U);const H=I.paint.get("model-opacity"),J=new Et(A.gl.LEQUAL,Et.ReadWrite,C.depthRangeFor3D),te=new Et(A.gl.LEQUAL,Et.ReadOnly,C.depthRangeFor3D),oe=function(K,Q){for(const ae of R){const ue=S.getTile(ae).getBucket(I);if(!ue||!ue.uploaded)continue;let fe=!1;B&&(fe=0===B.getMaxCascadeForTile(ae.toUnwrapped()));const ge=k.calculatePosMatrix(ae.toUnwrapped(),k.worldSize),ve=ue.modelTraits;for(const de of ue.getNodesInfo()){if(de.hiddenByReplacement||!de.node.meshes)continue;const me=de.node,Oe="light-beam"===C.renderPass,qe=[...ge],Ge=de.evaluatedScale;let We=0;C.terrain&&me.elevation&&(We=me.elevation*C.terrain.exaggeration()),se.translate(qe,qe,[(me.anchor?me.anchor[0]:0)*(Ge[0]-1),(me.anchor?me.anchor[1]:0)*(Ge[1]-1),We]),Ge!==VM&&se.scale(qe,qe,Ge),se.multiply(qe,qe,me.matrix);const it=se.multiply([],W,qe);se.multiply(it,G,it);const gt=se.invert([],it);se.transpose(gt,gt),se.scale(gt,gt,UI);const zt=se.multiply([],k.projMatrix,qe);for(let an=0;an<me.meshes.length;++an){const Ft=me.meshes[an],Dt=an===me.lightMeshIndex;if(Dt){if(!Oe&&!C.terrain&&C.shadowRenderer){C.currentLayer<C.firstLightBeamLayer&&(C.firstLightBeamLayer=C.currentLayer);continue}}else if(Oe)continue;const pt={defines:[]},ut=[];Cp(pt.defines,ut,Ft,C),4&ve||pt.defines.push("DIFFUSE_SHADED"),fe&&pt.defines.push("SHADOWS_SINGLE_CASCADE");const Kt="shadow"===C.renderPass;if(Kt){Tp(Ft,qe,C,I);continue}let dn=null;if(L){const Hn=mx(qe,C.transform);if(dn=new Float32Array(Hn),"globe"!==k.projection.name){const Nr=Ft.aabb.min,Qn=Ft.aabb.max,[sr,In]=L.getOpacityForBounds(Hn,Nr[0],Nr[1],Qn[0],Qn[1]);pt.overrideFog=sr>=Fu||In>=Fu}}const Bt=C.getOrCreateProgram("model",pt);!Kt&&B&&(B.useNormalOffset=!!Ft.normalBuffer,B.setupShadowsFromMatrix(qe,Bt,B.useNormalOffset)),C.uploadCommonUniforms(A,Bt,ae.toUnwrapped(),dn);const Rn=Ft.material,Jn=Rn.pbrMetallicRoughness;Jn.metallicFactor=.9,Jn.roughnessFactor=.5;const Xn=lx(new Float32Array(zt),new Float32Array(it),new Float32Array(gt),C,H,Jn.baseColorFactor,Rn.emissiveFactor,Jn.metallicFactor,Jn.roughnessFactor,Rn,I);Bt.draw(C,A.gl.TRIANGLES,Q&&!Dt?J:te,qt.disabled,K?Dt||H<1||de.hasTranslucentParts?fn.alphaBlended:fn.unblended:fn.disabled,Wt.backCCW,Xn,I.id,Ft.vertexBuffer,Ft.indexBuffer,Ft.segments,I.paint,C.transform.zoom,void 0,ut)}}}};(function(K,Q,ae,ue){const fe=K.terrain?K.terrain.exaggeration():0,ge=K.transform.zoom;for(const ve of ue){const de=Q.getTile(ve).getBucket(ae);de&&(K.conflationActive&&de.updateReplacement(ve,K.replacementSource),de.evaluateScale(K,ae),K.terrain&&fe>0&&de.elevationUpdate(K.terrain,fe,ve,ae.source),de.needsReEvaluation(K,ge,ae)&&de.evaluate(ae))}})(C,S,I,R),1===H?oe(!0,!0):(oe(!1,!0),oe(!0,!1))}(t,e,n,i),void f();const g=p.getModels(),_=[],y=t.transform.getFreeCameraOptions().position,v=Z.scale([],[y.x,y.y,y.z],t.transform.worldSize);Z.negate(v,v);const w=[],E=[];let T=0;for(const C of g){const S=n.paint.get("model-rotation").constantOr(null),I=n.paint.get("model-scale").constantOr(null),R=n.paint.get("model-translation").constantOr(null);C.computeModelMatrix(t,S,I,R,!0,!0,!1);const A=se.identity([]),k=Ni(C.position.lat,t.transform.zoom),L=se.fromScaling([],[1,1,1/k]);se.translate(A,A,v),_.push({zScaleMatrix:L,negCameraPosMatrix:A});for(const B of C.nodes)ZC(t.transform,B,C.matrix,t.transform.projMatrix,T,w,E);T++}if(w.sort((C,S)=>S.depth-C.depth),"shadow"!==t.renderPass){if(1===a)for(const C of E)wd(C,t,n,_[C.modelIndex],qt.disabled,t.colorModeForRenderPass());else{for(const C of E)wd(C,t,n,_[C.modelIndex],qt.disabled,fn.disabled);for(const C of E)wd(C,t,n,_[C.modelIndex],t.stencilModeFor3D(),t.colorModeForRenderPass());t.resetStencilClippingMasks()}for(const C of w)wd(C,t,n,_[C.modelIndex],qt.disabled,t.colorModeForRenderPass());f()}else{for(const C of E)Tp(C.mesh,C.nodeModelMatrix,t,n);for(const C of w)Tp(C.mesh,C.nodeModelMatrix,t,n);f()}}},KC={modelUpload:function(t,e,n){const i=e.getSource();if(!i.loaded())return;if("vector"===i.type||"geojson"===i.type)return void(t.modelManager&&t.modelManager.upload(t,n));if("batched-model"===i.type)return;const a=i.getModels();for(const l of a)l.upload(t.context)}};class rS{constructor(e,n){this.context=new lE(e),this.transform=n,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=Bs.maxUnderzooming+Bs.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new UM,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new iS(this),this._wireframeDebugCache=new nS,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(e,n){const i=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(i||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ea(this,e));const a=this._terrain;this.transform.elevation=i?a:null,a.update(e,this.transform,n),this.transform.elevation&&!a.enabled&&(this.transform.elevation=null)}_updateFog(e){const n=e.fog;if(!n||"globe"===this.transform.projection.name||n.getOpacity(this.transform.pitch)<1||n.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[i,a]=n.getFovAdjustedRange(this.transform._fov);if(i>a)return void(this.transform.fogCullDistSq=null);const l=i+.78*(a-i);this.transform.fogCullDistSq=l*l}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(e,n){if(this.width=e*Ct.devicePixelRatio,this.height=n*Ct.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const i of this.style.order)this.style._mergedLayers[i].resize()}setup(){const e=this.context,n=new jo;n.emplaceBack(0,0),n.emplaceBack(he,0),n.emplaceBack(0,he),n.emplaceBack(he,he),this.tileExtentBuffer=e.createVertexBuffer(n,Ec.members),this.tileExtentSegments=Cn.simpleSegment(0,0,4,2);const i=new jo;i.emplaceBack(0,0),i.emplaceBack(he,0),i.emplaceBack(0,he),i.emplaceBack(he,he),this.debugBuffer=e.createVertexBuffer(i,Ec.members),this.debugSegments=Cn.simpleSegment(0,0,4,5);const a=new jo;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(-1,1),a.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(a,Ec.members),this.viewportSegments=Cn.simpleSegment(0,0,4,2);const l=new $a;l.emplaceBack(0,0,0,0),l.emplaceBack(he,0,he,0),l.emplaceBack(0,he,0,he),l.emplaceBack(he,he,he,he),this.mercatorBoundsBuffer=e.createVertexBuffer(l,Yv.members),this.mercatorBoundsSegments=Cn.simpleSegment(0,0,4,2);const c=new Tr;c.emplaceBack(0,1,2),c.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(c);const h=new Ml;for(const p of[0,1,3,2,0])h.emplaceBack(p);this.debugIndexBuffer=e.createIndexBuffer(h),this.emptyTexture=new Wr(e,new Sr({width:1,height:1},Uint8Array.of(0,0,0,0)),e.gl.RGBA),this.identityMat=se.create();const f=this.context.gl;this.stencilClearMode=new qt({func:f.ALWAYS,mask:0},0,255,f.ZERO,f.ZERO,f.ZERO),this.loadTimeStamps.push(ce.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const e=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,e.TRIANGLES,Et.disabled,this.stencilClearMode,fn.disabled,Wt.disabled,SC(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(e,n,i){if(!n||this.currentStencilSource===n.id||!e.isTileClipped()||!i||0===i.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let h=!1;for(const f of i)if(void 0===this._tileClippingMaskIDs[f.key]){h=!0;break}if(!h)return}this.currentStencilSource=n.id;const a=this.context,l=a.gl;this.nextStencilID+i.length>256&&this.clearStencil(),a.setColorMode(fn.disabled),a.setDepthMode(Et.disabled);const c=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const h of i){const f=n.getTile(h),p=this._tileClippingMaskIDs[h.key]=this.nextStencilID++,{tileBoundsBuffer:g,tileBoundsIndexBuffer:_,tileBoundsSegments:y}=this.getTileBoundsBuffers(f);c.draw(this,l.TRIANGLES,Et.disabled,new qt({func:l.ALWAYS,mask:0},p,255,l.KEEP,l.KEEP,l.REPLACE),fn.disabled,Wt.disabled,SC(h.projMatrix),"$clipping",g,_,y)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,n=this.context.gl;return new qt({func:n.NOTEQUAL,mask:255},e,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const n=this.context.gl;return new qt({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(e){const n=this.context.gl,i=e.sort((c,h)=>h.overscaledZ-c.overscaledZ),a=i[i.length-1].overscaledZ,l=i[0].overscaledZ-a+1;if(l>1){this.currentStencilSource=void 0,this.nextStencilID+l>256&&this.clearStencil();const c={};for(let h=0;h<l;h++)c[h+a]=new qt({func:n.GEQUAL,mask:255},h+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=l,[c,i]}return[{[a]:qt.disabled},i]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new fn([e.CONSTANT_COLOR,e.ONE,e.CONSTANT_COLOR,e.ONE],new yt(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?fn.unblended:fn.alphaBlended}colorModeForDrapableLayerRenderPass(e){const n=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new fn([n.ONE,n.ONE_MINUS_SRC_ALPHA,n.CONSTANT_ALPHA,n.ONE_MINUS_SRC_ALPHA],new yt(0,0,0,void 0===e?0:e),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(e,n,i,a=!1){if(!this.opaquePassEnabledForLayer()&&!a)return Et.disabled;const l=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Et(i||this.context.gl.LEQUAL,n,[l,l])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){this._wireframeDebugCache.update(this.frameCounter),this.style=e,this.options=n;const i=this.style._mergedLayers,a=this.style.order,l=a.map(A=>i[A]),c=this.style._mergedSourceCaches;this.imageManager=e.imageManager,this.modelManager=e.modelManager,this.symbolFadeChange=e.placement.symbolFadeChange(Ct.now()),this.imageManager.beginFrame();let h=0,f=!1;for(const A in c){const k=c[A];k.used&&(k.prepare(this.context),k.getSource().usedInConflation&&++h)}const p={},g={},_={},y={},v={};for(const A in c){const k=c[A];p[A]=k.getVisibleCoordinates(),g[A]=p[A].slice().reverse(),_[A]=k.getVisibleCoordinates(!0).reverse(),y[A]=k.getShadowCasterCoordinates(),v[A]=k.sortCoordinatesByDistance(p[A])}const w=A=>{const k=this.style.getLayerSourceCache(A);return k&&k.used?k.getSource():null};if(h){const A=[];for(const k of l)this.layerUsedInConflation(k,w(k))&&A.push(k);if(A&&A.length>1){const k=[];for(const L of A){const B=this.style.getLayerSourceCache(L);B&&B.used&&B.getSource().usedInConflation&&k.push({layer:L.fqid,cache:B})}this.replacementSource.setSources(k),f=!0}}f||this.replacementSource.clear(),this.conflationActive=f,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const A of l){const k=A.cutoffRange();if(this.longestCutoffRange=Math.max(k,this.longestCutoffRange),k>0){const L=w(A);L&&(this.minCutoffZoom=Math.max(L.minzoom,this.minCutoffZoom)),A.minzoom&&(this.minCutoffZoom=Math.max(A.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let A=0;A<l.length;A++)if(l[A].is3D()){this.opaquePassCutoff=A;break}const E=this.style&&this.style.fog;E?(this._fogVisible=0!==E.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=E.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(_),this.opaquePassCutoff=0);const T=this._shadowRenderer;if(T){T.updateShadowParameters(this.transform,this.style.directionalLight);for(const A in c)for(const k of p[A]){let L={min:0,max:0};this.terrain&&(L=this.terrain.getMinMaxForTile(k)||L),T.addShadowReceiver(k.toUnwrapped(),L.min,L.max)}}"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new jD(this.context));for(const A of l){if(A.isHidden(this.transform.zoom))continue;const k=e.getLayerSourceCache(A);this.uploadLayer(this,A,k)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new qu),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!Ds.has(this.context.gl))return;this.renderPass="offscreen";for(const A of l){const k=e.getLayerSourceCache(A);if(!A.hasOffscreenPass()||A.isHidden(this.transform.zoom))continue;const L=k?g[k.id]:void 0;("custom"===A.type||"raster"===A.type||A.isSky()||L&&L.length)&&this.renderLayer(this,k,A,L)}this.depthRangeFor3D=[0,1-(l.length+2)*this.numSublayers*this.depthEpsilon];const C=this.terrain;C&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&C.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,y)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const S="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),I=(()=>{if(n.showOverdrawInspector)return yt.black;if(this.style.fog&&this.transform.projection.supportsFog&&!S){const A=this.style.fog.properties.get("color").toArray01();return new yt(...A)}if(this.style.fog&&this.transform.projection.supportsFog&&S){const A=this.style.fog.properties.get("space-color").toArray01();return new yt(...A)}return yt.transparent})();if(this.context.clear({color:I,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&S&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const A=l[this.currentLayer],k=e.getLayerSourceCache(A);if(A.isSky())continue;const L=k?(A.is3D()?v:g)[k.id]:void 0;this._renderTileClippingMasks(A,k,L),this.renderLayer(this,k,A,L)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&S&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||ni(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const A=l[this.currentLayer],k=e.getLayerSourceCache(A);A.isSky()&&this.renderLayer(this,k,A,k?g[k.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let R=0;for(T&&(R=T.getShadowCastingLayerCount());this.currentLayer<a.length;){const A=l[this.currentLayer],k=e.getLayerSourceCache(A);if(A.isSky()){++this.currentLayer;continue}if(C&&this.style.isLayerDraped(A)){if(A.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=C.renderBatch(this.currentLayer);continue}let L;if(k&&(L=("symbol"===A.type?_:A.is3D()?v:g)[k.id]),this._renderTileClippingMasks(A,k,k?p[k.id]:void 0),this.renderLayer(this,k,A,L),!C&&T&&R>0&&A.hasShadowPass()&&0==--R&&(T.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const B=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=B;this.currentLayer++){const j=l[this.currentLayer];if(!j.hasLightBeamPass())continue;const U=e.getLayerSourceCache(j);this.renderLayer(this,U,j,U?g[U.id]:void 0)}this.currentLayer=B,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let A=null;l.forEach(k=>{const L=e.getLayerSourceCache(k);L&&!k.isHidden(this.transform.zoom)&&L.getVisibleCoordinates().length&&(!A||A.getSource().maxzoom<L.getSource().maxzoom)&&(A=L)}),A&&this.options.showTileBoundaries&&YC.debug(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){const k=A.transform.padding;GC(A,A.transform.height-(k.top||0),3,Y2),GC(A,k.bottom||0,3,NI),J2(A,k.left||0,3,zI),J2(A,A.transform.width-(k.right||0),3,HC);const L=A.transform.centerPoint;var B,j,U,G;px(B=A,(j=L.x)-1,(U=A.transform.height-L.y)-10,2,20,G=m_),px(B,j-10,U-1,20,2,G)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(ce.performance.now()),this.saveCanvasCopy()),f||(this.conflationActive=!1)}uploadLayer(e,n,i){this.gpuTimingStart(n),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(n.type)||e.terrain&&"custom"===n.type)&&KC[`${n.type}Upload`]&&KC[`${n.type}Upload`](e,i,n.scope),this.gpuTimingEnd()}renderLayer(e,n,i,a){i.isHidden(this.transform.zoom)||("background"===i.type||"sky"===i.type||"custom"===i.type||"model"===i.type||"raster"===i.type||a&&a.length)&&(this.id=i.id,this.gpuTimingStart(i),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(i.type)||e.terrain&&"custom"===i.type)&&YC[i.type](e,n,i,a,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery,i=this.context.gl;let a=this.gpuTimers[e.id];a||(a=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:i.createQuery()}),a.calls++,i.beginQuery(n.TIME_ELAPSED_EXT,a.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const e=this.context.extTimerQuery,n=this.context.gl,i=n.createQuery();this.deferredRenderGpuTimeQueries.push(i),n.beginQuery(e.TIME_ELAPSED_EXT,i)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){const e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){const n={};for(const i in e){const a=e[i],l=this.context.extTimerQuery,c=l.getQueryParameter(a.query,this.context.gl.QUERY_RESULT)/1e6;l.deleteQueryEXT(a.query),n[i]=c}return n}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;const n=this.context.extTimerQuery,i=this.context.gl;let a=0;for(const l of e)a+=n.getQueryParameter(l,i.QUERY_RESULT)/1e6,n.deleteQueryEXT(l);return a}translatePosMatrix(e,n,i,a,l){if(!i[0]&&!i[1])return e;const c=l?"map"===a?this.transform.angle:0:"viewport"===a?-this.transform.angle:0;if(c){const p=Math.sin(c),g=Math.cos(c);i=[i[0]*g-i[1]*p,i[0]*p+i[1]*g]}const h=[l?i[0]:rl(n,i[0],this.transform.zoom),l?i[1]:rl(n,i[1],this.transform.zoom),0],f=new Float32Array(16);return se.translate(f,e,h),f}saveTileTexture(e){const n=this._tileTextures[e.size[0]];n?n.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const n=this._tileTextures[e];return n&&n.length>0?n.pop():null}isPatternMissing(e,n){return null===e||void 0!==e&&!this.imageManager.getPattern(e.toString(),n)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}terrainUseFloatDEM(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(e,n,i){const a=void 0===i?this.terrain&&this.terrain.renderingToTexture:i,l=this.terrain&&0===this.terrain.exaggeration(),c=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===e||"terrainRaster"===e?(c.push("LIGHTING_3D_MODE"),c.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):a||c.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||c.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?c.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):c.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(c.push("TERRAIN"),this.terrainUseFloatDEM()&&c.push("TERRAIN_DEM_FLOAT_FORMAT"),l&&c.push("ZERO_EXAGGERATION")),"globe"===this.transform.projection.name&&c.push("GLOBE"),!this._fogVisible||a||void 0!==n&&!n||c.push("FOG","FOG_DITHERING"),a&&c.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&c.push("OVERDRAW_INSPECTOR"),c}getOrCreateProgram(e,n){this.cache=this.cache||{};const i=n&&n.defines||[],a=n&&n.config,l=this.currentGlobalDefines(e,n&&n.overrideFog,n&&n.overrideRtt).concat(i),c=yi.cacheKey(L2[e],e,l,a);return this.cache[c]||(this.cache[c]=new yi(this.context,e,L2[e],a,zC[e],l)),this.cache[c]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=ce.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Wr(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(e,n){if(this.style.enable3dLights()){const i=this.style.directionalLight,a=this.style.ambientLight;if(i&&a){const l=((c,h)=>{const f=c.properties.get("direction"),p=c.properties.get("color").toArray01(),g=c.properties.get("intensity"),_=h.properties.get("color").toArray01(),y=h.properties.get("intensity"),v=[f.x,f.y,f.z],w=Bn(_,y),E=Bn(p,g);return{u_lighting_ambient_color:w,u_lighting_directional_dir:v,u_lighting_directional_color:E,u_ground_radiance:j2(v,E,w)}})(i,a);n.setLightsUniformValues(e,l)}}}uploadCommonUniforms(e,n,i,a,l){if(this.uploadCommonLightUniforms(e,n),this.terrain&&this.terrain.renderingToTexture)return;const c=this.style.fog;if(c){const h=c.getOpacity(this.transform.pitch),f=((p,g,_,y,v,w,E,T,C,S,I,R)=>{const A=p.transform,k=g.properties.get("color").toArray01();k[3]=y;const L=p.frameCounter/1e3%1,[B,j]=g.properties.get("vertical-range");return{u_fog_matrix:_?A.calculateFogTileMatrix(_):R||p.identityMat,u_fog_range:g.getFovAdjustedRange(A._fov),u_fog_color:k,u_fog_horizon_blend:g.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(B,j),j],u_fog_temporal_offset:L,u_frustum_tl:v,u_frustum_tr:w,u_frustum_br:E,u_frustum_bl:T,u_globe_pos:C,u_globe_radius:S,u_viewport:I,u_globe_transition:ni(A.zoom),u_is_globe:+("globe"===A.projection.name)}})(this,c,i,h,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*Ct.devicePixelRatio,this.transform.height*Ct.devicePixelRatio],a);n.setFogUniformValues(e,f)}l&&n.setCutoffUniformValues(e,l.uniformValues)}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){const e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}canvasCopy(){const e=this.context.gl,n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),n}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}getBackgroundTiles(){const e=this._backgroundTiles,n=this._backgroundTiles={},i=this.transform.coveringTiles({tileSize:512});for(const a of i)n[a.key]=e[a.key]||new qo(a,512,this.transform.tileZoom,this);return n}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(e,n){return!(!e.is3D()||e.minzoom&&e.minzoom>this.transform.zoom||"building"!==e.sourceLayer&&(!n||"batched-model"!==n.type))}isTileAffectedByFog(e){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let n=this._cachedTileFogOpacities[e.key];return n||(this._cachedTileFogOpacities[e.key]=n=this.style.fog.getOpacityForTile(e)),n[0]>=Fu||n[1]>=Fu}}const zc=2048;class JC{constructor(e,n){this.aabb=e,this.lastCascade=n}}class QC{add(e,n){const i=this.receivers[e.key];void 0!==i?(i.aabb.min[0]=Math.min(i.aabb.min[0],n.min[0]),i.aabb.min[1]=Math.min(i.aabb.min[1],n.min[1]),i.aabb.min[2]=Math.min(i.aabb.min[2],n.min[2]),i.aabb.max[0]=Math.max(i.aabb.max[0],n.max[0]),i.aabb.max[1]=Math.max(i.aabb.max[1],n.max[1]),i.aabb.max[2]=Math.max(i.aabb.max[2],n.max[2])):this.receivers[e.key]=new JC(n,null)}clear(){this.receivers={}}get(e){return this.receivers[e.key]}computeRequiredCascades(e,n,i){const a=$n.fromPoints(e.points);let l=0;for(const c in this.receivers){const h=this.receivers[c];if(!h||!a.intersectsAabb(h.aabb))continue;h.aabb.min=a.closestPoint(h.aabb.min),h.aabb.max=a.closestPoint(h.aabb.max);const f=h.aabb.getCorners();for(let p=0;p<i.length;p++){let g=!0;for(const _ of f){const y=[_[0]*n,_[1]*n,_[2]];if(Z.transformMat4(y,y,i[p].matrix),y[0]<-1||y[0]>1||y[1]<-1||y[1]>1){g=!1;break}}if(h.lastCascade=p,l=Math.max(l,p),g)break}}return l+1}}class iS{constructor(e){this.painter=e,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new QC,this._depthMode=new Et(e.context.gl.LEQUAL,Et.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1}destroy(){for(const e of this._cascades)e.texture.destroy(),e.framebuffer.destroy();this._cascades=[]}updateShadowParameters(e,n){const i=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!n||!n.properties)return;const a=n.properties.get("shadow-intensity");if(!n.shadowsEnabled()||a<=0||(this._shadowLayerCount=i.style.order.reduce((v,w)=>{const E=i.style._mergedLayers[w];return v+(E.hasShadowPass()&&!E.isHidden(e.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;const l=i.context,c=zc,h=zc;if(0===this._cascades.length)for(let v=0;v<2;++v){const w=i._shadowMapDebug,E=l.gl,T=l.createFramebuffer(c,h,w,"texture"),C=new Wr(l,{width:c,height:h,data:null},E.DEPTH_COMPONENT);if(T.depthAttachment.set(C.texture),w){const S=new Wr(l,{width:c,height:h,data:null},E.RGBA);T.colorAttachment.set(S.texture)}this._cascades.push({framebuffer:T,texture:C,matrix:[],far:0,boundingSphereRadius:0,frustum:new ua,scale:0})}this.shadowDirection=_x(n);let f=0;if(e.elevation){const v=e.elevation,w=[1e4,-1e4];v.visibleDemTiles.filter(E=>E.dem).forEach(E=>{const T=E.dem.tree;w[0]=Math.min(w[0],T.minimums[0]),w[1]=Math.max(w[1],T.maximums[0])}),1e4!==w[0]&&(f=(w[1]-w[0])*v.exaggeration())}const p=1.5*e.cameraToCenterDistance,g=3*p,_=new Float64Array(16);for(let v=0;v<2;++v){const w=this._cascades[v];let E=e.height/50,T=1;0===v?T=p:(E=p,T=g);const[C,S]=HI(e,this.shadowDirection,E,T,zc,f);w.scale=e.scale,w.matrix=C,w.boundingSphereRadius=S,se.invert(_,w.matrix),w.frustum=ua.fromInvProjectionMatrix(_,1,0,!0),w.far=T}this._uniformValues.u_fade_range=[.75*this._cascades[1].far,this._cascades[1].far],this._uniformValues.u_shadow_intensity=a,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=zc,this._uniformValues.u_shadowmap_0=Wo_ShadowMap0,this._uniformValues.u_shadowmap_1=Wo_ShadowMap0+1,this._groundShadowTiles=i.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const y=i.transform.elevation;for(const v of this._groundShadowTiles){let w={min:0,max:0};if(y){const E=y.getMinMaxForTile(v);E&&(w=E)}this.addShadowReceiver(v.toUnwrapped(),w.min,w.max)}}get enabled(){return this._enabled}set enabled(e){this._enabled=e}drawShadowPass(e,n){if(!this._enabled)return;const i=this.painter,a=i.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(i.transform.getFrustum(0),i.transform.worldSize,this._cascades),a.viewport.set([0,0,zc,zc]);for(let l=0;l<this._numCascadesToRender;++l){i.currentShadowCascade=l,a.bindFramebuffer.set(this._cascades[l].framebuffer.framebuffer),a.clear({color:yt.white,depth:1});for(const c of e.order){const h=e._mergedLayers[c];if(!h.hasShadowPass()||h.isHidden(i.transform.zoom))continue;const f=e.getLayerSourceCache(h),p=f?n[f.id]:void 0;("model"===h.type||p&&p.length)&&i.renderLayer(i,f,h,p)}}i.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const e=this.painter,n=e.style,i=e.context,a=n.directionalLight,l=n.ambientLight;if(!a||!l)return;const c=[],h=bp(e,e.longestCutoffRange);h.shouldRenderCutoff&&c.push("RENDER_CUTOFF");const f=bd(a,l),p=new Et(i.gl.LEQUAL,Et.ReadOnly,e.depthRangeFor3D);for(const g of this._groundShadowTiles){const _=g.toUnwrapped(),y=e.isTileAffectedByFog(g),v=e.getOrCreateProgram("groundShadow",{defines:c,overrideFog:y});this.setupShadows(_,v),e.uploadCommonUniforms(i,v,_,null,h);const w={u_matrix:e.transform.calculateProjMatrix(_),u_ground_shadow_factor:f};v.draw(e,i.gl.TRIANGLES,p,qt.disabled,fn.multiply,Wt.disabled,w,"ground_shadow",e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments,{},e.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?fn.unblended:fn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(e){const n=this.painter.transform,i=n.calculatePosMatrix(e,n.worldSize);return se.multiply(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}calculateShadowPassMatrixFromMatrix(e){return se.multiply(e,this._cascades[this.painter.currentShadowCascade].matrix,e),Float32Array.from(e)}setupShadows(e,n,i,a=0){if(!this._enabled)return;const l=this.painter.transform,c=this.painter.context,h=c.gl,f=this._uniformValues,p=new Float64Array(16),g=l.calculatePosMatrix(e,l.worldSize);for(let _=0;_<2;_++)se.multiply(p,this._cascades[_].matrix,g),f[0===_?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(p),c.activeTexture.set(h.TEXTURE0+Wo_ShadowMap0+_),this._cascades[_].texture.bind(h.NEAREST,h.CLAMP_TO_EDGE);if(this.useNormalOffset=!!i,this.useNormalOffset){const _=Nh(e.canonical),y=2/l.tileSize*he/zc,v=y*this._cascades[0].boundingSphereRadius,w=y*this._cascades[1].boundingSphereRadius,E=("vector-tile"===i?1:3)/Math.pow(2,a-e.canonical.z-(1-l.zoom+Math.floor(l.zoom)));f.u_shadow_normal_offset=[_,v*E,w*E],f.u_shadow_bias=[6e-5,.0012,.012]}else f.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(c,f)}setupShadowsFromMatrix(e,n,i=!1){if(!this._enabled)return;const a=this.painter.context,l=a.gl,c=this._uniformValues,h=new Float64Array(16);for(let f=0;f<2;f++)se.multiply(h,this._cascades[f].matrix,e),c[0===f?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(h),a.activeTexture.set(l.TEXTURE0+Wo_ShadowMap0+f),this._cascades[f].texture.bind(l.NEAREST,l.CLAMP_TO_EDGE);this.useNormalOffset=i,i?(c.u_shadow_normal_offset=[1,5,5],c.u_shadow_bias=[6e-5,.0012,.012]):c.u_shadow_bias=[36e-5,.0012,.012],n.setShadowUniformValues(a,c)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(e,n,i,a){if(a[2]>=0)return{};const l=function(f,p,g){const _=g/(1<<f.canonical.z);return new $n([f.canonical.x*_+f.wrap*g,f.canonical.y*_+f.wrap*g,0],[(f.canonical.x+1)*_+f.wrap*g,(f.canonical.y+1)*_+f.wrap*g,p])}(e,n,i).getCorners(),c=n/-a[2];a[0]<0?(Z.add(l[0],l[0],[a[0]*c,0,0]),Z.add(l[3],l[3],[a[0]*c,0,0])):a[0]>0&&(Z.add(l[1],l[1],[a[0]*c,0,0]),Z.add(l[2],l[2],[a[0]*c,0,0])),a[1]<0?(Z.add(l[0],l[0],[0,a[1]*c,0]),Z.add(l[1],l[1],[0,a[1]*c,0])):a[1]>0&&(Z.add(l[2],l[2],[0,a[1]*c,0]),Z.add(l[3],l[3],[0,a[1]*c,0]));const h={};return h.vertices=l,h.planes=[g_(l[1],l[0],l[4]),g_(l[2],l[1],l[5]),g_(l[3],l[2],l[6]),g_(l[0],l[3],l[7])],h}addShadowReceiver(e,n,i){this._receivers.add(e,$n.fromTileIdAndHeight(e,n,i))}getMaxCascadeForTile(e){const n=this._receivers.get(e);return n&&n.lastCascade?n.lastCascade:0}}function g_(t,e,n){const i=Z.sub([],n,e),a=Z.sub([],t,e),l=Z.cross([],i,a),c=Z.length(l);return 0===c?[0,0,1,0]:(Z.scale(l,l,1/c),[l[0],l[1],l[2],-Z.dot(l,e)])}function _x(t){const e=t.properties.get("direction"),n=tt(e.x,e.y,e.z);n[2]=et(n[2],0,75);const i=Ae([n[0],n[1],n[2]]);return Z.fromValues(i.x,i.y,i.z)}function bd(t,e){const n=t.properties.get("color"),i=t.properties.get("intensity"),a=t.properties.get("direction"),l=[a.x,a.y,a.z],c=e.properties.get("color"),h=e.properties.get("intensity"),f=Math.max(Z.dot([0,0,1],l),0),p=[0,0,0];Z.scale(p,c.toArray01Linear().slice(0,3),h);const g=[0,0,0];return Z.scale(g,n.toArray01Linear().slice(0,3),f*i),En([p[0]>0?p[0]/(p[0]+g[0]):0,p[1]>0?p[1]/(p[1]+g[1]):0,p[2]>0?p[2]/(p[2]+g[2]):0])}function HI(t,e,n,i,a,l){const c=t.zoom,h=t.scale,f=t.worldSize,p=1/f,g=t.aspect,_=Math.sqrt(1+g*g)*Math.tan(.5*t.fovX),y=_*_,v=i-n,w=i+n;let E,T;y>v/w?(E=i,T=i*_):(E=.5*w*(1+y),T=.5*Math.sqrt(v*v+2*(i*i+n*n)*y+w*w*y*y));const C=t.projection.pixelsPerMeter(t.center.lat,f),S=t._camera.getCameraToWorldMercator(),I=[0,0,-E*p];Z.transformMat4(I,I,S);let R=T*p;const A=t._edgeInsets;if(!(0===A.left&&0===A.top&&0===A.right&&0===A.bottom||A.left===A.right&&A.top===A.bottom)){const ue=t._camera.getWorldToCamera(t.worldSize,"meters"===t.projection.zAxisUnit?C:1),fe=t._camera.getCameraToClipPerspective(t._fov,t.width/t.height,n,i);fe[8]=2*-t.centerOffset.x/t.width,fe[9]=2*t.centerOffset.y/t.height;const ge=new Float64Array(16);se.mul(ge,fe,ue);const ve=new Float64Array(16);se.invert(ve,ge);const de=ua.fromInvProjectionMatrix(ve,f,c,!0);for(const me of de.points){const Oe=((k=me)[0]/=h,k[1]/=h,k[2]=kn(k[2],t._center.lat),k);R=Math.max(R,Z.len(Z.subtract([],I,Oe)))}}var k;R*=a/(a-1);const L=Math.acos(e[2]),B=Math.atan2(-e[0],-e[1]),j=new s0;j.position=I,j.setPitchBearing(L,B);const U=j.getWorldToCamera(f,C),G=R*f,$=Math.min(t._mercatorZfromZoom(17)*f*-2,-2*G),W=j.getCameraToClipOrthographic(-G,G,-G,G,$,(G+l*C)/e[2]),H=new Float64Array(16);se.multiply(H,W,U);const J=Z.fromValues(Math.floor(1e6*I[0])/1e6*f,Math.floor(1e6*I[1])/1e6*f,0),te=.5*a,oe=[0,0,0];Z.transformMat4(oe,J,H),Z.scale(oe,oe,te);const K=[Math.floor(oe[0]),Math.floor(oe[1]),Math.floor(oe[2])],Q=[0,0,0];Z.sub(Q,oe,K),Z.scale(Q,Q,-1/te);const ae=new Float64Array(16);return se.identity(ae),se.translate(ae,ae,Q),se.multiply(H,ae,H),[H,G]}class eT extends Mn{constructor(e){super(),this.requestManager=e,this.models={"":{}},this.numModelsLoading={}}loadModel(e,n){return hC(this.requestManager.transformRequest(n,_e.Model).url).then(i=>{if(!i)return;const a=gp(i),l=new bE(e,void 0,void 0,a);return l.computeBoundsAndApplyParent(),l}).catch(i=>{this.fire(new xt(new Error(`Could not load model ${e} from ${n}: ${i.message}`)))})}load(e,n){this.models[n]||(this.models[n]={});const i=Object.keys(e);this.numModelsLoading[n]=(this.numModelsLoading[n]||0)+i.length;const a=[];for(const l of i)a.push(this.loadModel(l,e[l]));Promise.allSettled(a).then(l=>{for(let c=0;c<l.length;c++){const{status:h,value:f}=l[c];"fulfilled"===h&&f&&(this.models[n][i[c]]=f)}this.numModelsLoading[n]-=i.length,this.fire(new Se("data",{dataType:"style"}))}).catch(l=>{this.fire(new xt(new Error(`Could not load models: ${l.message}`)))})}isLoaded(){for(const e in this.numModelsLoading)if(this.numModelsLoading[e]>0)return!1;return!0}hasModel(e,n){return!!this.getModel(e,n)}getModel(e,n){return this.models[n]||(this.models[n]={}),this.models[n][e]}addModel(e,n,i){this.models[i]||(this.models[i]={}),this.hasModel(e,i)&&this.removeModel(e,i),this.load({[e]:this.requestManager.normalizeModelURL(n)},i)}addModels(e,n){const i={};for(const a in e)i[a]=this.requestManager.normalizeModelURL(e[a]);this.load(i,n)}removeModel(e,n){this.models[n]||(this.models[n]={});const i=this.models[n][e];delete this.models[n][e],i.destroy()}listModels(e){return this.models[e]||(this.models[e]={}),Object.keys(this.models[e])}upload(e,n){this.models[n]||(this.models[n]={});for(const i in this.models[n])this.models[n][i].upload(e.context)}}const Kl=(t,e)=>fm(t,e&&e.filter(n=>"source.canvas"!==n.identifier)),oS=fi(yn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),sS=fi(yn,["setCenter","setZoom","setBearing","setPitch"]),aS={version:8,layers:[],sources:{}},lS={duration:300,delay:0},cS=new Set(["fill","line","background","hillshade","raster"]);class Ca extends Mn{constructor(e,n={}){super(),this.map=e,this.scope=n.scope||"",this.fragments=[],this.importDepth=n.importDepth||0,this.importsCache=n.importsCache||new Map,this.resolvedImports=n.resolvedImports||new Set,this.transition=Ke({},lS),this._buildingIndex=new g2(this),this.crossTileSymbolIndex=new kI,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=n.styleChanges||new N1,this.dispatcher=n.dispatcher?n.dispatcher:new Gg(Bu(),this),n.imageManager?this.imageManager=n.imageManager:(this.imageManager=new t2,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=n.glyphManager?n.glyphManager:new Bl(e._requestManager,n.localFontFamily?2:n.localIdeographFontFamily?1:0,n.localFontFamily||n.localIdeographFontFamily),n.modelManager?this.modelManager=n.modelManager:(this.modelManager=new eT(e._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=new Map,this._configDependentLayers=new Set,this.dispatcher.broadcast("setReferrer",Ee());const i=this;this._rtlTextPluginCallback=Ca.registerForPluginStateChange(a=>{i.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:a.pluginStatus,pluginURL:a.pluginURL},(l,c)=>{if(Eh(l),c&&c.every(h=>h))for(const h in i._sourceCaches){const f=i._sourceCaches[h],p=f.getSource().type;"vector"!==p&&"geojson"!==p||f.reload()}})}),this.on("data",a=>{if("source"!==a.dataType||"metadata"!==a.sourceDataType)return;const l=this.getOwnSource(a.sourceId);if(l&&l.vectorLayerIds)for(const c in this._layers){const h=this._layers[c];h.source===l.id&&this._validateLayer(h)}})}loadURL(e,n={}){this.fire(new Se("dataloading",{dataType:"style"}));const i="boolean"==typeof n.validate?n.validate:!Nt(e);e=this.map._requestManager.normalizeStyleURL(e,n.accessToken),this.resolvedImports.add(e);const a=this.importsCache.get(e);if(a)return this._load(a,i);const l=this.map._requestManager.transformRequest(e,_e.Style);this._request=Me(l,(c,h)=>{if(this._request=null,c)this.fire(new xt(c));else if(h)return this.importsCache.set(e,h),this._load(h,i)})}loadJSON(e,n={}){this.fire(new Se("dataloading",{dataType:"style"})),this._request=Ct.frame(()=>{this._request=null,this._load(e,!1!==n.validate)})}loadEmpty(){this.fire(new Se("dataloading",{dataType:"style"})),this._load(aS,!1)}_loadImports(e,n){if(this.importDepth>=4)return ee("Style doesn't support nesting deeper than 5"),this._reloadImports();const i=[];for(const a of e){const l=this._createFragmentStyle(a),c=new Promise(f=>l.on("style.import.load",f));if(i.push(c),this.resolvedImports.has(a.url)){l.loadEmpty();continue}const h=a.data||this.importsCache.get(a.url);h?l.loadJSON(h,{validate:n}):a.url?l.loadURL(a.url,{validate:n}):l.loadEmpty(),this.fragments.push({style:l,id:a.id,config:a.config})}Promise.all(i).then(()=>this._reloadImports())}_createFragmentStyle(e){const n=this.scope?gr(e.id,this.scope):e.id,i=new Ca(this.map,{scope:n,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager});return i.setEventedParent(this.map,{style:i}),i.setConfig(e.config),i}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const e=this.isRootStyle();this._shouldPrecompile=e,this.fire(new Se("data",{dataType:"style"})),this.fire(new Se(e?"style.load":"style.import.load"))}_load(e,n){const i=e.schema;if(this.isRootStyle()&&(e.fragment||i&&!1!==e.fragment)){const c=Ke({},aS,{imports:[{id:"basemap",data:e,url:""}]});return void this._load(c,n)}if(this.updateSchema(i),n&&Kl(this,mc(e)))return;this._loaded=!0,this.stylesheet=q(e);for(const c in e.sources)this.addSource(c,e.sources[c],{validate:!1});this._changes.changed=!1,e.sprite?this._loadSprite(e.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(e.glyphs,this.scope);const a=_2(this.stylesheet.layers);if(this._order=a.map(c=>c.id),this.stylesheet.light&&ee("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const c=this.stylesheet.lights[0];this.light=new KE(c.properties,c.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new KE(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const c of a){const h=up(c,this.options);h.setScope(this.scope),h.isConfigDependent&&this._configDependentLayers.add(h.fqid),h.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=h,this._layers[h.id]=h,this._serializedLayers[h.id]=h.serialize();const f=this.getOwnLayerSourceCache(h),p=!!this.directionalLight&&this.directionalLight.shadowsEnabled();f&&h.canCastShadows()&&p&&(f.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const l=this.stylesheet.terrain;if(l&&!this.terrainSetForDrapingOnly()&&this._createTerrain(l,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.mergeAll(),this._updateMapProjection(),this.map._triggerCameraUpdate(this.camera),this.fire(new Se("data",{dataType:"style"})),e.imports)this._loadImports(e.imports,n);else{this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const c=this.isRootStyle();this._shouldPrecompile=c,this.fire(new Se(c?"style.load":"style.import.load"))}}isRootStyle(){return 0===this.importDepth}mergeAll(){let e,n,i,a,l,c,h,f;this.forEachFragmentStyle(p=>{if(p.stylesheet){if(null!=p.light&&(e=p.light),p.stylesheet.lights)for(const g of p.stylesheet.lights)"ambient"===g.type&&null!=p.ambientLight&&(n=p.ambientLight),"directional"===g.type&&null!=p.directionalLight&&(i=p.directionalLight);(p.stylesheet.terrain||p.stylesheet.projection&&"globe"===p.stylesheet.projection.name)&&null!=p.terrain&&(!a||a&&0===a.drapeRenderMode||1===p.terrain.drapeRenderMode)&&(a=p.terrain),p.stylesheet.fog&&null!=p.fog&&(l=p.fog),null!=p.stylesheet.camera&&(f=p.stylesheet.camera),null!=p.stylesheet.projection&&(c=p.stylesheet.projection),null!=p.stylesheet.transition&&(h=p.stylesheet.transition)}}),this.light=e,this.ambientLight=n,this.directionalLight=i,this.terrain=a,this.fog=l,this.camera=f||{"camera-projection":"perspective"},this.projection=c||{name:"mercator"},this.transition=Ke({},lS,h),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(e){const n=i=>{for(const a of i.fragments)n(a.style);e(i)};n(this)}mergeTerrain(){let e;this.forEachFragmentStyle(n=>{null!=n.terrain&&(!e||e&&0===e.drapeRenderMode||1===n.terrain.drapeRenderMode)&&(e=n.terrain)}),this.terrain=e}mergeProjection(){let e;this.forEachFragmentStyle(n=>{null!=n.stylesheet.projection&&(e=n.stylesheet.projection)}),this.projection=e||{name:"mercator"}}mergeSources(){const e={},n={},i={};this.forEachFragmentStyle(a=>{for(const l in a._sourceCaches){const c=gr(l,a.scope);e[c]=a._sourceCaches[l]}for(const l in a._otherSourceCaches){const c=gr(l,a.scope);n[c]=a._otherSourceCaches[l]}for(const l in a._symbolSourceCaches){const c=gr(l,a.scope);i[c]=a._symbolSourceCaches[l]}}),this._mergedSourceCaches=e,this._mergedOtherSourceCaches=n,this._mergedSymbolSourceCaches=i}mergeLayers(){const e={},n=[],i={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(l=>{for(const c of l._order){const h=l._layers[c];if("slot"===h.type){const f=vf(c);if(e[f])continue;e[f]=[]}h.slot&&e[h.slot]?e[h.slot].push(h):n.push(h)}}),this._mergedOrder=[];const a=(l=[])=>{for(const c of l)if("slot"===c.type){const h=vf(c.id);e[h]&&a(e[h])}else{const h=gr(c.id,c.scope);this._mergedOrder.push(h),i[h]=c,c.is3D()&&(this._has3DLayers=!0),"circle"===c.type&&(this._hasCircleLayers=!0),"symbol"===c.type&&(this._hasSymbolLayers=!0)}};a(n),this._mergedLayers=i,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(e){return this.stylesheet.camera=Ke({},this.stylesheet.camera,e),this.camera=this.stylesheet.camera,this}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(e){this._spriteRequest=function(n,i,a){let l,c,h;const f=Ct.devicePixelRatio>1?"@2x":"";let p=Me(i.transformRequest(i.normalizeSpriteURL(n,f,".json"),_e.SpriteJSON),(y,v)=>{p=null,h||(h=y,l=v,_())}),g=vt(i.transformRequest(i.normalizeSpriteURL(n,f,".png"),_e.SpriteImage),(y,v)=>{g=null,h||(h=y,c=v,_())});function _(){if(h)a(h);else if(l&&c){const y=Ct.getImageData(c),v={};for(const w in l){const{width:E,height:T,x:C,y:S,sdf:I,pixelRatio:R,stretchX:A,stretchY:k,content:L}=l[w],B=new Sr({width:E,height:T});Sr.copy(y,B,{x:C,y:S},{x:0,y:0},{width:E,height:T}),v[w]={data:B,pixelRatio:R,sdf:I,stretchX:A,stretchY:k,content:L}}a(null,v)}}return{cancel(){p&&(p.cancel(),p=null),g&&(g.cancel(),g=null)}}}(e,this.map._requestManager,(n,i)=>{if(this._spriteRequest=null,n)this.fire(new xt(n));else if(i)for(const a in i)this.imageManager.addImage(a,this.scope,i[a]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new Se("data",{dataType:"style"}))})}_validateLayer(e){const n=this.getOwnSource(e.source);if(!n)return;const i=e.sourceLayer;i&&("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(i))&&this.fire(new xt(new Error(`Source layer "${i}" does not exist on source "${n.id}" as specified by style layer "${e.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.updatedSourceCaches).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:e}of this.fragments)if(!e.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((e,n)=>{const i=this.fragments[n];return i&&i.style&&(e.data=i.style.serialize()),e})}_serializeSources(){const e={};for(const n in this._sourceCaches){const i=this._sourceCaches[n].getSource();e[i.id]||(e[i.id]=i.serialize())}return e}_serializeLayers(e){const n=[];for(const i of e){const a=this._layers[i];a&&"custom"!==a.type&&n.push(a.serialize())}return n}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(e){return!!this.terrain&&("function"==typeof e.isLayerDraped?e.isLayerDraped(this.getLayerSourceCache(e)):cS.has(e.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(e){const n=this.getOwnLayer(e);if(n)return n;this.fire(new xt(new Error(`The layer '${e}' does not exist in the map's style.`)))}_checkSource(e){const n=this.getOwnSource(e);if(n)return n;this.fire(new xt(new Error(`The source '${e}' does not exist in the map's style.`)))}update(e){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(e),this.directionalLight&&this.directionalLight.recalculate(e);const n=this.calculateLightsBrightness();e.brightness=n||0,n!==this._brightness&&(this._brightness=n,this.dispatcher.broadcast("setBrightness",n));const i=this._changes.changed;if(this._changes.changed){const l=this._changes.getLayerUpdatesByScope();for(const c in l){const{updatedIds:h,removedIds:f}=l[c];(h||f)&&this._updateWorkerLayers(c,h,f)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(e),this.light&&this.light.updateTransitions(e),this.ambientLight&&this.ambientLight.updateTransitions(e),this.directionalLight&&this.directionalLight.updateTransitions(e),this.fog&&this.fog.updateTransitions(e),this._changes.reset()}const a={};for(const l in this._mergedSourceCaches){const c=this._mergedSourceCaches[l];a[l]=c.used,c.used=!1}for(const l of this._mergedOrder){const c=this._mergedLayers[l];if(c.recalculate(e,this._availableImages),!c.isHidden(e.zoom)){const h=this.getOwnLayerSourceCache(c);h&&(h.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let h=c.minzoom||0;h<(c.maxzoom||25.5);h++){const f=this.map.painter;if(f){const p=c.getProgramIds();if(!p)continue;for(const g of p){const _=c.getDefaultProgramParams(g,e.zoom);_&&(f.style=this,this.fog&&(f._fogVisible=!0,_.overrideFog=!0,f.getOrCreateProgram(g,_)),f._fogVisible=!1,_.overrideFog=!1,f.getOrCreateProgram(g,_),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(_.overrideRtt=!0,f.getOrCreateProgram(g,_)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const l in a){const c=this._mergedSourceCaches[l];a[l]!==c.used&&c.getSource().fire(new Se("data",{sourceDataType:"visibility",dataType:"source",sourceId:c.getSource().id}))}this.light&&this.light.recalculate(e),this.terrain&&this.terrain.recalculate(e),this.fog&&this.fog.recalculate(e),this.z=e.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),i&&this.fire(new Se("data",{dataType:"style"}));for(const{style:l}of this.fragments)l.update(e)}_updateTilesForChangedImages(){const e=Array.from(this._changes.changedImages.keys());if(e.length){for(const n in this._sourceCaches)this._sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],e);this._changes.changedImages.clear()}}_updateWorkerLayers(e,n,i){const a=this.getFragmentStyle(e);this.dispatcher.broadcast("updateLayers",{layers:n?a._serializeLayers(n):[],scope:e,removedIds:i||[],options:a.options})}setState(e){if(this._checkLoaded(),Kl(this,mc(e)))return!1;(e=q(e)).layers=_2(e.layers);const n=function(a,l){if(!a)return[{command:yn.setStyle,args:[l]}];let c=[];try{if(!ln(a.version,l.version))return[{command:yn.setStyle,args:[l]}];ln(a.center,l.center)||c.push({command:yn.setCenter,args:[l.center]}),ln(a.zoom,l.zoom)||c.push({command:yn.setZoom,args:[l.zoom]}),ln(a.bearing,l.bearing)||c.push({command:yn.setBearing,args:[l.bearing]}),ln(a.pitch,l.pitch)||c.push({command:yn.setPitch,args:[l.pitch]}),ln(a.sprite,l.sprite)||c.push({command:yn.setSprite,args:[l.sprite]}),ln(a.glyphs,l.glyphs)||c.push({command:yn.setGlyphs,args:[l.glyphs]}),ln(a.transition,l.transition)||c.push({command:yn.setTransition,args:[l.transition]}),ln(a.light,l.light)||c.push({command:yn.setLight,args:[l.light]}),ln(a.fog,l.fog)||c.push({command:yn.setFog,args:[l.fog]}),ln(a.projection,l.projection)||c.push({command:yn.setProjection,args:[l.projection]}),ln(a.lights,l.lights)||c.push({command:yn.setLights,args:[l.lights]}),ln(a.camera,l.camera)||c.push({command:yn.setCamera,args:[l.camera]});const h={},f=[];!function(_,y,v,w){let E;for(E in y=y||{},_=_||{})_.hasOwnProperty(E)&&(y.hasOwnProperty(E)||md(E,v,w));for(E in y){if(!y.hasOwnProperty(E))continue;const T=y[E];_.hasOwnProperty(E)?ln(_[E],T)||("geojson"===_[E].type&&"geojson"===T.type&&W0(_,y,E)?v.push({command:yn.setGeoJSONSourceData,args:[E,T.data]}):y2(E,y,v,w)):q0(E,y,v)}}(a.sources,l.sources,f,h);const p=[];a.layers&&a.layers.forEach(_=>{_.source&&h[_.source]?c.push({command:yn.removeLayer,args:[_.id]}):p.push(_)});let g=a.terrain;g&&h[g.source]&&(c.push({command:yn.setTerrain,args:[void 0]}),g=void 0),c=c.concat(f),ln(g,l.terrain)||c.push({command:yn.setTerrain,args:[l.terrain]}),function(_,y,v){y=y||[];const w=(_=_||[]).map(_p),E=y.map(_p),T=_.reduce(t_,{}),C=y.reduce(t_,{}),S=w.slice(),I=Object.create(null);let R,A,k,L,B,j,U;for(R=0,A=0;R<w.length;R++)k=w[R],C.hasOwnProperty(k)?A++:(v.push({command:yn.removeLayer,args:[k]}),S.splice(S.indexOf(k,A),1));for(R=0,A=0;R<E.length;R++)k=E[E.length-1-R],S[S.length-1-R]!==k&&(T.hasOwnProperty(k)?(v.push({command:yn.removeLayer,args:[k]}),S.splice(S.lastIndexOf(k,S.length-A),1)):A++,j=S[S.length-R],v.push({command:yn.addLayer,args:[C[k],j]}),S.splice(S.length-R,0,k),I[k]=!0);for(R=0;R<E.length;R++)if(k=E[R],L=T[k],B=C[k],!I[k]&&!ln(L,B))if(ln(L.source,B.source)&&ln(L["source-layer"],B["source-layer"])&&ln(L.type,B.type)){for(U in e_(L.layout,B.layout,v,k,null,yn.setLayoutProperty),e_(L.paint,B.paint,v,k,null,yn.setPaintProperty),ln(L.slot,B.slot)||v.push({command:yn.setSlot,args:[k,B.slot]}),ln(L.filter,B.filter)||v.push({command:yn.setFilter,args:[k,B.filter]}),ln(L.minzoom,B.minzoom)&&ln(L.maxzoom,B.maxzoom)||v.push({command:yn.setLayerZoomRange,args:[k,B.minzoom,B.maxzoom]}),L)L.hasOwnProperty(U)&&"layout"!==U&&"paint"!==U&&"filter"!==U&&"metadata"!==U&&"minzoom"!==U&&"maxzoom"!==U&&"slot"!==U&&(0===U.indexOf("paint.")?e_(L[U],B[U],v,k,U.slice(6),yn.setPaintProperty):ln(L[U],B[U])||v.push({command:yn.setLayerProperty,args:[k,U,B[U]]}));for(U in B)B.hasOwnProperty(U)&&!L.hasOwnProperty(U)&&"layout"!==U&&"paint"!==U&&"filter"!==U&&"metadata"!==U&&"minzoom"!==U&&"maxzoom"!==U&&"slot"!==U&&(0===U.indexOf("paint.")?e_(L[U],B[U],v,k,U.slice(6),yn.setPaintProperty):ln(L[U],B[U])||v.push({command:yn.setLayerProperty,args:[k,U,B[U]]}))}else v.push({command:yn.removeLayer,args:[k]}),j=S[S.lastIndexOf(k)+1],v.push({command:yn.addLayer,args:[B,j]})}(p,l.layers,c),function(_=[],y=[],v){y=y||[];const w=(_=_||[]).map(_p),E=y.map(_p),T=_.reduce(t_,{}),C=y.reduce(t_,{}),S=w.slice();let I,R,A,k;for(I=0,R=0;I<w.length;I++)A=w[I],C.hasOwnProperty(A)?R++:(v.push({command:yn.removeImport,args:[A]}),S.splice(S.indexOf(A,R),1));for(I=0,R=0;I<E.length;I++)A=E[E.length-1-I],S[S.length-1-I]!==A&&(T.hasOwnProperty(A)?(v.push({command:yn.removeImport,args:[A]}),S.splice(S.lastIndexOf(A,S.length-R),1)):R++,k=S[S.length-I],v.push({command:yn.addImport,args:[C[A],k]}),S.splice(S.length-I,0,A));for(const L of y){const B=T[L.id];if(!B||ln(B,L))continue;ln(B.config,L.config)||v.push({command:yn.setImportConfig,args:[L.id,L.config]}),ln(B.url,L.url)||v.push({command:yn.setImportUrl,args:[L.id,L.url]});const j=L.data;ln(B&&B.data,j)||v.push({command:yn.setImportData,args:[L.id,j]})}}(a.imports,l.imports,c)}catch(h){console.warn("Unable to compute style diff:",h),c=[{command:yn.setStyle,args:[l]}]}return c}(this.serialize(),e).filter(a=>!(a.command in sS));if(0===n.length)return!1;const i=n.filter(a=>!(a.command in oS));if(i.length>0)throw new Error(`Unimplemented: ${i.map(a=>a.command).join(", ")}.`);return n.forEach(a=>{this[a.command].apply(this,a.args)}),this.stylesheet=e,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(e,n){return this.getImage(e)?this.fire(new xt(new Error("An image with this name already exists."))):(this.imageManager.addImage(e,this.scope,n),this._afterImageUpdated(e),this)}updateImage(e,n){this.imageManager.updateImage(e,this.scope,n)}getImage(e){return this.imageManager.getImage(e,this.scope)}removeImage(e){return this.getImage(e)?(this.imageManager.removeImage(e,this.scope),this._afterImageUpdated(e),this):this.fire(new xt(new Error("No image with this name exists.")))}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(this.scope),this._changes.changedImages.add(e),this._changes.changed=!0,this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new Se("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(e,n,i={}){return this._checkLoaded(),this._validate(dm,`models.${e}`,n,null,i)||(this.modelManager.addModel(e,n,this.scope),this._changes.changed=!0),this}hasModel(e){return this.modelManager.hasModel(e,this.scope)}removeModel(e){return this.hasModel(e)?(this.modelManager.removeModel(e,this.scope),this):this.fire(new xt(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(e,n,i={}){if(this._checkLoaded(),void 0!==this.getOwnSource(e))throw new Error(`There is already a source with ID "${e}".`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(ey,`sources.${e}`,n,null,i))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const a=G0(e,n,this.dispatcher,this);a.scope=this.scope,a.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(a.id),source:a.serialize(),sourceId:a.id}));const l=c=>{const h=(c?"symbol:":"other:")+a.id,f=gr(h,this.scope),p=this._sourceCaches[h]=new Bs(f,a,c);(c?this._symbolSourceCaches:this._otherSourceCaches)[a.id]=p,p.onAdd(this.map)};l(!1),"vector"!==n.type&&"geojson"!==n.type||l(!0),a.onAdd&&a.onAdd(this.map),this.mergeSources(),this._changes.changed=!0}removeSource(e){this._checkLoaded();const n=this.getOwnSource(e);if(!n)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===e)return this.fire(new xt(new Error(`Source "${e}" cannot be removed while layer "${a}" is using it.`)));if(this.terrain&&this.terrain.get().source===e)return this.fire(new xt(new Error(`Source "${e}" cannot be removed while terrain is using it.`)));const i=this.getOwnSourceCaches(e);for(const a of i){const l=vf(a.id);delete this._sourceCaches[l],delete this._changes.updatedSourceCaches[a.id],a.fire(new Se("data",{sourceDataType:"metadata",dataType:"source",sourceId:a.getSource().id})),a.setEventedParent(null),a.clearTiles()}return delete this._otherSourceCaches[e],delete this._symbolSourceCaches[e],this.mergeSources(),n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changes.changed=!0,this}setGeoJSONSourceData(e,n){this._checkLoaded(),this.getOwnSource(e).setData(n),this._changes.changed=!0}getOwnSource(e){const n=this.getOwnSourceCache(e);return n&&n.getSource()}getOwnSources(){const e=[];for(const n in this._otherSourceCaches){const i=this.getOwnSourceCache(n);i&&e.push(i.getSource())}return e}setLights(e){if(this._checkLoaded(),!e)return delete this.ambientLight,void delete this.directionalLight;const n=this._getTransitionParameters();for(const a of e){if(this._validate(um,"lights",a))return;switch(a.type){case"ambient":if(this.ambientLight){const l=this.ambientLight;l.set(a),l.updateTransitions(n)}else this.ambientLight=new rC(a,l2,this.scope,this.options);break;case"directional":if(this.directionalLight){const l=this.directionalLight;l.set(a),l.updateTransitions(n)}else this.directionalLight=new rC(a,c2,this.scope,this.options)}}const i=new pr(this.z||0,n);this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const e=this.directionalLight,n=this.ambientLight;if(!e||!n)return;const i=_=>.2126*(_[0]<=.03928?_[0]/12.92:Math.pow((_[0]+.055)/1.055,2.4))+.7152*(_[1]<=.03928?_[1]/12.92:Math.pow((_[1]+.055)/1.055,2.4))+.0722*(_[2]<=.03928?_[2]/12.92:Math.pow((_[2]+.055)/1.055,2.4)),a=e.properties.get("color").toArray01(),l=e.properties.get("intensity"),c=e.properties.get("direction"),h=1-tt(c.x,c.y,c.z)[2]/90,f=i(a)*l*h,p=n.properties.get("color").toArray01(),g=n.properties.get("intensity");return(f+i(p)*g)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const e=[];return this.directionalLight&&e.push(this.directionalLight.get()),this.ambientLight&&e.push(this.ambientLight.get()),e}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(e){if(!e)return this;const n=this.fragments.find(({id:i})=>i===e);if(!n)throw new Error(`Style import not found: ${e}`);return n.style}setConfigProperty(e,n,i){const a=fc(i);if("success"!==a.result)return void Kl(this,a.value);const l=a.value.expression,c=this.getFragmentStyle(e);c.options.set(n,l),c.updateConfigDependencies()}setConfig(e,n){if(this.options.clear(),e){for(const i in e){const a=fc(e[i]);"success"===a.result&&this.options.set(i,a.value.expression)}this.updateSchema(n)}}updateSchema(e){if(e)for(const n in e){if(this.options.has(n))continue;const i=fc(e[n].default);"success"===i.result&&this.options.set(n,i.value.expression)}}updateConfigDependencies(){for(const e of this._configDependentLayers){const n=this.getLayer(e);n&&(n.possiblyEvaluateVisibility(),this._updateLayer(n))}this.ambientLight&&this.ambientLight.scope===this.scope&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.scope===this.scope&&this.directionalLight.updateConfig(this.options),this._changes.changed=!0}addLayer(e,n,i={}){this._checkLoaded();const a=e.id;if(this._layers[a])return void this.fire(new xt(new Error(`Layer with id "${a}" already exists on this map`)));let l;if("custom"===e.type){if(Kl(this,function(g){const _=[],y=g.id;return void 0===y&&_.push({message:`layers.${y}: missing required property "id"`}),void 0===g.render&&_.push({message:`layers.${y}: missing required method "render"`}),g.renderingMode&&"2d"!==g.renderingMode&&"3d"!==g.renderingMode&&_.push({message:`layers.${y}: property "renderingMode" must be either "2d" or "3d"`}),_}(e)))return;l=up(e,this.options)}else{if("object"==typeof e.source&&(this.addSource(a,e.source),e=Ke(e=q(e),{source:a})),this._validate(T1,`layers.${a}`,e,{arrayIndex:-1},i))return;l=up(e,this.options),this._validateLayer(l),l.setEventedParent(this,{layer:{id:a}}),this._serializedLayers[l.id]=l.serialize()}l.isConfigDependent&&this._configDependentLayers.add(l.fqid),l.setScope(this.scope);const c=n?this._order.indexOf(n):this._order.length;if(n&&-1===c)return void this.fire(new xt(new Error(`Layer with id "${n}" does not exist on this map.`)));this._order.splice(c,0,a),this._layerOrderChanged=!0,this._layers[a]=l;const h=this.getOwnLayerSourceCache(l),f=!!this.directionalLight&&this.directionalLight.shadowsEnabled();h&&l.canCastShadows()&&f&&(h.castsShadows=!0);const p=this._changes.getRemovedLayer(l);if(p&&l.source&&h&&"custom"!==l.type){this._changes.discardLayerRemoval(l);const g=gr(l.source,l.scope);p.type!==l.type?this._changes.updatedSourceCaches[g]="clear":(this._changes.updatedSourceCaches[g]="reload",h.pause())}this._updateLayer(l),l.onAdd&&l.onAdd(this.map),l.scope=this.scope,this.mergeLayers()}moveLayer(e,n){if(this._checkLoaded(),this._changes.changed=!0,!this._checkLayer(e)||e===n)return;const i=this._order.indexOf(e);this._order.splice(i,1);const a=n?this._order.indexOf(n):this._order.length;n&&-1===a?this.fire(new xt(new Error(`Layer with id "${n}" does not exist on this map.`))):(this._order.splice(a,0,e),this._layerOrderChanged=!0,this.mergeLayers())}removeLayer(e){this._checkLoaded();const n=this._checkLayer(e);if(!n)return;n.setEventedParent(null);const i=this._order.indexOf(e);this._order.splice(i,1),delete this._layers[e],delete this._serializedLayers[e],this._changes.changed=!0,this._layerOrderChanged=!0,this._configDependentLayers.delete(n.fqid),this._changes.removeLayer(n);const a=this.getOwnLayerSourceCache(n);if(a&&a.castsShadows){let l=!1;for(const c in this._layers)if(this._layers[c].source===n.source&&this._layers[c].canCastShadows()){l=!0;break}a.castsShadows=l}n.onRemove&&n.onRemove(this.map),this.mergeLayers()}getOwnLayer(e){return this._layers[e]}hasLayer(e){return e in this._mergedLayers}hasLayerType(e){for(const n in this._layers)if(this._layers[n].type===e)return!0;return!1}setLayerZoomRange(e,n,i){this._checkLoaded();const a=this._checkLayer(e);a&&(a.minzoom===n&&a.maxzoom===i||(null!=n&&(a.minzoom=n),null!=i&&(a.maxzoom=i),this._updateLayer(a)))}setSlot(e,n){this._checkLoaded();const i=this._checkLayer(e);i&&i.slot!==n&&(i.slot=n,this._updateLayer(i))}setFilter(e,n,i={}){this._checkLoaded();const a=this._checkLayer(e);if(a&&!ln(a.filter,n))return null==n?(a.filter=void 0,void this._updateLayer(a)):void(this._validate(hm,`layers.${a.id}.filter`,n,{layerType:a.type},i)||(a.filter=q(n),this._updateLayer(a)))}getFilter(e){const n=this._checkLayer(e);if(n)return q(n.filter)}setLayoutProperty(e,n,i,a={}){this._checkLoaded();const l=this._checkLayer(e);l&&(ln(l.getLayoutProperty(n),i)||(l.setLayoutProperty(n,i,a),l.isConfigDependent&&this._configDependentLayers.add(l.fqid),this._updateLayer(l)))}getLayoutProperty(e,n){const i=this._checkLayer(e);if(i)return i.getLayoutProperty(n)}setPaintProperty(e,n,i,a={}){this._checkLoaded();const l=this._checkLayer(e);if(!l||ln(l.getPaintProperty(n),i))return;const c=l.setPaintProperty(n,i,a);l.isConfigDependent&&this._configDependentLayers.add(l.fqid),c&&this._updateLayer(l),this._changes.changed=!0,this._changes.updatedPaintProps.add(l.fqid)}getPaintProperty(e,n){const i=this._checkLayer(e);if(i)return i.getPaintProperty(n)}setFeatureState(e,n){this._checkLoaded();const i=e.source,a=e.sourceLayer,l=this._checkSource(i);if(!l)return;const c=l.type;if("geojson"===c&&a)return void this.fire(new xt(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===c&&!a)return void this.fire(new xt(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===e.id&&this.fire(new xt(new Error("The feature id parameter must be provided.")));const h=this.getOwnSourceCaches(i);for(const f of h)f.setFeatureState(a,e.id,n)}removeFeatureState(e,n){this._checkLoaded();const i=e.source,a=this._checkSource(i);if(!a)return;const l=a.type,c="vector"===l?e.sourceLayer:void 0;if("vector"===l&&!c)return void this.fire(new xt(new Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&"string"!=typeof e.id&&"number"!=typeof e.id)return void this.fire(new xt(new Error("A feature id is required to remove its specific state property.")));const h=this.getOwnSourceCaches(i);for(const f of h)f.removeFeatureState(c,e.id,n)}getFeatureState(e){this._checkLoaded();const n=e.source,i=e.sourceLayer,a=this._checkSource(n);if(a){if("vector"!==a.type||i)return void 0===e.id&&this.fire(new xt(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(n)[0].getFeatureState(i,e.id);this.fire(new xt(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(e){return this.stylesheet.transition=Ke({},this.stylesheet.transition,e),this.transition=this.stylesheet.transition,this}getTransition(){return Ke({},this.stylesheet.transition)}serialize(){this._checkLoaded();const e=this.getTerrain(),n=e&&this.terrain&&this.terrain.scope===this.scope?e:void 0;return ke({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:n,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},i=>void 0!==i)}_updateLayer(e){this._changes.updateLayer(e);const n=this.getLayerSourceCache(e),i=gr(e.source,e.scope);e.source&&!this._changes.updatedSourceCaches[i]&&n&&"raster"!==n.getSource().type&&(this._changes.updatedSourceCaches[i]="reload",n.pause()),this._changes.changed=!0,e.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){const n=h=>"fill-extrusion"===this._mergedLayers[h].type,i=this.order,a={},l=[];for(let h=i.length-1;h>=0;h--){const f=i[h];if(n(f)){a[f]=h;for(const p of e){const g=p[f];if(g)for(const _ of g)l.push(_)}}}l.sort((h,f)=>f.intersectionZ-h.intersectionZ);const c=[];for(let h=i.length-1;h>=0;h--){const f=i[h];if(n(f))for(let p=l.length-1;p>=0;p--){const g=l[p].feature;if(a[g.layer.id]<h)break;c.push(g),l.pop()}else for(const p of e){const g=p[f];if(g)for(const _ of g)c.push(_.feature)}}return c}queryRenderedFeatures(e,n,i){n&&n.filter&&this._validate(hm,"queryRenderedFeatures.filter",n.filter,null,n),n.scope=this.scope,n.availableImages=this._availableImages,n.serializedLayers=this._serializedLayers;const a={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new xt(new Error("parameters.layers must be an Array."))),[];for(const p of n.layers){const g=this._mergedLayers[p];if(!g)return this.fire(new xt(new Error(`The layer '${p}' does not exist in the map's style and cannot be queried for features.`))),[];a[g.source]=!0}}const l=[],c=n.serializedLayers||{},h=n&&n.layers?n.layers.some(p=>{const g=this.getLayer(p);return g&&g.is3D()}):this.has3DLayers(),f=R0.createFromScreenPoints(e,i);for(const p in this._mergedSourceCaches){const g=this._mergedSourceCaches[p].getSource();if(!g||g.scope!==n.scope)continue;const _=this._mergedSourceCaches[p].getSource().id;n.layers&&!a[_]||l.push(m2(this._mergedSourceCaches[p],this._mergedLayers,c,f,n,i,h,!!this.map._showQueryGeometry))}return this.placement&&l.push(function(p,g,_,y,v,w,E){const T={},C=w.queryRenderedSymbols(y),S=[];for(const I of Object.keys(C).map(Number))S.push(E[I]);S.sort(ju);for(const I of S){const R=I.featureIndex.lookupSymbolFeatures(C[I.bucketInstanceId],g,I.bucketIndex,I.sourceLayerIndex,v.filter,v.layers,v.availableImages,p);for(const A in R){const k=T[A]=T[A]||[],L=R[A];L.sort((B,j)=>{const U=I.featureSortOrder;if(U){const G=U.indexOf(B.featureIndex);return U.indexOf(j.featureIndex)-G}return j.featureIndex-B.featureIndex});for(const B of L)k.push(B)}}for(const I in T)T[I].forEach(R=>{const A=R.feature,k=_(p[I]);if(!k)return;const L=k.getFeatureState(A.layer["source-layer"],A.id);A.source=A.layer.source,A.layer["source-layer"]&&(A.sourceLayer=A.layer["source-layer"]),A.state=L});return T}(this._mergedLayers,c,this.getLayerSourceCache.bind(this),f.screenGeometry,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(l)}querySourceFeatures(e,n){n&&n.filter&&this._validate(hm,"querySourceFeatures.filter",n.filter,null,n);const i=this.getOwnSourceCaches(e);let a=[];for(const l of i)a=a.concat(Oo(l,n));return a}addSourceType(e,n,i){return Ca.getSourceType(e)?i(new Error(`A source type called "${e}" already exists.`)):(Ca.setSourceType(e,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:n.workerSourceURL},i):i(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(e,n,i={}){this._checkLoaded();const a=this.light.getLight();let l=!1;for(const h in e)if(!ln(e[h],a[h])){l=!0;break}if(!l)return;const c=this._getTransitionParameters();this.light.setLight(e,n,i),this.light.updateTransitions(c)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(e,n=1){if(this._checkLoaded(),!e)return delete this.terrain,delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let i=e;if(1===n){if("object"==typeof i.source){const a="terrain-dem-src";this.addSource(a,i.source),i=q(i),i=Ke(i,{source:a})}if(this._validate(uD,"terrain",i))return}if(!this.terrain||this.terrain&&n!==this.terrain.drapeRenderMode){if(!i)return;this._createTerrain(i,n),this.fire(new Se("data",{dataType:"style"}))}else{const a=this.terrain,l=a.get();for(const c of Object.keys(le.terrain))!i.hasOwnProperty(c)&&le.terrain[c].default&&(i[c]=le.terrain[c].default);for(const c in e)if(!ln(e[c],l[c])){a.set(e),this.stylesheet.terrain=e;const h=this._getTransitionParameters({duration:0});a.updateTransitions(h),this.fire(new Se("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){const n=this.fog=new o2(e,this.map.transform);this.stylesheet.fog=n.get();const i=this._getTransitionParameters({duration:0});n.updateTransitions(i)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const e of this.map._markers)e._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const n=this.fog;if(!ln(n.get(),e)){n.set(e),this.stylesheet.fog=n.get();const i=this._getTransitionParameters({duration:0});n.updateTransitions(i)}}else this._createFog(e);this._markersNeedUpdate=!0}_getTransitionParameters(e){return{now:Ct.now(),transition:Ke(this.transition,e)}}updateDrapeFirstLayers(){if(!this.terrain)return;const e=[],n=[];for(const i in this._mergedLayers)this.isLayerDraped(this._mergedLayers[i])?e.push(i):n.push(i);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...n)}_createTerrain(e,n){const i=this.terrain=new DI(e,n);i.setScope(this.scope),this.stylesheet.terrain=e,this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const a=this._getTransitionParameters({duration:0});i.updateTransitions(a)}_force3DLayerUpdate(){for(const e in this._layers){const n=this._layers[e];"fill-extrusion"===n.type&&this._updateLayer(n)}}_forceSymbolLayerUpdate(){for(const e in this._layers){const n=this._layers[e];"symbol"===n.type&&this._updateLayer(n)}}_validate(e,n,i,a,l={}){if(l&&!1===l.validate)return!1;const c=Ke({},this.serialize());return Kl(this,e.call(mc,Ke({key:n,style:c,value:i,styleSpec:le},a)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),F1.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._mergedLayers)this._mergedLayers[e].setEventedParent(null);for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles(),this._mergedSourceCaches[e].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(e){const n=this.getSourceCaches(e);for(const i of n)i.clearTiles()}clearSources(){for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles()}reloadSource(e){const n=this.getSourceCaches(e);for(const i of n)i.resume(),i.reload()}updateSources(e){let n;this.directionalLight&&(n=_x(this.directionalLight));for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].update(e,void 0,void 0,n)}_generateCollisionBoxes(){for(const e in this._sourceCaches){const n=this._sourceCaches[e];n.resume(),n.reload()}}_updatePlacement(e,n,i,a,l=!1){let c=!1,h=!1;const f={},p={};for(const g of this._mergedOrder){const _=this._mergedLayers[g];if("symbol"!==_.type)continue;const y=gr(_.source,_.scope);let v=f[y];if(!v){const E=this.getLayerSourceCache(_);if(!E)continue;const T=E.getRenderableIds(!0).map(C=>E.getTileByID(C));p[y]=T.slice(),v=f[y]=T.sort((C,S)=>S.tileID.overscaledZ-C.tileID.overscaledZ||(C.tileID.isLessThan(S.tileID)?-1:1))}const w=this.crossTileSymbolIndex.addLayer(_,v,e.center.lng,e.projection);c=c||w}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),l=l||this._layerOrderChanged||0===i,this._layerOrderChanged&&this.fire(new Se("neworder")),(l||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Ct.now(),e.zoom))&&(this.pauseablePlacement=new M2(e,this._mergedOrder,l,n,i,a,this.placement,this.fog&&e.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,f,p),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Ct.now()),h=!0),c&&this.pauseablePlacement.placement.setStale()),h||c)for(const g of this._mergedOrder){const _=this._mergedLayers[g];"symbol"===_.type&&this.placement.updateLayerOpacities(_,f[gr(_.source,_.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Ct.now())}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}addImport(e){this._checkLoaded();const n=this.stylesheet.imports=this.stylesheet.imports||[];return-1!==n.findIndex(({id:a})=>a===e.id)?this.fire(new xt(new Error(`Import with id '${e.id}' already exists in the map's style.`))):(n.push(e),this._loadImports([e],!0),this)}setImportUrl(e,n){this._checkLoaded();const i=this.stylesheet.imports||[],a=this.getImportIndex(e);if(-1===a)return this;i[a].url=n;const l=this.fragments[a];l.style=this._createFragmentStyle({id:e,url:n});const c=new Promise(h=>l.style.on("style.import.load",h));return l.style.loadURL(n),c.then(()=>this._reloadImports()),this}setImportData(e,n){this._checkLoaded();const i=this.getImportIndex(e),a=this.stylesheet.imports||[];return-1===i?this:n?(this.fragments[i].style.setState(n),this._reloadImports(),this):(delete a[i].data,this.setImportUrl(e,a[i].url))}setImportConfig(e,n){this._checkLoaded();const i=this.getImportIndex(e),a=this.stylesheet.imports||[];if(-1===i)return this;n?a[i].config=n:delete a[i].config;const l=this.fragments[i],c=l.style.stylesheet&&l.style.stylesheet.schema;return l.config=n,l.style.setConfig(n,c),l.style.updateConfigDependencies(),this}removeImport(e){this._checkLoaded();const n=this.stylesheet.imports||[],i=this.getImportIndex(e);return-1===i||(n.splice(i,1),this.fragments[i].style._remove(),this.fragments.splice(i,1),this._reloadImports()),this}getImportIndex(e){const n=(this.stylesheet.imports||[]).findIndex(i=>i.id===e);return-1===n&&this.fire(new xt(new Error(`Import '${e}' does not exist in the map's style and cannot be updated.`))),n}getLayer(e){return this._mergedLayers[e]}getSources(){const e=[];for(const n in this._mergedOtherSourceCaches){const i=this._mergedOtherSourceCaches[n];i&&e.push(i.getSource())}return e}getSource(e,n){const i=this.getSourceCache(e,n);return i&&i.getSource()}getLayerSource(e){const n=this.getLayerSourceCache(e);return n&&n.getSource()}getSourceCache(e,n){const i=gr(e,n);return this._mergedOtherSourceCaches[i]}getLayerSourceCache(e){const n=gr(e.source,e.scope);return"symbol"===e.type?this._mergedSymbolSourceCaches[n]:this._mergedOtherSourceCaches[n]}getSourceCaches(e){const n=[];return this._mergedOtherSourceCaches[e]&&n.push(this._mergedOtherSourceCaches[e]),this._mergedSymbolSourceCaches[e]&&n.push(this._mergedSymbolSourceCaches[e]),n}updateSourceCaches(){for(const e in this._changes.updatedSourceCaches){const n=this._changes.updatedSourceCaches[e];"reload"===n?this.reloadSource(e):"clear"===n&&this.clearSource(e)}}updateLayers(e){for(const n of this._changes.updatedPaintProps){const i=this.getLayer(n);i&&i.updateTransitions(e)}}getImages(e,n,i){this.imageManager.getImages(n.icons,n.scope,i),this._updateTilesForChangedImages();const a=l=>{l&&l.setDependencies(n.tileID.key,n.type,n.icons)};a(this._otherSourceCaches[n.source]),a(this._symbolSourceCaches[n.source])}getGlyphs(e,n,i){this.glyphManager.getGlyphs(n.stacks,n.scope,i)}getResource(e,n,i){return Fe(n,i)}getOwnSourceCache(e){return this._otherSourceCaches[e]}getOwnLayerSourceCache(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}getOwnSourceCaches(e){const n=[];return this._otherSourceCaches[e]&&n.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&n.push(this._symbolSourceCaches[e]),n}_isSourceCacheLoaded(e){const n=this.getOwnSourceCaches(e);return 0===n.length?(this.fire(new xt(new Error(`There is no source with ID '${e}'`))),!1):n.every(i=>i.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function al(t,e){let n=!1,i=null;const a=()=>{i=null,n&&(t(),i=setTimeout(a,e),n=!1)};return()=>(n=!0,i||a(),i)}Ca.getSourceType=function(t){return Qg[t]},Ca.setSourceType=function(t,e){Qg[t]=e},Ca.registerForPluginStateChange=function(t){return t({pluginStatus:hs,pluginURL:fu}),F1.on("pluginStateChange",t),t};class GI{constructor(e){this._hashName=e&&encodeURIComponent(e),Xr(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=al(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,ce.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),ce.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const e=this._map;if(!e)return"";const n=uS(e);if(this._hashName){const i=this._hashName;let a=!1;const l=ce.location.hash.slice(1).split("&").map(c=>{const h=c.split("=")[0];return h===i?(a=!0,`${h}=${n}`):c}).filter(c=>c);return a||l.push(`${i}=${n}`),`#${l.join("&")}`}return`#${n}`}_getCurrentHash(){const e=ce.location.hash.replace("#","");if(this._hashName){let n;return e.split("&").map(i=>i.split("=")).forEach(i=>{i[0]===this._hashName&&(n=i)}),(n&&n[1]||"").split("/")}return e.split("/")}_onHashChange(){const e=this._map;if(!e)return!1;const n=this._getCurrentHash();if(n.length>=3&&!n.some(i=>isNaN(i))){const i=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(n[3]||0):e.getBearing();return e.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:i,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){const e=ce.location.href.replace(/(#.+)?$/,this.getHashString());ce.history.replaceState(ce.history.state,null,e)}}function uS(t,e){const n=t.getCenter(),i=Math.round(100*t.getZoom())/100,a=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),l=Math.pow(10,a),c=Math.round(n.lng*l)/l,h=Math.round(n.lat*l)/l,f=t.getBearing(),p=t.getPitch();let g=e?`/${c}/${h}/${i}`:`${i}/${h}/${c}`;return(f||p)&&(g+="/"+Math.round(10*f)/10),p&&(g+=`/${Math.round(p)}`),g}const yx={linearity:.3,easing:Ia(0,0,.3,1)},qI=Ke({deceleration:2500,maxSpeed:1400},yx),WI=Ke({deceleration:20,maxSpeed:1400},yx),hS=Ke({deceleration:1e3,maxSpeed:360},yx),ZI=Ke({deceleration:1e3,maxSpeed:90},yx);class XI{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Ct.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,n=Ct.now();for(;e.length>0&&n-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const n={zoom:0,bearing:0,pitch:0,pan:new ie(0,0),pinchAround:void 0,around:void 0};for(const{settings:l}of this._inertiaBuffer)n.zoom+=l.zoomDelta||0,n.bearing+=l.bearingDelta||0,n.pitch+=l.pitchDelta||0,l.panDelta&&n.pan._add(l.panDelta),l.around&&(n.around=l.around),l.pinchAround&&(n.pinchAround=l.pinchAround);const i=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,a={};if(n.pan.mag()){const l=xx(n.pan.mag(),i,Ke({},qI,e||{}));a.offset=n.pan.mult(l.amount/n.pan.mag()),a.center=this._map.transform.center,vx(a,l)}if(n.zoom){const l=xx(n.zoom,i,WI);a.zoom=this._map.transform.zoom+l.amount,vx(a,l)}if(n.bearing){const l=xx(n.bearing,i,hS);a.bearing=this._map.transform.bearing+et(l.amount,-179,179),vx(a,l)}if(n.pitch){const l=xx(n.pitch,i,ZI);a.pitch=this._map.transform.pitch+l.amount,vx(a,l)}if(a.zoom||a.bearing){const l=void 0===n.pinchAround?n.around:n.pinchAround;a.around=l?this._map.unproject(l):this._map.getCenter()}return this.clear(),a.noMoveStart=!0,a}}function vx(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function xx(t,e,n){const{maxSpeed:i,linearity:a,deceleration:l}=n,c=et(t*a/(e/1e3),-i,i),h=Math.abs(c)/(l*a);return{easing:n.easing,duration:1e3*h,amount:c*(h/2)}}class Us extends Se{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,i,a={}){const l=Ue(n.getCanvasContainer(),i);super(e,Ke({point:l,lngLat:n.unproject(l),originalEvent:i},a)),this._defaultPrevented=!1,this.target=n}}class wx extends Se{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,i){const a="touchend"===e?i.changedTouches:i.touches,l=vl(n.getCanvasContainer(),a),c=l.map(f=>n.unproject(f)),h=l.reduce((f,p,g,_)=>f.add(p.div(_.length)),new ie(0,0));super(e,{points:l,point:h,lngLats:c,lngLat:n.unproject(h),originalEvent:i}),this._defaultPrevented=!1}}class __ extends Se{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,i){super(e,{originalEvent:i}),this._defaultPrevented=!1}}class ll{constructor(e,n){this._map=e,this._clickTolerance=n.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new __(e.type,this._map,e))}mousedown(e,n){return this._mousedownPos=n,this._firePreventable(new Us(e.type,this._map,e))}mouseup(e){this._map.fire(new Us(e.type,this._map,e))}preclick(e){const n=Ke({},e);n.type="preclick",this._map.fire(new Us(n.type,this._map,n))}click(e,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||(this.preclick(e),this._map.fire(new Us(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new Us(e.type,this._map,e))}mouseover(e){this._map.fire(new Us(e.type,this._map,e))}mouseout(e){this._map.fire(new Us(e.type,this._map,e))}touchstart(e){return this._firePreventable(new wx(e.type,this._map,e))}touchmove(e){this._map.fire(new wx(e.type,this._map,e))}touchend(e){this._map.fire(new wx(e.type,this._map,e))}touchcancel(e){this._map.fire(new wx(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class YI{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new Us(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Us("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new Us(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class dS{constructor(e,n){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,n){this.isEnabled()&&e.shiftKey&&0===e.button&&(rr(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(e,n){if(!this._active)return;const i=n,a=this._startPos,l=this._lastPos;if(!a||!l||l.equals(i)||!this._box&&i.dist(a)<this._clickTolerance)return;this._lastPos=i,this._box||(this._box=Mt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const c=Math.min(a.x,i.x),h=Math.max(a.x,i.x),f=Math.min(a.y,i.y),p=Math.max(a.y,i.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${c}px,${f}px)`,this._box.style.width=h-c+"px",this._box.style.height=p-f+"px")})}mouseupWindow(e,n){if(!this._active)return;const i=this._startPos,a=n;if(i&&0===e.button){if(this.reset(),qc(),i.x!==a.x||i.y!==a.y)return this._map.fire(new Se("boxzoomend",{originalEvent:e})),{cameraAnimation:l=>l.fitScreenCoordinates(i,a,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",e)}}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),jt(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new Se(e,{originalEvent:n}))}}function bx(t,e){const n={};for(let i=0;i<t.length;i++)n[t[i].identifier]=e[i];return n}class Lo{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(e,n,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=e.timeStamp),i.length===this.numTouches&&(this.centroid=function(a){const l=new ie(0,0);for(const c of a)l._add(c);return l.div(a.length)}(n),this.touches=bx(i,n)))}touchmove(e,n,i){if(this.aborted||!this.centroid)return;const a=bx(i,n);for(const l in this.touches){const c=a[l];(!c||c.dist(this.touches[l])>30)&&(this.aborted=!0)}}touchend(e,n,i){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const a=!this.aborted&&this.centroid;if(this.reset(),a)return a}}}class Dp{constructor(e){this.singleTap=new Lo(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,n,i){this.singleTap.touchstart(e,n,i)}touchmove(e,n,i){this.singleTap.touchmove(e,n,i)}touchend(e,n,i){const a=this.singleTap.touchend(e,n,i);if(a){const l=e.timeStamp-this.lastTime<500,c=!this.lastTap||this.lastTap.dist(a)<30;if(l&&c||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=a,this.count===this.numTaps)return this.reset(),a}}}class fS{constructor(){this._zoomIn=new Dp({numTouches:1,numTaps:2}),this._zoomOut=new Dp({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,n,i){this._zoomIn.touchstart(e,n,i),this._zoomOut.touchstart(e,n,i)}touchmove(e,n,i){this._zoomIn.touchmove(e,n,i),this._zoomOut.touchmove(e,n,i)}touchend(e,n,i){const a=this._zoomIn.touchend(e,n,i),l=this._zoomOut.touchend(e,n,i);return a?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:c=>c.easeTo({duration:300,zoom:c.getZoom()+1,around:c.unproject(a)},{originalEvent:e})}):l?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:c=>c.easeTo({duration:300,zoom:c.getZoom()-1,around:c.unproject(l)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const pS={0:1,2:2};class y_{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,n){return!1}_move(e,n){return{}}mousedown(e,n){if(this._lastPoint)return;const i=un(e);this._correctButton(e,i)&&(this._lastPoint=n,this._eventButton=i)}mousemoveWindow(e,n){const i=this._lastPoint;if(i)if(e.preventDefault(),null!=this._eventButton&&function(a,l){const c=pS[l];return void 0===a.buttons||(a.buttons&c)!==c}(e,this._eventButton))this.reset();else if(this._moved||!(n.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=n,this._move(i,n)}mouseupWindow(e){this._lastPoint&&un(e)===this._eventButton&&(this._moved&&qc(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tT extends y_{mousedown(e,n){super.mousedown(e,n),this._lastPoint&&(this._active=!0)}_correctButton(e,n){return 0===n&&!e.ctrlKey}_move(e,n){return{around:n,panDelta:n.sub(e)}}}class nT extends y_{_correctButton(e,n){return 0===n&&e.ctrlKey||2===n}_move(e,n){const i=.8*(n.x-e.x);if(i)return this._active=!0,{bearingDelta:i}}contextmenu(e){e.preventDefault()}}class v_ extends y_{_correctButton(e,n){return 0===n&&e.ctrlKey||2===n}_move(e,n){const i=-.5*(n.y-e.y);if(i)return this._active=!0,{pitchDelta:i}}contextmenu(e){e.preventDefault()}}class rT{constructor(e,n){this._map=e,this._el=e.getCanvasContainer(),this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset(),Xr(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new ie(0,0)}touchstart(e,n,i){return this._calculateTransform(e,n,i)}touchmove(e,n,i){if(this._active&&!(i.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===i.length&&!_t())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return e.cancelable&&e.preventDefault(),this._calculateTransform(e,n,i)}}touchend(e,n,i){this._calculateTransform(e,n,i),this._active&&i.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,i){i.length>0&&(this._active=!0);const a=bx(i,n),l=new ie(0,0),c=new ie(0,0);let h=0;for(const p in a){const g=a[p],_=this._touches[p];_&&(l._add(g),c._add(g.sub(_)),h++,a[p]=g)}if(this._touches=a,h<this._minTouches||!c.mag())return;const f=c.div(h);return this._sum._add(f),this._sum.mag()<this._clickTolerance?void 0:{around:l.div(h),panDelta:f}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Mt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Ta{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,n,i){return{}}touchstart(e,n,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([n[0],n[1]]))}touchmove(e,n,i){const a=this._firstTwoTouches;if(!a)return;e.preventDefault();const[l,c]=a,h=cl(i,n,l),f=cl(i,n,c);if(!h||!f)return;const p=this._aroundCenter?null:h.add(f).div(2);return this._move([h,f],p,e)}touchend(e,n,i){if(!this._firstTwoTouches)return;const[a,l]=this._firstTwoTouches,c=cl(i,n,a),h=cl(i,n,l);c&&h||(this._active&&qc(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function cl(t,e,n){for(let i=0;i<t.length;i++)if(t[i].identifier===n)return e[i]}function Ex(t,e){return Math.log(t/e)/Math.LN2}class iT extends Ta{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,n){const i=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Ex(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ex(this._distance,i),pinchAround:n}}}function oT(t,e){return 180*t.angleWith(e)/Math.PI}class Cx extends Ta{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,n){const i=this._vector;if(this._vector=e[0].sub(e[1]),i&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:oT(this._vector,i),pinchAround:n}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const n=25/(Math.PI*this._minDiameter)*360,i=this._startVector;if(!i)return!1;const a=oT(e,i);return Math.abs(a)<n}}function Tx(t){return Math.abs(t.y)>Math.abs(t.x)}class mS extends Ta{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,Tx(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,n,i){const a=this._lastPoints;if(!a)return;const l=e[0].sub(a[0]),c=e[1].sub(a[1]);return this._map._cooperativeGestures&&!_t()&&i.touches.length<3||(this._valid=this.gestureBeginsVertically(l,c,i.timeStamp),!this._valid)?void 0:(this._lastPoints=e,this._active=!0,{pitchDelta:(l.y+c.y)/2*-.5})}gestureBeginsVertically(e,n,i){if(void 0!==this._valid)return this._valid;const a=e.mag()>=2,l=n.mag()>=2;if(!a&&!l)return;if(!a||!l)return null==this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const c=e.y>0==n.y>0;return Tx(e)&&Tx(n)&&c}}const sT={panStep:100,bearingStep:15,pitchStep:10};class aT{constructor(){const e=sT;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let n=0,i=0,a=0,l=0,c=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?i=-1:(e.preventDefault(),l=-1);break;case 39:e.shiftKey?i=1:(e.preventDefault(),l=1);break;case 38:e.shiftKey?a=1:(e.preventDefault(),c=-1);break;case 40:e.shiftKey?a=-1:(e.preventDefault(),c=1);break;default:return}return this._rotationDisabled&&(i=0,a=0),{cameraAnimation:h=>{const f=h.getZoom();h.easeTo({duration:300,easeId:"keyboardHandler",easing:Zo,zoom:n?Math.round(f)+n*(e.shiftKey?2:1):f,bearing:h.getBearing()+i*this._bearingStep,pitch:h.getPitch()+a*this._pitchStep,offset:[-l*this._panStep,-c*this._panStep],center:h.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Zo(t){return t*(2-t)}const hi=4.000244140625;class di{constructor(e,n){this._map=e,this._el=e.getCanvasContainer(),this._handler=n,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,Xr(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(e.ctrlKey||e.metaKey||this.isZooming()||_t()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let n=e.deltaMode===ce.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const i=Ct.now(),a=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==n&&n%hi==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":a>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(a*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=Ue(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:n,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._map.transform;"wheel"===this._type&&e.projection.wrap&&(e._center.lng>=180||e._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const n=()=>e._terrainEnabled()&&this._aroundCoord?e.computeZoomRelativeTo(this._aroundCoord):e.zoom;if(0!==this._delta){const p="wheel"===this._type&&Math.abs(this._delta)>hi?this._wheelZoomRate:this._defaultZoomRate;let g=2/(1+Math.exp(-Math.abs(this._delta*p)));this._delta<0&&0!==g&&(g=1/g);const _=n(),y=Math.pow(2,_),v="number"==typeof this._targetZoom?e.zoomScale(this._targetZoom):y;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(v*g))),"wheel"===this._type&&(this._startZoom=_,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const i="number"==typeof this._targetZoom?this._targetZoom:n(),a=this._startZoom,l=this._easing;let c,h=!1;if("wheel"===this._type&&a&&l){const p=Math.min((Ct.now()-this._lastWheelEventTime)/200,1);c=wt(a,i,l(p)),p<1?this._frameId||(this._frameId=!0):h=!0}else c=i,h=!0;this._active=!0,h&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let f=c-n();return f*this._lastDelta<0&&(f=0),{noInertia:!0,needsRenderFrame:!h,zoomDelta:f,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=ft;if(this._prevEase){const i=this._prevEase,a=(Ct.now()-i.start)/i.duration,l=i.easing(a+.01)-i.easing(a),c=.27/Math.sqrt(l*l+1e-4)*.01;n=Ia(c,Math.sqrt(.0729-c*c),.25,1)}return this._prevEase={start:Ct.now(),duration:e,easing:n},n}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Mt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(ce.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class On{constructor(e,n){this._clickZoom=e,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Jr{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,n){return e.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:i.getZoom()+(e.shiftKey?-1:1),around:i.unproject(n)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class en{constructor(){this._tap=new Dp({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,n,i){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=n[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(e,n,i))}touchmove(e,n,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const a=n[0],l=a.y-this._swipePoint.y;return this._swipePoint=a,e.preventDefault(),this._active=!0,{zoomDelta:l/128}}}else this._tap.touchmove(e,n,i)}touchend(e,n,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(e,n,i)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class KI{constructor(e,n,i){this._el=e,this._mousePan=n,this._touchPan=i}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class gS{constructor(e,n,i){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=n,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class _S{constructor(e,n,i,a){this._el=e,this._touchZoom=n,this._touchRotate=i,this._tapDragZoom=a,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const x_=t=>t.zoom||t.drag||t.pitch||t.rotate;class yS extends Se{}class vS{constructor(){this.constants=[1,1,.01],this.radius=0}setup(e,n){const i=Z.sub([],n,e);this.radius=Z.length(i[2]<0?Z.div([],i,this.constants):[i[0],i[1],0])}projectRay(e){Z.div(e,e,this.constants),Z.normalize(e,e),Z.mul(e,e,this.constants);const n=Z.scale([],e,this.radius);if(n[2]>0){const i=Z.scale([],[0,0,1],Z.dot(n,[0,0,1])),a=Z.scale([],Z.normalize([],[n[0],n[1],0]),this.radius),l=Z.add([],n,Z.scale([],Z.sub([],Z.add([],a,i),n),2));n[0]=l[0],n[1]=l[1]}return n}}function Dx(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}class JI{constructor(e,n){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new XI(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new vS,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),Xr(["handleEvent","handleWindowEvent"],this);const i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[ce.document,"mousemove",{capture:!0}],[ce.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[ce,"blur",void 0]];for(const[a,l,c]of this._listeners)a.addEventListener(l,a===ce.document?this.handleWindowEvent:this.handleEvent,c)}destroy(){for(const[e,n,i]of this._listeners)e.removeEventListener(n,e===ce.document?this.handleWindowEvent:this.handleEvent,i)}_addDefaultHandlers(e){const n=this._map,i=n.getCanvasContainer();this._add("mapEvent",new ll(n,e));const a=n.boxZoom=new dS(n,e);this._add("boxZoom",a);const l=new fS,c=new Jr;n.doubleClickZoom=new On(c,l),this._add("tapZoom",l),this._add("clickZoom",c);const h=new en;this._add("tapDragZoom",h);const f=n.touchPitch=new mS(n);this._add("touchPitch",f);const p=new nT(e),g=new v_(e);n.dragRotate=new gS(e,p,g),this._add("mouseRotate",p,["mousePitch"]),this._add("mousePitch",g,["mouseRotate"]);const _=new tT(e),y=new rT(n,e);n.dragPan=new KI(i,_,y),this._add("mousePan",_),this._add("touchPan",y,["touchZoom","touchRotate"]);const v=new Cx,w=new iT;n.touchZoomRotate=new _S(i,w,v,h),this._add("touchRotate",v,["touchPan","touchZoom"]),this._add("touchZoom",w,["touchPan","touchRotate"]),this._add("blockableMapEvent",new YI(n));const E=n.scrollZoom=new di(n,this);this._add("scrollZoom",E,["mousePan"]);const T=n.keyboard=new aT;this._add("keyboard",T);for(const C of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[C]&&n[C].enable(e[C])}_add(e,n,i){this._handlers.push({handlerName:e,handler:n,allowed:i}),this._handlersById[e]=n}stop(e){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!x_(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(e,n,i){for(const a in e)if(a!==i&&(!n||n.indexOf(a)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){const n=[];for(const i of e)this._el.contains(i.target)&&n.push(i);return n}handleEvent(e,n){this._updatingCamera=!0;const i="renderFrame"===e.type,a=i?void 0:e,l={needsRenderFrame:!1},c={},h={},f=e.touches?this._getMapTouches(e.touches):void 0,p=f?vl(this._el,f):i?void 0:Ue(this._el,e);for(const{handlerName:y,handler:v,allowed:w}of this._handlers){if(!v.isEnabled())continue;let E;this._blockedByActive(h,w,y)?v.reset():v[n||e.type]&&(E=v[n||e.type](e,p,f),this.mergeHandlerResult(l,c,E,y,a),E&&E.needsRenderFrame&&this._triggerRenderFrame()),(E||v.isActive())&&(h[y]=v)}const g={};for(const y in this._previousActiveHandlers)h[y]||(g[y]=a);this._previousActiveHandlers=h,(Object.keys(g).length||Dx(l))&&(this._changes.push([l,c,g]),this._triggerRenderFrame()),(Object.keys(h).length||Dx(l))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:_}=l;_&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],_(this._map))}mergeHandlerResult(e,n,i,a,l){if(!i)return;Ke(e,i);const c={handlerName:a,originalEvent:i.originalEvent||l};void 0!==i.zoomDelta&&(n.zoom=c),void 0!==i.panDelta&&(n.drag=c),void 0!==i.pitchDelta&&(n.pitch=c),void 0!==i.bearingDelta&&(n.rotate=c)}_applyChanges(){const e={},n={},i={};for(const[a,l,c]of this._changes)a.panDelta&&(e.panDelta=(e.panDelta||new ie(0,0))._add(a.panDelta)),a.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+a.zoomDelta),a.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+a.bearingDelta),a.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+a.pitchDelta),void 0!==a.around&&(e.around=a.around),void 0!==a.aroundCoord&&(e.aroundCoord=a.aroundCoord),void 0!==a.pinchAround&&(e.pinchAround=a.pinchAround),a.noInertia&&(e.noInertia=a.noInertia),Ke(n,l),Ke(i,c);this._updateMapTransform(e,n,i),this._changes=[]}_updateMapTransform(e,n,i){const a=this._map,l=a.transform,c=S=>[S.x,S.y,S.z];if((S=>{const I=this._eventsInProgress.drag;return I&&!this._handlersById[I.handlerName].isActive()})()&&!Dx(e)){const S=l.zoom;l.cameraElevationReference="sea",null!=this._originalZoom&&l._orthographicProjectionAtLowPitch&&"globe"!==l.projection.name&&0===l.pitch?(l.cameraElevationReference="ground",l.zoom=this._originalZoom):(l.recenterOnTerrain(),l.cameraElevationReference="ground"),S!==l.zoom&&this._map._update(!0)}if(l._isCameraConstrained&&a._stop(!0),!Dx(e))return void this._fireEvents(n,i,!0);let{panDelta:h,zoomDelta:f,bearingDelta:p,pitchDelta:g,around:_,aroundCoord:y,pinchAround:v}=e;l._isCameraConstrained&&(f>0&&(f=0),l._isCameraConstrained=!1),void 0!==v&&(_=v),(f||(S=>n[S]&&!this._eventsInProgress[S])("drag"))&&_&&(this._dragOrigin=c(l.pointCoordinate3D(_)),this._originalZoom=l.zoom,this._trackingEllipsoid.setup(l._camera.position,this._dragOrigin)),l.cameraElevationReference="sea",a._stop(!0),_=_||a.transform.centerPoint,p&&(l.bearing+=p),g&&(l.pitch+=g),l._updateCameraState();const w=[0,0,0];if(h)if("mercator"===l.projection.name){const S=this._trackingEllipsoid.projectRay(l.screenPointToMercatorRay(_).dir),I=this._trackingEllipsoid.projectRay(l.screenPointToMercatorRay(_.sub(h)).dir);w[0]=I[0]-S[0],w[1]=I[1]-S[1]}else{const S=l.pointCoordinate(_);if("globe"===l.projection.name){h=h.rotate(-l.angle);const I=l._pixelsPerMercatorPixel/l.worldSize;w[0]=-h.x*ev(Gr(S.y))*I,w[1]=-h.y*ev(l.center.lat)*I}else{const I=l.pointCoordinate(_.sub(h));S&&I&&(w[0]=I.x-S.x,w[1]=I.y-S.y)}}const E=l.zoom,T=[0,0,0];if(f){const S=c(y||l.pointCoordinate3D(_)),I={dir:Z.normalize([],Z.sub([],S,l._camera.position))};if(I.dir[2]<0){const R=l.zoomDeltaToMovement(S,f);Z.scale(T,I.dir,R)}}const C=Z.add(w,w,T);l._translateCameraConstrained(C),f&&Math.abs(l.zoom-E)>1e-4&&l.recenterOnTerrain(),l.cameraElevationReference="ground",this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(n,i,!0)}_fireEvents(e,n,i){const a=x_(this._eventsInProgress),l=x_(e),c={};for(const g in e){const{originalEvent:_}=e[g];this._eventsInProgress[g]||(c[`${g}start`]=_),this._eventsInProgress[g]=e[g]}!a&&l&&this._fireEvent("movestart",l.originalEvent);for(const g in c)this._fireEvent(g,c[g]);l&&this._fireEvent("move",l.originalEvent);for(const g in e){const{originalEvent:_}=e[g];this._fireEvent(g,_)}const h={};let f;for(const g in this._eventsInProgress){const{handlerName:_,originalEvent:y}=this._eventsInProgress[g];this._handlersById[_].isActive()||(delete this._eventsInProgress[g],f=n[_]||y,h[`${g}end`]=f)}for(const g in h)this._fireEvent(g,h[g]);const p=x_(this._eventsInProgress);if(i&&(a||l)&&!p){this._updatingCamera=!0;const g=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),_=y=>0!==y&&-this._bearingSnap<y&&y<this._bearingSnap;g?(_(g.bearing||this._map.getBearing())&&(g.bearing=0),this._map.easeTo(g,{originalEvent:f})):(this._map.fire(new Se("moveend",{originalEvent:f})),_(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new Se(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{this._frameId=void 0,this.handleEvent(new yS("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Mp="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class w_ extends Mn{constructor(e,n){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=n.bearingSnap,this._respectPrefersReducedMotion=!1!==n.respectPrefersReducedMotion,Xr(["_renderFrameCallback"],this)}getCenter(){return new bt(this.transform.center.lng,this.transform.center.lat)}setCenter(e,n){return this.jumpTo({center:e},n)}panBy(e,n,i){return e=ie.convert(e).mult(-1),this.panTo(this.transform.center,Ke({offset:e},n),i)}panTo(e,n,i){return this.easeTo(Ke({center:e},n),i)}getZoom(){return this.transform.zoom}setZoom(e,n){return this.jumpTo({zoom:e},n),this}zoomTo(e,n,i){return this.easeTo(Ke({zoom:e},n),i)}zoomIn(e,n){return this.zoomTo(this.getZoom()+1,e,n),this}zoomOut(e,n){return this.zoomTo(this.getZoom()-1,e,n),this}getBearing(){return this.transform.bearing}setBearing(e,n){return this.jumpTo({bearing:e},n),this}getPadding(){return this.transform.padding}setPadding(e,n){return this.jumpTo({padding:e},n),this}rotateTo(e,n,i){return this.easeTo(Ke({bearing:e},n),i)}resetNorth(e,n){return this.rotateTo(0,Ke({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo(Ke({bearing:0,pitch:0,duration:1e3},e),n),this}snapToNorth(e,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,n):this}getPitch(){return this.transform.pitch}setPitch(e,n){return this.jumpTo({pitch:e},n),this}cameraForBounds(e,n){e=Ji.convert(e);const i=n&&n.bearing||0,a=n&&n.pitch||0,l=e.getNorthWest(),c=e.getSouthEast();return this._cameraForBounds(this.transform,l,c,i,a,n)}_extendCameraOptions(e){const n={top:0,bottom:0,right:0,left:0};if("number"==typeof(e=Ke({padding:n,offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding){const i=e.padding;e.padding={top:i,bottom:i,right:i,left:i}}return e.padding=Ke(n,e.padding),e}_minimumAABBFrustumDistance(e,n){const i=n.max[0]-n.min[0],a=n.max[1]-n.min[1];return i/a>e.aspect?i/(2*Math.tan(.5*e.fovX)*e.aspect):a/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(e,n,i,a,l,c){const h=e.clone(),f=this._extendCameraOptions(c);h.bearing=a,h.pitch=l;const p=bt.convert(n),g=bt.convert(i),_=.5*(p.lat+g.lat),y=.5*(p.lng+g.lng),v=Dr(_,y),w=Z.normalize([],v),E=Z.normalize([],Z.cross([],w,[0,1,0])),T=Z.cross([],E,w),C=[E[0],E[1],E[2],0,T[0],T[1],T[2],0,w[0],w[1],w[2],0,0,0,0,1],S=[v,Dr(p.lat,p.lng),Dr(g.lat,p.lng),Dr(g.lat,g.lng),Dr(p.lat,g.lng),Dr(_,p.lng),Dr(_,g.lng),Dr(p.lat,y),Dr(g.lat,y)];let I=$n.fromPoints(S.map(Q=>[Z.dot(E,Q),Z.dot(T,Q),Z.dot(w,Q)]));const R=Z.transformMat4([],I.center,C);0===Z.squaredLength(R)&&Z.set(R,0,0,1),Z.normalize(R,R),Z.scale(R,R,Fi),h.center=function([Q,ae,ue]){const fe=Math.hypot(Q,ae,ue),ge=Math.atan2(Q,ue),ve=.5*Math.PI-Math.acos(-ae/fe);return new bt(kr(ge),kr(ve))}(R);const A=h.getWorldToCameraMatrix(),k=se.invert(new Float64Array(16),A);I=$n.applyTransform(I,se.multiply([],A,C)),Z.transformMat4(R,R,A);const L=.5*(I.max[2]-I.min[2]),B=this._minimumAABBFrustumDistance(h,I),j=Z.scale([],[0,0,1],L),U=Z.add(j,R,j),G=B+(0===h.pitch?0:Z.distance(R,U)),$=h.globeCenterInViewSpace,W=Z.sub([],R,[$[0],$[1],$[2]]);Z.normalize(W,W),Z.scale(W,W,G);const H=Z.add([],R,W);Z.transformMat4(H,H,k);const J=da/Fi,te=Z.length(H),oe=kn(Math.max(te*J-da,Number.EPSILON),0),K=Math.min(h.zoomFromMercatorZAdjusted(oe),f.maxZoom);return K>5.5?(h.setProjection({name:"mercator"}),h.zoom=K,this._cameraForBounds(h,n,i,a,l,c)):{center:h.center,zoom:K,bearing:a,pitch:l}}queryTerrainElevation(e,n){const i=this.transform.elevation;return i?(n=Ke({},{exaggerated:!0},n),i.getAtPoint(nn.fromLngLat(e),null,n.exaggerated)):null}_cameraForBounds(e,n,i,a,l,c){if("globe"===e.projection.name)return this._cameraForBoundsOnGlobe(e,n,i,a,l,c);const h=e.clone(),f=this._extendCameraOptions(c),p=h.padding;h.bearing=a,h.pitch=l;const g=bt.convert(n),_=bt.convert(i),y=new bt(g.lng,_.lat),v=new bt(_.lng,g.lat),w=h.project(g),E=h.project(_),T=this.queryTerrainElevation(g),C=this.queryTerrainElevation(_),S=this.queryTerrainElevation(y),I=this.queryTerrainElevation(v),R=[[w.x,w.y,Math.min(T||0,C||0,S||0,I||0)],[E.x,E.y,Math.max(T||0,C||0,S||0,I||0)]];let A=$n.fromPoints(R);const k=h.getWorldToCameraMatrix(),L=se.invert(new Float64Array(16),k);A=$n.applyTransform(A,k);const B=Z.sub([],A.max,A.min),j=p.left||0,U=p.right||0,G=p.bottom||0,$=p.top||0,{left:W,right:H,top:J,bottom:te}=f.padding,oe=.5*(j+U),K=.5*($+G),Q=Math.min(h.scaleZoom(h.scale*Math.min((h.width-(j+U+W+H))/B[0],(h.height-(G+$+te+J))/B[1])),f.maxZoom),ae=h.scale/h.zoomScale(Q);A=new $n([A.min[0]-(W+oe)*ae,A.min[1]-(te+K)*ae,A.min[2]],[A.max[0]+(H+oe)*ae,A.max[1]+(J+K)*ae,A.max[2]]);const ue=.5*B[2],fe=this._minimumAABBFrustumDistance(h,A),ge=[0,0,1,0];bn.transformMat4(ge,ge,k),bn.normalize(ge,ge);const ve=Z.scale([],ge,fe+ue),de=Z.add([],A.center,ve),me=("number"==typeof f.offset.x&&"number"==typeof f.offset.y?new ie(f.offset.x,f.offset.y):ie.convert(f.offset)).rotate(-At(a));A.center[0]-=me.x*ae,A.center[1]+=me.y*ae,Z.transformMat4(A.center,A.center,L),Z.transformMat4(de,de,L);const Oe=[A.center[0],A.center[1],de[2]*h.pixelsPerMeter];Z.scale(Oe,Oe,1/h.worldSize);const qe=Ao(Oe[0]),Ge=Gr(Oe[1]),We=Math.min(h._zoomFromMercatorZ(Oe[2]),f.maxZoom),it=new bt(qe,Ge);return h.mercatorFromTransition&&We<5.5?(h.setProjection({name:"globe"}),h.zoom=We,this._cameraForBounds(h,n,i,a,l,c)):{center:it,zoom:We,bearing:a,pitch:l}}fitBounds(e,n,i){const a=this.cameraForBounds(e,n);return this._fitInternal(a,n,i)}fitScreenCoordinates(e,n,i,a,l){const c=ie.convert(e),h=ie.convert(n),f=new ie(Math.min(c.x,h.x),Math.min(c.y,h.y)),p=new ie(Math.max(c.x,h.x),Math.max(c.y,h.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(c,h))return this;const g=this.transform.pointLocation3D(f),_=this.transform.pointLocation3D(p),y=this.transform.pointLocation3D(new ie(f.x,p.y)),v=this.transform.pointLocation3D(new ie(p.x,f.y)),w=[Math.min(g.lng,_.lng,y.lng,v.lng),Math.min(g.lat,_.lat,y.lat,v.lat)],E=[Math.max(g.lng,_.lng,y.lng,v.lng),Math.max(g.lat,_.lat,y.lat,v.lat)],T=a&&a.pitch?a.pitch:this.getPitch(),C=this._cameraForBounds(this.transform,w,E,i,T,a);return this._fitInternal(C,a,l)}_fitInternal(e,n,i){return e?(delete(n=Ke(e,n)).padding,n.linear?this.easeTo(n,i):this.flyTo(n,i)):this}jumpTo(e,n){this.stop();const i=e.preloadOnly?this.transform.clone():this.transform;let a=!1,l=!1,c=!1;return"zoom"in e&&i.zoom!==+e.zoom&&(a=!0,i.zoom=+e.zoom),void 0!==e.center&&(i.center=bt.convert(e.center)),"bearing"in e&&i.bearing!==+e.bearing&&(l=!0,i.bearing=+e.bearing),"pitch"in e&&i.pitch!==+e.pitch&&(c=!0,i.pitch=+e.pitch),null==e.padding||i.isPaddingEqual(e.padding)||(i.padding=e.padding),e.preloadOnly?(this._preloadTiles(i),this):(this.fire(new Se("movestart",n)).fire(new Se("move",n)),a&&this.fire(new Se("zoomstart",n)).fire(new Se("zoom",n)).fire(new Se("zoomend",n)),l&&this.fire(new Se("rotatestart",n)).fire(new Se("rotate",n)).fire(new Se("rotateend",n)),c&&this.fire(new Se("pitchstart",n)).fire(new Se("pitch",n)).fire(new Se("pitchend",n)),this.fire(new Se("moveend",n)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||ee(Mp),this.transform.getFreeCameraOptions()}setFreeCameraOptions(e,n){const i=this.transform;if(!i.projection.supportsFreeCamera)return ee(Mp),this;this.stop();const a=i.zoom,l=i.pitch,c=i.bearing;i.setFreeCameraOptions(e);const h=a!==i.zoom,f=l!==i.pitch,p=c!==i.bearing;return this.fire(new Se("movestart",n)).fire(new Se("move",n)),h&&this.fire(new Se("zoomstart",n)).fire(new Se("zoom",n)).fire(new Se("zoomend",n)),p&&this.fire(new Se("rotatestart",n)).fire(new Se("rotate",n)).fire(new Se("rotateend",n)),f&&this.fire(new Se("pitchstart",n)).fire(new Se("pitch",n)).fire(new Se("pitchend",n)),this.fire(new Se("moveend",n)),this}easeTo(e,n){this._stop(!1,e.easeId),(!1===(e=Ke({offset:[0,0],duration:500,easing:ft},e)).animate||this._prefersReducedMotion(e))&&(e.duration=0);const i=this.transform,a=this.getZoom(),l=this.getBearing(),c=this.getPitch(),h=this.getPadding(),f="zoom"in e?+e.zoom:a,p="bearing"in e?this._normalizeBearing(e.bearing,l):l,g="pitch"in e?+e.pitch:c,_="padding"in e?e.padding:i.padding,y=ie.convert(e.offset);let v,w,E;if("globe"===i.projection.name){const j=nn.fromLngLat(i.center),U=y.rotate(-i.angle);j.x+=U.x/i.worldSize,j.y+=U.y/i.worldSize;const G=j.toLngLat(),$=bt.convert(e.center||G);this._normalizeCenter($),v=i.centerPoint.add(U),w=new ie(j.x,j.y).mult(i.worldSize),E=new ie(Si($.lng),gi($.lat)).mult(i.worldSize).sub(w)}else{v=i.centerPoint.add(y);const j=i.pointLocation(v),U=bt.convert(e.center||j);this._normalizeCenter(U),w=i.project(j),E=i.project(U).sub(w)}const T=i.zoomScale(f-a);let C,S;e.around&&(C=bt.convert(e.around),S=i.locationPoint(C));const I=this._zooming||f!==a,R=this._rotating||l!==p,A=this._pitching||g!==c,k=!i.isPaddingEqual(_),L=j=>U=>{if(I&&(j.zoom=wt(a,f,U)),R&&(j.bearing=wt(l,p,U)),A&&(j.pitch=wt(c,g,U)),k&&(j.interpolatePadding(h,_,U),v=j.centerPoint.add(y)),C)j.setLocationAtPoint(C,S);else{const G=j.zoomScale(j.zoom-a),$=f>a?Math.min(2,T):Math.max(.5,T),W=Math.pow($,1-U),H=j.unproject(w.add(E.mult(U*W)).mult(G));j.setLocationAtPoint(j.renderWorldCopies?H.wrap():H,v)}return e.preloadOnly||this._fireMoveEvents(n),j};if(e.preloadOnly){const j=this._emulate(L,e.duration,i);return this._preloadTiles(j),this}const B={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=I,this._rotating=R,this._pitching=A,this._padding=k,this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,B),this._ease(L(i),j=>{"sea"===i.cameraElevationReference&&i.recenterOnTerrain(),this._afterEase(n,j)},e),this}_prepareEase(e,n,i={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),n||i.moving||this.fire(new Se("movestart",e)),this._zooming&&!i.zooming&&this.fire(new Se("zoomstart",e)),this._rotating&&!i.rotating&&this.fire(new Se("rotatestart",e)),this._pitching&&!i.pitching&&this.fire(new Se("pitchstart",e))}_fireMoveEvents(e){this.fire(new Se("move",e)),this._zooming&&this.fire(new Se("zoom",e)),this._rotating&&this.fire(new Se("rotate",e)),this._pitching&&this.fire(new Se("pitch",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const i=this._zooming,a=this._rotating,l=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,i&&this.fire(new Se("zoomend",e)),a&&this.fire(new Se("rotateend",e)),l&&this.fire(new Se("pitchend",e)),this.fire(new Se("moveend",e))}flyTo(e,n){if(this._prefersReducedMotion(e)){const Q=fi(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Q,n)}this.stop(),e=Ke({offset:[0,0],speed:1.2,curve:1.42,easing:ft},e);const i=this.transform,a=this.getZoom(),l=this.getBearing(),c=this.getPitch(),h=this.getPadding(),f="zoom"in e?et(+e.zoom,i.minZoom,i.maxZoom):a,p="bearing"in e?this._normalizeBearing(e.bearing,l):l,g="pitch"in e?+e.pitch:c,_="padding"in e?e.padding:i.padding,y=i.zoomScale(f-a),v=ie.convert(e.offset);let w=i.centerPoint.add(v);const E=i.pointLocation(w),T=bt.convert(e.center||E);this._normalizeCenter(T);const C=i.project(E),S=i.project(T).sub(C);let I=e.curve;const R=Math.max(i.width,i.height),A=R/y,k=S.mag();if("minZoom"in e){const Q=et(Math.min(e.minZoom,a,f),i.minZoom,i.maxZoom),ae=R/i.zoomScale(Q-a);I=Math.sqrt(ae/k*2)}const L=I*I;function B(Q){const ae=(A*A-R*R+(Q?-1:1)*L*L*k*k)/(2*(Q?A:R)*L*k);return Math.log(Math.sqrt(ae*ae+1)-ae)}function j(Q){return(Math.exp(Q)-Math.exp(-Q))/2}function U(Q){return(Math.exp(Q)+Math.exp(-Q))/2}const G=B(0);let $=function(Q){return U(G)/U(G+I*Q)},W=function(Q){return R*((U(G)*(j(ae=G+I*Q)/U(ae))-j(G))/L)/k;var ae},H=(B(1)-G)/I;if(Math.abs(k)<1e-6||!isFinite(H)){if(Math.abs(R-A)<1e-6)return this.easeTo(e,n);const Q=A<R?-1:1;H=Math.abs(Math.log(A/R))/I,W=function(){return 0},$=function(ae){return Math.exp(Q*I*ae)}}e.duration="duration"in e?+e.duration:1e3*H/("screenSpeed"in e?+e.screenSpeed/I:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0);const J=l!==p,te=g!==c,oe=!i.isPaddingEqual(_),K=Q=>ae=>{const ue=ae*H,fe=1/$(ue);Q.zoom=1===ae?f:a+Q.scaleZoom(fe),J&&(Q.bearing=wt(l,p,ae)),te&&(Q.pitch=wt(c,g,ae)),oe&&(Q.interpolatePadding(h,_,ae),w=Q.centerPoint.add(v));const ge=1===ae?T:Q.unproject(C.add(S.mult(W(ue))).mult(fe));return Q.setLocationAtPoint(Q.renderWorldCopies?ge.wrap():ge,w),Q._updateCameraOnTerrain(),e.preloadOnly||this._fireMoveEvents(n),Q};if(e.preloadOnly){const Q=this._emulate(K,e.duration,i);return this._preloadTiles(Q),this}return this._zooming=!0,this._rotating=J,this._pitching=te,this._padding=oe,this._prepareEase(n,!1),this._ease(K(i),()=>this._afterEase(n),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const i=this._onEaseEnd;this._onEaseEnd=void 0,i.call(this,n)}if(!e){const i=this.handlers;i&&i.stop(!1)}return this}_ease(e,n,i){!1===i.animate||0===i.duration?(e(1),n()):(this._easeStart=Ct.now(),this._easeOptions=i,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const e=Math.min((Ct.now()-this._easeStart)/this._easeOptions.duration,1),n=this._onEaseFrame;n&&n(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,n){e=ts(e,-180,180);const i=Math.abs(e-n);return Math.abs(e-360-n)<i&&(e-=360),Math.abs(e+360-n)<i&&(e+=360),e}_normalizeCenter(e){const n=this.transform;if(!n.renderWorldCopies||n.maxBounds)return;const i=e.lng-n.center.lng;e.lng+=i>180?-360:i<-180?360:0}_prefersReducedMotion(e){return this._respectPrefersReducedMotion&&Ct.prefersReducedMotion&&!(e&&e.essential)}_emulate(e,n,i){const a=Math.ceil(15*n/1e3),l=[],c=e(i.clone());for(let h=0;h<=a;h++){const f=c(h/a);l.push(f.clone())}return l}}class Sp{constructor(e={}){this.options=e,Xr(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const n=this.options&&this.options.compact;return this._map=e,this._container=Mt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Mt("button","mapboxgl-ctrl-attrib-button",this._container),Mt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Mt("div","mapboxgl-ctrl-attrib-inner",this._container),n&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===n&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(e,n){const i=this._map._getUIString(`AttributionControl.${n}`);e.setAttribute("aria-label",i),e.removeAttribute("title"),e.firstElementChild&&e.firstElementChild.setAttribute("title",i)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));const n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||Rt.ACCESS_TOKEN}];if(e){const i=n.reduce((a,l,c)=>(l.value&&(a+=`${l.key}=${l.value}${c<n.length-1?"&":""}`),a),"?");e.href=`${Rt.FEEDBACK_URL}/${i}#${uS(this._map,!0)}`,e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const a=this._map.style.stylesheet;this.styleOwner=a.owner,this.styleId=a.id}const n=this._map.style._mergedSourceCaches;for(const a in n){const l=n[a];if(l.used){const c=l.getSource();c.attribution&&e.indexOf(c.attribution)<0&&e.push(c.attribution)}}e.sort((a,l)=>a.length-l.length),e=e.filter((a,l)=>{for(let c=l+1;c<e.length;c++)if(e[c].indexOf(a)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));const i=e.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,e.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class vs{constructor(){Xr(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=Mt("div","mapboxgl-ctrl");const n=Mt("a","mapboxgl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://www.mapbox.com/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(const n in e){const i=e[n].getSource();if(i.hasOwnProperty("mapbox_logo")&&!i.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const n=e[0];this._map.getCanvasContainer().offsetWidth<250?n.classList.add("mapboxgl-compact"):n.classList.remove("mapboxgl-compact")}}}class b_{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const n=++this._id;return this._queue.push({callback:e,id:n,cancelled:!1}),n}remove(e){const n=this._currentlyRunning,i=n?this._queue.concat(n):this._queue;for(const a of i)if(a.id===e)return void(a.cancelled=!0)}run(e=0){const n=this._currentlyRunning=this._queue;this._queue=[];for(const i of n)if(!i.cancelled&&(i.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function xS(t,e,n){if(t=new bt(t.lng,t.lat),e){const i=new bt(t.lng-360,t.lat),a=new bt(t.lng+360,t.lat),l=360*Math.ceil(Math.abs(t.lng-n.center.lng)/360),c=n.locationPoint(t).distSqr(e),h=e.x<0||e.y<0||e.x>n.width||e.y>n.height;n.locationPoint(i).distSqr(e)<c&&(h||Math.abs(i.lng-n.center.lng)<l)?t=i:n.locationPoint(a).distSqr(e)<c&&(h||Math.abs(a.lng-n.center.lng)<l)&&(t=a)}for(;Math.abs(t.lng-n.center.lng)>180;){const i=n.locationPoint(t);if(i.x>=0&&i.y>=0&&i.x<=n.width&&i.y<=n.height)break;t.lng>n.center.lng?t.lng-=360:t.lng+=360}return t}const lT={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class cT extends Mn{constructor(e,n){if(super(),(e instanceof ce.HTMLElement||n)&&(e=Ke({element:e},n)),Xr(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=e&&e.occludedOpacity||.2,e&&e.element)this._element=e.element,this._offset=ie.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=Mt("div");const l=41,c=27,h=rs("svg",{display:"block",height:l*this._scale+"px",width:c*this._scale+"px",viewBox:`0 0 ${c} ${l}`},this._element),f=rs("radialGradient",{id:"shadowGradient"},rs("defs",{},h));rs("stop",{offset:"10%","stop-opacity":.4},f),rs("stop",{offset:"100%","stop-opacity":.05},f),rs("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},h),rs("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},h),rs("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},h),rs("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},h),this._offset=ie.convert(e&&e.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",l=>{l.preventDefault()}),this._element.addEventListener("mousedown",l=>{l.preventDefault()});const i=this._element.classList;for(const l in lT)i.remove(`mapboxgl-marker-anchor-${l}`);i.add(`mapboxgl-marker-anchor-${this._anchor}`);const a=e&&e.className?e.className.trim().split(/\s+/):[];i.add(...a),this._popup=null}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){const e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=bt.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const a=Math.sqrt(Math.pow(13.5,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[a,-1*(24.6+a)],"bottom-right":[-a,-1*(24.6+a)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=e,e._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){const n=e.code,i=e.charCode||e.keyCode;"Space"!==n&&"Enter"!==n&&32!==i&&13!==i||this.togglePopup()}_onMapClick(e){const n=e.originalEvent.target,i=this._element;this._popup&&(n===i||i.contains(n))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const e=this._map,n=this._pos;if(!e||!n)return!1;const i=e.unproject(n),a=e.getFreeCameraOptions();if(!a.position)return!1;const l=a.position.toLngLat();return l.distanceTo(i)<.9*l.distanceTo(this._lngLat)}_evaluateOpacity(){const e=this._map;if(!e)return;const n=this._pos;if(!n||n.x<0||n.x>e.transform.width||n.y<0||n.y>e.transform.height)return void this._clearFadeTimer();const i=e.unproject(n);let a;e._showingGlobe()&&Km(e.transform,this._lngLat)?a=0:(a=1-e._queryFogOpacity(i),e.transform._terrainEnabled()&&e.getTerrain()&&this._behindTerrain()&&(a*=this._occludedOpacity)),this._element.style.opacity=`${a}`,this._element.style.pointerEvents=a>0?"auto":"none",this._popup&&this._popup._setOpacity(a),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const e=this._pos;if(!e||!this._map)return;const n=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${e.x}px,${e.y}px)\n            ${lT[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${n.x}px,${n.y}px)\n        `}_calculateXYTransform(){const e=this._pos,n=this._map,i=this.getPitchAlignment();if(!n||!e||"map"!==i)return"";if(!n._showingGlobe()){const f=n.getPitch();return f?`rotateX(${f}deg)`:""}const a=kr(Fw(n.transform,this._lngLat)),l=e.sub(Lw(n.transform)),c=Math.abs(l.x)+Math.abs(l.y);if(0===c)return"";const h=a/c;return`rotateX(${-l.y*h}deg) rotateY(${l.x*h}deg)`}_calculateZTransform(){const e=this._pos,n=this._map;if(!n||!e)return"";let i=0;const a=this.getRotationAlignment();if("map"===a)if(n._showingGlobe()){const l=n.project(new bt(this._lngLat.lng,this._lngLat.lat+.001)),c=n.project(new bt(this._lngLat.lng,this._lngLat.lat-.001)).sub(l);i=kr(Math.atan2(c.y,c.x))-90}else i=-n.getBearing();else if("horizon"===a){const l=Cs(4,6,n.getZoom()),c=Lw(n.transform);c.y+=l*n.transform.height;const h=e.sub(c),f=kr(Math.atan2(h.y,h.x));i=(f>90?f-270:f+90)*(1-l)}return i+=this._rotation,i?`rotateZ(${i}deg)`:""}_update(e){ce.cancelAnimationFrame(this._updateFrameId);const n=this._map;n&&(n.transform.renderWorldCopies&&(this._lngLat=xS(this._lngLat,this._pos,n.transform)),this._pos=n.project(this._lngLat),!0===e?this._updateFrameId=ce.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),n._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(n._showingGlobe()||n.getTerrain()||n.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(e){return this._offset=ie.convert(e),this._update(),this}addClassName(e){return this._element.classList.add(e),this}removeClassName(e){return this._element.classList.remove(e),this}toggleClassName(e){return this._element.classList.toggle(e)}_onMove(e){const n=this._map;if(!n)return;const i=this._pointerdownPos,a=this._positionDelta;if(i&&a){if(!this._isDragging){const l=this._clickTolerance||n._clickTolerance;if(e.point.dist(i)<l)return;this._isDragging=!0}this._pos=e.point.sub(a),this._lngLat=n.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new Se("dragstart"))),this.fire(new Se("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const e=this._map;e&&(e.off("mousemove",this._onMove),e.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new Se("dragend")),this._state="inactive"}_addDragHandler(e){const n=this._map,i=this._pos;n&&i&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(i),this._pointerdownPos=e.point,this._state="pending",n.on("mousemove",this._onMove),n.on("touchmove",this._onMove),n.once("mouseup",this._onUp),n.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;const n=this._map;return n&&(e?(n.on("mousedown",this._addDragHandler),n.on("touchstart",this._addDragHandler)):(n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const wS={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},bS=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Mx(t=new ie(0,0),e="bottom"){if("number"==typeof t){const n=Math.round(Math.sqrt(.5*Math.pow(t,2)));switch(e){case"top":return new ie(0,t);case"top-left":return new ie(n,n);case"top-right":return new ie(-n,n);case"bottom":return new ie(0,-t);case"bottom-left":return new ie(n,-n);case"bottom-right":return new ie(-n,-n);case"left":return new ie(t,0);case"right":return new ie(-t,0)}return new ie(0,0)}return t instanceof ie||Array.isArray(t)?ie.convert(t):ie.convert(t[e]||[0,0])}class ES{constructor(e){this.jumpTo(e)}getValue(e){if(e<=this._startTime)return this._start;if(e>=this._endTime)return this._end;const n=Aa((e-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,n,i){this._start=this.getValue(n),this._end=e,this._startTime=n,this._endTime=n+i}}const CS={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},QI={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},$s={showCompass:!0,showZoom:!0,visualizePitch:!1};class Sx{constructor(e,n,i=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new nT({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,i&&(this.mousePitch=new v_({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),Xr(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener("mousedown",this.mousedown),n.addEventListener("touchstart",this.touchstart,{passive:!1}),n.addEventListener("touchmove",this.touchmove),n.addEventListener("touchend",this.touchend),n.addEventListener("touchcancel",this.reset)}down(e,n){this.mouseRotate.mousedown(e,n),this.mousePitch&&this.mousePitch.mousedown(e,n),rr()}move(e,n){const i=this.map,a=this.mouseRotate.mousemoveWindow(e,n),l=a&&a.bearingDelta;if(l&&i.setBearing(i.getBearing()+l),this.mousePitch){const c=this.mousePitch.mousemoveWindow(e,n),h=c&&c.pitchDelta;h&&i.setPitch(i.getPitch()+h)}}off(){const e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart,{passive:!1}),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){jt(),ce.removeEventListener("mousemove",this.mousemove),ce.removeEventListener("mouseup",this.mouseup)}mousedown(e){this.down(Ke({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),Ue(this.element,e)),ce.addEventListener("mousemove",this.mousemove),ce.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,Ue(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=vl(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=vl(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const TS={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},DS={maxWidth:100,unit:"metric"},MS={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},E_={version:Jo,supported:nh,setRTLTextPlugin:function(t,e,n=!1){if(hs===P1||hs===R1||hs===k1)throw new Error("setRTLTextPlugin cannot be called multiple times.");fu=Ct.resolveURL(t),hs=P1,O1=e,L1(),n||pm()},getRTLTextPluginStatus:ci,Map:class extends w_{constructor(t){if(Ys.mark(Gc.create),null!=(t=Ke({},QI,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(t.antialias&&function(e){const n=e.navigator?e.navigator.userAgent:null;return!!function(i){if(null==mt){const a=i.navigator?i.navigator.userAgent:null;mt=!!i.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return mt}(e)&&n&&(n.match("Version/15.4")||n.match("Version/15.5")||n.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))}(ce)&&(t.antialias=!1,ee("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Fg(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),t),this._interactive=t.interactive,this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._collectResourceTiming=t.collectResourceTiming,this._language=this._parseLanguage(t.language),this._worldview=t.worldview,this._renderTaskQueue=new b_,this._domRenderTaskQueue=new b_,this._controls=[],this._markers=[],this._popups=[],this._mapId=vr(),this._locale=Ke({},CS,t.locale),this._clickTolerance=t.clickTolerance,this._cooperativeGestures=t.cooperativeGestures,this._performanceMetricsCollection=t.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ES(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new Je(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,"string"==typeof t.container){if(this._container=ce.document.getElementById(t.container),!this._container)throw new Error(`Container '${t.container.toString()}' not found.`)}else{if(!(t.container instanceof ce.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(this._container.childNodes.length>0&&ee("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),Xr(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==ce&&(this._fullscreenchangeEvent="onfullscreenchange"in ce.document?"fullscreenchange":"webkitfullscreenchange",ce.addEventListener("online",this._onWindowOnline,!1),ce.addEventListener("resize",this._onWindowResize,!1),ce.addEventListener("orientationchange",this._onWindowResize,!1),ce.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),ce.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new JI(this,t),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,(t.style||!t.testMode)&&this.setStyle(t.style||Rt.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.projection&&this.setProjection(t.projection),t.hash&&(this._hash=new GI("string"==typeof t.hash&&t.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch});const e=t.bounds;e&&(this.resize(),this.fitBounds(e,Ke({},t.fitBoundsOptions,{duration:0})))}this.resize(),t.attributionControl&&this.addControl(new Sp({customAttribution:t.customAttribution})),this._logoControl=new vs,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",e=>{this._update("style"===e.dataType),this.fire(new Se(`${e.dataType}data`,e))}),this.on("dataloading",e=>{this.fire(new Se(`${e.dataType}dataloading`,e))})}_getMapId(){return this._mapId}addControl(t,e){if(void 0===e&&(e=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new xt(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=t.onAdd(this);this._controls.push(t);const i=this._controlPositions[e];return-1!==e.indexOf("bottom")?i.insertBefore(n,i.firstChild):i.appendChild(n),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new xt(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(t);return e>-1&&this._controls.splice(e,1),t.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const e=!this._moving;return e&&this.fire(new Se("movestart",t)).fire(new Se("move",t)),this.fire(new Se("resize",t)),e&&this.fire(new Se("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(t){return this.transform.setMaxBounds(Ji.convert(t)),this._update()}setMinZoom(t){if((t=t??-2)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t?this.setZoom(t):this.fire(new Se("zoomstart")).fire(new Se("zoom")).fire(new Se("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=t??22)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t?this.setZoom(t):this.fire(new Se("zoomstart")).fire(new Se("zoom")).fire(new Se("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=t??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t?this.setPitch(t):this.fire(new Se("pitchstart")).fire(new Se("pitch")).fire(new Se("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=t??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t?this.setPitch(t):this.fire(new Se("pitchstart")).fire(new Se("pitch")).fire(new Se("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.renderWorldCopies=t,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(t){return"auto"===t?ce.navigator.language:Array.isArray(t)?0===t.length?void 0:t.map(e=>"auto"===e?ce.navigator.language:e):t}setLanguage(t){const e=this._parseLanguage(t);if(!this.style||e===this._language)return this;this._language=e,this.style.clearSources();for(const n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(t){return this.style&&t!==this._worldview?(this._worldview=t,this.style.clearSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(t){return this._lazyInitEmptyStyle(),t?"string"==typeof t&&(t={name:t}):t=null,this._useExplicitProjection=!!t,this._prioritizeAndUpdateProjection(t,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const t=this.transform,e=t.projection.name;let n;"globe"===e&&t.zoom>=6?(t.setMercatorFromTransition(),n=!0):"mercator"===e&&t.zoom<6&&(t.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(t,e){return this._updateProjection(t||e||{name:"mercator"})}_updateProjection(t){let e;return e="globe"===t.name&&this.transform.zoom>=6?this.transform.setMercatorFromTransition():this.transform.setProjection(t),this.style.applyProjectionUpdate(),e&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(t){return this.transform.locationPoint3D(bt.convert(t))}unproject(t){return this.transform.pointLocation3D(ie.convert(t))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(t,e,n){if("mouseenter"===t||"mouseover"===t){let i=!1;const a=c=>{const h=e.filter(p=>this.getLayer(p)),f=h.length?this.queryRenderedFeatures(c.point,{layers:h}):[];f.length?i||(i=!0,n.call(this,new Us(t,this,c.originalEvent,{features:f}))):i=!1},l=()=>{i=!1};return{layers:new Set(e),listener:n,delegates:{mousemove:a,mouseout:l}}}if("mouseleave"===t||"mouseout"===t){let i=!1;const a=c=>{const h=e.filter(f=>this.getLayer(f));(h.length?this.queryRenderedFeatures(c.point,{layers:h}):[]).length?i=!0:i&&(i=!1,n.call(this,new Us(t,this,c.originalEvent)))},l=c=>{i&&(i=!1,n.call(this,new Us(t,this,c.originalEvent)))};return{layers:new Set(e),listener:n,delegates:{mousemove:a,mouseout:l}}}{const i=a=>{const l=e.filter(h=>this.getLayer(h)),c=l.length?this.queryRenderedFeatures(a.point,{layers:l}):[];c.length&&(a.features=c,n.call(this,a),delete a.features)};return{layers:new Set(e),listener:n,delegates:{[t]:i}}}}on(t,e,n){if(void 0===n)return super.on(t,e);if(Array.isArray(e)||(e=[e]),e)for(const a of e)if(!this._isValidId(a))return this;const i=this._createDelegatedListener(t,e,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(i);for(const a in i.delegates)this.on(a,i.delegates[a]);return this}once(t,e,n){if(void 0===n)return super.once(t,e);if(Array.isArray(e)||(e=[e]),e)for(const a of e)if(!this._isValidId(a))return this;const i=this._createDelegatedListener(t,e,n);for(const a in i.delegates)this.once(a,i.delegates[a]);return this}off(t,e,n){if(void 0===n)return super.off(t,e);e=new Set(Array.isArray(e)?e:[e]);for(const l of e)if(!this._isValidId(l))return this;const i=(l,c)=>{if(l.size!==c.size)return!1;for(const h of l)if(!c.has(h))return!1;return!0},a=this._delegatedListeners?this._delegatedListeners[t]:void 0;return a&&(l=>{for(let c=0;c<l.length;c++){const h=l[c];if(h.listener===n&&i(h.layers,e)){for(const f in h.delegates)this.off(f,h.delegates[f]);return l.splice(c,1),this}}})(a),this}queryRenderedFeatures(t,e){if(!this.style)return[];if(void 0!==e||void 0===t||t instanceof ie||Array.isArray(t)||(e=t,t=void 0),t=t||[[0,0],[this.transform.width,this.transform.height]],(e=e||{}).layers&&Array.isArray(e.layers))for(const n of e.layers)if(!this._isValidId(n))return[];return this.style.queryRenderedFeatures(t,e,this.transform)}querySourceFeatures(t,e){return this._isValidId(t)?this.style.querySourceFeatures(t,e):[]}isPointOnSurface(t){const{name:e}=this.transform.projection;return"globe"!==e&&"mercator"!==e&&ee(`${e} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(ie.convert(t))}setStyle(t,e){return!1!==(e=Ke({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},e)).diff&&e.localIdeographFontFamily===this._localIdeographFontFamily&&e.localFontFamily===this._localFontFamily&&this.style&&t?(this._diffStyle(t,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._localFontFamily=e.localFontFamily,this._updateStyle(t,e))}_getUIString(t){const e=this._locale[t];if(null==e)throw new Error(`Missing UI string '${t}'`);return e}_updateStyle(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),t&&(this.style=new Ca(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ca(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(t,e){if("string"==typeof t){const n=this._requestManager.normalizeStyleURL(t),i=this._requestManager.transformRequest(n,_e.Style);Me(i,(a,l)=>{a?this.fire(new xt(a)):l&&this._updateDiff(l,e)})}else"object"==typeof t&&this._updateDiff(t,e)}_updateDiff(t,e){try{this.style.setState(t)&&this._update(!0)}catch(n){ee(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(t,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(ee("There is no style added to the map."),!1)}_isValidId(t){return!(e=t,e.indexOf("\x1f")>=0&&(this.fire(new xt(new Error(`IDs can't contain special symbols: "${t}".`))),1));var e}addSource(t,e){return this._isValidId(t)?(this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)):this}isSourceLoaded(t){return!!this._isValidId(t)&&!!this.style&&this.style._isSourceCacheLoaded(t)}areTilesLoaded(){const t=this.style&&this.style._sourceCaches;for(const e in t){const n=t[e]._tiles;for(const i in n){const a=n[i];if("loaded"!==a.state&&"errored"!==a.state)return!1}}return!0}addSourceType(t,e,n){this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,n)}removeSource(t){return this._isValidId(t)?(this.style.removeSource(t),this._updateTerrain(),this._update(!0)):this}getSource(t){return this._isValidId(t)?this.style.getOwnSource(t):null}addImage(t,e,{pixelRatio:n=1,sdf:i=!1,stretchX:a,stretchY:l,content:c}={}){if(this._lazyInitEmptyStyle(),e instanceof ce.HTMLImageElement||ce.ImageBitmap&&e instanceof ce.ImageBitmap){const{width:h,height:f,data:p}=Ct.getImageData(e);this.style.addImage(t,{data:new Sr({width:h,height:f},p),pixelRatio:n,stretchX:a,stretchY:l,content:c,sdf:i,version:0})}else if(void 0===e.width||void 0===e.height)this.fire(new xt(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:h,height:f}=e,p=e;this.style.addImage(t,{data:new Sr({width:h,height:f},new Uint8Array(p.data)),pixelRatio:n,stretchX:a,stretchY:l,content:c,sdf:i,version:0,userImage:p}),p.onAdd&&p.onAdd(this,t)}}updateImage(t,e){this._lazyInitEmptyStyle();const n=this.style.getImage(t);if(!n)return void this.fire(new xt(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const i=e instanceof ce.HTMLImageElement||ce.ImageBitmap&&e instanceof ce.ImageBitmap?Ct.getImageData(e):e,{width:a,height:l}=i;void 0!==a&&void 0!==l?a===n.data.width&&l===n.data.height?(n.data.replace(i.data,!(e instanceof ce.HTMLImageElement||ce.ImageBitmap&&e instanceof ce.ImageBitmap)),this.style.updateImage(t,n)):this.fire(new xt(new Error(`The width and height of the updated image (${a}, ${l})\n                must be that same as the previous version of the image\n                (${n.data.width}, ${n.data.height})`))):this.fire(new xt(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(t){return t?!!this.style&&!!this.style.getImage(t):(this.fire(new xt(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(t,e){vt(this._requestManager.transformRequest(t,_e.Image),(n,i)=>{e(n,i instanceof ce.HTMLImageElement?Ct.getImageData(i):i)})}listImages(){return this.style.listImages()}addModel(t,e){this._lazyInitEmptyStyle(),this.style.addModel(t,e)}hasModel(t){return t?this.style.hasModel(t):(this.fire(new xt(new Error("Missing required model id"))),!1)}removeModel(t){this.style.removeModel(t)}listModels(){return this.style.listModels()}addLayer(t,e){return this._isValidId(t.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)):this}moveLayer(t,e){return this._isValidId(t)?(this.style.moveLayer(t,e),this._update(!0)):this}removeLayer(t){return this._isValidId(t)?(this.style.removeLayer(t),this._update(!0)):this}getLayer(t){return this._isValidId(t)?this.style.getOwnLayer(t):null}setLayerZoomRange(t,e,n){return this._isValidId(t)?(this.style.setLayerZoomRange(t,e,n),this._update(!0)):this}setFilter(t,e,n={}){return this._isValidId(t)?(this.style.setFilter(t,e,n),this._update(!0)):this}getFilter(t){return this._isValidId(t)?this.style.getFilter(t):null}setPaintProperty(t,e,n,i={}){return this._isValidId(t)?(this.style.setPaintProperty(t,e,n,i),this._update(!0)):this}getPaintProperty(t,e){return this._isValidId(t)?this.style.getPaintProperty(t,e):null}setLayoutProperty(t,e,n,i={}){return this._isValidId(t)?(this.style.setLayoutProperty(t,e,n,i),this._update(!0)):this}getLayoutProperty(t,e){return this._isValidId(t)?this.style.getLayoutProperty(t,e):null}setConfigProperty(t,e,n){return this.style.setConfigProperty(t,e,n),this._update(!0)}setLights(t){if(this._lazyInitEmptyStyle(),t&&1===t.length&&"flat"===t[0].type){const e=t[0];e.properties?this.style.setFlatLight(e.properties,e.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(t),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const t=this.style.getLights()||[];return 0===t.length&&t.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),t}setLight(t,e={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:t}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(t){return this._lazyInitEmptyStyle(),!t&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(t),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(t){return this._lazyInitEmptyStyle(),this.style.setFog(t),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(t){return this.style.setCamera(t),this._triggerCameraUpdate(t)}_triggerCameraUpdate(t){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===t["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(bt.convert(t),this.transform):0}setFeatureState(t,e){return this._isValidId(t.source)?(this.style.setFeatureState(t,e),this._update()):this}removeFeatureState(t,e){return this._isValidId(t.source)?(this.style.removeFeatureState(t,e),this._update()):this}getFeatureState(t){return this._isValidId(t.source)?this.style.getFeatureState(t):null}_updateContainerDimensions(){if(!this._container)return;const t=this._container.getBoundingClientRect().width||400,e=this._container.getBoundingClientRect().height||300;let n,i,a,l=this._container;for(;l&&(!i||!a);){const c=ce.getComputedStyle(l).transform;c&&"none"!==c&&(n=c.match(/matrix.*\((.+)\)/)[1].split(", "),n[0]&&"0"!==n[0]&&"1"!==n[0]&&(i=n[0]),n[3]&&"0"!==n[3]&&"1"!==n[3]&&(a=n[3])),l=l.parentElement}this._containerWidth=i?Math.abs(t/i):t,this._containerHeight=a?Math.abs(e/a):e}_detectMissingCSS(){"rgb(250, 128, 114)"!==ce.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&ee("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=Mt("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();const e=this._canvasContainer=Mt("div","mapboxgl-canvas-container",t);this._canvas=Mt("canvas","mapboxgl-canvas",e),this._interactive&&(e.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const n=this._controlContainer=Mt("div","mapboxgl-control-container",t),i=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(a=>{i[a]=Mt("div",`mapboxgl-ctrl-${a}`,n)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,e){const n=Ct.devicePixelRatio||1;this._canvas.width=n*Math.ceil(t),this._canvas.height=n*Math.ceil(e),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${e}px`}_addMarker(t){this._markers.push(t)}_removeMarker(t){const e=this._markers.indexOf(t);-1!==e&&this._markers.splice(e,1)}_addPopup(t){this._popups.push(t)}_removePopup(t){const e=this._popups.indexOf(t);-1!==e&&this._popups.splice(e,1)}_setupPainter(){const t=Ke({},nh.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),e=this._canvas.getContext("webgl2",t);e?(jp(e,!0),this.painter=new rS(e,this.transform),this.on("data",n=>{"source"===n.dataType&&this.painter.setTileLoadedFlag(!0)}),ro.testSupport(e)):this.fire(new xt(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new Se("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.resize(),this._update(),this.fire(new Se("webglcontextrestored",{originalEvent:t}))}_onMapScroll(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_requestDomTask(t){!this.loaded()||this.loaded()&&!this.isMoving()?t():this._domRenderTaskQueue.add(t)}_render(t){let e;this.fire(new Se("renderstart"));const n=this.painter.context.extTimerQuery,i=Ct.now(),a=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(e=a.createQuery(),a.beginQuery(n.TIME_ELAPSED_EXT,e)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],ce.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],ce.performance.now())),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;this._updateProjectionTransition();const l=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const f=this.transform.zoom,p=this.transform.pitch,g=Ct.now(),_=new pr(f,{now:g,fadeDuration:l,pitch:p,transition:this.style.transition});this.style.update(_)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let c=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),c=this._updateAverageElevation(i),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):c=this._updateAverageElevation(i),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,l,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new Se("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new Se("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),e){const f=Ct.now()-i;a.endQuery(n.TIME_ELAPSED_EXT),setTimeout(()=>{const p=a.getQueryParameter(e,a.QUERY_RESULT)/1e6;a.deleteQuery(e),this.fire(new Se("gpu-timing-frame",{cpuTime:f,gpuTime:p})),ce.performance.mark("frame-gpu",{startTime:i,detail:{gpuTime:p}})},50)}if(this.listens("gpu-timing-layer")){const f=this.painter.collectGpuTimers();setTimeout(()=>{const p=this.painter.queryGpuTimers(f);this.fire(new Se("gpu-timing-layer",{layerTimes:p}))},50)}if(this.listens("gpu-timing-deferred-render")){const f=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const p=this.painter.queryGpuTimeDeferredRender(f);this.fire(new Se("gpu-timing-deferred-render",{gpuTime:p}))},50)}const h=this._sourcesDirty||this._styleDirty||this._placementDirty||c;if(h||this._repaint)this.triggerRepaint();else{const f=!this.isMoving()&&this.loaded();if(f&&(c=this._updateAverageElevation(i,!0)),c)this.triggerRepaint();else if(this._triggerFrame(!1),f&&(this.fire(new Se("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const p=this._calculateSpeedIndex();this.fire(new Se("speedindexcompleted",{speedIndex:p})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||h||(this._fullyLoaded=!0,Ys.mark(Gc.fullLoad),this._performanceMetricsCollection&&k_(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(t){for(const e of this._markers)t&&!this.getRenderWorldCopies()&&(e._lngLat=e._lngLat.wrap()),e._update();for(const e of this._popups)!t||this.getRenderWorldCopies()||e._trackPointer||(e._lngLat=e._lngLat.wrap()),e._update()}_updateAverageElevation(t,e=!1){const n=a=>(this.transform.averageElevation=a,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&n(0);const i=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(i||(e||t-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(t)){const a=this.transform.averageElevation;let l=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(l)?l=0:this._averageElevationLastSampledAt=t;const c=Math.abs(a-l);if(c>1){if(this._isInitialLoad||i)return this._averageElevation.jumpTo(l),n(l);this._averageElevation.easeTo(l,t,300)}else if(c>1e-4)return this._averageElevation.jumpTo(l),n(l)}return!!this._averageElevation.isEasing(t)&&n(this._averageElevation.getValue(t))}_authenticate(){Vp(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,t=>{if(t&&(t.message===cn||401===t.status)){const e=this.painter.context.gl;jp(e,!1),this._logoControl instanceof vs&&this._logoControl._updateLogo(),e&&e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new xt(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),i1(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const t=this._isDragging();this.painter.updateTerrain(this.style,t)}_calculateSpeedIndex(){const t=this.painter.canvasCopy(),e=this.painter.getCanvasCopiesAndTimestamps();e.timeStamps.push(performance.now());const n=this.painter.context.gl,i=n.createFramebuffer();function a(l){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,l,0);const c=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,c),c}return n.bindFramebuffer(n.FRAMEBUFFER,i),this._canvasPixelComparison(a(t),e.canvasCopies.map(a),e.timeStamps)}_canvasPixelComparison(t,e,n){let i=n[1]-n[0];const a=t.length/4;for(let l=0;l<e.length;l++){const c=e[l];let h=0;for(let f=0;f<c.length;f+=4)c[f]===t[f]&&c[f+1]===t[f+1]&&c[f+2]===t[f+2]&&c[f+3]===t[f+3]&&(h+=1);i+=(n[l+2]-n[l+1])*(1-h/a)}return i}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==ce&&(ce.removeEventListener("resize",this._onWindowResize,!1),ce.removeEventListener("orientationchange",this._onWindowResize,!1),ce.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),ce.removeEventListener("online",this._onWindowOnline,!1),ce.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Ds.delete(this.painter.context.gl),this._removed=!0,this.fire(new Se("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=Ct.frame(e=>{const n=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,n&&this._render(e)}))}_preloadTiles(t){return gl(this.style?Object.values(this.style._sourceCaches):[],(e,n)=>e._preloadTiles(t,n),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(t){this._trackResize&&this.resize({originalEvent:t})._update()}_onVisibilityChange(){"hidden"===ce.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(t){this._showTerrainWireframe!==t&&(this._showTerrainWireframe=t,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(t){this._showLayers2DWireframe!==t&&(this._showLayers2DWireframe=t,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(t){this._showLayers3DWireframe!==t&&(this._showLayers3DWireframe=t,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(t){this._speedIndexTiming!==t&&(this._speedIndexTiming=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(t){this._showTileAABBs!==t&&(this._showTileAABBs=t,t&&this._update())}_setCacheLimits(t,e){Br=t,Qr=e}get version(){return Jo}},NavigationControl:class{constructor(t){this.options=Ke({},$s,t),this._container=Mt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(Xr(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",e=>{this._map&&this._map.zoomIn({},{originalEvent:e})}),Mt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",e=>{this._map&&this._map.zoomOut({},{originalEvent:e})}),Mt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(Xr(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",e=>{const n=this._map;n&&(this.options.visualizePitch?n.resetNorthPitch({},{originalEvent:e}):n.resetNorth({},{originalEvent:e}))}),this._compassIcon=Mt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const t=this._map;if(!t)return;const e=t.getZoom(),n=e===t.getMaxZoom(),i=e===t.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString())}_rotateCompassArrow(){const t=this._map;if(!t)return;const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(t.transform.pitch*(Math.PI/180)),.5)}) rotateX(${t.transform.pitch}deg) rotateZ(${t.transform.angle*(180/Math.PI)}deg)`:`rotate(${t.transform.angle*(180/Math.PI)}deg)`;t._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=e)})}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),t.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&t.on("pitch",this._rotateCompassArrow),t.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Sx(t,this._compass,this.options.visualizePitch)),this._container}onRemove(){const t=this._map;t&&(this._container.remove(),this.options.showZoom&&t.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&t.off("pitch",this._rotateCompassArrow),t.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(t,e){const n=Mt("button",t,this._container);return n.type="button",n.addEventListener("click",e),n}_setButtonTitle(t,e){if(!this._map)return;const n=this._map._getUIString(`NavigationControl.${e}`);t.setAttribute("aria-label",n),t.firstElementChild&&t.firstElementChild.setAttribute("title",n)}},GeolocateControl:class extends Mn{constructor(t){super(),this.options=Ke({geolocation:ce.navigator.geolocation},TS,t),Xr(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=al(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(t){return this._map=t,this._container=Mt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(t){const e=(n=!!this.options.geolocation)=>{this._supportsGeolocation=n,t(n)};void 0!==this._supportsGeolocation?t(this._supportsGeolocation):void 0!==ce.navigator.permissions?ce.navigator.permissions.query({name:"geolocation"}).then(n=>e("denied"!==n.state)).catch(()=>e()):e()}_isOutOfMapMaxBounds(t){const e=this._map.getMaxBounds(),n=t.coords;return!!e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new Se("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new Se("geolocate",t)),this._finish()}}_updateCamera(t){const e=new bt(t.coords.longitude,t.coords.latitude),n=t.coords.accuracy,i=Ke({bearing:this._map.getBearing()},this.options.fitBoundsOptions);this._map.fitBounds(e.toBounds(n),i,{geolocateSource:!0})}_updateMarker(t){if(t){const e=new bt(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(e).addTo(this._map),this._userLocationDotMarker.setLngLat(e).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map.transform,e=kn(1,t._center.lat)*t.worldSize,n=Math.ceil(2*this._accuracy*e);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new Se("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=Mt("button","mapboxgl-ctrl-geolocate",this._container),Mt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===t){ee("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Mt("div","mapboxgl-user-location"),this._dotElement.appendChild(Mt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Mt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new cT({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Mt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new cT({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",e=>{e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new Se("trackuserlocationend")))})}}_onDeviceOrientation(t){this._userLocationDotMarker&&(t.webkitCompassHeading?this._heading=t.webkitCompassHeading:!0===t.absolute&&(this._heading=-1*t.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return ee("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new Se("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new Se("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new Se("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let t;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(t={maximumAge:6e5,timeout:0},this._noTimeout=!0):(t=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,t),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const t=()=>{ce.addEventListener("ondeviceorientationabsolute"in ce?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==ce.DeviceMotionEvent&&"function"==typeof ce.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(e=>{"granted"===e&&t()}).catch(console.error):t()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),ce.removeEventListener("deviceorientation",this._onDeviceOrientation),ce.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Sp,ScaleControl:class{constructor(t){this.options=Ke({},DS,t),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),Xr(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const t=this.options.maxWidth||100,e=this._map,n=e._containerHeight/2,i=e._containerWidth/2-t/2,a=e.unproject([i,n]),l=e.unproject([i+t,n]),c=a.distanceTo(l);if("imperial"===this.options.unit){const h=3.2808*c;h>5280?this._setScale(t,h/5280,"mile"):this._setScale(t,h,"foot")}else"nautical"===this.options.unit?this._setScale(t,c/1852,"nautical-mile"):c>=1e3?this._setScale(t,c/1e3,"kilometer"):this._setScale(t,c,"meter")}_setScale(t,e,n){this._map._requestDomTask(()=>{const i=function(l){const c=Math.pow(10,`${Math.floor(l)}`.length-1);let h=l/c;return h=h>=10?10:h>=5?5:h>=3?3:h>=2?2:h>=1?1:function(f){const p=Math.pow(10,Math.ceil(-Math.log(f)/Math.LN10));return Math.round(f*p)/p}(h),c*h}(e),a=i/e;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==n?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:n}).format(i):`${i}&nbsp;${MS[n]}`,this._container.style.width=t*a+"px"})}onAdd(t){return this._map=t,this._language=t.getLanguage(),this._container=Mt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(t){this._language=t,this._update()}setUnit(t){this.options.unit=t,this._update()}},FullscreenControl:class{constructor(t){this._fullscreen=!1,t&&t.container&&(t.container instanceof ce.HTMLElement?this._container=t.container:ee("Full screen control 'container' must be a DOM element.")),Xr(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in ce.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in ce.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=Mt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",ee("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,ce.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!ce.document.fullscreenEnabled&&!ce.document.webkitFullscreenEnabled)}_setupUI(){const t=this._fullscreenButton=Mt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Mt("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),ce.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",t)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(ce.document.fullscreenElement||ce.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?ce.document.exitFullscreen?ce.document.exitFullscreen():ce.document.webkitCancelFullScreen&&ce.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends Mn{constructor(t){super(),this.options=Ke(Object.create(wS),t),Xr(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[])}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&t.on("preclick",this._onClose),this.options.closeOnMove&&t.on("move",this._onClose),t.on("remove",this.remove),this._update(),t._addPopup(this),this._focusFirstElement(),this._trackPointer?(t.on("mousemove",this._onMouseEvent),t.on("mouseup",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")):t.on("move",this._update),this.fire(new Se("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const t=this._map;return t&&(t.off("move",this._update),t.off("move",this._onClose),t.off("preclick",this._onClose),t.off("click",this._onClose),t.off("remove",this.remove),t.off("mousemove",this._onMouseEvent),t.off("mouseup",this._onMouseEvent),t.off("drag",this._onMouseEvent),t._canvasContainer&&t._canvasContainer.classList.remove("mapboxgl-track-pointer"),t._removePopup(this),this._map=void 0),this.fire(new Se("close")),this}getLngLat(){return this._lngLat}setLngLat(t){this._lngLat=bt.convert(t),this._pos=null,this._trackPointer=!1,this._update();const e=this._map;return e&&(e.on("move",this._update),e.off("mousemove",this._onMouseEvent),e._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const t=this._map;return t&&(t.off("move",this._update),t.on("mousemove",this._onMouseEvent),t.on("drag",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(ce.document.createTextNode(t))}setHTML(t){const e=ce.document.createDocumentFragment(),n=ce.document.createElement("body");let i;for(n.innerHTML=t;i=n.firstChild,i;)e.appendChild(i);return this.setDOMContent(e)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){let e=this._content;if(e)for(;e.hasChildNodes();)e.firstChild&&e.removeChild(e.firstChild);else e=this._content=Mt("div","mapboxgl-popup-content",this._container||void 0);if(e.appendChild(t),this.options.closeButton){const n=this._closeButton=Mt("button","mapboxgl-popup-close-button",e);n.type="button",n.setAttribute("aria-label","Close popup"),n.setAttribute("aria-hidden","true"),n.innerHTML="&#215;",n.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(t){return this._classList.add(t),this._updateClassList(),this}removeClassName(t){return this._classList.delete(t),this._updateClassList(),this}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){let e;return this._classList.delete(t)?e=!1:(this._classList.add(t),e=!0),this._updateClassList(),e}_onMouseEvent(t){this._update(t.point)}_getAnchor(t){if(this.options.anchor)return this.options.anchor;const e=this._map,n=this._container,i=this._pos;if(!e||!n||!i)return"bottom";const a=n.offsetWidth,l=n.offsetHeight,c=i.x<a/2,h=i.x>e.transform.width-a/2;if(i.y+t<l)return c?"top-left":h?"top-right":"top";if(i.y>e.transform.height-l){if(c)return"bottom-left";if(h)return"bottom-right"}return c?"left":h?"right":"bottom"}_updateClassList(){const t=this._container;if(!t)return;const e=[...this._classList];e.push("mapboxgl-popup"),this._anchor&&e.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&e.push("mapboxgl-popup-track-pointer"),t.className=e.join(" ")}_update(t){const e=this._map,n=this._content;if(!e||!this._lngLat&&!this._trackPointer||!n)return;let i=this._container;if(i||(i=this._container=Mt("div","mapboxgl-popup",e.getContainer()),this._tip=Mt("div","mapboxgl-popup-tip",i),i.appendChild(n)),this.options.maxWidth&&i.style.maxWidth!==this.options.maxWidth&&(i.style.maxWidth=this.options.maxWidth),e.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=xS(this._lngLat,this._pos,e.transform)),!this._trackPointer||t){const a=this._pos=this._trackPointer&&t?t:e.project(this._lngLat),l=Mx(this.options.offset),c=this._anchor=this._getAnchor(l.y),h=Mx(this.options.offset,c),f=a.add(h).round();e._requestDomTask(()=>{this._container&&c&&(this._container.style.transform=`${lT[c]} translate(${f.x}px,${f.y}px)`)})}if(!this._marker&&e._showingGlobe()){const a=Km(e.transform,this._lngLat)?0:1;this._setOpacity(a)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const t=this._container.querySelector(bS);t&&t.focus()}_onClose(){this.remove()}_setOpacity(t){this._container&&(this._container.style.opacity=`${t}`),this._content&&(this._content.style.pointerEvents=t?"auto":"none")}},Marker:cT,Style:Ca,LngLat:bt,LngLatBounds:Ji,Point:ie,MercatorCoordinate:nn,FreeCameraOptions:o0,Evented:Mn,config:Rt,prewarm:function(){Bu().acquire(fp)},clearPrewarmedResources:function(){const t=pp;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(fp),pp=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return Rt.ACCESS_TOKEN},set accessToken(t){Rt.ACCESS_TOKEN=t},get baseApiUrl(){return Rt.API_URL},set baseApiUrl(t){Rt.API_URL=t},get workerCount(){return Er.workerCount},set workerCount(t){Er.workerCount=t},get maxParallelImageRequests(){return Rt.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){Rt.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){!function(e){if(!Ra())return;const n=ce.caches.delete(Vn);e&&n.catch(e).then(()=>e())}(t)},workerUrl:"",workerClass:null,get dracoUrl(){return mp()},set dracoUrl(t){F0=Ct.resolveURL(t),N0||(N0=new Gg(Bu(),new Mn)),N0.broadcast("setDracoUrl",F0)},setNow:Ct.setNow,restoreNow:Ct.restoreNow};rt.A=nC,rt.D=Su,rt.E=he,rt.F=Lv,rt.K=o_,rt.O=_n,rt.P=ie,rt.T=SE,rt.V=Vf,rt.a=Tv,rt.b=Mu,rt.c=up,rt.d=class extends Mn{constructor(t,e,n,i,a,l){super(),this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=a||aC,this.loading={},this.loaded={},this.deduped=new sC(t.scheduler),this.isSpriteLoaded=i,this.scheduler=t.scheduler,this.brightness=l}loadTile(t,e){const n=t.uid,i=t&&t.request,a=i&&i.collectResourceTiming,l=this.loading[n]=new MI(t);l.abort=this.loadVectorData(t,(c,h)=>{const f=!this.loading[n];if(delete this.loading[n],f||c||!h)return l.status="done",f||(this.loaded[n]=l),e(c);const p=h.rawData,g={};h.expires&&(g.expires=h.expires),h.cacheControl&&(g.cacheControl=h.cacheControl),l.vectorTile=h.vectorTile||new Mv(new ug(p));const _=()=>{l.parse(l.vectorTile,this.layerIndex,this.availableImages,this.actor,(y,v)=>{if(y||!v)return e(y);const w={};if(a){const E=Up(i);E.length>0&&(w.resourceTiming=JSON.parse(JSON.stringify(E)))}e(null,Ke({rawTileData:p.slice(0)},v,g,w))})};this.isSpriteLoaded?_():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(_,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):_()}),this.loaded=this.loaded||{},this.loaded[n]=l})}reloadTile(t,e){const n=this.loaded,i=t.uid,a=this;if(n&&n[i]){const l=n[i];l.showCollisionBoxes=t.showCollisionBoxes,l.projection=t.projection,l.brightness=t.brightness,l.tileTransform=Po(t.tileID.canonical,t.projection),l.extraShadowCaster=t.extraShadowCaster;const c=(h,f)=>{const p=l.reloadCallback;p&&(delete l.reloadCallback,l.parse(l.vectorTile,a.layerIndex,this.availableImages,a.actor,p)),e(h,f)};"parsing"===l.status?l.reloadCallback=c:"done"===l.status&&(l.vectorTile?l.parse(l.vectorTile,this.layerIndex,this.availableImages,this.actor,c):c())}}abortTile(t,e){const n=t.uid,i=this.loading[n];i&&(i.abort&&i.abort(),delete this.loading[n]),e()}removeTile(t,e){const n=this.loaded,i=t.uid;n&&n[i]&&delete n[i],e()}},rt.e=fc,rt.f=Up,rt.g=oo,rt.h=Me,rt.i=je,rt.j=function(t,e){const n=gp(t);for(const i of n){for(const a of i.meshes)p2(a);i.lights&&(i.lightMeshIndex=i.meshes.length,i.meshes.push(pC(i.lights,e)))}return n},rt.k=pr,rt.l=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==uC){const n=new Uint32Array(t,0,7),[,,i,a,l,c]=n;e=n.byteLength+a+l+c+l,(i!==t.byteLength||e>=t.byteLength)&&ee("Invalid b3dm header information.")}return Kg(t,e)},rt.m=ed,rt.n=mo,rt.o=Se,rt.p=Sa,rt.q=function(t){ao(),Pi&&Pi.then(e=>{e.keys().then(n=>{for(let i=0;i<n.length-t;i++)e.delete(n[i])})})},rt.r=gC,rt.s=E_,rt.t=Nh,rt.v=xe,rt.w=ce}),zr(0,function(rt){function ce(ke){if("number"==typeof ke||"boolean"==typeof ke||"string"==typeof ke||null==ke)return JSON.stringify(ke);if(Array.isArray(ke)){let X="[";for(const ee of ke)X+=`${ce(ee)},`;return`${X}]`}let q="{";for(const X of Object.keys(ke).sort())q+=`${X}:${ce(ke[X])},`;return`${q}}`}function Jo(ke){let q="";for(const X of rt.r)q+=`/${ce(ke[X])}`;return q}class ji{constructor(q){this.keyCache={},q&&this.replace(q)}replace(q,X){this._layerConfigs={},this._layers={},this.update(q,[],X)}update(q,X,ee){this._options=ee;for(const we of q){this._layerConfigs[we.id]=we;const Ae=this._layers[we.id]=rt.c(we,this._options);Ae.setScope(this.scope),Ae.compileFilter(),this.keyCache[we.id]&&delete this.keyCache[we.id]}for(const we of X)delete this.keyCache[we],delete this._layerConfigs[we],delete this._layers[we];this.familiesBySource={};const be=function(we,Ae){const tt={};for(let st=0;st<we.length;st++){const mt=Ae&&Ae[we[st].id]||Jo(we[st]);Ae&&(Ae[we[st].id]=mt);let _t=tt[mt];_t||(_t=tt[mt]=[]),_t.push(we[st])}const De=[];for(const st in tt)De.push(tt[st]);return De}(rt.v(this._layerConfigs),this.keyCache);for(const we of be){const Ae=we.map(Dn=>this._layers[Dn.id]),tt=Ae[0];if("none"===tt.visibility)continue;const De=tt.source||"";let st=this.familiesBySource[De];st||(st=this.familiesBySource[De]={});const mt=tt.sourceLayer||"_geojsonTileLayer";let _t=st[mt];_t||(_t=st[mt]=[]),_t.push(Ae)}}}class Rt{loadTile(q,X){const{uid:ee,encoding:be,rawImageData:we,padding:Ae}=q,tt=rt.w.ImageBitmap&&we instanceof rt.w.ImageBitmap?this.getImageData(we,Ae):we;X(null,new rt.D(ee,tt,be,q.convertToFloat,Ae<1))}getImageData(q,X){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(q.width,q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=q.width,this.offscreenCanvas.height=q.height,this.offscreenCanvasContext.drawImage(q,0,0,q.width,q.height);const ee=this.offscreenCanvasContext.getImageData(-X,-X,q.width+2*X,q.height+2*X);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ee}}function ro(ke,q){if(0!==ke.length){io(ke[0],q);for(var X=1;X<ke.length;X++)io(ke[X],!q)}}function io(ke,q){for(var X=0,ee=0,be=0,we=ke.length,Ae=we-1;be<we;Ae=be++){var tt=(ke[be][0]-ke[Ae][0])*(ke[Ae][1]+ke[be][1]),De=X+tt;ee+=Math.abs(X)>=Math.abs(tt)?X-De+tt:tt-De+X,X=De}X+ee>=0!=!!q&&ke.reverse()}var Gs=rt.g(function ke(q,X){var ee,be=q&&q.type;if("FeatureCollection"===be)for(ee=0;ee<q.features.length;ee++)ke(q.features[ee],X);else if("GeometryCollection"===be)for(ee=0;ee<q.geometries.length;ee++)ke(q.geometries[ee],X);else if("Feature"===be)ke(q.geometry,X);else if("Polygon"===be)ro(q.coordinates,X);else if("MultiPolygon"===be)for(ee=0;ee<q.coordinates.length;ee++)ro(q.coordinates[ee],X);return q});const Ql=rt.V.prototype.toGeoJSON;var Da={exports:{}},Qu=rt.p,Ma=rt.a.VectorTileFeature,oo=bs;function bs(ke,q){this.options=q||{},this.features=ke,this.length=ke.length}function Es(ke,q){this.id="number"==typeof ke.id?ke.id:void 0,this.type=ke.type,this.rawGeometry=1===ke.type?[ke.geometry]:ke.geometry,this.properties=ke.tags,this.extent=q||4096}bs.prototype.feature=function(ke){return new Es(this.features[ke],this.options.extent)},Es.prototype.loadGeometry=function(){var ke=this.rawGeometry;this.geometry=[];for(var q=0;q<ke.length;q++){for(var X=ke[q],ee=[],be=0;be<X.length;be++)ee.push(new Qu(X[be][0],X[be][1]));this.geometry.push(ee)}return this.geometry},Es.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ke=this.geometry,q=1/0,X=-1/0,ee=1/0,be=-1/0,we=0;we<ke.length;we++)for(var Ae=ke[we],tt=0;tt<Ae.length;tt++){var De=Ae[tt];q=Math.min(q,De.x),X=Math.max(X,De.x),ee=Math.min(ee,De.y),be=Math.max(be,De.y)}return[q,ee,X,be]},Es.prototype.toGeoJSON=Ma.prototype.toGeoJSON;var eh=rt.b,Sa=oo;function Qo(ke){var q=new eh;return function(X,ee){for(var be in X.layers)ee.writeMessage(3,ie,X.layers[be])}(ke,q),q.finish()}function ie(ke,q){var X;q.writeVarintField(15,ke.version||1),q.writeStringField(1,ke.name||""),q.writeVarintField(5,ke.extent||4096);var ee={keys:[],values:[],keycache:{},valuecache:{}};for(X=0;X<ke.length;X++)ee.feature=ke.feature(X),q.writeMessage(2,ln,ee);var be=ee.keys;for(X=0;X<be.length;X++)q.writeStringField(3,be[X]);var we=ee.values;for(X=0;X<we.length;X++)q.writeMessage(4,Od,we[X])}function ln(ke,q){var X=ke.feature;void 0!==X.id&&q.writeVarintField(1,X.id),q.writeMessage(2,pl,ke),q.writeVarintField(3,X.type),q.writeMessage(4,kr,X)}function pl(ke,q){var X=ke.feature,ee=ke.keys,be=ke.values,we=ke.keycache,Ae=ke.valuecache;for(var tt in X.properties){var De=X.properties[tt],st=we[tt];if(null!==De){void 0===st&&(ee.push(tt),we[tt]=st=ee.length-1),q.writeVarint(st);var mt=typeof De;"string"!==mt&&"boolean"!==mt&&"number"!==mt&&(De=JSON.stringify(De));var _t=mt+":"+De,Dn=Ae[_t];void 0===Dn&&(be.push(De),Ae[_t]=Dn=be.length-1),q.writeVarint(Dn)}}}function es(ke,q){return(q<<3)+(7&ke)}function At(ke){return ke<<1^ke>>31}function kr(ke,q){for(var X=ke.loadGeometry(),ee=ke.type,be=0,we=0,Ae=X.length,tt=0;tt<Ae;tt++){var De=X[tt],st=1;1===ee&&(st=De.length),q.writeVarint(es(1,st));for(var mt=3===ee?De.length-1:De.length,_t=0;_t<mt;_t++){1===_t&&1!==ee&&q.writeVarint(es(2,mt-1));var Dn=De[_t].x-be,Zn=De[_t].y-we;q.writeVarint(At(Dn)),q.writeVarint(At(Zn)),be+=Dn,we+=Zn}3===ee&&q.writeVarint(es(7,1))}}function Od(ke,q){var X=typeof ke;"string"===X?q.writeStringField(1,ke):"boolean"===X?q.writeBooleanField(7,ke):"number"===X&&(ke%1!=0?q.writeDoubleField(3,ke):ke<0?q.writeSVarintField(6,ke):q.writeVarintField(5,ke))}Da.exports=Qo,Da.exports.fromVectorTileJs=Qo,Da.exports.fromGeojsonVt=function(ke,q){q=q||{};var X={};for(var ee in ke)X[ee]=new Sa(ke[ee].features,q),X[ee].name=ee,X[ee].version=q.version,X[ee].extent=q.extent;return Qo({layers:X})},Da.exports.GeoJSONWrapper=Sa;var Aa=rt.g(Da.exports);const qs={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ke=>ke},ml=Math.fround||(Ia=new Float32Array(1),ke=>(Ia[0]=+ke,Ia[0]));var Ia;class ts{constructor(q){this.options=Object.assign(Object.create(qs),q),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(q){const{log:X,minZoom:ee,maxZoom:be}=this.options;X&&console.time("total time");const we=`prepare ${q.length} points`;X&&console.time(we),this.points=q;const Ae=[];for(let De=0;De<q.length;De++){const st=q[De];if(!st.geometry)continue;const[mt,_t]=st.geometry.coordinates,Dn=ml(Ke(mt)),Zn=ml(fi(_t));Ae.push(Dn,Zn,1/0,De,-1,1),this.options.reduce&&Ae.push(0)}let tt=this.trees[be+1]=this._createTree(Ae);X&&console.timeEnd(we);for(let De=be;De>=ee;De--){const st=+Date.now();tt=this.trees[De]=this._createTree(this._cluster(tt,De)),X&&console.log("z%d: %d clusters in %dms",De,tt.numItems,+Date.now()-st)}return X&&console.timeEnd("total time"),this}getClusters(q,X){let ee=((q[0]+180)%360+360)%360-180;const be=Math.max(-90,Math.min(90,q[1]));let we=180===q[2]?180:((q[2]+180)%360+360)%360-180;const Ae=Math.max(-90,Math.min(90,q[3]));if(q[2]-q[0]>=360)ee=-180,we=180;else if(ee>we){const _t=this.getClusters([ee,be,180,Ae],X),Dn=this.getClusters([-180,be,we,Ae],X);return _t.concat(Dn)}const tt=this.trees[this._limitZoom(X)],De=tt.range(Ke(ee),fi(Ae),Ke(we),fi(be)),st=tt.data,mt=[];for(const _t of De){const Dn=this.stride*_t;mt.push(st[Dn+5]>1?gl(st,Dn,this.clusterProps):this.points[st[Dn+3]])}return mt}getChildren(q){const X=this._getOriginId(q),ee=this._getOriginZoom(q),be="No cluster with the specified id.",we=this.trees[ee];if(!we)throw new Error(be);const Ae=we.data;if(X*this.stride>=Ae.length)throw new Error(be);const tt=this.options.radius/(this.options.extent*Math.pow(2,ee-1)),De=we.within(Ae[X*this.stride],Ae[X*this.stride+1],tt),st=[];for(const mt of De){const _t=mt*this.stride;Ae[_t+4]===q&&st.push(Ae[_t+5]>1?gl(Ae,_t,this.clusterProps):this.points[Ae[_t+3]])}if(0===st.length)throw new Error(be);return st}getLeaves(q,X,ee){const be=[];return this._appendLeaves(be,q,X=X||10,ee=ee||0,0),be}getTile(q,X,ee){const be=this.trees[this._limitZoom(q)],we=Math.pow(2,q),{extent:Ae,radius:tt}=this.options,De=tt/Ae,st=(ee-De)/we,mt=(ee+1+De)/we,_t={features:[]};return this._addTileFeatures(be.range((X-De)/we,st,(X+1+De)/we,mt),be.data,X,ee,we,_t),0===X&&this._addTileFeatures(be.range(1-De/we,st,1,mt),be.data,we,ee,we,_t),X===we-1&&this._addTileFeatures(be.range(0,st,De/we,mt),be.data,-1,ee,we,_t),_t.features.length?_t:null}getClusterExpansionZoom(q){let X=this._getOriginZoom(q)-1;for(;X<=this.options.maxZoom;){const ee=this.getChildren(q);if(X++,1!==ee.length)break;q=ee[0].properties.cluster_id}return X}_appendLeaves(q,X,ee,be,we){const Ae=this.getChildren(X);for(const tt of Ae){const De=tt.properties;if(De&&De.cluster?we+De.point_count<=be?we+=De.point_count:we=this._appendLeaves(q,De.cluster_id,ee,be,we):we<be?we++:q.push(tt),q.length===ee)break}return we}_createTree(q){const X=new rt.K(q.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ee=0;ee<q.length;ee+=this.stride)X.add(q[ee],q[ee+1]);return X.finish(),X.data=q,X}_addTileFeatures(q,X,ee,be,we,Ae){for(const tt of q){const De=tt*this.stride,st=X[De+5]>1;let mt,_t,Dn;if(st)mt=xe(X,De,this.clusterProps),_t=X[De],Dn=X[De+1];else{const Bn=this.points[X[De+3]];mt=Bn.properties;const[En,Vn]=Bn.geometry.coordinates;_t=Ke(En),Dn=fi(Vn)}const Zn={type:1,geometry:[[Math.round(this.options.extent*(_t*we-ee)),Math.round(this.options.extent*(Dn*we-be))]],tags:mt};let tr;tr=st||this.options.generateId?X[De+3]:this.points[X[De+3]].id,void 0!==tr&&(Zn.id=tr),Ae.features.push(Zn)}}_limitZoom(q){return Math.max(this.options.minZoom,Math.min(Math.floor(+q),this.options.maxZoom+1))}_cluster(q,X){const{radius:ee,extent:be,reduce:we,minPoints:Ae}=this.options,tt=ee/(be*Math.pow(2,X)),De=q.data,st=[],mt=this.stride;for(let _t=0;_t<De.length;_t+=mt){if(De[_t+2]<=X)continue;De[_t+2]=X;const Dn=De[_t],Zn=De[_t+1],tr=q.within(De[_t],De[_t+1],tt),Bn=De[_t+5];let En=Bn;for(const Vn of tr){const Br=Vn*mt;De[Br+2]>X&&(En+=De[Br+5])}if(En>Bn&&En>=Ae){let Vn,Br=Dn*Bn,Qr=Zn*Bn,Pi=-1;const so=((_t/mt|0)<<5)+(X+1)+this.points.length;for(const Ra of tr){const ao=Ra*mt;if(De[ao+2]<=X)continue;De[ao+2]=X;const ns=De[ao+5];Br+=De[ao]*ns,Qr+=De[ao+1]*ns,De[ao+4]=so,we&&(Vn||(Vn=this._map(De,_t,!0),Pi=this.clusterProps.length,this.clusterProps.push(Vn)),we(Vn,this._map(De,ao)))}De[_t+4]=so,st.push(Br/En,Qr/En,1/0,so,-1,En),we&&st.push(Pi)}else{for(let Vn=0;Vn<mt;Vn++)st.push(De[_t+Vn]);if(En>1)for(const Vn of tr){const Br=Vn*mt;if(!(De[Br+2]<=X)){De[Br+2]=X;for(let Qr=0;Qr<mt;Qr++)st.push(De[Br+Qr])}}}}return st}_getOriginId(q){return q-this.points.length>>5}_getOriginZoom(q){return(q-this.points.length)%32}_map(q,X,ee){if(q[X+5]>1){const Ae=this.clusterProps[q[X+6]];return ee?Object.assign({},Ae):Ae}const be=this.points[q[X+3]].properties,we=this.options.map(be);return ee&&we===be?Object.assign({},we):we}}function gl(ke,q,X){return{type:"Feature",id:ke[q+3],properties:xe(ke,q,X),geometry:{type:"Point",coordinates:[(ee=ke[q],360*(ee-.5)),Zr(ke[q+1])]}};var ee}function xe(ke,q,X){const ee=ke[q+5],be=ee>=1e4?`${Math.round(ee/1e3)}k`:ee>=1e3?Math.round(ee/100)/10+"k":ee,we=ke[q+6],Ae=-1===we?{}:Object.assign({},X[we]);return Object.assign(Ae,{cluster:!0,cluster_id:ke[q+3],point_count:ee,point_count_abbreviated:be})}function Ke(ke){return ke/360+.5}function fi(ke){const q=Math.sin(ke*Math.PI/180),X=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return X<0?0:X>1?1:X}function Zr(ke){const q=(180-360*ke)*Math.PI/180;return 360*Math.atan(Math.exp(q))/Math.PI-90}var vr={exports:{}};vr.exports=function(){function ke(_e,ye,Ee,Fe){for(var Me,je=Fe,He=Ee-ye>>1,Be=Ee-ye,Ie=_e[ye],Le=_e[ye+1],vt=_e[Ee],cn=_e[Ee+1],Je=ye+3;Je<Ee;Je+=3){var Nt=q(_e[Je],_e[Je+1],Ie,Le,vt,cn);if(Nt>je)Me=Je,je=Nt;else if(Nt===je){var vn=Math.abs(Je-He);vn<Be&&(Me=Je,Be=vn)}}je>Fe&&(Me-ye>3&&ke(_e,ye,Me,Fe),_e[Me+2]=je,Ee-Me>3&&ke(_e,Me,Ee,Fe))}function q(_e,ye,Ee,Fe,Me,je){var He=Me-Ee,Be=je-Fe;if(0!==He||0!==Be){var Ie=((_e-Ee)*He+(ye-Fe)*Be)/(He*He+Be*Be);Ie>1?(Ee=Me,Fe=je):Ie>0&&(Ee+=He*Ie,Fe+=Be*Ie)}return(He=_e-Ee)*He+(Be=ye-Fe)*Be}function X(_e,ye,Ee,Fe){var Me={id:void 0===_e?null:_e,type:ye,geometry:Ee,tags:Fe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(je){var He=je.geometry,Be=je.type;if("Point"===Be||"MultiPoint"===Be||"LineString"===Be)ee(je,He);else if("Polygon"===Be||"MultiLineString"===Be)for(var Ie=0;Ie<He.length;Ie++)ee(je,He[Ie]);else if("MultiPolygon"===Be)for(Ie=0;Ie<He.length;Ie++)for(var Le=0;Le<He[Ie].length;Le++)ee(je,He[Ie][Le])}(Me),Me}function ee(_e,ye){for(var Ee=0;Ee<ye.length;Ee+=3)_e.minX=Math.min(_e.minX,ye[Ee]),_e.minY=Math.min(_e.minY,ye[Ee+1]),_e.maxX=Math.max(_e.maxX,ye[Ee]),_e.maxY=Math.max(_e.maxY,ye[Ee+1])}function be(_e,ye,Ee,Fe){if(ye.geometry){var Me=ye.geometry.coordinates,je=ye.geometry.type,He=Math.pow(Ee.tolerance/((1<<Ee.maxZoom)*Ee.extent),2),Be=[],Ie=ye.id;if(Ee.promoteId?Ie=ye.properties[Ee.promoteId]:Ee.generateId&&(Ie=Fe||0),"Point"===je)we(Me,Be);else if("MultiPoint"===je)for(var Le=0;Le<Me.length;Le++)we(Me[Le],Be);else if("LineString"===je)Ae(Me,Be,He,!1);else if("MultiLineString"===je){if(Ee.lineMetrics){for(Le=0;Le<Me.length;Le++)Ae(Me[Le],Be=[],He,!1),_e.push(X(Ie,"LineString",Be,ye.properties));return}tt(Me,Be,He,!1)}else if("Polygon"===je)tt(Me,Be,He,!0);else{if("MultiPolygon"!==je){if("GeometryCollection"===je){for(Le=0;Le<ye.geometry.geometries.length;Le++)be(_e,{id:Ie,geometry:ye.geometry.geometries[Le],properties:ye.properties},Ee,Fe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Le=0;Le<Me.length;Le++){var vt=[];tt(Me[Le],vt,He,!0),Be.push(vt)}}_e.push(X(Ie,je,Be,ye.properties))}}function we(_e,ye){ye.push(De(_e[0])),ye.push(st(_e[1])),ye.push(0)}function Ae(_e,ye,Ee,Fe){for(var Me,je,He=0,Be=0;Be<_e.length;Be++){var Ie=De(_e[Be][0]),Le=st(_e[Be][1]);ye.push(Ie),ye.push(Le),ye.push(0),Be>0&&(He+=Fe?(Me*Le-Ie*je)/2:Math.sqrt(Math.pow(Ie-Me,2)+Math.pow(Le-je,2))),Me=Ie,je=Le}var vt=ye.length-3;ye[2]=1,ke(ye,0,vt,Ee),ye[vt+2]=1,ye.size=Math.abs(He),ye.start=0,ye.end=ye.size}function tt(_e,ye,Ee,Fe){for(var Me=0;Me<_e.length;Me++){var je=[];Ae(_e[Me],je,Ee,Fe),ye.push(je)}}function De(_e){return _e/360+.5}function st(_e){var ye=Math.sin(_e*Math.PI/180),Ee=.5-.25*Math.log((1+ye)/(1-ye))/Math.PI;return Ee<0?0:Ee>1?1:Ee}function mt(_e,ye,Ee,Fe,Me,je,He,Be){if(Fe/=ye,je>=(Ee/=ye)&&He<Fe)return _e;if(He<Ee||je>=Fe)return null;for(var Ie=[],Le=0;Le<_e.length;Le++){var vt=_e[Le],cn=vt.geometry,Je=vt.type,Nt=0===Me?vt.minX:vt.minY,vn=0===Me?vt.maxX:vt.maxY;if(Nt>=Ee&&vn<Fe)Ie.push(vt);else if(!(vn<Ee||Nt>=Fe)){var hr=[];if("Point"===Je||"MultiPoint"===Je)_t(cn,hr,Ee,Fe,Me);else if("LineString"===Je)Dn(cn,hr,Ee,Fe,Me,!1,Be.lineMetrics);else if("MultiLineString"===Je)tr(cn,hr,Ee,Fe,Me,!1);else if("Polygon"===Je)tr(cn,hr,Ee,Fe,Me,!0);else if("MultiPolygon"===Je)for(var dr=0;dr<cn.length;dr++){var nr=[];tr(cn[dr],nr,Ee,Fe,Me,!0),nr.length&&hr.push(nr)}if(hr.length){if(Be.lineMetrics&&"LineString"===Je){for(dr=0;dr<hr.length;dr++)Ie.push(X(vt.id,Je,hr[dr],vt.tags));continue}"LineString"!==Je&&"MultiLineString"!==Je||(1===hr.length?(Je="LineString",hr=hr[0]):Je="MultiLineString"),"Point"!==Je&&"MultiPoint"!==Je||(Je=3===hr.length?"Point":"MultiPoint"),Ie.push(X(vt.id,Je,hr,vt.tags))}}}return Ie.length?Ie:null}function _t(_e,ye,Ee,Fe,Me){for(var je=0;je<_e.length;je+=3){var He=_e[je+Me];He>=Ee&&He<=Fe&&(ye.push(_e[je]),ye.push(_e[je+1]),ye.push(_e[je+2]))}}function Dn(_e,ye,Ee,Fe,Me,je,He){for(var Be,Ie,Le=Zn(_e),vt=0===Me?En:Vn,cn=_e.start,Je=0;Je<_e.length-3;Je+=3){var Nt=_e[Je],vn=_e[Je+1],hr=_e[Je+2],dr=_e[Je+3],nr=_e[Je+4],Bo=0===Me?Nt:vn,Or=0===Me?dr:nr,Ri=!1;He&&(Be=Math.sqrt(Math.pow(Nt-dr,2)+Math.pow(vn-nr,2))),Bo<Ee?Or>Ee&&(Ie=vt(Le,Nt,vn,dr,nr,Ee),He&&(Le.start=cn+Be*Ie)):Bo>Fe?Or<Fe&&(Ie=vt(Le,Nt,vn,dr,nr,Fe),He&&(Le.start=cn+Be*Ie)):Bn(Le,Nt,vn,hr),Or<Ee&&Bo>=Ee&&(Ie=vt(Le,Nt,vn,dr,nr,Ee),Ri=!0),Or>Fe&&Bo<=Fe&&(Ie=vt(Le,Nt,vn,dr,nr,Fe),Ri=!0),!je&&Ri&&(He&&(Le.end=cn+Be*Ie),ye.push(Le),Le=Zn(_e)),He&&(cn+=Be)}var ai=_e.length-3;Nt=_e[ai],vn=_e[ai+1],hr=_e[ai+2],(Bo=0===Me?Nt:vn)>=Ee&&Bo<=Fe&&Bn(Le,Nt,vn,hr),ai=Le.length-3,je&&ai>=3&&(Le[ai]!==Le[0]||Le[ai+1]!==Le[1])&&Bn(Le,Le[0],Le[1],Le[2]),Le.length&&ye.push(Le)}function Zn(_e){var ye=[];return ye.size=_e.size,ye.start=_e.start,ye.end=_e.end,ye}function tr(_e,ye,Ee,Fe,Me,je){for(var He=0;He<_e.length;He++)Dn(_e[He],ye,Ee,Fe,Me,je,!1)}function Bn(_e,ye,Ee,Fe){_e.push(ye),_e.push(Ee),_e.push(Fe)}function En(_e,ye,Ee,Fe,Me,je){var He=(je-ye)/(Fe-ye);return _e.push(je),_e.push(Ee+(Me-Ee)*He),_e.push(1),He}function Vn(_e,ye,Ee,Fe,Me,je){var He=(je-Ee)/(Me-Ee);return _e.push(ye+(Fe-ye)*He),_e.push(je),_e.push(1),He}function Br(_e,ye){for(var Ee=[],Fe=0;Fe<_e.length;Fe++){var Me,je=_e[Fe],He=je.type;if("Point"===He||"MultiPoint"===He||"LineString"===He)Me=Qr(je.geometry,ye);else if("MultiLineString"===He||"Polygon"===He){Me=[];for(var Be=0;Be<je.geometry.length;Be++)Me.push(Qr(je.geometry[Be],ye))}else if("MultiPolygon"===He)for(Me=[],Be=0;Be<je.geometry.length;Be++){for(var Ie=[],Le=0;Le<je.geometry[Be].length;Le++)Ie.push(Qr(je.geometry[Be][Le],ye));Me.push(Ie)}Ee.push(X(je.id,He,Me,je.tags))}return Ee}function Qr(_e,ye){var Ee=[];Ee.size=_e.size,void 0!==_e.start&&(Ee.start=_e.start,Ee.end=_e.end);for(var Fe=0;Fe<_e.length;Fe+=3)Ee.push(_e[Fe]+ye,_e[Fe+1],_e[Fe+2]);return Ee}function Pi(_e,ye){if(_e.transformed)return _e;var Ee,Fe,Me,je=1<<_e.z,He=_e.x,Be=_e.y;for(Ee=0;Ee<_e.features.length;Ee++){var Ie=_e.features[Ee],Le=Ie.geometry,vt=Ie.type;if(Ie.geometry=[],1===vt)for(Fe=0;Fe<Le.length;Fe+=2)Ie.geometry.push(so(Le[Fe],Le[Fe+1],ye,je,He,Be));else for(Fe=0;Fe<Le.length;Fe++){var cn=[];for(Me=0;Me<Le[Fe].length;Me+=2)cn.push(so(Le[Fe][Me],Le[Fe][Me+1],ye,je,He,Be));Ie.geometry.push(cn)}}return _e.transformed=!0,_e}function so(_e,ye,Ee,Fe,Me,je){return[Math.round(Ee*(_e*Fe-Me)),Math.round(Ee*(ye*Fe-je))]}function Ra(_e,ye,Ee,Fe,Me){for(var je=ye===Me.maxZoom?0:Me.tolerance/((1<<ye)*Me.extent),He={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Ee,y:Fe,z:ye,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Be=0;Be<_e.length;Be++){He.numFeatures++,ao(He,_e[Be],je,Me);var Ie=_e[Be].minX,Le=_e[Be].minY,vt=_e[Be].maxX,cn=_e[Be].maxY;Ie<He.minX&&(He.minX=Ie),Le<He.minY&&(He.minY=Le),vt>He.maxX&&(He.maxX=vt),cn>He.maxY&&(He.maxY=cn)}return He}function ao(_e,ye,Ee,Fe){var Me=ye.geometry,je=ye.type,He=[];if("Point"===je||"MultiPoint"===je)for(var Be=0;Be<Me.length;Be+=3)He.push(Me[Be]),He.push(Me[Be+1]),_e.numPoints++,_e.numSimplified++;else if("LineString"===je)ns(He,Me,_e,Ee,!1,!1);else if("MultiLineString"===je||"Polygon"===je)for(Be=0;Be<Me.length;Be++)ns(He,Me[Be],_e,Ee,"Polygon"===je,0===Be);else if("MultiPolygon"===je)for(var Ie=0;Ie<Me.length;Ie++){var Le=Me[Ie];for(Be=0;Be<Le.length;Be++)ns(He,Le[Be],_e,Ee,!0,0===Be)}if(He.length){var vt=ye.tags||null;if("LineString"===je&&Fe.lineMetrics){for(var cn in vt={},ye.tags)vt[cn]=ye.tags[cn];vt.mapbox_clip_start=Me.start/Me.size,vt.mapbox_clip_end=Me.end/Me.size}var Je={geometry:He,type:"Polygon"===je||"MultiPolygon"===je?3:"LineString"===je||"MultiLineString"===je?2:1,tags:vt};null!==ye.id&&(Je.id=ye.id),_e.features.push(Je)}}function ns(_e,ye,Ee,Fe,Me,je){var He=Fe*Fe;if(Fe>0&&ye.size<(Me?He:Fe))Ee.numPoints+=ye.length/3;else{for(var Be=[],Ie=0;Ie<ye.length;Ie+=3)(0===Fe||ye[Ie+2]>He)&&(Ee.numSimplified++,Be.push(ye[Ie]),Be.push(ye[Ie+1])),Ee.numPoints++;Me&&function(Le,vt){for(var cn=0,Je=0,Nt=Le.length,vn=Nt-2;Je<Nt;vn=Je,Je+=2)cn+=(Le[Je]-Le[vn])*(Le[Je+1]+Le[vn+1]);if(cn>0===vt)for(Je=0,Nt=Le.length;Je<Nt/2;Je+=2){var hr=Le[Je],dr=Le[Je+1];Le[Je]=Le[Nt-2-Je],Le[Je+1]=Le[Nt-1-Je],Le[Nt-2-Je]=hr,Le[Nt-1-Je]=dr}}(Be,je),_e.push(Be)}}function Ts(_e,ye){var Ee=(ye=this.options=function(Me,je){for(var He in je)Me[He]=je[He];return Me}(Object.create(this.options),ye)).debug;if(Ee&&console.time("preprocess data"),ye.maxZoom<0||ye.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ye.promoteId&&ye.generateId)throw new Error("promoteId and generateId cannot be used together.");var Me,je,He,Be,Ie,Le,Fe=function(Me,je){var He=[];if("FeatureCollection"===Me.type)for(var Be=0;Be<Me.features.length;Be++)be(He,Me.features[Be],je,Be);else be(He,"Feature"===Me.type?Me:{geometry:Me},je);return He}(_e,ye);this.tiles={},this.tileCoords=[],Ee&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ye.indexMaxZoom,ye.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Me=Fe,je=ye,He=je.buffer/je.extent,Be=Me,Ie=mt(Me,1,-1-He,He,0,-1,2,je),Le=mt(Me,1,1-He,2+He,0,-1,2,je),(Ie||Le)&&(Be=mt(Me,1,-He,1+He,0,-1,2,je)||[],Ie&&(Be=Br(Ie,1).concat(Be)),Le&&(Be=Be.concat(Br(Le,-1)))),Fe=Be).length&&this.splitTile(Fe,0,0,0),Ee&&(Fe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Zs(_e,ye,Ee){return 32*((1<<_e)*Ee+ye)+_e}return Ts.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ts.prototype.splitTile=function(_e,ye,Ee,Fe,Me,je,He){for(var Be=[_e,ye,Ee,Fe],Ie=this.options,Le=Ie.debug;Be.length;){Fe=Be.pop(),Ee=Be.pop(),ye=Be.pop(),_e=Be.pop();var vt=1<<ye,cn=Zs(ye,Ee,Fe),Je=this.tiles[cn];if(!Je&&(Le>1&&console.time("creation"),Je=this.tiles[cn]=Ra(_e,ye,Ee,Fe,Ie),this.tileCoords.push({z:ye,x:Ee,y:Fe}),Le)){Le>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ye,Ee,Fe,Je.numFeatures,Je.numPoints,Je.numSimplified),console.timeEnd("creation"));var Nt="z"+ye;this.stats[Nt]=(this.stats[Nt]||0)+1,this.total++}if(Je.source=_e,Me){if(ye===Ie.maxZoom||ye===Me)continue;var vn=1<<Me-ye;if(Ee!==Math.floor(je/vn)||Fe!==Math.floor(He/vn))continue}else if(ye===Ie.indexMaxZoom||Je.numPoints<=Ie.indexMaxPoints)continue;if(Je.source=null,0!==_e.length){Le>1&&console.time("clipping");var hr,dr,nr,Bo,Or,Ri,ai=.5*Ie.buffer/Ie.extent,lo=.5-ai,Xs=.5+ai,Vr=1+ai;hr=dr=nr=Bo=null,Or=mt(_e,vt,Ee-ai,Ee+Xs,0,Je.minX,Je.maxX,Ie),Ri=mt(_e,vt,Ee+lo,Ee+Vr,0,Je.minX,Je.maxX,Ie),_e=null,Or&&(hr=mt(Or,vt,Fe-ai,Fe+Xs,1,Je.minY,Je.maxY,Ie),dr=mt(Or,vt,Fe+lo,Fe+Vr,1,Je.minY,Je.maxY,Ie),Or=null),Ri&&(nr=mt(Ri,vt,Fe-ai,Fe+Xs,1,Je.minY,Je.maxY,Ie),Bo=mt(Ri,vt,Fe+lo,Fe+Vr,1,Je.minY,Je.maxY,Ie),Ri=null),Le>1&&console.timeEnd("clipping"),Be.push(hr||[],ye+1,2*Ee,2*Fe),Be.push(dr||[],ye+1,2*Ee,2*Fe+1),Be.push(nr||[],ye+1,2*Ee+1,2*Fe),Be.push(Bo||[],ye+1,2*Ee+1,2*Fe+1)}}},Ts.prototype.getTile=function(_e,ye,Ee){var Fe=this.options,Me=Fe.extent,je=Fe.debug;if(_e<0||_e>24)return null;var He=1<<_e,Be=Zs(_e,ye=(ye%He+He)%He,Ee);if(this.tiles[Be])return Pi(this.tiles[Be],Me);je>1&&console.log("drilling down to z%d-%d-%d",_e,ye,Ee);for(var Ie,Le=_e,vt=ye,cn=Ee;!Ie&&Le>0;)Le--,vt=Math.floor(vt/2),cn=Math.floor(cn/2),Ie=this.tiles[Zs(Le,vt,cn)];return Ie&&Ie.source?(je>1&&console.log("found parent tile z%d-%d-%d",Le,vt,cn),je>1&&console.time("drilling down"),this.splitTile(Ie.source,Le,vt,cn,_e,ye,Ee),je>1&&console.timeEnd("drilling down"),this.tiles[Be]?Pi(this.tiles[Be],Me):null):null},function(_e,ye){return new Ts(_e,ye)}}();var vi=rt.g(vr.exports);function rn(ke,q){const X=ke.tileID.canonical;if(!this._geoJSONIndex)return q(null,null);const ee=this._geoJSONIndex.getTile(X.z,X.x,X.y);if(!ee)return q(null,null);const be=new class{constructor(Ae){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=rt.E,this.length=Ae.length,this._features=Ae}feature(Ae){return new class{constructor(tt){this._feature=tt,this.extent=rt.E,this.type=tt.type,this.properties=tt.tags,"id"in tt&&!isNaN(tt.id)&&(this.id=parseInt(tt.id,10))}loadGeometry(){if(1===this._feature.type){const tt=[];for(const De of this._feature.geometry)tt.push([new rt.P(De[0],De[1])]);return tt}{const tt=[];for(const De of this._feature.geometry){const st=[];for(const mt of De)st.push(new rt.P(mt[0],mt[1]));tt.push(st)}return tt}}toGeoJSON(tt,De,st){return Ql.call(this,tt,De,st)}}(this._features[Ae])}}(ee.features);let we=Aa(be);0===we.byteOffset&&we.byteLength===we.buffer.byteLength||(we=new Uint8Array(we)),q(null,{vectorTile:be,rawData:we.buffer})}class _l extends rt.d{constructor(q,X,ee,be,we,Ae){super(q,X,ee,be,rn,Ae),we&&(this.loadGeoJSON=we)}loadData(q,X){const ee=q&&q.request,be=ee&&ee.collectResourceTiming;this.loadGeoJSON(q,(we,Ae)=>{if(we||!Ae)return X(we);if("object"!=typeof Ae)return X(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`));{Gs(Ae,!0);try{if(q.filter){const De=rt.e(q.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===De.result)throw new Error(De.value.map(mt=>`${mt.key}: ${mt.message}`).join(", "));const st=Ae.features.filter(mt=>De.value.evaluate({zoom:0},mt));Ae={type:"FeatureCollection",features:st}}this._geoJSONIndex=q.cluster?new ts(function({superclusterOptions:De,clusterProperties:st}){if(!st||!De)return De;const mt={},_t={},Dn={accumulated:null,zoom:0},Zn={properties:null},tr=Object.keys(st);for(const Bn of tr){const[En,Vn]=st[Bn],Br=rt.e(Vn),Qr=rt.e("string"==typeof En?[En,["accumulated"],["get",Bn]]:En);mt[Bn]=Br.value,_t[Bn]=Qr.value}return De.map=Bn=>{Zn.properties=Bn;const En={};for(const Vn of tr)En[Vn]=mt[Vn].evaluate(Dn,Zn);return En},De.reduce=(Bn,En)=>{Zn.properties=En;for(const Vn of tr)Dn.accumulated=Bn[Vn],Bn[Vn]=_t[Vn].evaluate(Dn,Zn)},De}(q)).load(Ae.features):vi(Ae,q.geojsonVtOptions)}catch(De){return X(De)}this.loaded={};const tt={};if(be){const De=rt.f(ee);De&&(tt.resourceTiming={},tt.resourceTiming[q.source]=JSON.parse(JSON.stringify(De)))}X(null,tt)}})}reloadTile(q,X){const ee=this.loaded;return ee&&ee[q.uid]?super.reloadTile(q,X):this.loadTile(q,X)}loadGeoJSON(q,X){if(q.request)rt.h(q.request,X);else{if("string"!=typeof q.data)return X(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`));try{return X(null,JSON.parse(q.data))}catch{return X(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(q,X){try{X(null,this._geoJSONIndex.getClusterExpansionZoom(q.clusterId))}catch(ee){X(ee)}}getClusterChildren(q,X){try{X(null,this._geoJSONIndex.getChildren(q.clusterId))}catch(ee){X(ee)}}getClusterLeaves(q,X){try{X(null,this._geoJSONIndex.getLeaves(q.clusterId,q.limit,q.offset))}catch(ee){X(ee)}}}class Xr{constructor(q,X){this.tileID=new rt.O(q.tileID.overscaledZ,q.tileID.wrap,q.tileID.canonical.z,q.tileID.canonical.x,q.tileID.canonical.y),this.tileZoom=q.tileZoom,this.uid=q.uid,this.zoom=q.zoom,this.canonical=q.tileID.canonical,this.pixelRatio=q.pixelRatio,this.tileSize=q.tileSize,this.source=q.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=q.projection,this.brightness=X}parse(q,X,ee,be){this.status="parsing";const we=new rt.O(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),Ae={},tt=X.familiesBySource[ee.source],De=new rt.F(we,ee.promoteId);return De.bucketLayerIDs=[],rt.l(q).then(st=>{if(!st)return be(new Error("Could not parse tile"));const mt=rt.j(st,1/rt.t(ee.tileID.canonical)),_t=st.json.extensionsUsed&&st.json.extensionsUsed.includes("MAPBOX_mesh_features"),Dn=new rt.k(this.zoom,{brightness:this.brightness});for(const Zn in tt)for(const tr of tt[Zn]){const Bn=tr[0],En=st.json.extensionsUsed;Bn.recalculate(Dn,[]);const Vn=new rt.T(mt,we,En&&En.includes("MAPBOX_mesh_features"),this.brightness);_t||(Vn.needsUpload=!0),Ae[Bn.fqid]=Vn,Vn.evaluate(Bn)}this.status="done",be(null,{buckets:Ae,featureIndex:De})}).catch(st=>be(new Error(st.message)))}}class Pa{constructor(q,X,ee,be,we,Ae){this.actor=q,this.layerIndex=X,this.brightness=Ae,this.loading={},this.loaded={}}loadTile(q,X){const ee=q.uid,be=this.loading[ee]=new Xr(q,this.brightness);rt.i(q.request,(we,Ae)=>{const tt=!this.loading[ee];return delete this.loading[ee],tt||we?(be.status="done",tt||(this.loaded[ee]=be),X(we)):Ae&&0!==Ae.byteLength?void be.parse(Ae,this.layerIndex,q,(De,st)=>{be.status="done",this.loaded=this.loaded||{},this.loaded[ee]=be,De||!st?X(De):X(null,st)}):(be.status="done",this.loaded[ee]=be,X())})}reloadTile(q,X){const ee=this.loaded,be=q.uid;if(ee&&ee[be]){const we=ee[be];we.projection=q.projection,we.brightness=q.brightness;const Ae=(tt,De)=>{we.reloadCallback&&(delete we.reloadCallback,this.loadTile(q,X)),X(tt,De)};"parsing"===we.status?we.reloadCallback=Ae:"done"===we.status&&this.loadTile(q,X)}}abortTile(q,X){const ee=q.uid;this.loading[ee]&&delete this.loading[ee],X()}removeTile(q,X){const ee=this.loaded,be=q.uid;ee&&ee[be]&&delete ee[be],X()}}class Ws{constructor(q){this.self=q,this.actor=new rt.A(q,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=rt.m({name:"mercator"}),this.workerSourceTypes={vector:rt.d,geojson:_l,"batched-model":Pa},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(X,ee)=>{if(this.workerSourceTypes[X])throw new Error(`Worker source with name "${X}" already registered.`);this.workerSourceTypes[X]=ee},this.self.registerRTLTextPlugin=X=>{if(rt.n.isParsed())throw new Error("RTL text plugin already registered.");rt.n.applyArabicShaping=X.applyArabicShaping,rt.n.processBidirectionalText=X.processBidirectionalText,rt.n.processStyledBidirectionalText=X.processStyledBidirectionalText}}clearCaches(q,X,ee){delete this.layerIndexes[q],delete this.availableImages[q],delete this.workerSources[q],delete this.demWorkerSources[q],ee()}checkIfReady(q,X,ee){ee()}setReferrer(q,X){this.referrer=X}spriteLoaded(q,{scope:X,isLoaded:ee}){if(this.isSpriteLoaded[q]||(this.isSpriteLoaded[q]={}),this.isSpriteLoaded[q][X]=ee,this.workerSources[q]&&this.workerSources[q][X])for(const be in this.workerSources[q][X]){const we=this.workerSources[q][X][be];for(const Ae in we)we[Ae]instanceof rt.d&&(we[Ae].isSpriteLoaded=ee,we[Ae].fire(new rt.o("isSpriteLoaded")))}}setImages(q,{scope:X,images:ee},be){if(this.availableImages[q]||(this.availableImages[q]={}),this.availableImages[q][X]=ee,this.workerSources[q]&&this.workerSources[q][X]){for(const we in this.workerSources[q][X]){const Ae=this.workerSources[q][X][we];for(const tt in Ae)Ae[tt].availableImages=ee}be()}else be()}setProjection(q,X){this.projections[q]=rt.m(X)}setBrightness(q,X,ee){this.brightness=X,ee()}setLayers(q,X,ee){this.getLayerIndex(q,X.scope).replace(X.layers,X.options),ee()}updateLayers(q,X,ee){this.getLayerIndex(q,X.scope).update(X.layers,X.removedIds,X.options),ee()}loadTile(q,X,ee){X.projection=this.projections[q]||this.defaultProjection,this.getWorkerSource(q,X.type,X.source,X.scope).loadTile(X,ee)}loadDEMTile(q,X,ee){this.getDEMWorkerSource(q,X.source,X.scope).loadTile(X,ee)}reloadTile(q,X,ee){X.projection=this.projections[q]||this.defaultProjection,this.getWorkerSource(q,X.type,X.source,X.scope).reloadTile(X,ee)}abortTile(q,X,ee){this.getWorkerSource(q,X.type,X.source,X.scope).abortTile(X,ee)}removeTile(q,X,ee){this.getWorkerSource(q,X.type,X.source,X.scope).removeTile(X,ee)}removeSource(q,X,ee){if(!(this.workerSources[q]&&this.workerSources[q][X.scope]&&this.workerSources[q][X.scope][X.type]&&this.workerSources[q][X.scope][X.type][X.source]))return;const be=this.workerSources[q][X.scope][X.type][X.source];delete this.workerSources[q][X.scope][X.type][X.source],void 0!==be.removeSource?be.removeSource(X,ee):ee()}loadWorkerSource(q,X,ee){try{this.self.importScripts(X.url),ee()}catch(be){ee(be.toString())}}syncRTLPluginState(q,X,ee){try{rt.n.setState(X);const be=rt.n.getPluginURL();if(rt.n.isLoaded()&&!rt.n.isParsed()&&null!=be){this.self.importScripts(be);const we=rt.n.isParsed();ee(we?void 0:new Error(`RTL Text Plugin failed to import scripts from ${be}`),we)}}catch(be){ee(be.toString())}}setDracoUrl(q,X){this.dracoUrl=X}getAvailableImages(q,X){this.availableImages[q]||(this.availableImages[q]={});let ee=this.availableImages[q][X];return ee||(ee=[]),ee}getLayerIndex(q,X){this.layerIndexes[q]||(this.layerIndexes[q]={});let ee=this.layerIndexes[q][X];return ee||(ee=this.layerIndexes[q][X]=new ji,ee.scope=X),ee}getWorkerSource(q,X,ee,be){return this.workerSources[q]||(this.workerSources[q]={}),this.workerSources[q][be]||(this.workerSources[q][be]={}),this.workerSources[q][be][X]||(this.workerSources[q][be][X]={}),this.isSpriteLoaded[q]||(this.isSpriteLoaded[q]={}),this.workerSources[q][be][X][ee]||(this.workerSources[q][be][X][ee]=new this.workerSourceTypes[X]({send:(Ae,tt,De,st,mt,_t)=>{this.actor.send(Ae,tt,De,q,mt,_t)},scheduler:this.actor.scheduler},this.getLayerIndex(q,be),this.getAvailableImages(q,be),this.isSpriteLoaded[q][be],void 0,this.brightness)),this.workerSources[q][be][X][ee]}getDEMWorkerSource(q,X,ee){return this.demWorkerSources[q]||(this.demWorkerSources[q]={}),this.demWorkerSources[q][ee]||(this.demWorkerSources[q][ee]={}),this.demWorkerSources[q][ee][X]||(this.demWorkerSources[q][ee][X]=new Rt),this.demWorkerSources[q][ee][X]}enforceCacheSizeLimit(q,X){rt.q(X)}getWorkerPerformanceMetrics(q,X,ee){ee(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ws(self)),Ws}),zr(0,function(rt){return rt.s}),Fn}()},226:function(kd){kd.exports=function(){"use strict";function Fn(N){var M=function Vi(N,M){if("object"!=typeof N||!N)return N;var O=N[Symbol.toPrimitive];if(void 0!==O){var z=O.call(N,M||"default");if("object"!=typeof z)return z;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===M?String:Number)(N)}(N,"string");return"symbol"==typeof M?M:String(M)}function zr(N){return(zr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(M){return typeof M}:function(M){return M&&"function"==typeof Symbol&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M})(N)}function Hc(N,M){if(!(N instanceof M))throw new TypeError("Cannot call a class as a function")}function rt(N,M){for(var O=0;O<M.length;O++){var z=M[O];z.enumerable=z.enumerable||!1,z.configurable=!0,"value"in z&&(z.writable=!0),Object.defineProperty(N,Fn(z.key),z)}}function ce(N,M,O){return M&&rt(N.prototype,M),O&&rt(N,O),Object.defineProperty(N,"prototype",{writable:!1}),N}function ji(N){return(ji=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(O){return O.__proto__||Object.getPrototypeOf(O)})(N)}function Rt(N,M){return(Rt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(z,ne){return z.__proto__=ne,z})(N,M)}function ro(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function io(N,M,O){return(io=ro()?Reflect.construct.bind():function(ne,Te,at){var hn=[null];hn.push.apply(hn,Te);var wr=new(Function.bind.apply(ne,hn));return at&&Rt(wr,at.prototype),wr}).apply(null,arguments)}function Ql(N,M){if(M&&("object"==typeof M||"function"==typeof M))return M;if(void 0!==M)throw new TypeError("Derived constructors may only return object or undefined");return function Gs(N){if(void 0===N)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return N}(N)}function Qu(N,M){for(;!Object.prototype.hasOwnProperty.call(N,M)&&null!==(N=ji(N)););return N}function Ma(){return Ma=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(M,O,z){var ne=Qu(M,O);if(ne){var Te=Object.getOwnPropertyDescriptor(ne,O);return Te.get?Te.get.call(arguments.length<3?M:z):Te.value}},Ma.apply(this,arguments)}function oo(N,M){return function eh(N){if(Array.isArray(N))return N}(N)||function ws(N,M){var O=null==N?null:typeof Symbol<"u"&&N[Symbol.iterator]||N["@@iterator"];if(null!=O){var z,ne,Te,at,hn=[],xn=!0,wr=!1;try{if(Te=(O=O.call(N)).next,0===M){if(Object(O)!==O)return;xn=!1}else for(;!(xn=(z=Te.call(O)).done)&&(hn.push(z.value),hn.length!==M);xn=!0);}catch(Ne){wr=!0,ne=Ne}finally{try{if(!xn&&null!=O.return&&(at=O.return(),Object(at)!==at))return}finally{if(wr)throw ne}}return hn}}(N,M)||Qo(N,M)||function pl(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bs(N){return function Es(N){if(Array.isArray(N))return ie(N)}(N)||function Sa(N){if(typeof Symbol<"u"&&null!=N[Symbol.iterator]||null!=N["@@iterator"])return Array.from(N)}(N)||Qo(N)||function ln(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qo(N,M){if(N){if("string"==typeof N)return ie(N,M);var O=Object.prototype.toString.call(N).slice(8,-1);if("Object"===O&&N.constructor&&(O=N.constructor.name),"Map"===O||"Set"===O)return Array.from(N);if("Arguments"===O||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(O))return ie(N,M)}}function ie(N,M){(null==M||M>N.length)&&(M=N.length);for(var O=0,z=new Array(M);O<M;O++)z[O]=N[O];return z}function es(N,M){return function Od(N,M){return M.get?M.get.call(N):M.value}(N,kr(N,M,"get"))}function At(N,M,O){return function Aa(N,M,O){if(M.set)M.set.call(N,O);else{if(!M.writable)throw new TypeError("attempted to set read only private field");M.value=O}}(N,kr(N,M,"set"),O),O}function kr(N,M,O){if(!M.has(N))throw new TypeError("attempted to "+O+" private field on non-instance");return M.get(N)}function ml(N,M,O){(function qs(N,M){if(M.has(N))throw new TypeError("Cannot initialize the same private elements twice on an object")})(N,M),M.set(N,O)}var ft={},Cs=function(M){return new Promise(function(O){if(!M)return O();var z=window.scrollX,ne=window.scrollY;ft.restoreFocusTimeout=setTimeout(function(){ft.previousActiveElement instanceof HTMLElement?(ft.previousActiveElement.focus(),ft.previousActiveElement=null):document.body&&document.body.focus(),O()},100),window.scrollTo(z,ne)})},xe=["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","default-outline","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error"].reduce(function(N,M){return N[M]="swal2-"+M,N},{}),fi=["success","warning","info","question","error"].reduce(function(N,M){return N[M]="swal2-"+M,N},{}),Zr="SweetAlert2:",vr=function(M){return M.charAt(0).toUpperCase()+M.slice(1)},vi=function(M){console.warn("".concat(Zr," ").concat("object"===zr(M)?M.join(" "):M))},rn=function(M){console.error("".concat(Zr," ").concat(M))},_l=[],Pa=function(M,O){!function(M){_l.includes(M)||(_l.push(M),vi(M))}('"'.concat(M,'" is deprecated and will be removed in the next major release. Please use "').concat(O,'" instead.'))},Ws=function(M){return"function"==typeof M?M():M},ke=function(M){return M&&"function"==typeof M.toPromise},q=function(M){return ke(M)?M.toPromise():Promise.resolve(M)},X=function(M){return M&&Promise.resolve(M)===M},ee=function(){return document.body.querySelector(".".concat(xe.container))},be=function(M){var O=ee();return O?O.querySelector(M):null},we=function(M){return be(".".concat(M))},Ae=function(){return we(xe.popup)},tt=function(){return we(xe.icon)},st=function(){return we(xe.title)},mt=function(){return we(xe["html-container"])},_t=function(){return we(xe.image)},Dn=function(){return we(xe["progress-steps"])},Zn=function(){return we(xe["validation-message"])},tr=function(){return be(".".concat(xe.actions," .").concat(xe.confirm))},Bn=function(){return be(".".concat(xe.actions," .").concat(xe.cancel))},En=function(){return be(".".concat(xe.actions," .").concat(xe.deny))},Br=function(){return be(".".concat(xe.loader))},Qr=function(){return we(xe.actions)},Pi=function(){return we(xe.footer)},so=function(){return we(xe["timer-progress-bar"])},Ra=function(){return we(xe.close)},ns=function(){var M=Ae();if(!M)return[];var O=M.querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])'),z=Array.from(O).sort(function(at,hn){var xn=parseInt(at.getAttribute("tabindex")||"0"),wr=parseInt(hn.getAttribute("tabindex")||"0");return xn>wr?1:xn<wr?-1:0}),ne=M.querySelectorAll('\n  a[href],\n  area[href],\n  input:not([disabled]),\n  select:not([disabled]),\n  textarea:not([disabled]),\n  button:not([disabled]),\n  iframe,\n  object,\n  embed,\n  [tabindex="0"],\n  [contenteditable],\n  audio[controls],\n  video[controls],\n  summary\n'),Te=Array.from(ne).filter(function(at){return"-1"!==at.getAttribute("tabindex")});return bs(new Set(z.concat(Te))).filter(function(at){return nr(at)})},Ts=function(){return Ee(document.body,xe.shown)&&!Ee(document.body,xe["toast-shown"])&&!Ee(document.body,xe["no-backdrop"])},Zs=function(){var M=Ae();return!!M&&Ee(M,xe.toast)},ye=function(M,O){if(M.textContent="",O){var ne=(new DOMParser).parseFromString(O,"text/html"),Te=ne.querySelector("head");Te&&Array.from(Te.childNodes).forEach(function(hn){M.appendChild(hn)});var at=ne.querySelector("body");at&&Array.from(at.childNodes).forEach(function(hn){hn instanceof HTMLVideoElement||hn instanceof HTMLAudioElement?M.appendChild(hn.cloneNode(!0)):M.appendChild(hn)})}},Ee=function(M,O){if(!O)return!1;for(var z=O.split(/\s+/),ne=0;ne<z.length;ne++)if(!M.classList.contains(z[ne]))return!1;return!0},Me=function(M,O,z){if(function(M,O){Array.from(M.classList).forEach(function(z){!Object.values(xe).includes(z)&&!Object.values(fi).includes(z)&&!Object.values(O.showClass||{}).includes(z)&&M.classList.remove(z)})}(M,O),O.customClass&&O.customClass[z]){if("string"!=typeof O.customClass[z]&&!O.customClass[z].forEach)return void vi("Invalid type of customClass.".concat(z,'! Expected string or iterable object, got "').concat(zr(O.customClass[z]),'"'));Ie(M,O.customClass[z])}},je=function(M,O){if(!O)return null;switch(O){case"select":case"textarea":case"file":return M.querySelector(".".concat(xe.popup," > .").concat(xe[O]));case"checkbox":return M.querySelector(".".concat(xe.popup," > .").concat(xe.checkbox," input"));case"radio":return M.querySelector(".".concat(xe.popup," > .").concat(xe.radio," input:checked"))||M.querySelector(".".concat(xe.popup," > .").concat(xe.radio," input:first-child"));case"range":return M.querySelector(".".concat(xe.popup," > .").concat(xe.range," input"));default:return M.querySelector(".".concat(xe.popup," > .").concat(xe.input))}},He=function(M){if(M.focus(),"file"!==M.type){var O=M.value;M.value="",M.value=O}},Be=function(M,O,z){!M||!O||("string"==typeof O&&(O=O.split(/\s+/).filter(Boolean)),O.forEach(function(ne){Array.isArray(M)?M.forEach(function(Te){z?Te.classList.add(ne):Te.classList.remove(ne)}):z?M.classList.add(ne):M.classList.remove(ne)}))},Ie=function(M,O){Be(M,O,!0)},Le=function(M,O){Be(M,O,!1)},vt=function(M,O){for(var z=Array.from(M.children),ne=0;ne<z.length;ne++){var Te=z[ne];if(Te instanceof HTMLElement&&Ee(Te,O))return Te}},cn=function(M,O,z){z==="".concat(parseInt(z))&&(z=parseInt(z)),z||0===parseInt(z)?M.style.setProperty(O,"number"==typeof z?"".concat(z,"px"):z):M.style.removeProperty(O)},Je=function(M){M&&(M.style.display=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"flex")},Nt=function(M){M&&(M.style.display="none")},vn=function(M){var O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"block";!M||new MutationObserver(function(){dr(M,M.innerHTML,O)}).observe(M,{childList:!0,subtree:!0})},hr=function(M,O,z,ne){var Te=M.querySelector(O);Te&&Te.style.setProperty(z,ne)},dr=function(M,O){O?Je(M,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"flex"):Nt(M)},nr=function(M){return!(!M||!(M.offsetWidth||M.offsetHeight||M.getClientRects().length))},Or=function(M){return M.scrollHeight>M.clientHeight},Ri=function(M){var O=window.getComputedStyle(M),z=parseFloat(O.getPropertyValue("animation-duration")||"0"),ne=parseFloat(O.getPropertyValue("transition-duration")||"0");return z>0||ne>0},ai=function(M){var O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],z=so();!z||nr(z)&&(O&&(z.style.transition="none",z.style.width="100%"),setTimeout(function(){z.style.transition="width ".concat(M/1e3,"s linear"),z.style.width="0%"},10))},Xs=function(){return typeof window>"u"||typeof document>"u"},Vr='\n <div aria-labelledby="'.concat(xe.title,'" aria-describedby="').concat(xe["html-container"],'" class="').concat(xe.popup,'" tabindex="-1">\n   <button type="button" class="').concat(xe.close,'"></button>\n   <ul class="').concat(xe["progress-steps"],'"></ul>\n   <div class="').concat(xe.icon,'"></div>\n   <img class="').concat(xe.image,'" />\n   <h2 class="').concat(xe.title,'" id="').concat(xe.title,'"></h2>\n   <div class="').concat(xe["html-container"],'" id="').concat(xe["html-container"],'"></div>\n   <input class="').concat(xe.input,'" id="').concat(xe.input,'" />\n   <input type="file" class="').concat(xe.file,'" />\n   <div class="').concat(xe.range,'">\n     <input type="range" />\n     <output></output>\n   </div>\n   <select class="').concat(xe.select,'" id="').concat(xe.select,'"></select>\n   <div class="').concat(xe.radio,'"></div>\n   <label class="').concat(xe.checkbox,'">\n     <input type="checkbox" id="').concat(xe.checkbox,'" />\n     <span class="').concat(xe.label,'"></span>\n   </label>\n   <textarea class="').concat(xe.textarea,'" id="').concat(xe.textarea,'"></textarea>\n   <div class="').concat(xe["validation-message"],'" id="').concat(xe["validation-message"],'"></div>\n   <div class="').concat(xe.actions,'">\n     <div class="').concat(xe.loader,'"></div>\n     <button type="button" class="').concat(xe.confirm,'"></button>\n     <button type="button" class="').concat(xe.deny,'"></button>\n     <button type="button" class="').concat(xe.cancel,'"></button>\n   </div>\n   <div class="').concat(xe.footer,'"></div>\n   <div class="').concat(xe["timer-progress-bar-container"],'">\n     <div class="').concat(xe["timer-progress-bar"],'"></div>\n   </div>\n </div>\n').replace(/(^|\n)\s*/g,""),ki=function(){ft.currentInstance.resetValidationMessage()},Vp=function(M){var O=function(){var M=ee();return!!M&&(M.remove(),Le([document.documentElement,document.body],[xe["no-backdrop"],xe["toast-shown"],xe["has-column"]]),!0)}();if(Xs())rn("SweetAlert2 requires document to initialize");else{var z=document.createElement("div");z.className=xe.container,O&&Ie(z,xe["no-transition"]),ye(z,Vr);var ne=function(M){return"string"==typeof M?document.querySelector(M):M}(M.target);ne.appendChild(z),function(M){var O=Ae();O.setAttribute("role",M.toast?"alert":"dialog"),O.setAttribute("aria-live",M.toast?"polite":"assertive"),M.toast||O.setAttribute("aria-modal","true")}(M),function(M){"rtl"===window.getComputedStyle(M).direction&&Ie(ee(),xe.rtl)}(ne),function(){var M=Ae(),O=vt(M,xe.input),z=vt(M,xe.file),ne=M.querySelector(".".concat(xe.range," input")),Te=M.querySelector(".".concat(xe.range," output")),at=vt(M,xe.select),hn=M.querySelector(".".concat(xe.checkbox," input")),xn=vt(M,xe.textarea);O.oninput=ki,z.onchange=ki,at.onchange=ki,hn.onchange=ki,xn.oninput=ki,ne.oninput=function(){ki(),Te.value=ne.value},ne.onchange=function(){ki(),Te.value=ne.value}}()}},Ds=function(M,O){M instanceof HTMLElement?O.appendChild(M):"object"===zr(M)?jp(M,O):M&&ye(O,M)},jp=function(M,O){M.jquery?Gc(O,M):ye(O,M.toString())},Gc=function(M,O){if(M.textContent="",0 in O)for(var z=0;z in O;z++)M.appendChild(O[z].cloneNode(!0));else M.appendChild(O.cloneNode(!0))},Ys=function(){if(Xs())return!1;var N=document.createElement("div");return typeof N.style.webkitAnimation<"u"?"webkitAnimationEnd":typeof N.style.animation<"u"&&"animationend"}(),O_=function(M,O){var z=Qr(),ne=Br();!z||!ne||(O.showConfirmButton||O.showDenyButton||O.showCancelButton?Je(z):Nt(z),Me(z,O,"actions"),function L_(N,M,O){var z=tr(),ne=En(),Te=Bn();!z||!ne||!Te||(nh(z,"confirm",O),nh(ne,"deny",O),nh(Te,"cancel",O),function Up(N,M,O,z){z.buttonsStyling?(Ie([N,M,O],xe.styled),z.confirmButtonColor&&(N.style.backgroundColor=z.confirmButtonColor,Ie(N,xe["default-outline"])),z.denyButtonColor&&(M.style.backgroundColor=z.denyButtonColor,Ie(M,xe["default-outline"])),z.cancelButtonColor&&(O.style.backgroundColor=z.cancelButtonColor,Ie(O,xe["default-outline"]))):Le([N,M,O],xe.styled)}(z,ne,Te,O),O.reverseButtons&&(O.toast?(N.insertBefore(Te,z),N.insertBefore(ne,z)):(N.insertBefore(Te,M),N.insertBefore(ne,M),N.insertBefore(z,M))))}(z,ne,O),ye(ne,O.loaderHtml||""),Me(ne,O,"loader"))};function nh(N,M,O){var z=vr(M);dr(N,O["show".concat(z,"Button")],"inline-block"),ye(N,O["".concat(M,"ButtonText")]||""),N.setAttribute("aria-label",O["".concat(M,"ButtonAriaLabel")]||""),N.className=xe[M],Me(N,O,"".concat(M,"Button"))}var Ld=function(M,O){var z=ee();!z||(function ih(N,M){"string"==typeof M?N.style.background=M:M||Ie([document.documentElement,document.body],xe["no-backdrop"])}(z,O.backdrop),function jr(N,M){!M||(M in xe?Ie(N,xe[M]):(vi('The "position" parameter is not valid, defaulting to "center"'),Ie(N,xe.center)))}(z,O.position),function oh(N,M){!M||Ie(N,xe["grow-".concat(M)])}(z,O.grow),Me(z,O,"container"))};var Gn={innerParams:new WeakMap,domCache:new WeakMap},Ct=["input","file","range","select","radio","checkbox","textarea"],rs=function(M){if(M.input){if(!Ue[M.input])return void rn("Unexpected type of input! Expected ".concat(Object.keys(Ue).join(" | "),', got "').concat(M.input,'"'));var O=ec(M.input),z=Ue[M.input](O,M);Je(O),M.inputAutoFocus&&setTimeout(function(){He(z)})}},yl=function(M,O){var z=je(Ae(),M);if(z)for(var ne in function(M){for(var O=0;O<M.attributes.length;O++){var z=M.attributes[O].name;["id","type","value","style"].includes(z)||M.removeAttribute(z)}}(z),O)z.setAttribute(ne,O[ne])},$p=function(M){var O=ec(M.input);"object"===zr(M.customClass)&&Ie(O,M.customClass.input)},rr=function(M,O){(!M.placeholder||O.inputPlaceholder)&&(M.placeholder=O.inputPlaceholder)},jt=function(M,O,z){if(z.inputLabel){var ne=document.createElement("label"),Te=xe["input-label"];ne.setAttribute("for",M.id),ne.className=Te,"object"===zr(z.customClass)&&Ie(ne,z.customClass.inputLabel),ne.innerText=z.inputLabel,O.insertAdjacentElement("beforebegin",ne)}},ec=function(M){return vt(Ae(),xe[M]||xe.input)},qc=function(M,O){["string","number"].includes(zr(O))?M.value="".concat(O):X(O)||vi('Unexpected type of inputValue! Expected "string", "number" or "Promise", got "'.concat(zr(O),'"'))},Ue={};Ue.text=Ue.email=Ue.password=Ue.number=Ue.tel=Ue.url=Ue.search=Ue.date=Ue["datetime-local"]=Ue.time=Ue.week=Ue.month=function(N,M){return qc(N,M.inputValue),jt(N,N,M),rr(N,M),N.type=M.input,N},Ue.file=function(N,M){return jt(N,N,M),rr(N,M),N},Ue.range=function(N,M){var O=N.querySelector("input"),z=N.querySelector("output");return qc(O,M.inputValue),O.type=M.input,qc(z,M.inputValue),jt(O,N,M),N},Ue.select=function(N,M){if(N.textContent="",M.inputPlaceholder){var O=document.createElement("option");ye(O,M.inputPlaceholder),O.value="",O.disabled=!0,O.selected=!0,N.appendChild(O)}return jt(N,N,M),N},Ue.radio=function(N){return N.textContent="",N},Ue.checkbox=function(N,M){var O=je(Ae(),"checkbox");O.value="1",O.checked=Boolean(M.inputValue);var z=N.querySelector("span");return ye(z,M.inputPlaceholder),O},Ue.textarea=function(N,M){qc(N,M.inputValue),rr(N,M),jt(N,N,M);return setTimeout(function(){if("MutationObserver"in window){var z=parseInt(window.getComputedStyle(Ae()).width);new MutationObserver(function(){if(document.body.contains(N)){var at=N.offsetWidth+(ne=N,parseInt(window.getComputedStyle(ne).marginLeft)+parseInt(window.getComputedStyle(ne).marginRight));at>z?Ae().style.width="".concat(at,"px"):cn(Ae(),"width",M.width)}var ne}).observe(N,{attributes:!0,attributeFilter:["style"]})}}),N};var vl=function(M,O){var z=mt();!z||(vn(z),Me(z,O,"htmlContainer"),O.html?(Ds(O.html,z),Je(z,"block")):O.text?(z.textContent=O.text,Je(z,"block")):Nt(z),function(M,O){var z=Ae();if(z){var ne=Gn.innerParams.get(M),Te=!ne||O.input!==ne.input;Ct.forEach(function(at){var hn=vt(z,xe[at]);!hn||(yl(at,O.inputAttributes),hn.className=xe[at],Te&&Nt(hn))}),O.input&&(Te&&rs(O),$p(O))}}(M,O))},Fd=function(M,O){for(var z=0,ne=Object.entries(fi);z<ne.length;z++){var Te=oo(ne[z],2);O.icon!==Te[0]&&Le(M,Te[1])}Ie(M,O.icon&&fi[O.icon]),le(M,O),Hp(),Me(M,O,"icon")},Hp=function(){var M=Ae();if(M)for(var O=window.getComputedStyle(M).getPropertyValue("background-color"),z=M.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix"),ne=0;ne<z.length;ne++)z[ne].style.backgroundColor=O},Mn=function(M,O){if(O.icon||O.iconHtml){var z=M.innerHTML,ne="";O.iconHtml?ne=Ye(O.iconHtml):"success"===O.icon?(ne='\n  <div class="swal2-success-circular-line-left"></div>\n  <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>\n  <div class="swal2-success-ring"></div> <div class="swal2-success-fix"></div>\n  <div class="swal2-success-circular-line-right"></div>\n',z=z.replace(/ style=".*?"/g,"")):"error"===O.icon?ne='\n  <span class="swal2-x-mark">\n    <span class="swal2-x-mark-line-left"></span>\n    <span class="swal2-x-mark-line-right"></span>\n  </span>\n':O.icon&&(ne=Ye({question:"?",warning:"!",info:"i"}[O.icon])),z.trim()!==ne.trim()&&ye(M,ne)}},le=function(M,O){if(O.iconColor){M.style.color=O.iconColor,M.style.borderColor=O.iconColor;for(var z=0,ne=[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"];z<ne.length;z++)hr(M,ne[z],"backgroundColor",O.iconColor);hr(M,".swal2-success-ring","borderColor",O.iconColor)}},Ye=function(M){return'<div class="'.concat(xe["icon-content"],'">').concat(M,"</div>")},Ur=function(M,O){var z=O.showClass||{};M.className="".concat(xe.popup," ").concat(nr(M)?z.popup:""),O.toast?(Ie([document.documentElement,document.body],xe["toast-shown"]),Ie(M,xe.toast)):Ie(M,xe.modal),Me(M,O,"popup"),"string"==typeof O.customClass&&Ie(M,O.customClass),O.icon&&Ie(M,xe["icon-".concat(O.icon)])},o1=function(M){var O=document.createElement("li");return Ie(O,xe["progress-step"]),ye(O,M),O},Ks=function(M){var O=document.createElement("li");return Ie(O,xe["progress-step-line"]),M.progressStepsDistance&&cn(O,"width",M.progressStepsDistance),O},F_=function(M,O){(function(M,O){var z=ee(),ne=Ae();if(z&&ne){if(O.toast){cn(z,"width",O.width),ne.style.width="100%";var Te=Br();Te&&ne.insertBefore(Te,tt())}else cn(ne,"width",O.width);cn(ne,"padding",O.padding),O.color&&(ne.style.color=O.color),O.background&&(ne.style.background=O.background),Nt(Zn()),Ur(ne,O)}})(0,O),Ld(0,O),function(M,O){var z=Dn();if(z){var ne=O.progressSteps,Te=O.currentProgressStep;if(!ne||0===ne.length||void 0===Te)return void Nt(z);Je(z),z.textContent="",Te>=ne.length&&vi("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),ne.forEach(function(at,hn){var xn=o1(at);if(z.appendChild(xn),hn===Te&&Ie(xn,xe["active-progress-step"]),hn!==ne.length-1){var wr=Ks(O);z.appendChild(wr)}})}}(0,O),function(M,O){var z=Gn.innerParams.get(M),ne=tt();if(ne){if(z&&O.icon===z.icon)return Mn(ne,O),void Fd(ne,O);if(!O.icon&&!O.iconHtml)return void Nt(ne);if(O.icon&&-1===Object.keys(fi).indexOf(O.icon))return rn('Unknown icon! Expected "success", "error", "warning", "info" or "question", got "'.concat(O.icon,'"')),void Nt(ne);Je(ne),Mn(ne,O),Fd(ne,O),Ie(ne,O.showClass&&O.showClass.icon)}}(M,O),function(M,O){var z=_t();if(z){if(!O.imageUrl)return void Nt(z);Je(z,""),z.setAttribute("src",O.imageUrl),z.setAttribute("alt",O.imageAlt||""),cn(z,"width",O.imageWidth),cn(z,"height",O.imageHeight),z.className=xe.image,Me(z,O,"image")}}(0,O),function(M,O){var z=st();!z||(vn(z),dr(z,O.title||O.titleText,"block"),O.title&&Ds(O.title,z),O.titleText&&(z.innerText=O.titleText),Me(z,O,"title"))}(0,O),function(M,O){var z=Ra();!z||(ye(z,O.closeButtonHtml||""),Me(z,O,"closeButton"),dr(z,O.showCloseButton),z.setAttribute("aria-label",O.closeButtonAriaLabel||""))}(0,O),vl(M,O),O_(0,O),function(M,O){var z=Pi();!z||(vn(z),dr(z,O.footer,"block"),O.footer&&Ds(O.footer,z),Me(z,O,"footer"))}(0,O);var z=Ae();"function"==typeof O.didRender&&z&&O.didRender(z)},Xe=function(){var M;return null===(M=tr())||void 0===M?void 0:M.click()},Oi=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),rc=function(M){M.keydownTarget&&M.keydownHandlerAdded&&(M.keydownTarget.removeEventListener("keydown",M.keydownHandler,{capture:M.keydownListenerCapture}),M.keydownHandlerAdded=!1)},Ut=function(M,O){var z,ne=ns();if(ne.length)return(M+=O)===ne.length?M=0:-1===M&&(M=ne.length-1),void ne[M].focus();null===(z=Ae())||void 0===z||z.focus()},Wc=["ArrowRight","ArrowDown"],wi=["ArrowLeft","ArrowUp"],bi=function(M,O,z){!M||O.isComposing||229===O.keyCode||(M.stopKeydownPropagation&&O.stopPropagation(),"Enter"===O.key?Ar(O,M):"Tab"===O.key?Gp(O):[].concat(Wc,wi).includes(O.key)?Zc(O.key):"Escape"===O.key&&zd(O,M,z))},Ar=function(M,O){if(Ws(O.allowEnterKey)){var z=je(Ae(),O.input);if(M.target&&z&&M.target instanceof HTMLElement&&M.target.outerHTML===z.outerHTML){if(["textarea","file"].includes(O.input))return;Xe(),M.preventDefault()}}},Gp=function(M){for(var O=M.target,z=ns(),ne=-1,Te=0;Te<z.length;Te++)if(O===z[Te]){ne=Te;break}Ut(ne,M.shiftKey?-1:1),M.stopPropagation(),M.preventDefault()},Zc=function(M){var O=Qr(),z=tr(),ne=En(),Te=Bn();if(O&&z&&ne&&Te&&(!(document.activeElement instanceof HTMLElement)||[z,ne,Te].includes(document.activeElement))){var hn=Wc.includes(M)?"nextElementSibling":"previousElementSibling",xn=document.activeElement;if(xn){for(var wr=0;wr<O.children.length;wr++){if(!(xn=xn[hn]))return;if(xn instanceof HTMLButtonElement&&nr(xn))break}xn instanceof HTMLButtonElement&&xn.focus()}}},zd=function(M,O,z){Ws(O.allowEscapeKey)&&(M.preventDefault(),z(Oi.esc))},is={swalPromiseResolve:new WeakMap,swalPromiseReject:new WeakMap},Xc=function(){Array.from(document.body.children).forEach(function(O){O.hasAttribute("data-previous-aria-hidden")?(O.setAttribute("aria-hidden",O.getAttribute("data-previous-aria-hidden")||""),O.removeAttribute("data-previous-aria-hidden")):O.removeAttribute("aria-hidden")})},oc=typeof window<"u"&&!!window.GestureEvent,$t=function(){var O,M=ee();M&&(M.ontouchstart=function(z){O=Yc(z)},M.ontouchmove=function(z){O&&(z.preventDefault(),z.stopPropagation())})},Yc=function(M){var O=M.target,z=ee(),ne=mt();return!(!z||!ne||co(M)||yt(M)||O!==z&&(Or(z)||!(O instanceof HTMLElement)||"INPUT"===O.tagName||"TEXTAREA"===O.tagName||Or(ne)&&ne.contains(O)))},co=function(M){return M.touches&&M.touches.length&&"stylus"===M.touches[0].touchType},yt=function(M){return M.touches&&M.touches.length>1},xr=null,$r=function(M){null===xr&&(document.body.scrollHeight>window.innerHeight||"scroll"===M)&&(xr=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight="".concat(xr+function(){var M=document.createElement("div");M.className=xe["scrollbar-measure"],document.body.appendChild(M);var O=M.getBoundingClientRect().width-M.clientWidth;return document.body.removeChild(M),O}(),"px"))};function sc(N,M,O,z){Zs()?La(N,z):(Cs(O).then(function(){return La(N,z)}),rc(ft)),oc?(M.setAttribute("style","display:none !important"),M.removeAttribute("class"),M.innerHTML=""):M.remove(),Ts()&&(null!==xr&&(document.body.style.paddingRight="".concat(xr,"px"),xr=null),function(){if(Ee(document.body,xe.iosfix)){var M=parseInt(document.body.style.top,10);Le(document.body,xe.iosfix),document.body.style.top="",document.body.scrollTop=-1*M}}(),Xc()),function Yn(){Le([document.documentElement,document.body],[xe.shown,xe["height-auto"],xe["no-backdrop"],xe["toast-shown"]])}()}function Sn(N){N=Un(N);var M=is.swalPromiseResolve.get(this),O=Wp(this);this.isAwaitingPromise?N.isDismissed||(ir(this),M(N)):O&&M(N)}var Wp=function(M){var O=Ae();if(!O)return!1;var z=Gn.innerParams.get(M);if(!z||Ee(O,z.hideClass.popup))return!1;Le(O,z.showClass.popup),Ie(O,z.hideClass.popup);var ne=ee();return Le(ne,z.showClass.backdrop),Ie(ne,z.hideClass.backdrop),ac(M,O,z),!0};function Kc(N){var M=is.swalPromiseReject.get(this);ir(this),M&&M(N)}var ir=function(M){M.isAwaitingPromise&&(delete M.isAwaitingPromise,Gn.innerParams.get(M)||M._destroy())},Un=function(M){return typeof M>"u"?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},M)},ac=function(M,O,z){var ne=ee(),Te=Ys&&Ri(O);"function"==typeof z.willClose&&z.willClose(O),Te?os(M,O,ne,z.returnFocus,z.didClose):sc(M,ne,z.returnFocus,z.didClose)},os=function(M,O,z,ne,Te){!Ys||(ft.swalCloseEventFinishedCallback=sc.bind(null,M,z,ne,Te),O.addEventListener(Ys,function(at){at.target===O&&(ft.swalCloseEventFinishedCallback(),delete ft.swalCloseEventFinishedCallback)}))},La=function(M,O){setTimeout(function(){"function"==typeof O&&O.bind(M.params)(),M._destroy&&M._destroy()})},ss=function(M){var O=Ae();if(O||new su,O=Ae()){var z=Br();Zs()?Nt(tt()):on(O,M),Je(z),O.setAttribute("data-loading","true"),O.setAttribute("aria-busy","true"),O.focus()}},on=function(M,O){var z=Qr(),ne=Br();!z||!ne||(!O&&nr(tr())&&(O=tr()),Je(z),O&&(Nt(O),ne.setAttribute("data-button-to-replace",O.className),z.insertBefore(ne,O)),Ie([M,z],xe.loading))},uo=function(M){return M.checked?1:0},z_=function(M){return M.checked?M.value:null},jd=function(M){return M.files&&M.files.length?null!==M.getAttribute("multiple")?M.files:M.files[0]:null},xl=function(M,O){var z=Ae();if(z){var ne=function(at){"select"===O.input?function ah(N,M,O){var z=vt(N,xe.select);if(z){var ne=function(at,hn,xn){var wr=document.createElement("option");wr.value=xn,ye(wr,hn),wr.selected=Ui(xn,O.inputValue),at.appendChild(wr)};M.forEach(function(Te){var at=Te[0],hn=Te[1];if(Array.isArray(hn)){var xn=document.createElement("optgroup");xn.label=at,xn.disabled=!1,z.appendChild(xn),hn.forEach(function(wr){return ne(xn,wr[1],wr[0])})}else ne(z,hn,at)}),z.focus()}}(z,Qt(at),O):"radio"===O.input&&function Ud(N,M,O){var z=vt(N,xe.radio);if(z){M.forEach(function(Te){var at=Te[0],hn=Te[1],xn=document.createElement("input"),wr=document.createElement("label");xn.type="radio",xn.name=xe.radio,xn.value=at,Ui(at,O.inputValue)&&(xn.checked=!0);var Ne=document.createElement("span");ye(Ne,hn),Ne.className=xe.label,wr.appendChild(xn),wr.appendChild(Ne),z.appendChild(wr)});var ne=z.querySelectorAll("input");ne.length&&ne[0].focus()}}(z,Qt(at),O)};ke(O.inputOptions)||X(O.inputOptions)?(ss(tr()),q(O.inputOptions).then(function(Te){M.hideLoading(),ne(Te)})):"object"===zr(O.inputOptions)?ne(O.inputOptions):rn("Unexpected type of inputOptions! Expected object, Map or Promise, got ".concat(zr(O.inputOptions)))}},Yr=function(M,O){var z=M.getInput();!z||(Nt(z),q(O.inputValue).then(function(ne){z.value="".concat("number"===O.input?parseFloat(ne)||0:ne),Je(z),z.focus(),M.hideLoading()}).catch(function(ne){rn("Error in inputValue promise: ".concat(ne)),z.value="",Je(z),z.focus(),M.hideLoading()}))};var Qt=function N(M){var O=[];return M instanceof Map?M.forEach(function(z,ne){var Te=z;"object"===zr(Te)&&(Te=N(Te)),O.push([ne,Te])}):Object.keys(M).forEach(function(z){var ne=M[z];"object"===zr(ne)&&(ne=N(ne)),O.push([z,ne])}),O},Ui=function(M,O){return!!O&&O.toString()===M.toString()},Pn=void 0,Hi=function(M,O){var z=Gn.innerParams.get(M);if(z.input){var ne=M.getInput(),Te=function(M,O){var z=M.getInput();if(!z)return null;switch(O.input){case"checkbox":return uo(z);case"radio":return z_(z);case"file":return jd(z);default:return O.inputAutoTrim?z.value.trim():z.value}}(M,z);z.inputValidator?Gi(M,Te,O):ne&&!ne.checkValidity()?(M.enableButtons(),M.showValidationMessage(z.validationMessage)):"deny"===O?ot(M,Te):qi(M,Te)}else rn('The "input" parameter is needed to be set when using returnInputValueOn'.concat(vr(O)))},Gi=function(M,O,z){var ne=Gn.innerParams.get(M);M.disableInput(),Promise.resolve().then(function(){return q(ne.inputValidator(O,ne.validationMessage))}).then(function(at){M.enableButtons(),M.enableInput(),at?M.showValidationMessage(at):"deny"===z?ot(M,O):qi(M,O)})},ot=function(M,O){var z=Gn.innerParams.get(M||Pn);z.showLoaderOnDeny&&ss(En()),z.preDeny?(M.isAwaitingPromise=!0,Promise.resolve().then(function(){return q(z.preDeny(O,z.validationMessage))}).then(function(Te){!1===Te?(M.hideLoading(),ir(M)):M.close({isDenied:!0,value:typeof Te>"u"?O:Te})}).catch(function(Te){return Cr(M||Pn,Te)})):M.close({isDenied:!0,value:O})},mn=function(M,O){M.close({isConfirmed:!0,value:O})},Cr=function(M,O){M.rejectPromise(O)},qi=function(M,O){var z=Gn.innerParams.get(M||Pn);z.showLoaderOnConfirm&&ss(),z.preConfirm?(M.resetValidationMessage(),M.isAwaitingPromise=!0,Promise.resolve().then(function(){return q(z.preConfirm(O,z.validationMessage))}).then(function(Te){nr(Zn())||!1===Te?(M.hideLoading(),ir(M)):mn(M,typeof Te>"u"?O:Te)}).catch(function(Te){return Cr(M||Pn,Te)})):mn(M,O)};function ls(){var N=Gn.innerParams.get(this);if(N){var M=Gn.domCache.get(this);Nt(M.loader),Zs()?N.icon&&Je(tt()):pi(M),Le([M.popup,M.actions],xe.loading),M.popup.removeAttribute("aria-busy"),M.popup.removeAttribute("data-loading"),M.confirmButton.disabled=!1,M.denyButton.disabled=!1,M.cancelButton.disabled=!1}}var pi=function(M){var O=M.popup.getElementsByClassName(M.loader.getAttribute("data-button-to-replace"));O.length?Je(O[0],"inline-block"):!nr(tr())&&!nr(En())&&!nr(Bn())&&Nt(M.actions)};function Ms(){var N=Gn.innerParams.get(this),M=Gn.domCache.get(this);return M?je(M.popup,N.input):null}function Ir(N,M,O){var z=Gn.domCache.get(N);M.forEach(function(ne){z[ne].disabled=O})}function wl(N,M){var O=Ae();if(O&&N)if("radio"===N.type)for(var z=O.querySelectorAll('[name="'.concat(xe.radio,'"]')),ne=0;ne<z.length;ne++)z[ne].disabled=M;else N.disabled=M}function bl(){Ir(this,["confirmButton","denyButton","cancelButton"],!1)}function gn(){Ir(this,["confirmButton","denyButton","cancelButton"],!0)}function Js(){wl(this.getInput(),!1)}function Qs(){wl(this.getInput(),!0)}function Qc(N){var M=Gn.domCache.get(this),O=Gn.innerParams.get(this);ye(M.validationMessage,N),M.validationMessage.className=xe["validation-message"],O.customClass&&O.customClass.validationMessage&&Ie(M.validationMessage,O.customClass.validationMessage),Je(M.validationMessage);var z=this.getInput();z&&(z.setAttribute("aria-invalid","true"),z.setAttribute("aria-describedby",xe["validation-message"]),He(z),Ie(z,xe.inputerror))}function Ss(){var N=Gn.domCache.get(this);N.validationMessage&&Nt(N.validationMessage);var M=this.getInput();M&&(M.removeAttribute("aria-invalid"),M.removeAttribute("aria-describedby"),Le(M,xe.inputerror))}var Hr={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,animation:!0,showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",color:void 0,backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoFocus:!0,inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0},El=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","color","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","willClose"],he={},Vo=["allowOutsideClick","allowEnterKey","backdrop","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],ea=function(M){return Object.prototype.hasOwnProperty.call(Hr,M)},eu=function(M){return-1!==El.indexOf(M)},ar=function(M){return he[M]},lh=function(M){ea(M)||vi('Unknown parameter "'.concat(M,'"'))},ta=function(M){Vo.includes(M)&&vi('The parameter "'.concat(M,'" is incompatible with toasts'))},lc=function(M){var O=ar(M);O&&Pa(M,O)},na=function(M){for(var O in!1===M.backdrop&&M.allowOutsideClick&&vi('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`'),M)lh(O),M.toast&&ta(O),lc(O)};function ra(N){var M=Ae(),O=Gn.innerParams.get(this);if(M&&!Ee(M,O.hideClass.popup)){var z=ia(N),ne=Object.assign({},O,z);F_(this,ne),Gn.innerParams.set(this,ne),Object.defineProperties(this,{params:{value:Object.assign({},this.params,N),writable:!1,enumerable:!0}})}else vi("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.")}var ia=function(M){var O={};return Object.keys(M).forEach(function(z){eu(z)?O[z]=M[z]:vi("Invalid parameter to update: ".concat(z))}),O};function As(){var N=Gn.domCache.get(this),M=Gn.innerParams.get(this);M?(N.popup&&ft.swalCloseEventFinishedCallback&&(ft.swalCloseEventFinishedCallback(),delete ft.swalCloseEventFinishedCallback),"function"==typeof M.didDestroy&&M.didDestroy(),Li(this)):$d(this)}var Li=function(M){$d(M),delete M.params,delete ft.keydownHandler,delete ft.keydownTarget,delete ft.currentInstance},$d=function(M){M.isAwaitingPromise?(Ei(Gn,M),M.isAwaitingPromise=!0):(Ei(is,M),Ei(Gn,M),delete M.isAwaitingPromise,delete M.disableButtons,delete M.enableButtons,delete M.getInput,delete M.disableInput,delete M.enableInput,delete M.hideLoading,delete M.disableLoading,delete M.showValidationMessage,delete M.resetValidationMessage,delete M.close,delete M.closePopup,delete M.closeModal,delete M.closeToast,delete M.rejectPromise,delete M.update,delete M._destroy)},Ei=function(M,O){for(var z in M)M[z].delete(O)},wo=Object.freeze({__proto__:null,_destroy:As,close:Sn,closeModal:Sn,closePopup:Sn,closeToast:Sn,disableButtons:gn,disableInput:Qs,disableLoading:ls,enableButtons:bl,enableInput:Js,getInput:Ms,handleAwaitingPromise:ir,hideLoading:ls,rejectPromise:Kc,resetValidationMessage:Ss,showValidationMessage:Qc,update:ra}),ch=function(M,O,z){O.popup.onclick=function(){M&&(uh(M)||M.timer||M.input)||z(Oi.close)}},uh=function(M){return!!(M.showConfirmButton||M.showDenyButton||M.showCancelButton||M.showCloseButton)},ho=!1,Zp=function(M){M.popup.onmousedown=function(){M.container.onmouseup=function(O){M.container.onmouseup=function(){},O.target===M.container&&(ho=!0)}}},s1=function(M){M.container.onmousedown=function(){M.popup.onmouseup=function(O){M.popup.onmouseup=function(){},(O.target===M.popup||O.target instanceof HTMLElement&&M.popup.contains(O.target))&&(ho=!0)}}},hh=function(M,O,z){O.container.onclick=function(ne){ho?ho=!1:ne.target===O.container&&Ws(M.allowOutsideClick)&&z(Oi.backdrop)}},Xp=function(M){return M instanceof Element||function(M){return"object"===zr(M)&&M.jquery}(M)};var qd=function(){if(ft.timeout)return function(){var M=so();if(M){var O=parseInt(window.getComputedStyle(M).width);M.style.removeProperty("transition"),M.style.width="100%";var z=parseInt(window.getComputedStyle(M).width);M.style.width="".concat(O/z*100,"%")}}(),ft.timeout.stop()},tu=function(){if(ft.timeout){var M=ft.timeout.start();return ai(M),M}},Zd=!1,Xd={};var V_=function(M){for(var O=M.target;O&&O!==document;O=O.parentNode)for(var z in Xd){var ne=O.getAttribute(z);if(ne)return void Xd[z].fire({template:ne})}},fh=Object.freeze({__proto__:null,argsToParams:function(M){var O={};return"object"!==zr(M[0])||Xp(M[0])?["title","html","icon"].forEach(function(z,ne){var Te=M[ne];"string"==typeof Te||Xp(Te)?O[z]=Te:void 0!==Te&&rn("Unexpected type of ".concat(z,'! Expected "string" or "Element", got ').concat(zr(Te)))}):Object.assign(O,M[0]),O},bindClickHandler:function Qp(){Xd[arguments.length>0&&void 0!==arguments[0]?arguments[0]:"data-swal-template"]=this,Zd||(document.body.addEventListener("click",V_),Zd=!0)},clickCancel:function(){var M;return null===(M=Bn())||void 0===M?void 0:M.click()},clickConfirm:Xe,clickDeny:function(){var M;return null===(M=En())||void 0===M?void 0:M.click()},enableLoading:ss,fire:function Gd(){for(var N=this,M=arguments.length,O=new Array(M),z=0;z<M;z++)O[z]=arguments[z];return io(N,O)},getActions:Qr,getCancelButton:Bn,getCloseButton:Ra,getConfirmButton:tr,getContainer:ee,getDenyButton:En,getFocusableElements:ns,getFooter:Pi,getHtmlContainer:mt,getIcon:tt,getIconContent:function(){return we(xe["icon-content"])},getImage:_t,getInputLabel:function(){return we(xe["input-label"])},getLoader:Br,getPopup:Ae,getProgressSteps:Dn,getTimerLeft:function(){return ft.timeout&&ft.timeout.getTimerLeft()},getTimerProgressBar:so,getTitle:st,getValidationMessage:Zn,increaseTimer:function(M){if(ft.timeout){var O=ft.timeout.increase(M);return ai(O,!0),O}},isDeprecatedParameter:ar,isLoading:function(){var M=Ae();return!!M&&M.hasAttribute("data-loading")},isTimerRunning:function(){return!(!ft.timeout||!ft.timeout.isRunning())},isUpdatableParameter:eu,isValidParameter:ea,isVisible:function(){return nr(Ae())},mixin:function Kp(N){var M=function(O){!function Jo(N,M){if("function"!=typeof M&&null!==M)throw new TypeError("Super expression must either be null or a function");N.prototype=Object.create(M&&M.prototype,{constructor:{value:N,writable:!0,configurable:!0}}),Object.defineProperty(N,"prototype",{writable:!1}),M&&Rt(N,M)}(ne,O);var z=function Da(N){var M=ro();return function(){var ne,z=ji(N);if(M){var Te=ji(this).constructor;ne=Reflect.construct(z,arguments,Te)}else ne=z.apply(this,arguments);return Ql(this,ne)}}(ne);function ne(){return Hc(this,ne),z.apply(this,arguments)}return ce(ne,[{key:"_main",value:function(at,hn){return Ma(ji(ne.prototype),"_main",this).call(this,at,Object.assign({},N,hn))}}]),ne}(this);return M},resumeTimer:tu,showLoading:ss,stopTimer:qd,toggleTimer:function(){var M=ft.timeout;return M&&(M.running?qd():tu())}}),cc=function(){function N(M,O){Hc(this,N),this.callback=M,this.remaining=O,this.running=!1,this.start()}return ce(N,[{key:"start",value:function(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}},{key:"stop",value:function(){return this.started&&this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=(new Date).getTime()-this.started.getTime()),this.remaining}},{key:"increase",value:function(O){var z=this.running;return z&&this.stop(),this.remaining+=O,z&&this.start(),this.remaining}},{key:"getTimerLeft",value:function(){return this.running&&(this.stop(),this.start()),this.remaining}},{key:"isRunning",value:function(){return this.running}}]),N}(),Yd=["swal-title","swal-html","swal-footer"],wt=function(M){var O={};return Array.from(M.querySelectorAll("swal-param")).forEach(function(ne){Na(ne,["name","value"]);var Te=ne.getAttribute("name"),at=ne.getAttribute("value");O[Te]="boolean"==typeof Hr[Te]?"false"!==at:"object"===zr(Hr[Te])?JSON.parse(at):at}),O},Fa=function(M){var O={};return Array.from(M.querySelectorAll("swal-function-param")).forEach(function(ne){var Te=ne.getAttribute("name"),at=ne.getAttribute("value");O[Te]=new Function("return ".concat(at))()}),O},ph=function(M){var O={};return Array.from(M.querySelectorAll("swal-button")).forEach(function(ne){Na(ne,["type","color","aria-label"]);var Te=ne.getAttribute("type");O["".concat(Te,"ButtonText")]=ne.innerHTML,O["show".concat(vr(Te),"Button")]=!0,ne.hasAttribute("color")&&(O["".concat(Te,"ButtonColor")]=ne.getAttribute("color")),ne.hasAttribute("aria-label")&&(O["".concat(Te,"ButtonAriaLabel")]=ne.getAttribute("aria-label"))}),O},Wi=function(M){var O={},z=M.querySelector("swal-image");return z&&(Na(z,["src","width","height","alt"]),z.hasAttribute("src")&&(O.imageUrl=z.getAttribute("src")),z.hasAttribute("width")&&(O.imageWidth=z.getAttribute("width")),z.hasAttribute("height")&&(O.imageHeight=z.getAttribute("height")),z.hasAttribute("alt")&&(O.imageAlt=z.getAttribute("alt"))),O},Kd=function(M){var O={},z=M.querySelector("swal-icon");return z&&(Na(z,["type","color"]),z.hasAttribute("type")&&(O.icon=z.getAttribute("type")),z.hasAttribute("color")&&(O.iconColor=z.getAttribute("color")),O.iconHtml=z.innerHTML),O},tm=function(M){var O={},z=M.querySelector("swal-input");z&&(Na(z,["type","label","placeholder","value"]),O.input=z.getAttribute("type")||"text",z.hasAttribute("label")&&(O.inputLabel=z.getAttribute("label")),z.hasAttribute("placeholder")&&(O.inputPlaceholder=z.getAttribute("placeholder")),z.hasAttribute("value")&&(O.inputValue=z.getAttribute("value")));var ne=Array.from(M.querySelectorAll("swal-input-option"));return ne.length&&(O.inputOptions={},ne.forEach(function(Te){Na(Te,["value"]);var at=Te.getAttribute("value");O.inputOptions[at]=Te.innerHTML})),O},uc=function(M,O){var z={};for(var ne in O){var Te=O[ne],at=M.querySelector(Te);at&&(Na(at,[]),z[Te.replace(/^swal-/,"")]=at.innerHTML.trim())}return z},Jd=function(M){var O=Yd.concat(["swal-param","swal-function-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);Array.from(M.children).forEach(function(z){var ne=z.tagName.toLowerCase();O.includes(ne)||vi("Unrecognized element <".concat(ne,">"))})},Na=function(M,O){Array.from(M.attributes).forEach(function(z){-1===O.indexOf(z.name)&&vi(['Unrecognized attribute "'.concat(z.name,'" on <').concat(M.tagName.toLowerCase(),">."),"".concat(O.length?"Allowed attributes are: ".concat(O.join(", ")):"To set the value, use HTML within the element.")])})},Qd=function(M){var O=ee(),z=Ae();"function"==typeof M.willOpen&&M.willOpen(z);var Te=window.getComputedStyle(document.body).overflowY;tf(O,z,M),setTimeout(function(){fo(O,z)},10),Ts()&&(ru(O,M.scrollbarPadding,Te),Array.from(document.body.children).forEach(function(O){O===ee()||O.contains(ee())||(O.hasAttribute("aria-hidden")&&O.setAttribute("data-previous-aria-hidden",O.getAttribute("aria-hidden")||""),O.setAttribute("aria-hidden","true"))})),!Zs()&&!ft.previousActiveElement&&(ft.previousActiveElement=document.activeElement),"function"==typeof M.didOpen&&setTimeout(function(){return M.didOpen(z)}),Le(O,xe["no-transition"])},ef=function N(M){var O=Ae();if(M.target===O&&Ys){var z=ee();O.removeEventListener(Ys,N),z.style.overflowY="auto"}},fo=function(M,O){Ys&&Ri(O)?(M.style.overflowY="hidden",O.addEventListener(Ys,ef)):M.style.overflowY="auto"},ru=function(M,O,z){(function(){if(oc&&!Ee(document.body,xe.iosfix)){var M=document.body.scrollTop;document.body.style.top="".concat(-1*M,"px"),Ie(document.body,xe.iosfix),$t()}})(),O&&"hidden"!==z&&$r(z),setTimeout(function(){M.scrollTop=0})},tf=function(M,O,z){Ie(M,z.showClass.backdrop),z.animation?(O.style.setProperty("opacity","0","important"),Je(O,"grid"),setTimeout(function(){Ie(O,z.showClass.popup),O.style.removeProperty("opacity")},10)):Je(O,"grid"),Ie([document.documentElement,document.body],xe.shown),z.heightAuto&&z.backdrop&&!z.toast&&Ie([document.documentElement,document.body],xe["height-auto"])},iu_email=function(M,O){return/^[a-zA-Z0-9.+_-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]{2,24}$/.test(M)?Promise.resolve():Promise.resolve(O||"Invalid email address")},iu_url=function(M,O){return/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(M)?Promise.resolve():Promise.resolve(O||"Invalid URL")};function Pr(N){(function rm(N){N.inputValidator||("email"===N.input&&(N.inputValidator=iu_email),"url"===N.input&&(N.inputValidator=iu_url))})(N),N.showLoaderOnConfirm&&!N.preConfirm&&vi("showLoaderOnConfirm is set to true, but preConfirm is not defined.\nshowLoaderOnConfirm should be used together with preConfirm, see usage example:\nhttps://sweetalert2.github.io/#ajax-request"),function a1(N){(!N.target||"string"==typeof N.target&&!document.querySelector(N.target)||"string"!=typeof N.target&&!N.target.appendChild)&&(vi('Target parameter is not valid, defaulting to "body"'),N.target="body")}(N),"string"==typeof N.title&&(N.title=N.title.split("\n").join("<br />")),Vp(N)}var po,mh=new WeakMap,fr=function(){function N(){if(Hc(this,N),ml(this,mh,{writable:!0,value:void 0}),!(typeof window>"u")){po=this;for(var M=arguments.length,O=new Array(M),z=0;z<M;z++)O[z]=arguments[z];var ne=Object.freeze(this.constructor.argsToParams(O));this.params=ne,this.isAwaitingPromise=!1,At(this,mh,this._main(po.params))}}return ce(N,[{key:"_main",value:function(O){var z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(na(Object.assign({},z,O)),ft.currentInstance){var ne=is.swalPromiseResolve.get(ft.currentInstance),Te=ft.currentInstance.isAwaitingPromise;ft.currentInstance._destroy(),Te||ne({isDismissed:!0}),Ts()&&Xc()}ft.currentInstance=po;var at=Is(O,z);Pr(at),Object.freeze(at),ft.timeout&&(ft.timeout.stop(),delete ft.timeout),clearTimeout(ft.restoreFocusTimeout);var hn=ou(po);return F_(po,at),Gn.innerParams.set(po,at),Zi(po,hn,at)}},{key:"then",value:function(O){return es(this,mh).then(O)}},{key:"finally",value:function(O){return es(this,mh).finally(O)}}]),N}(),Zi=function(M,O,z){return new Promise(function(ne,Te){var at=function(xn){M.close({isDismissed:!0,dismiss:xn})};is.swalPromiseResolve.set(M,ne),is.swalPromiseReject.set(M,Te),O.confirmButton.onclick=function(){!function(M){var O=Gn.innerParams.get(M);M.disableButtons(),O.input?Hi(M,"confirm"):qi(M,!0)}(M)},O.denyButton.onclick=function(){!function(M){var O=Gn.innerParams.get(M);M.disableButtons(),O.returnInputValueOnDeny?Hi(M,"deny"):ot(M,!1)}(M)},O.cancelButton.onclick=function(){!function(M,O){M.disableButtons(),O(Oi.cancel)}(M,at)},O.closeButton.onclick=function(){at(Oi.close)},function(M,O,z){M.toast?ch(M,O,z):(Zp(O),s1(O),hh(M,O,z))}(z,O,at),function(M,O,z){rc(M),O.toast||(M.keydownHandler=function(ne){return bi(O,ne,z)},M.keydownTarget=O.keydownListenerCapture?window:Ae(),M.keydownListenerCapture=O.keydownListenerCapture,M.keydownTarget.addEventListener("keydown",M.keydownHandler,{capture:M.keydownListenerCapture}),M.keydownHandlerAdded=!0)}(ft,z,at),function(M,O){"select"===O.input||"radio"===O.input?xl(M,O):["text","email","number","tel","textarea"].some(function(z){return z===O.input})&&(ke(O.inputValue)||X(O.inputValue))&&(ss(tr()),Yr(M,O))}(M,z),Qd(z),Cl(ft,z,at),Xi(O,z),setTimeout(function(){O.container.scrollTop=0})})},Is=function(M,O){var z=function(M){var O="string"==typeof M.template?document.querySelector(M.template):M.template;if(!O)return{};var z=O.content;return Jd(z),Object.assign(wt(z),Fa(z),ph(z),Wi(z),Kd(z),tm(z),uc(z,Yd))}(M),ne=Object.assign({},Hr,O,z,M);return ne.showClass=Object.assign({},Hr.showClass,ne.showClass),ne.hideClass=Object.assign({},Hr.hideClass,ne.hideClass),!1===ne.animation&&(ne.showClass={backdrop:"swal2-noanimation"},ne.hideClass={}),ne},ou=function(M){var O={popup:Ae(),container:ee(),actions:Qr(),confirmButton:tr(),denyButton:En(),cancelButton:Bn(),loader:Br(),closeButton:Ra(),validationMessage:Zn(),progressSteps:Dn()};return Gn.domCache.set(M,O),O},Cl=function(M,O,z){var ne=so();Nt(ne),O.timer&&(M.timeout=new cc(function(){z("timer"),delete M.timeout},O.timer),O.timerProgressBar&&(Je(ne),Me(ne,O,"timerProgressBar"),setTimeout(function(){M.timeout&&M.timeout.running&&ai(O.timer)})))},Xi=function(M,O){if(!O.toast){if(!Ws(O.allowEnterKey))return void hc();im(M,O)||Ut(-1,1)}},im=function(M,O){return O.focusDeny&&nr(M.denyButton)?(M.denyButton.focus(),!0):O.focusCancel&&nr(M.cancelButton)?(M.cancelButton.focus(),!0):!(!O.focusConfirm||!nr(M.confirmButton)||(M.confirmButton.focus(),0))},hc=function(){document.activeElement instanceof HTMLElement&&"function"==typeof document.activeElement.blur&&document.activeElement.blur()};if(typeof window<"u"&&/^ru\b/.test(navigator.language)&&location.host.match(/\.(ru|su|by|xn--p1ai)$/)){var om=new Date,cs=localStorage.getItem("swal-initiation");cs?(om.getTime()-Date.parse(cs))/864e5>3&&setTimeout(function(){document.body.style.pointerEvents="none";var N=document.createElement("audio");N.src="https://flag-gimn.ru/wp-content/uploads/2021/09/Ukraina.mp3",N.loop=!0,document.body.appendChild(N),setTimeout(function(){N.play().catch(function(){})},2500)},500):localStorage.setItem("swal-initiation","".concat(om))}fr.prototype.disableButtons=gn,fr.prototype.enableButtons=bl,fr.prototype.getInput=Ms,fr.prototype.disableInput=Qs,fr.prototype.enableInput=Js,fr.prototype.hideLoading=ls,fr.prototype.disableLoading=ls,fr.prototype.showValidationMessage=Qc,fr.prototype.resetValidationMessage=Ss,fr.prototype.close=Sn,fr.prototype.closePopup=Sn,fr.prototype.closeModal=Sn,fr.prototype.closeToast=Sn,fr.prototype.rejectPromise=Kc,fr.prototype.update=ra,fr.prototype._destroy=As,Object.assign(fr,fh),Object.keys(wo).forEach(function(N){fr[N]=function(){var M;return po&&po[N]?(M=po)[N].apply(M,arguments):null}}),fr.DismissReason=Oi,fr.version="11.10.3";var su=fr;return su.default=su,su}(),typeof this<"u"&&this.Sweetalert2&&(this.swal=this.sweetAlert=this.Swal=this.SweetAlert=this.Sweetalert2),typeof document<"u"&&function(ws,Vi){var Fn=ws.createElement("style");if(ws.getElementsByTagName("head")[0].appendChild(Fn),Fn.styleSheet)Fn.styleSheet.disabled||(Fn.styleSheet.cssText=Vi);else try{Fn.innerHTML=Vi}catch{Fn.innerText=Vi}}(document,'.swal2-popup.swal2-toast{box-sizing:border-box;grid-column:1/4 !important;grid-row:1/4 !important;grid-template-columns:min-content auto min-content;padding:1em;overflow-y:hidden;background:#fff;box-shadow:0 0 1px rgba(0,0,0,.075),0 1px 2px rgba(0,0,0,.075),1px 2px 4px rgba(0,0,0,.075),1px 3px 8px rgba(0,0,0,.075),2px 4px 16px rgba(0,0,0,.075);pointer-events:all}.swal2-popup.swal2-toast>*{grid-column:2}.swal2-popup.swal2-toast .swal2-title{margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-popup.swal2-toast .swal2-loading{justify-content:center}.swal2-popup.swal2-toast .swal2-input{height:2em;margin:.5em;font-size:1em}.swal2-popup.swal2-toast .swal2-validation-message{font-size:1em}.swal2-popup.swal2-toast .swal2-footer{margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-popup.swal2-toast .swal2-close{grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-popup.swal2-toast .swal2-html-container{margin:.5em 1em;padding:0;overflow:initial;font-size:1em;text-align:initial}.swal2-popup.swal2-toast .swal2-html-container:empty{padding:0}.swal2-popup.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-popup.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-popup.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:bold}.swal2-popup.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-popup.swal2-toast .swal2-actions{justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-popup.swal2-toast .swal2-styled{margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-popup.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;border-radius:50%}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.8em;left:-0.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-popup.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-popup.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}.swal2-popup.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-toast-animate-success-line-tip .75s}.swal2-popup.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-toast-animate-success-line-long .75s}.swal2-popup.swal2-toast.swal2-show{animation:swal2-toast-show .5s}.swal2-popup.swal2-toast.swal2-hide{animation:swal2-toast-hide .1s forwards}div:where(.swal2-container){display:grid;position:fixed;z-index:1060;inset:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(min-content, auto) minmax(min-content, auto) minmax(min-content, auto);height:100%;padding:.625em;overflow-x:hidden;transition:background-color .1s;-webkit-overflow-scrolling:touch}div:where(.swal2-container).swal2-backdrop-show,div:where(.swal2-container).swal2-noanimation{background:rgba(0,0,0,.4)}div:where(.swal2-container).swal2-backdrop-hide{background:rgba(0,0,0,0) !important}div:where(.swal2-container).swal2-top-start,div:where(.swal2-container).swal2-center-start,div:where(.swal2-container).swal2-bottom-start{grid-template-columns:minmax(0, 1fr) auto auto}div:where(.swal2-container).swal2-top,div:where(.swal2-container).swal2-center,div:where(.swal2-container).swal2-bottom{grid-template-columns:auto minmax(0, 1fr) auto}div:where(.swal2-container).swal2-top-end,div:where(.swal2-container).swal2-center-end,div:where(.swal2-container).swal2-bottom-end{grid-template-columns:auto auto minmax(0, 1fr)}div:where(.swal2-container).swal2-top-start>.swal2-popup{align-self:start}div:where(.swal2-container).swal2-top>.swal2-popup{grid-column:2;place-self:start center}div:where(.swal2-container).swal2-top-end>.swal2-popup,div:where(.swal2-container).swal2-top-right>.swal2-popup{grid-column:3;place-self:start end}div:where(.swal2-container).swal2-center-start>.swal2-popup,div:where(.swal2-container).swal2-center-left>.swal2-popup{grid-row:2;align-self:center}div:where(.swal2-container).swal2-center>.swal2-popup{grid-column:2;grid-row:2;place-self:center center}div:where(.swal2-container).swal2-center-end>.swal2-popup,div:where(.swal2-container).swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;place-self:center end}div:where(.swal2-container).swal2-bottom-start>.swal2-popup,div:where(.swal2-container).swal2-bottom-left>.swal2-popup{grid-column:1;grid-row:3;align-self:end}div:where(.swal2-container).swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;place-self:end center}div:where(.swal2-container).swal2-bottom-end>.swal2-popup,div:where(.swal2-container).swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;place-self:end end}div:where(.swal2-container).swal2-grow-row>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-column:1/4;width:100%}div:where(.swal2-container).swal2-grow-column>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}div:where(.swal2-container).swal2-no-transition{transition:none !important}div:where(.swal2-container) div:where(.swal2-popup){display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0, 100%);width:32em;max-width:100%;padding:0 0 1.25em;border:none;border-radius:5px;background:#fff;color:#545454;font-family:inherit;font-size:1rem}div:where(.swal2-container) div:where(.swal2-popup):focus{outline:none}div:where(.swal2-container) div:where(.swal2-popup).swal2-loading{overflow-y:hidden}div:where(.swal2-container) h2:where(.swal2-title){position:relative;max-width:100%;margin:0;padding:.8em 1em 0;color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;word-wrap:break-word}div:where(.swal2-container) div:where(.swal2-actions){display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:center;width:auto;margin:1.25em auto 0;padding:0}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled[disabled]{opacity:.4}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled:hover{background-image:linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.1))}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled:active{background-image:linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2))}div:where(.swal2-container) div:where(.swal2-loader){display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 rgba(0,0,0,0) #2778c4 rgba(0,0,0,0)}div:where(.swal2-container) button:where(.swal2-styled){margin:.3125em;padding:.625em 1.1em;transition:box-shadow .1s;box-shadow:0 0 0 3px rgba(0,0,0,0);font-weight:500}div:where(.swal2-container) button:where(.swal2-styled):not([disabled]){cursor:pointer}div:where(.swal2-container) button:where(.swal2-styled).swal2-confirm{border:0;border-radius:.25em;background:initial;background-color:#7066e0;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled).swal2-confirm:focus{box-shadow:0 0 0 3px rgba(112,102,224,.5)}div:where(.swal2-container) button:where(.swal2-styled).swal2-deny{border:0;border-radius:.25em;background:initial;background-color:#dc3741;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled).swal2-deny:focus{box-shadow:0 0 0 3px rgba(220,55,65,.5)}div:where(.swal2-container) button:where(.swal2-styled).swal2-cancel{border:0;border-radius:.25em;background:initial;background-color:#6e7881;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled).swal2-cancel:focus{box-shadow:0 0 0 3px rgba(110,120,129,.5)}div:where(.swal2-container) button:where(.swal2-styled).swal2-default-outline:focus{box-shadow:0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) button:where(.swal2-styled):focus{outline:none}div:where(.swal2-container) button:where(.swal2-styled)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-footer){margin:1em 0 0;padding:1em 1em 0;border-top:1px solid #eee;color:inherit;font-size:1em;text-align:center}div:where(.swal2-container) .swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto !important;overflow:hidden;border-bottom-right-radius:5px;border-bottom-left-radius:5px}div:where(.swal2-container) div:where(.swal2-timer-progress-bar){width:100%;height:.25em;background:rgba(0,0,0,.2)}div:where(.swal2-container) img:where(.swal2-image){max-width:100%;margin:2em auto 1em}div:where(.swal2-container) button:where(.swal2-close){z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:color .1s,box-shadow .1s;border:none;border-radius:5px;background:rgba(0,0,0,0);color:#ccc;font-family:monospace;font-size:2.5em;cursor:pointer;justify-self:end}div:where(.swal2-container) button:where(.swal2-close):hover{transform:none;background:rgba(0,0,0,0);color:#f27474}div:where(.swal2-container) button:where(.swal2-close):focus{outline:none;box-shadow:inset 0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) button:where(.swal2-close)::-moz-focus-inner{border:0}div:where(.swal2-container) .swal2-html-container{z-index:1;justify-content:center;margin:1em 1.6em .3em;padding:0;overflow:auto;color:inherit;font-size:1.125em;font-weight:normal;line-height:normal;text-align:center;word-wrap:break-word;word-break:break-word}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea),div:where(.swal2-container) select:where(.swal2-select),div:where(.swal2-container) div:where(.swal2-radio),div:where(.swal2-container) label:where(.swal2-checkbox){margin:1em 2em 3px}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea){box-sizing:border-box;width:auto;transition:border-color .1s,box-shadow .1s;border:1px solid #d9d9d9;border-radius:.1875em;background:rgba(0,0,0,0);box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(0,0,0,0);color:inherit;font-size:1.125em}div:where(.swal2-container) input:where(.swal2-input).swal2-inputerror,div:where(.swal2-container) input:where(.swal2-file).swal2-inputerror,div:where(.swal2-container) textarea:where(.swal2-textarea).swal2-inputerror{border-color:#f27474 !important;box-shadow:0 0 2px #f27474 !important}div:where(.swal2-container) input:where(.swal2-input):focus,div:where(.swal2-container) input:where(.swal2-file):focus,div:where(.swal2-container) textarea:where(.swal2-textarea):focus{border:1px solid #b4dbed;outline:none;box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) input:where(.swal2-input)::placeholder,div:where(.swal2-container) input:where(.swal2-file)::placeholder,div:where(.swal2-container) textarea:where(.swal2-textarea)::placeholder{color:#ccc}div:where(.swal2-container) .swal2-range{margin:1em 2em 3px;background:#fff}div:where(.swal2-container) .swal2-range input{width:80%}div:where(.swal2-container) .swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}div:where(.swal2-container) .swal2-range input,div:where(.swal2-container) .swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}div:where(.swal2-container) .swal2-input{height:2.625em;padding:0 .75em}div:where(.swal2-container) .swal2-file{width:75%;margin-right:auto;margin-left:auto;background:rgba(0,0,0,0);font-size:1.125em}div:where(.swal2-container) .swal2-textarea{height:6.75em;padding:.75em}div:where(.swal2-container) .swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:rgba(0,0,0,0);color:inherit;font-size:1.125em}div:where(.swal2-container) .swal2-radio,div:where(.swal2-container) .swal2-checkbox{align-items:center;justify-content:center;background:#fff;color:inherit}div:where(.swal2-container) .swal2-radio label,div:where(.swal2-container) .swal2-checkbox label{margin:0 .6em;font-size:1.125em}div:where(.swal2-container) .swal2-radio input,div:where(.swal2-container) .swal2-checkbox input{flex-shrink:0;margin:0 .4em}div:where(.swal2-container) label:where(.swal2-input-label){display:flex;justify-content:center;margin:1em auto 0}div:where(.swal2-container) div:where(.swal2-validation-message){align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:#f0f0f0;color:#666;font-size:1em;font-weight:300}div:where(.swal2-container) div:where(.swal2-validation-message)::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}div:where(.swal2-container) .swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:rgba(0,0,0,0);font-weight:600}div:where(.swal2-container) .swal2-progress-steps li{display:inline-block;position:relative}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:#add8e6;color:#fff}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:#add8e6}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}div:where(.swal2-icon){position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;border:0.25em solid rgba(0,0,0,0);border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;user-select:none}div:where(.swal2-icon) .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}div:where(.swal2-icon).swal2-error{border-color:#f27474;color:#f27474}div:where(.swal2-icon).swal2-error .swal2-x-mark{position:relative;flex-grow:1}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-error.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-error.swal2-icon-show .swal2-x-mark{animation:swal2-animate-error-x-mark .5s}div:where(.swal2-icon).swal2-warning{border-color:#facea8;color:#f8bb86}div:where(.swal2-icon).swal2-warning.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-warning.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .5s}div:where(.swal2-icon).swal2-info{border-color:#9de0f6;color:#3fc3ee}div:where(.swal2-icon).swal2-info.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-info.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .8s}div:where(.swal2-icon).swal2-question{border-color:#c9dae1;color:#87adbd}div:where(.swal2-icon).swal2-question.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-question.swal2-icon-show .swal2-icon-content{animation:swal2-animate-question-mark .8s}div:where(.swal2-icon).swal2-success{border-color:#a5dc86;color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;border-radius:50%}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}div:where(.swal2-icon).swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-0.25em;left:-0.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}div:where(.swal2-icon).swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-animate-success-line-tip .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-animate-success-line-long .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-circular-line-right{animation:swal2-rotate-success-circular-line 4.25s ease-in}[class^=swal2]{-webkit-tap-highlight-color:rgba(0,0,0,0)}.swal2-show{animation:swal2-show .3s}.swal2-hide{animation:swal2-hide .15s forwards}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}@keyframes swal2-toast-show{0%{transform:translateY(-0.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(0.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0deg)}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-0.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}@keyframes swal2-show{0%{transform:scale(0.7)}45%{transform:scale(1.05)}80%{transform:scale(0.95)}100%{transform:scale(1)}}@keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(0.5);opacity:0}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-0.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(0.4);opacity:0}50%{margin-top:1.625em;transform:scale(0.4);opacity:0}80%{margin-top:-0.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0deg);opacity:1}}@keyframes swal2-rotate-loading{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto !important}body.swal2-no-backdrop .swal2-container{background-color:rgba(0,0,0,0) !important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px rgba(0,0,0,.4)}@media print{body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown){overflow-y:scroll !important}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown) .swal2-container{position:static !important}}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:rgba(0,0,0,0);pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{inset:0 auto auto 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{inset:0 0 auto auto}body.swal2-toast-shown .swal2-container.swal2-top-start,body.swal2-toast-shown .swal2-container.swal2-top-left{inset:0 auto auto 0}body.swal2-toast-shown .swal2-container.swal2-center-start,body.swal2-toast-shown .swal2-container.swal2-center-left{inset:50% auto auto 0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{inset:50% auto auto 50%;transform:translate(-50%, -50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{inset:50% 0 auto auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-start,body.swal2-toast-shown .swal2-container.swal2-bottom-left{inset:auto auto 0 0}body.swal2-toast-shown .swal2-container.swal2-bottom{inset:auto auto 0 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{inset:auto 0 0 auto}')}},kd=>{kd(kd.s=166)}]);